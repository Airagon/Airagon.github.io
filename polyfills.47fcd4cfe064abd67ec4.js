(self.webpackChunkthree60_rooms=self.webpackChunkthree60_rooms||[]).push([[429],{129:()=>{var xr,ko=AFRAME.utils.debug,oa=AFRAME.utils.coordinates,pa=ko("components:look-at:warn"),Ko=oa.isCoordinates||oa.isCoordinate;delete AFRAME.components["look-at"],AFRAME.registerComponent("look-at",{schema:{default:"0 0 0",parse:function(xr){return Ko(xr)||"object"==typeof xr?oa.parse(xr):xr},stringify:function(xr){return"object"==typeof xr?oa.stringify(xr):xr}},init:function(){this.target3D=null,this.vector=new THREE.Vector3,this.cameraListener=AFRAME.utils.bind(this.cameraListener,this),this.el.addEventListener("componentinitialized",this.cameraListener),this.el.addEventListener("componentremoved",this.cameraListener)},update:function(){var Is,xr=this,ks=xr.data;return!ks||"object"==typeof ks&&!Object.keys(ks).length?xr.remove():"object"==typeof ks?this.lookAt(new THREE.Vector3(ks.x,ks.y,ks.z)):(Is=xr.el.sceneEl.querySelector(ks))?Is.hasLoaded?xr.beginTracking(Is):Is.addEventListener("loaded",function(){xr.beginTracking(Is)}):void pa('"'+ks+'" does not point to a valid entity to look-at')},tick:(xr=new THREE.Vector3,function(ks){var Is=this.target3D;Is&&(Is.getWorldPosition(xr),this.lookAt(xr))}),remove:function(){this.el.removeEventListener("componentinitialized",this.cameraListener),this.el.removeEventListener("componentremoved",this.cameraListener)},beginTracking:function(xr){this.target3D=xr.object3D},cameraListener:function(xr){xr.detail&&"camera"===xr.detail.name&&this.update()},lookAt:function(xr){var ks=this.vector,Is=this.el.object3D;this.el.getObject3D("camera")?ks.subVectors(Is.position,xr).add(Is.position):ks.copy(xr),Is.lookAt(ks)}})},86:(ko,oa,pa)=>{var Ko=pa(52).default;ko.exports=function k(ae,Ue,b){function D(w,T){if(!Ue[w]){if(!ae[w]){if(B)return B(w,!0);var S=new Error("Cannot find module '"+w+"'");throw S.code="MODULE_NOT_FOUND",S}var y=Ue[w]={exports:{}};ae[w][0].call(y.exports,function(M){return D(ae[w][1][M]||M)},y,y.exports,k,ae,Ue,b)}return Ue[w].exports}for(var B=void 0,I=0;I<b.length;I++)D(b[I]);return D}({1:[function(k,ae,Ue){var b=Object.prototype.toString;ae.exports=function(B){return B.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===b.call(B.buffer)||Array.isArray(B)}},{}],2:[function(k,ae,Ue){ae.exports=function(D,B){return"number"==typeof D?D:"number"==typeof B?B:0}},{}],3:[function(k,ae,Ue){"use strict";Ue.byteLength=function(F){var O=x(F),Y=O[1];return 3*(O[0]+Y)/4-Y},Ue.toByteArray=function(F){for(var O,V=x(F),Y=V[0],ee=V[1],oe=new B(function(F,O,V){return 3*(O+V)/4-V}(0,Y,ee)),Ee=0,ve=ee>0?Y-4:Y,Ce=0;Ce<ve;Ce+=4)O=D[F.charCodeAt(Ce)]<<18|D[F.charCodeAt(Ce+1)]<<12|D[F.charCodeAt(Ce+2)]<<6|D[F.charCodeAt(Ce+3)],oe[Ee++]=O>>16&255,oe[Ee++]=O>>8&255,oe[Ee++]=255&O;return 2===ee&&(O=D[F.charCodeAt(Ce)]<<2|D[F.charCodeAt(Ce+1)]>>4,oe[Ee++]=255&O),1===ee&&(O=D[F.charCodeAt(Ce)]<<10|D[F.charCodeAt(Ce+1)]<<4|D[F.charCodeAt(Ce+2)]>>2,oe[Ee++]=O>>8&255,oe[Ee++]=255&O),oe},Ue.fromByteArray=function(F){for(var O,V=F.length,Y=V%3,ee=[],Ee=0,ve=V-Y;Ee<ve;Ee+=16383)ee.push(_(F,Ee,Ee+16383>ve?ve:Ee+16383));return 1===Y?ee.push(b[(O=F[V-1])>>2]+b[O<<4&63]+"=="):2===Y&&ee.push(b[(O=(F[V-2]<<8)+F[V-1])>>10]+b[O>>4&63]+b[O<<2&63]+"="),ee.join("")};for(var b=[],D=[],B="undefined"!=typeof Uint8Array?Uint8Array:Array,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=0,T=I.length;w<T;++w)b[w]=I[w],D[I.charCodeAt(w)]=w;function x(F){var O=F.length;if(O%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var V=F.indexOf("=");return-1===V&&(V=O),[V,V===O?0:4-V%4]}function E(F){return b[F>>18&63]+b[F>>12&63]+b[F>>6&63]+b[63&F]}function _(F,O,V){for(var ee=[],oe=O;oe<V;oe+=3)ee.push(E((F[oe]<<16&16711680)+(F[oe+1]<<8&65280)+(255&F[oe+2])));return ee.join("")}D["-".charCodeAt(0)]=62,D["_".charCodeAt(0)]=63},{}],4:[function(k,ae,Ue){"use strict";ae.exports={createLink:function(b,D){var B=document.head||document.getElementsByTagName("head")[0],I=document.createElement("link");for(var w in I.href=b,I.rel="stylesheet",D)D.hasOwnProperty(w)&&I.setAttribute("data-"+w,D[w]);B.appendChild(I)},createStyle:function(b,D){var B=document.head||document.getElementsByTagName("head")[0],I=document.createElement("style");for(var w in I.type="text/css",D)D.hasOwnProperty(w)&&I.setAttribute("data-"+w,D[w]);I.sheet?(I.innerHTML=b,I.sheet.cssText=b,B.appendChild(I)):I.styleSheet?(B.appendChild(I),I.styleSheet.cssText=b):(I.appendChild(document.createTextNode(b)),B.appendChild(I))}}},{}],5:[function(k,ae,Ue){var b=k("buffer").Buffer;ae.exports=function(D,B){if(b.isBuffer(D)&&b.isBuffer(B)){if("function"==typeof D.equals)return D.equals(B);if(D.length!==B.length)return!1;for(var I=0;I<D.length;I++)if(D[I]!==B[I])return!1;return!0}}},{buffer:6}],6:[function(k,ae,Ue){(function(b,D){"use strict";var B=k("base64-js"),I=k("ieee754"),w=k("isarray");function x(){return D.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function S(ie,W){if(x()<W)throw new RangeError("Invalid typed array length");return D.TYPED_ARRAY_SUPPORT?(ie=new Uint8Array(W)).__proto__=D.prototype:(null===ie&&(ie=new D(W)),ie.length=W),ie}function D(ie,W,H){if(!(D.TYPED_ARRAY_SUPPORT||this instanceof D))return new D(ie,W,H);if("number"==typeof ie){if("string"==typeof W)throw new Error("If encoding is specified then the first argument must be a string");return _(this,ie)}return y(this,ie,W,H)}function y(ie,W,H,de){if("number"==typeof W)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&W instanceof ArrayBuffer?function(ie,W,H,de){if(H<0||W.byteLength<H)throw new RangeError("'offset' is out of bounds");if(W.byteLength<H+(de||0))throw new RangeError("'length' is out of bounds");return W=void 0===H&&void 0===de?new Uint8Array(W):void 0===de?new Uint8Array(W,H):new Uint8Array(W,H,de),D.TYPED_ARRAY_SUPPORT?(ie=W).__proto__=D.prototype:ie=F(ie,W),ie}(ie,W,H,de):"string"==typeof W?function(ie,W,H){if(("string"!=typeof H||""===H)&&(H="utf8"),!D.isEncoding(H))throw new TypeError('"encoding" must be a valid string encoding');var de=0|oe(W,H),Pe=(ie=S(ie,de)).write(W,H);return Pe!==de&&(ie=ie.slice(0,Pe)),ie}(ie,W,H):function(ie,W){if(D.isBuffer(W)){var H=0|Y(W.length);return 0===(ie=S(ie,H)).length||W.copy(ie,0,0,H),ie}if(W){if("undefined"!=typeof ArrayBuffer&&W.buffer instanceof ArrayBuffer||"length"in W)return"number"!=typeof W.length||function(ie){return ie!=ie}(W.length)?S(ie,0):F(ie,W);if("Buffer"===W.type&&w(W.data))return F(ie,W.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(ie,W)}function M(ie){if("number"!=typeof ie)throw new TypeError('"size" argument must be a number');if(ie<0)throw new RangeError('"size" argument must not be negative')}function _(ie,W){if(M(W),ie=S(ie,W<0?0:0|Y(W)),!D.TYPED_ARRAY_SUPPORT)for(var H=0;H<W;++H)ie[H]=0;return ie}function F(ie,W){var H=W.length<0?0:0|Y(W.length);ie=S(ie,H);for(var de=0;de<H;de+=1)ie[de]=255&W[de];return ie}function Y(ie){if(ie>=x())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x().toString(16)+" bytes");return 0|ie}function oe(ie,W){if(D.isBuffer(ie))return ie.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(ie)||ie instanceof ArrayBuffer))return ie.byteLength;"string"!=typeof ie&&(ie=""+ie);var H=ie.length;if(0===H)return 0;for(var de=!1;;)switch(W){case"ascii":case"latin1":case"binary":return H;case"utf8":case"utf-8":case void 0:return cn(ie).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*H;case"hex":return H>>>1;case"base64":return Se(ie).length;default:if(de)return cn(ie).length;W=(""+W).toLowerCase(),de=!0}}function Ee(ie,W,H){var de=!1;if((void 0===W||W<0)&&(W=0),W>this.length||((void 0===H||H>this.length)&&(H=this.length),H<=0)||(H>>>=0)<=(W>>>=0))return"";for(ie||(ie="utf8");;)switch(ie){case"hex":return Dn(this,W,H);case"utf8":case"utf-8":return ht(this,W,H);case"ascii":return _n(this,W,H);case"latin1":case"binary":return kn(this,W,H);case"base64":return ft(this,W,H);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return vi(this,W,H);default:if(de)throw new TypeError("Unknown encoding: "+ie);ie=(ie+"").toLowerCase(),de=!0}}function ve(ie,W,H){var de=ie[W];ie[W]=ie[H],ie[H]=de}function Ce(ie,W,H,de,Pe){if(0===ie.length)return-1;if("string"==typeof H?(de=H,H=0):H>2147483647?H=2147483647:H<-2147483648&&(H=-2147483648),H=+H,isNaN(H)&&(H=Pe?0:ie.length-1),H<0&&(H=ie.length+H),H>=ie.length){if(Pe)return-1;H=ie.length-1}else if(H<0){if(!Pe)return-1;H=0}if("string"==typeof W&&(W=D.from(W,de)),D.isBuffer(W))return 0===W.length?-1:He(ie,W,H,de,Pe);if("number"==typeof W)return W&=255,D.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?Pe?Uint8Array.prototype.indexOf.call(ie,W,H):Uint8Array.prototype.lastIndexOf.call(ie,W,H):He(ie,[W],H,de,Pe);throw new TypeError("val must be string, number or Buffer")}function He(ie,W,H,de,Pe){var Tn,Ye=1,rt=ie.length,Dt=W.length;if(void 0!==de&&("ucs2"===(de=String(de).toLowerCase())||"ucs-2"===de||"utf16le"===de||"utf-16le"===de)){if(ie.length<2||W.length<2)return-1;Ye=2,rt/=2,Dt/=2,H/=2}function un(Nn,Pn){return 1===Ye?Nn[Pn]:Nn.readUInt16BE(Pn*Ye)}if(Pe){var dn=-1;for(Tn=H;Tn<rt;Tn++)if(un(ie,Tn)===un(W,-1===dn?0:Tn-dn)){if(-1===dn&&(dn=Tn),Tn-dn+1===Dt)return dn*Ye}else-1!==dn&&(Tn-=Tn-dn),dn=-1}else for(H+Dt>rt&&(H=rt-Dt),Tn=H;Tn>=0;Tn--){for(var rn=!0,On=0;On<Dt;On++)if(un(ie,Tn+On)!==un(W,On)){rn=!1;break}if(rn)return Tn}return-1}function we(ie,W,H,de){H=Number(H)||0;var Pe=ie.length-H;de?(de=Number(de))>Pe&&(de=Pe):de=Pe;var Ye=W.length;if(Ye%2!=0)throw new TypeError("Invalid hex string");de>Ye/2&&(de=Ye/2);for(var rt=0;rt<de;++rt){var Dt=parseInt(W.substr(2*rt,2),16);if(isNaN(Dt))return rt;ie[H+rt]=Dt}return rt}function ce(ie,W,H,de){return me(cn(W,ie.length-H),ie,H,de)}function Me(ie,W,H,de){return me(function(ie){for(var W=[],H=0;H<ie.length;++H)W.push(255&ie.charCodeAt(H));return W}(W),ie,H,de)}function fe(ie,W,H,de){return Me(ie,W,H,de)}function je(ie,W,H,de){return me(Se(W),ie,H,de)}function it(ie,W,H,de){return me(function(ie,W){for(var H,de,Ye=[],rt=0;rt<ie.length&&!((W-=2)<0);++rt)de=(H=ie.charCodeAt(rt))>>8,Ye.push(H%256),Ye.push(de);return Ye}(W,ie.length-H),ie,H,de)}function ft(ie,W,H){return B.fromByteArray(0===W&&H===ie.length?ie:ie.slice(W,H))}function ht(ie,W,H){H=Math.min(ie.length,H);for(var de=[],Pe=W;Pe<H;){var un,Tn,dn,rn,Ye=ie[Pe],rt=null,Dt=Ye>239?4:Ye>223?3:Ye>191?2:1;if(Pe+Dt<=H)switch(Dt){case 1:Ye<128&&(rt=Ye);break;case 2:128==(192&(un=ie[Pe+1]))&&(rn=(31&Ye)<<6|63&un)>127&&(rt=rn);break;case 3:Tn=ie[Pe+2],128==(192&(un=ie[Pe+1]))&&128==(192&Tn)&&(rn=(15&Ye)<<12|(63&un)<<6|63&Tn)>2047&&(rn<55296||rn>57343)&&(rt=rn);break;case 4:Tn=ie[Pe+2],dn=ie[Pe+3],128==(192&(un=ie[Pe+1]))&&128==(192&Tn)&&128==(192&dn)&&(rn=(15&Ye)<<18|(63&un)<<12|(63&Tn)<<6|63&dn)>65535&&rn<1114112&&(rt=rn)}null===rt?(rt=65533,Dt=1):rt>65535&&(de.push((rt-=65536)>>>10&1023|55296),rt=56320|1023&rt),de.push(rt),Pe+=Dt}return function(ie){var W=ie.length;if(W<=4096)return String.fromCharCode.apply(String,ie);for(var H="",de=0;de<W;)H+=String.fromCharCode.apply(String,ie.slice(de,de+=4096));return H}(de)}Ue.Buffer=D,Ue.SlowBuffer=function(ie){return+ie!=ie&&(ie=0),D.alloc(+ie)},Ue.INSPECT_MAX_BYTES=50,D.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:function(){try{var ie=new Uint8Array(1);return ie.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===ie.foo()&&"function"==typeof ie.subarray&&0===ie.subarray(1,1).byteLength}catch(W){return!1}}(),Ue.kMaxLength=x(),D.poolSize=8192,D._augment=function(ie){return ie.__proto__=D.prototype,ie},D.from=function(ie,W,H){return y(null,ie,W,H)},D.TYPED_ARRAY_SUPPORT&&(D.prototype.__proto__=Uint8Array.prototype,D.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&D[Symbol.species]===D&&Object.defineProperty(D,Symbol.species,{value:null,configurable:!0})),D.alloc=function(ie,W,H){return function(ie,W,H,de){return M(W),W<=0?S(ie,W):void 0!==H?"string"==typeof de?S(ie,W).fill(H,de):S(ie,W).fill(H):S(ie,W)}(null,ie,W,H)},D.allocUnsafe=function(ie){return _(null,ie)},D.allocUnsafeSlow=function(ie){return _(null,ie)},D.isBuffer=function(W){return!(null==W||!W._isBuffer)},D.compare=function(W,H){if(!D.isBuffer(W)||!D.isBuffer(H))throw new TypeError("Arguments must be Buffers");if(W===H)return 0;for(var de=W.length,Pe=H.length,Ye=0,rt=Math.min(de,Pe);Ye<rt;++Ye)if(W[Ye]!==H[Ye]){de=W[Ye],Pe=H[Ye];break}return de<Pe?-1:Pe<de?1:0},D.isEncoding=function(W){switch(String(W).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},D.concat=function(W,H){if(!w(W))throw new TypeError('"list" argument must be an Array of Buffers');if(0===W.length)return D.alloc(0);var de;if(void 0===H)for(H=0,de=0;de<W.length;++de)H+=W[de].length;var Pe=D.allocUnsafe(H),Ye=0;for(de=0;de<W.length;++de){var rt=W[de];if(!D.isBuffer(rt))throw new TypeError('"list" argument must be an Array of Buffers');rt.copy(Pe,Ye),Ye+=rt.length}return Pe},D.byteLength=oe,D.prototype._isBuffer=!0,D.prototype.swap16=function(){var W=this.length;if(W%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var H=0;H<W;H+=2)ve(this,H,H+1);return this},D.prototype.swap32=function(){var W=this.length;if(W%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var H=0;H<W;H+=4)ve(this,H,H+3),ve(this,H+1,H+2);return this},D.prototype.swap64=function(){var W=this.length;if(W%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var H=0;H<W;H+=8)ve(this,H,H+7),ve(this,H+1,H+6),ve(this,H+2,H+5),ve(this,H+3,H+4);return this},D.prototype.toString=function(){var W=0|this.length;return 0===W?"":0===arguments.length?ht(this,0,W):Ee.apply(this,arguments)},D.prototype.equals=function(W){if(!D.isBuffer(W))throw new TypeError("Argument must be a Buffer");return this===W||0===D.compare(this,W)},D.prototype.inspect=function(){var W="",H=Ue.INSPECT_MAX_BYTES;return this.length>0&&(W=this.toString("hex",0,H).match(/.{2}/g).join(" "),this.length>H&&(W+=" ... ")),"<Buffer "+W+">"},D.prototype.compare=function(W,H,de,Pe,Ye){if(!D.isBuffer(W))throw new TypeError("Argument must be a Buffer");if(void 0===H&&(H=0),void 0===de&&(de=W?W.length:0),void 0===Pe&&(Pe=0),void 0===Ye&&(Ye=this.length),H<0||de>W.length||Pe<0||Ye>this.length)throw new RangeError("out of range index");if(Pe>=Ye&&H>=de)return 0;if(Pe>=Ye)return-1;if(H>=de)return 1;if(this===W)return 0;for(var rt=(Ye>>>=0)-(Pe>>>=0),Dt=(de>>>=0)-(H>>>=0),un=Math.min(rt,Dt),Tn=this.slice(Pe,Ye),dn=W.slice(H,de),rn=0;rn<un;++rn)if(Tn[rn]!==dn[rn]){rt=Tn[rn],Dt=dn[rn];break}return rt<Dt?-1:Dt<rt?1:0},D.prototype.includes=function(W,H,de){return-1!==this.indexOf(W,H,de)},D.prototype.indexOf=function(W,H,de){return Ce(this,W,H,de,!0)},D.prototype.lastIndexOf=function(W,H,de){return Ce(this,W,H,de,!1)},D.prototype.write=function(W,H,de,Pe){if(void 0===H)Pe="utf8",de=this.length,H=0;else if(void 0===de&&"string"==typeof H)Pe=H,de=this.length,H=0;else{if(!isFinite(H))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");H|=0,isFinite(de)?(de|=0,void 0===Pe&&(Pe="utf8")):(Pe=de,de=void 0)}var Ye=this.length-H;if((void 0===de||de>Ye)&&(de=Ye),W.length>0&&(de<0||H<0)||H>this.length)throw new RangeError("Attempt to write outside buffer bounds");Pe||(Pe="utf8");for(var rt=!1;;)switch(Pe){case"hex":return we(this,W,H,de);case"utf8":case"utf-8":return ce(this,W,H,de);case"ascii":return Me(this,W,H,de);case"latin1":case"binary":return fe(this,W,H,de);case"base64":return je(this,W,H,de);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return it(this,W,H,de);default:if(rt)throw new TypeError("Unknown encoding: "+Pe);Pe=(""+Pe).toLowerCase(),rt=!0}},D.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _n(ie,W,H){var de="";H=Math.min(ie.length,H);for(var Pe=W;Pe<H;++Pe)de+=String.fromCharCode(127&ie[Pe]);return de}function kn(ie,W,H){var de="";H=Math.min(ie.length,H);for(var Pe=W;Pe<H;++Pe)de+=String.fromCharCode(ie[Pe]);return de}function Dn(ie,W,H){var de=ie.length;(!W||W<0)&&(W=0),(!H||H<0||H>de)&&(H=de);for(var Pe="",Ye=W;Ye<H;++Ye)Pe+=Es(ie[Ye]);return Pe}function vi(ie,W,H){for(var de=ie.slice(W,H),Pe="",Ye=0;Ye<de.length;Ye+=2)Pe+=String.fromCharCode(de[Ye]+256*de[Ye+1]);return Pe}function bn(ie,W,H){if(ie%1!=0||ie<0)throw new RangeError("offset is not uint");if(ie+W>H)throw new RangeError("Trying to access beyond buffer length")}function qn(ie,W,H,de,Pe,Ye){if(!D.isBuffer(ie))throw new TypeError('"buffer" argument must be a Buffer instance');if(W>Pe||W<Ye)throw new RangeError('"value" argument is out of bounds');if(H+de>ie.length)throw new RangeError("Index out of range")}function _r(ie,W,H,de){W<0&&(W=65535+W+1);for(var Pe=0,Ye=Math.min(ie.length-H,2);Pe<Ye;++Pe)ie[H+Pe]=(W&255<<8*(de?Pe:1-Pe))>>>8*(de?Pe:1-Pe)}function Zr(ie,W,H,de){W<0&&(W=4294967295+W+1);for(var Pe=0,Ye=Math.min(ie.length-H,4);Pe<Ye;++Pe)ie[H+Pe]=W>>>8*(de?Pe:3-Pe)&255}function Lr(ie,W,H,de,Pe,Ye){if(H+de>ie.length)throw new RangeError("Index out of range");if(H<0)throw new RangeError("Index out of range")}function kr(ie,W,H,de,Pe){return Pe||Lr(ie,0,H,4),I.write(ie,W,H,de,23,4),H+4}function bs(ie,W,H,de,Pe){return Pe||Lr(ie,0,H,8),I.write(ie,W,H,de,52,8),H+8}D.prototype.slice=function(W,H){var Pe,de=this.length;if((W=~~W)<0?(W+=de)<0&&(W=0):W>de&&(W=de),(H=void 0===H?de:~~H)<0?(H+=de)<0&&(H=0):H>de&&(H=de),H<W&&(H=W),D.TYPED_ARRAY_SUPPORT)(Pe=this.subarray(W,H)).__proto__=D.prototype;else{var Ye=H-W;Pe=new D(Ye,void 0);for(var rt=0;rt<Ye;++rt)Pe[rt]=this[rt+W]}return Pe},D.prototype.readUIntLE=function(W,H,de){W|=0,H|=0,de||bn(W,H,this.length);for(var Pe=this[W],Ye=1,rt=0;++rt<H&&(Ye*=256);)Pe+=this[W+rt]*Ye;return Pe},D.prototype.readUIntBE=function(W,H,de){W|=0,H|=0,de||bn(W,H,this.length);for(var Pe=this[W+--H],Ye=1;H>0&&(Ye*=256);)Pe+=this[W+--H]*Ye;return Pe},D.prototype.readUInt8=function(W,H){return H||bn(W,1,this.length),this[W]},D.prototype.readUInt16LE=function(W,H){return H||bn(W,2,this.length),this[W]|this[W+1]<<8},D.prototype.readUInt16BE=function(W,H){return H||bn(W,2,this.length),this[W]<<8|this[W+1]},D.prototype.readUInt32LE=function(W,H){return H||bn(W,4,this.length),(this[W]|this[W+1]<<8|this[W+2]<<16)+16777216*this[W+3]},D.prototype.readUInt32BE=function(W,H){return H||bn(W,4,this.length),16777216*this[W]+(this[W+1]<<16|this[W+2]<<8|this[W+3])},D.prototype.readIntLE=function(W,H,de){W|=0,H|=0,de||bn(W,H,this.length);for(var Pe=this[W],Ye=1,rt=0;++rt<H&&(Ye*=256);)Pe+=this[W+rt]*Ye;return Pe>=(Ye*=128)&&(Pe-=Math.pow(2,8*H)),Pe},D.prototype.readIntBE=function(W,H,de){W|=0,H|=0,de||bn(W,H,this.length);for(var Pe=H,Ye=1,rt=this[W+--Pe];Pe>0&&(Ye*=256);)rt+=this[W+--Pe]*Ye;return rt>=(Ye*=128)&&(rt-=Math.pow(2,8*H)),rt},D.prototype.readInt8=function(W,H){return H||bn(W,1,this.length),128&this[W]?-1*(255-this[W]+1):this[W]},D.prototype.readInt16LE=function(W,H){H||bn(W,2,this.length);var de=this[W]|this[W+1]<<8;return 32768&de?4294901760|de:de},D.prototype.readInt16BE=function(W,H){H||bn(W,2,this.length);var de=this[W+1]|this[W]<<8;return 32768&de?4294901760|de:de},D.prototype.readInt32LE=function(W,H){return H||bn(W,4,this.length),this[W]|this[W+1]<<8|this[W+2]<<16|this[W+3]<<24},D.prototype.readInt32BE=function(W,H){return H||bn(W,4,this.length),this[W]<<24|this[W+1]<<16|this[W+2]<<8|this[W+3]},D.prototype.readFloatLE=function(W,H){return H||bn(W,4,this.length),I.read(this,W,!0,23,4)},D.prototype.readFloatBE=function(W,H){return H||bn(W,4,this.length),I.read(this,W,!1,23,4)},D.prototype.readDoubleLE=function(W,H){return H||bn(W,8,this.length),I.read(this,W,!0,52,8)},D.prototype.readDoubleBE=function(W,H){return H||bn(W,8,this.length),I.read(this,W,!1,52,8)},D.prototype.writeUIntLE=function(W,H,de,Pe){W=+W,H|=0,de|=0,Pe||qn(this,W,H,de,Math.pow(2,8*de)-1,0);var rt=1,Dt=0;for(this[H]=255&W;++Dt<de&&(rt*=256);)this[H+Dt]=W/rt&255;return H+de},D.prototype.writeUIntBE=function(W,H,de,Pe){W=+W,H|=0,de|=0,Pe||qn(this,W,H,de,Math.pow(2,8*de)-1,0);var rt=de-1,Dt=1;for(this[H+rt]=255&W;--rt>=0&&(Dt*=256);)this[H+rt]=W/Dt&255;return H+de},D.prototype.writeUInt8=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,1,255,0),D.TYPED_ARRAY_SUPPORT||(W=Math.floor(W)),this[H]=255&W,H+1},D.prototype.writeUInt16LE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,2,65535,0),D.TYPED_ARRAY_SUPPORT?(this[H]=255&W,this[H+1]=W>>>8):_r(this,W,H,!0),H+2},D.prototype.writeUInt16BE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,2,65535,0),D.TYPED_ARRAY_SUPPORT?(this[H]=W>>>8,this[H+1]=255&W):_r(this,W,H,!1),H+2},D.prototype.writeUInt32LE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,4,4294967295,0),D.TYPED_ARRAY_SUPPORT?(this[H+3]=W>>>24,this[H+2]=W>>>16,this[H+1]=W>>>8,this[H]=255&W):Zr(this,W,H,!0),H+4},D.prototype.writeUInt32BE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,4,4294967295,0),D.TYPED_ARRAY_SUPPORT?(this[H]=W>>>24,this[H+1]=W>>>16,this[H+2]=W>>>8,this[H+3]=255&W):Zr(this,W,H,!1),H+4},D.prototype.writeIntLE=function(W,H,de,Pe){if(W=+W,H|=0,!Pe){var Ye=Math.pow(2,8*de-1);qn(this,W,H,de,Ye-1,-Ye)}var rt=0,Dt=1,un=0;for(this[H]=255&W;++rt<de&&(Dt*=256);)W<0&&0===un&&0!==this[H+rt-1]&&(un=1),this[H+rt]=(W/Dt>>0)-un&255;return H+de},D.prototype.writeIntBE=function(W,H,de,Pe){if(W=+W,H|=0,!Pe){var Ye=Math.pow(2,8*de-1);qn(this,W,H,de,Ye-1,-Ye)}var rt=de-1,Dt=1,un=0;for(this[H+rt]=255&W;--rt>=0&&(Dt*=256);)W<0&&0===un&&0!==this[H+rt+1]&&(un=1),this[H+rt]=(W/Dt>>0)-un&255;return H+de},D.prototype.writeInt8=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,1,127,-128),D.TYPED_ARRAY_SUPPORT||(W=Math.floor(W)),W<0&&(W=255+W+1),this[H]=255&W,H+1},D.prototype.writeInt16LE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,2,32767,-32768),D.TYPED_ARRAY_SUPPORT?(this[H]=255&W,this[H+1]=W>>>8):_r(this,W,H,!0),H+2},D.prototype.writeInt16BE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,2,32767,-32768),D.TYPED_ARRAY_SUPPORT?(this[H]=W>>>8,this[H+1]=255&W):_r(this,W,H,!1),H+2},D.prototype.writeInt32LE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,4,2147483647,-2147483648),D.TYPED_ARRAY_SUPPORT?(this[H]=255&W,this[H+1]=W>>>8,this[H+2]=W>>>16,this[H+3]=W>>>24):Zr(this,W,H,!0),H+4},D.prototype.writeInt32BE=function(W,H,de){return W=+W,H|=0,de||qn(this,W,H,4,2147483647,-2147483648),W<0&&(W=4294967295+W+1),D.TYPED_ARRAY_SUPPORT?(this[H]=W>>>24,this[H+1]=W>>>16,this[H+2]=W>>>8,this[H+3]=255&W):Zr(this,W,H,!1),H+4},D.prototype.writeFloatLE=function(W,H,de){return kr(this,W,H,!0,de)},D.prototype.writeFloatBE=function(W,H,de){return kr(this,W,H,!1,de)},D.prototype.writeDoubleLE=function(W,H,de){return bs(this,W,H,!0,de)},D.prototype.writeDoubleBE=function(W,H,de){return bs(this,W,H,!1,de)},D.prototype.copy=function(W,H,de,Pe){if(de||(de=0),!Pe&&0!==Pe&&(Pe=this.length),H>=W.length&&(H=W.length),H||(H=0),Pe>0&&Pe<de&&(Pe=de),Pe===de||0===W.length||0===this.length)return 0;if(H<0)throw new RangeError("targetStart out of bounds");if(de<0||de>=this.length)throw new RangeError("sourceStart out of bounds");if(Pe<0)throw new RangeError("sourceEnd out of bounds");Pe>this.length&&(Pe=this.length),W.length-H<Pe-de&&(Pe=W.length-H+de);var rt,Ye=Pe-de;if(this===W&&de<H&&H<Pe)for(rt=Ye-1;rt>=0;--rt)W[rt+H]=this[rt+de];else if(Ye<1e3||!D.TYPED_ARRAY_SUPPORT)for(rt=0;rt<Ye;++rt)W[rt+H]=this[rt+de];else Uint8Array.prototype.set.call(W,this.subarray(de,de+Ye),H);return Ye},D.prototype.fill=function(W,H,de,Pe){if("string"==typeof W){if("string"==typeof H?(Pe=H,H=0,de=this.length):"string"==typeof de&&(Pe=de,de=this.length),1===W.length){var Ye=W.charCodeAt(0);Ye<256&&(W=Ye)}if(void 0!==Pe&&"string"!=typeof Pe)throw new TypeError("encoding must be a string");if("string"==typeof Pe&&!D.isEncoding(Pe))throw new TypeError("Unknown encoding: "+Pe)}else"number"==typeof W&&(W&=255);if(H<0||this.length<H||this.length<de)throw new RangeError("Out of range index");if(de<=H)return this;var rt;if(H>>>=0,de=void 0===de?this.length:de>>>0,W||(W=0),"number"==typeof W)for(rt=H;rt<de;++rt)this[rt]=W;else{var Dt=D.isBuffer(W)?W:cn(new D(W,Pe).toString()),un=Dt.length;for(rt=0;rt<de-H;++rt)this[rt+H]=Dt[rt%un]}return this};var qr=/[^+\/0-9A-Za-z-_]/g;function Es(ie){return ie<16?"0"+ie.toString(16):ie.toString(16)}function cn(ie,W){W=W||1/0;for(var H,de=ie.length,Pe=null,Ye=[],rt=0;rt<de;++rt){if((H=ie.charCodeAt(rt))>55295&&H<57344){if(!Pe){if(H>56319){(W-=3)>-1&&Ye.push(239,191,189);continue}if(rt+1===de){(W-=3)>-1&&Ye.push(239,191,189);continue}Pe=H;continue}if(H<56320){(W-=3)>-1&&Ye.push(239,191,189),Pe=H;continue}H=65536+(Pe-55296<<10|H-56320)}else Pe&&(W-=3)>-1&&Ye.push(239,191,189);if(Pe=null,H<128){if((W-=1)<0)break;Ye.push(H)}else if(H<2048){if((W-=2)<0)break;Ye.push(H>>6|192,63&H|128)}else if(H<65536){if((W-=3)<0)break;Ye.push(H>>12|224,H>>6&63|128,63&H|128)}else{if(!(H<1114112))throw new Error("Invalid code point");if((W-=4)<0)break;Ye.push(H>>18|240,H>>12&63|128,H>>6&63|128,63&H|128)}}return Ye}function Se(ie){return B.toByteArray(function(ie){if((ie=function(ie){return ie.trim?ie.trim():ie.replace(/^\s+|\s+$/g,"")}(ie).replace(qr,"")).length<2)return"";for(;ie.length%4!=0;)ie+="=";return ie}(ie))}function me(ie,W,H,de){for(var Pe=0;Pe<de&&!(Pe+H>=W.length||Pe>=ie.length);++Pe)W[Pe+H]=ie[Pe];return Pe}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},k("buffer").Buffer)},{"base64-js":3,buffer:6,ieee754:29,isarray:35}],7:[function(k,ae,Ue){!function(){if("undefined"!=typeof window)try{var b=new window.CustomEvent("test",{cancelable:!0});if(b.preventDefault(),!0!==b.defaultPrevented)throw new Error("Could not prevent default")}catch(B){var D=function(I,w){var T,x;return(w=w||{}).bubbles=!!w.bubbles,w.cancelable=!!w.cancelable,(T=document.createEvent("CustomEvent")).initCustomEvent(I,w.bubbles,w.cancelable,w.detail),x=T.preventDefault,T.preventDefault=function(){x.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(S){this.defaultPrevented=!0}},T};D.prototype=window.Event.prototype,window.CustomEvent=D}}()},{}],8:[function(k,ae,Ue){function w(){var x;try{x=Ue.storage.debug}catch(S){}return x}(Ue=ae.exports=k("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},Ue.formatArgs=function(){var x=arguments,S=this.useColors;if(x[0]=(S?"%c":"")+this.namespace+(S?" %c":" ")+x[0]+(S?"%c ":" "),!S)return x;var y="color: "+this.color;x=[x[0],y,"color: inherit"].concat(Array.prototype.slice.call(x,1));var M=0,E=0;return x[0].replace(/%[a-z%]/g,function(_){"%%"!==_&&(M++,"%c"===_&&(E=M))}),x.splice(E,0,y),x},Ue.save=function(x){try{null==x?Ue.storage.removeItem("debug"):Ue.storage.debug=x}catch(S){}},Ue.load=w,Ue.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},Ue.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(x){}}(),Ue.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],Ue.formatters.j=function(x){return JSON.stringify(x)},Ue.enable(w())},{"./debug":9}],9:[function(k,ae,Ue){(Ue=ae.exports=function(S){function y(){}function M(){var _=M;null==_.useColors&&(_.useColors=Ue.useColors()),null==_.color&&_.useColors&&(_.color=D());var R=Array.prototype.slice.call(arguments);R[0]=Ue.coerce(R[0]),"string"!=typeof R[0]&&(R=["%o"].concat(R));var F=0;R[0]=R[0].replace(/%([a-z%])/g,function(V,Y){if("%%"===V)return V;F++;var ee=Ue.formatters[Y];return"function"==typeof ee&&(V=ee.call(_,R[F]),R.splice(F,1),F--),V}),"function"==typeof Ue.formatArgs&&(R=Ue.formatArgs.apply(_,R)),(M.log||Ue.log||console.log.bind(console)).apply(_,R)}y.enabled=!1,M.enabled=!0;var E=Ue.enabled(S)?M:y;return E.namespace=S,E}).coerce=function(S){return S instanceof Error?S.stack||S.message:S},Ue.disable=function(){Ue.enable("")},Ue.enable=function(S){Ue.save(S);for(var y=(S||"").split(/[\s,]+/),M=y.length,E=0;E<M;E++)!y[E]||("-"===(S=y[E].replace(/\*/g,".*?"))[0]?Ue.skips.push(new RegExp("^"+S.substr(1)+"$")):Ue.names.push(new RegExp("^"+S+"$")))},Ue.enabled=function(S){var y,M;for(y=0,M=Ue.skips.length;y<M;y++)if(Ue.skips[y].test(S))return!1;for(y=0,M=Ue.names.length;y<M;y++)if(Ue.names[y].test(S))return!0;return!1},Ue.names=[],Ue.skips=[],Ue.formatters={};var b=0;function D(){return Ue.colors[b++%Ue.colors.length]}},{}],10:[function(k,ae,Ue){"use strict";var b=k("is-obj"),D=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;function I(x){if(null==x)throw new TypeError("Sources cannot be null or undefined");return Object(x)}function w(x,S,y){var M=S[y];if(null!=M){if(D.call(x,y)&&null==x[y])throw new TypeError("Cannot convert undefined or null to object ("+y+")");x[y]=D.call(x,y)&&b(M)?T(Object(x[y]),S[y]):M}}function T(x,S){if(x===S)return x;for(var y in S=Object(S))D.call(S,y)&&w(x,S,y);if(Object.getOwnPropertySymbols)for(var M=Object.getOwnPropertySymbols(S),E=0;E<M.length;E++)B.call(S,M[E])&&w(x,S,M[E]);return x}ae.exports=function(S){S=I(S);for(var y=1;y<arguments.length;y++)T(S,arguments[y]);return S}},{"is-obj":34}],11:[function(k,ae,Ue){"use strict";var b=k("object-keys"),D="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),B=Object.prototype.toString,I=Array.prototype.concat,w=Object.defineProperty,S=w&&function(){var E={};try{for(var _ in w(E,"x",{enumerable:!1,value:E}),E)return!1;return E.x===E}catch(R){return!1}}(),y=function(E,_,R,F){_ in E&&(!function(E){return"function"==typeof E&&"[object Function]"===B.call(E)}(F)||!F())||(S?w(E,_,{configurable:!0,enumerable:!1,value:R,writable:!0}):E[_]=R)},M=function(E,_){var R=arguments.length>2?arguments[2]:{},F=b(_);D&&(F=I.call(F,Object.getOwnPropertySymbols(_)));for(var O=0;O<F.length;O+=1)y(E,F[O],_[F[O]],R[F[O]])};M.supportsDescriptors=!!S,ae.exports=M},{"object-keys":41}],12:[function(k,ae,Ue){!function(b,D,B,I){"use strict";function w(vt,Nt){for(var Lt=0,Fn=vt.length;Lt<Fn;Lt++)Y(vt[Lt],Nt)}function x(vt){return function(Nt){he(Nt)&&(Y(Nt,vt),w(Nt.querySelectorAll(_n),vt))}}function S(vt){var Nt=Re.call(vt,"is"),Lt=vt.nodeName.toUpperCase(),Fn=Dn.call(_t,Nt?it+Nt.toUpperCase():je+Lt);return Nt&&-1<Fn&&!y(Lt,Nt)?-1:Fn}function y(vt,Nt){return-1<_n.indexOf(vt+'[is="'+Nt+'"]')}function M(vt){var Nt=vt.currentTarget,Lt=vt.attrChange,Fn=vt.attrName,sn=vt.target;dn&&(!sn||sn===Nt)&&Nt.attributeChangedCallback&&"style"!==Fn&&vt.prevValue!==vt.newValue&&Nt.attributeChangedCallback(Fn,Lt===vt[Ce]?null:vt.prevValue,Lt===vt[we]?null:vt.newValue)}function E(vt){var Nt=x(vt);return function(Lt){Ye.push(Nt,Lt.target)}}function _(vt){Tn&&(Tn=!1,vt.currentTarget.removeEventListener(Me,_)),w((vt.target||D).querySelectorAll(_n),vt.detail===Ee?Ee:oe),le&&function(){for(var vt,Nt=0,Lt=Se.length;Nt<Lt;Nt++)kn.contains(vt=Se[Nt])||(Lt--,Se.splice(Nt--,1),Y(vt,Ee))}()}function R(vt,Nt){ie.call(this,vt,Nt),rn.call(this,{target:this})}function F(vt,Nt){Kr(vt,Nt),Pn?Pn.observe(vt,de):(un&&(vt.setAttribute=R,vt[ee]=Nn(vt),vt.addEventListener(fe,rn)),vt.addEventListener(ce,M)),vt.createdCallback&&dn&&(vt.created=!0,vt.createdCallback(),vt.created=!1)}function V(vt){throw new Error("A "+vt+" type is already registered")}function Y(vt,Nt){var Lt,Fn=S(vt);-1<Fn&&(Ar(vt,Bt[Fn]),Fn=0,Nt!==oe||vt[oe]?Nt===Ee&&!vt[Ee]&&(vt[oe]=!1,vt[Ee]=!0,Fn=1):(vt[Ee]=!1,vt[oe]=!0,Fn=1,le&&Dn.call(Se,vt)<0&&Se.push(vt)),Fn&&(Lt=vt[Nt+"Callback"])&&Lt.call(vt))}if(!(I in D)){var Ye,rn,On,Nn,Pn,Ar,di,ee="__"+I+(1e5*Math.random()>>0),oe="attached",Ee="detached",ve="extends",Ce="ADDITION",He="MODIFICATION",we="REMOVAL",ce="DOMAttrModified",Me="DOMContentLoaded",fe="DOMSubtreeModified",je="<",it="=",ft=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,ht=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],_t=[],Bt=[],_n="",kn=D.documentElement,Dn=_t.indexOf||function(vt){for(var Nt=this.length;Nt--&&this[Nt]!==vt;);return Nt},vi=B.prototype,bn=vi.hasOwnProperty,qn=vi.isPrototypeOf,_r=B.defineProperty,Zr=B.getOwnPropertyDescriptor,Lr=B.getOwnPropertyNames,kr=B.getPrototypeOf,bs=B.setPrototypeOf,qr=!!B.__proto__,cr=B.create||function vt(Nt){return Nt?(vt.prototype=Nt,new vt):this},Kr=bs||(qr?function(vt,Nt){return vt.__proto__=Nt,vt}:Lr&&Zr?function(){function vt(Nt,Lt){for(var Fn,sn=Lr(Lt),Sn=0,En=sn.length;Sn<En;Sn++)bn.call(Nt,Fn=sn[Sn])||_r(Nt,Fn,Zr(Lt,Fn))}return function(Nt,Lt){do{vt(Nt,Lt)}while((Lt=kr(Lt))&&!qn.call(Lt,Nt));return Nt}}():function(vt,Nt){for(var Lt in Nt)vt[Lt]=Nt[Lt];return vt}),Es=b.MutationObserver||b.WebKitMutationObserver,cn=(b.HTMLElement||b.Element||b.Node).prototype,le=!qn.call(cn,kn),he=le?function(vt){return 1===vt.nodeType}:function(vt){return qn.call(cn,vt)},Se=le&&[],me=cn.cloneNode,Re=cn.getAttribute,ie=cn.setAttribute,W=cn.removeAttribute,H=D.createElement,de=Es&&{attributes:!0,characterData:!0,attributeOldValue:!0},Pe=Es||function(vt){un=!1,kn.removeEventListener(ce,Pe)},rt=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.msRequestAnimationFrame||function(vt){setTimeout(vt,10)},Dt=!1,un=!0,Tn=!0,dn=!0;bs||qr?(Ar=function(vt,Nt){qn.call(Nt,vt)||F(vt,Nt)},di=F):di=Ar=function(vt,Nt){vt[ee]||(vt[ee]=B(!0),F(vt,Nt))},le?(un=!1,vt=Zr(cn,"addEventListener"),Nt=vt.value,Lt=function(Sn){var En=new CustomEvent(ce,{bubbles:!0});En.attrName=Sn,En.prevValue=Re.call(this,Sn),En.newValue=null,En[we]=En.attrChange=2,W.call(this,Sn),this.dispatchEvent(En)},Fn=function(Sn,En){var Ei=this.hasAttribute(Sn),Zi=Ei&&Re.call(this,Sn);e=new CustomEvent(ce,{bubbles:!0}),ie.call(this,Sn,En),e.attrName=Sn,e.prevValue=Ei?Zi:null,e.newValue=En,Ei?e[He]=e.attrChange=1:e[Ce]=e.attrChange=0,this.dispatchEvent(e)},sn=function(Sn){var wi,En=Sn.currentTarget,Ei=En[ee],Zi=Sn.propertyName;Ei.hasOwnProperty(Zi)&&(Ei=Ei[Zi],(wi=new CustomEvent(ce,{bubbles:!0})).attrName=Ei.name,wi.prevValue=Ei.value||null,wi.newValue=Ei.value=En[Zi]||null,null==wi.prevValue?wi[Ce]=wi.attrChange=0:wi[He]=wi.attrChange=1,En.dispatchEvent(wi))},vt.value=function(Sn,En,Ei){Sn===ce&&this.attributeChangedCallback&&this.setAttribute!==Fn&&(this[ee]={className:{name:"class",value:this.className}},this.setAttribute=Fn,this.removeAttribute=Lt,Nt.call(this,"propertychange",sn)),Nt.call(this,Sn,En,Ei)},_r(cn,"addEventListener",vt)):Es||(kn.addEventListener(ce,Pe),kn.setAttribute(ee,1),kn.removeAttribute(ee),un&&(rn=function(vt){var Lt,Fn,sn,Nt=this;if(Nt===vt.target){for(sn in Lt=Nt[ee],Nt[ee]=Fn=Nn(Nt),Fn){if(!(sn in Lt))return On(0,Nt,sn,Lt[sn],Fn[sn],Ce);if(Fn[sn]!==Lt[sn])return On(1,Nt,sn,Lt[sn],Fn[sn],He)}for(sn in Lt)if(!(sn in Fn))return On(2,Nt,sn,Lt[sn],Fn[sn],we)}},On=function(vt,Nt,Lt,Fn,sn,Sn){var En={attrChange:vt,currentTarget:Nt,attrName:Lt,prevValue:Fn,newValue:sn};En[Sn]=vt,M(En)},Nn=function(vt){for(var Nt,Lt,Fn={},sn=vt.attributes,Sn=0,En=sn.length;Sn<En;Sn++)"setAttribute"!==(Lt=(Nt=sn[Sn]).name)&&(Fn[Lt]=Nt.value);return Fn})),D[I]=function(vt,Nt){if(En=vt.toUpperCase(),Dt||(Dt=!0,Es?(Pn=function(Zi,wi){function ur(Xi,Oi){for(var qi=0,er=Xi.length;qi<er;Oi(Xi[qi++]));}return new Es(function(Xi){for(var Oi,qi,er,Un=0,$e=Xi.length;Un<$e;Un++)"childList"===(Oi=Xi[Un]).type?(ur(Oi.addedNodes,Zi),ur(Oi.removedNodes,wi)):(qi=Oi.target,dn&&qi.attributeChangedCallback&&"style"!==Oi.attributeName&&(er=Re.call(qi,Oi.attributeName))!==Oi.oldValue&&qi.attributeChangedCallback(Oi.attributeName,Oi.oldValue,er))})}(x(oe),x(Ee))).observe(D,{childList:!0,subtree:!0}):(Ye=[],rt(function Zi(){for(;Ye.length;)Ye.shift().call(null,Ye.shift());rt(Zi)}),D.addEventListener("DOMNodeInserted",E(oe)),D.addEventListener("DOMNodeRemoved",E(Ee))),D.addEventListener(Me,_),D.addEventListener("readystatechange",_),D.createElement=function(Zi,wi){var ur=H.apply(D,arguments),Xi=""+Zi,Oi=Dn.call(_t,(wi?it:je)+(wi||Xi).toUpperCase()),qi=-1<Oi;return wi&&(ur.setAttribute("is",wi=wi.toLowerCase()),qi&&(qi=y(Xi.toUpperCase(),wi))),dn=!D.createElement.innerHTMLHelper,qi&&di(ur,Bt[Oi]),ur},cn.cloneNode=function(Zi){var wi=me.call(this,!!Zi),ur=S(wi);return-1<ur&&di(wi,Bt[ur]),Zi&&function(vt){for(var Fn,Nt=0,Lt=vt.length;Nt<Lt;Nt++)di(Fn=vt[Nt],Bt[S(Fn)])}(wi.querySelectorAll(_n)),wi}),-2<Dn.call(_t,it+En)+Dn.call(_t,je+En)&&V(vt),!ft.test(En)||-1<Dn.call(ht,En))throw new Error("The type "+vt+" is invalid");var En,Ei,Lt=function(){return sn?D.createElement(Sn,En):D.createElement(Sn)},Fn=Nt||vi,sn=bn.call(Fn,ve),Sn=sn?Nt[ve].toUpperCase():En;return sn&&-1<Dn.call(_t,je+Sn)&&V(Sn),Ei=_t.push((sn?it:je)+En)-1,_n=_n.concat(_n.length?",":"",sn?Sn+'[is="'+vt.toLowerCase()+'"]':Sn),Lt.prototype=Bt[Ei]=bn.call(Fn,"prototype")?Fn.prototype:cr(cn),w(D.querySelectorAll(_n),oe),Lt}}var vt,Nt,Lt,Fn,sn}(window,document,Object,"registerElement")},{}],13:[function(k,ae,Ue){ae.exports=function(b){switch(b){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],14:[function(k,ae,Ue){"use strict";var b,D=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,I=Object.getPrototypeOf||function(F){return F.__proto__},T=b,S=b,M=b,E=b,_="undefined"==typeof Uint8Array?b:I(Uint8Array),R={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?b:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?b:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":B?I([][Symbol.iterator]()):b,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":b,"$ %AsyncFunction%":S,"$ %AsyncFunctionPrototype%":b,"$ %AsyncGenerator%":b,"$ %AsyncGeneratorFunction%":M,"$ %AsyncGeneratorPrototype%":b,"$ %AsyncIteratorPrototype%":E&&B&&Symbol.asyncIterator?E[Symbol.asyncIterator]():b,"$ %Atomics%":"undefined"==typeof Atomics?b:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?b:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?b:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?b:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?b:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?b:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?b:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":b,"$ %GeneratorFunction%":T,"$ %GeneratorPrototype%":b,"$ %Int8Array%":"undefined"==typeof Int8Array?b:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?b:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?b:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?b:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?b:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?b:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":B?I(I([][Symbol.iterator]())):b,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?b:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&B?I((new Map)[Symbol.iterator]()):b,"$ %MapPrototype%":"undefined"==typeof Map?b:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?b:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?b:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?b:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?b:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?b:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?b:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?b:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?b:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?b:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&B?I((new Set)[Symbol.iterator]()):b,"$ %SetPrototype%":"undefined"==typeof Set?b:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?b:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?b:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":B?I(""[Symbol.iterator]()):b,"$ %StringPrototype%":String.prototype,"$ %Symbol%":B?Symbol:b,"$ %SymbolPrototype%":B?Symbol.prototype:b,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":D,"$ %TypedArray%":_,"$ %TypedArrayPrototype%":_?_.prototype:b,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?b:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?b:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?b:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?b:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?b:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?b:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?b:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?b:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?b:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?b:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?b:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?b:WeakSet.prototype};ae.exports=function(O,V){if(arguments.length>1&&"boolean"!=typeof V)throw new TypeError('"allowMissing" argument must be a boolean');var Y="$ "+O;if(!(Y in R))throw new SyntaxError("intrinsic "+O+" does not exist!");if(void 0===R[Y]&&!V)throw new TypeError("intrinsic "+O+" exists, but is not available. Please file an issue!");return R[Y]}},{}],15:[function(k,ae,Ue){"use strict";var b=k("./GetIntrinsic"),D=b("%Object%"),B=b("%TypeError%"),I=b("%String%"),w=k("./helpers/assertRecord"),T=k("./helpers/isNaN"),x=k("./helpers/isFinite"),S=k("./helpers/sign"),y=k("./helpers/mod"),M=k("is-callable"),E=k("es-to-primitive/es5"),_=k("has");ae.exports={ToPrimitive:E,ToBoolean:function(O){return!!O},ToNumber:function(O){return+O},ToInteger:function(O){var V=this.ToNumber(O);return T(V)?0:0!==V&&x(V)?S(V)*Math.floor(Math.abs(V)):V},ToInt32:function(O){return this.ToNumber(O)>>0},ToUint32:function(O){return this.ToNumber(O)>>>0},ToUint16:function(O){var V=this.ToNumber(O);if(T(V)||0===V||!x(V))return 0;var Y=S(V)*Math.floor(Math.abs(V));return y(Y,65536)},ToString:function(O){return I(O)},ToObject:function(O){return this.CheckObjectCoercible(O),D(O)},CheckObjectCoercible:function(O,V){if(null==O)throw new B(V||"Cannot call method on "+O);return O},IsCallable:M,SameValue:function(O,V){return O===V?0!==O||1/O==1/V:T(O)&&T(V)},Type:function(O){return null===O?"Null":void 0===O?"Undefined":"function"==typeof O||"object"==typeof O?"Object":"number"==typeof O?"Number":"boolean"==typeof O?"Boolean":"string"==typeof O?"String":void 0},IsPropertyDescriptor:function(O){if("Object"!==this.Type(O))return!1;var V={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var Y in O)if(_(O,Y)&&!V[Y])return!1;var ee=_(O,"[[Value]]"),oe=_(O,"[[Get]]")||_(O,"[[Set]]");if(ee&&oe)throw new B("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(O){return!(void 0===O||(w(this,"Property Descriptor","Desc",O),!_(O,"[[Get]]")&&!_(O,"[[Set]]")))},IsDataDescriptor:function(O){return!(void 0===O||(w(this,"Property Descriptor","Desc",O),!_(O,"[[Value]]")&&!_(O,"[[Writable]]")))},IsGenericDescriptor:function(O){return void 0!==O&&(w(this,"Property Descriptor","Desc",O),!this.IsAccessorDescriptor(O)&&!this.IsDataDescriptor(O))},FromPropertyDescriptor:function(O){if(void 0===O)return O;if(w(this,"Property Descriptor","Desc",O),this.IsDataDescriptor(O))return{value:O["[[Value]]"],writable:!!O["[[Writable]]"],enumerable:!!O["[[Enumerable]]"],configurable:!!O["[[Configurable]]"]};if(this.IsAccessorDescriptor(O))return{get:O["[[Get]]"],set:O["[[Set]]"],enumerable:!!O["[[Enumerable]]"],configurable:!!O["[[Configurable]]"]};throw new B("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(O){if("Object"!==this.Type(O))throw new B("ToPropertyDescriptor requires an object");var V={};if(_(O,"enumerable")&&(V["[[Enumerable]]"]=this.ToBoolean(O.enumerable)),_(O,"configurable")&&(V["[[Configurable]]"]=this.ToBoolean(O.configurable)),_(O,"value")&&(V["[[Value]]"]=O.value),_(O,"writable")&&(V["[[Writable]]"]=this.ToBoolean(O.writable)),_(O,"get")){var Y=O.get;if(void 0!==Y&&!this.IsCallable(Y))throw new TypeError("getter must be a function");V["[[Get]]"]=Y}if(_(O,"set")){var ee=O.set;if(void 0!==ee&&!this.IsCallable(ee))throw new B("setter must be a function");V["[[Set]]"]=ee}if((_(V,"[[Get]]")||_(V,"[[Set]]"))&&(_(V,"[[Value]]")||_(V,"[[Writable]]")))throw new B("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return V}}},{"./GetIntrinsic":14,"./helpers/assertRecord":16,"./helpers/isFinite":17,"./helpers/isNaN":18,"./helpers/mod":19,"./helpers/sign":20,"es-to-primitive/es5":21,has:28,"is-callable":32}],16:[function(k,ae,Ue){"use strict";var b=k("../GetIntrinsic"),D=b("%TypeError%"),B=b("%SyntaxError%"),I=k("has"),w={"Property Descriptor":function(x,S){if("Object"!==x.Type(S))return!1;var y={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var M in S)if(I(S,M)&&!y[M])return!1;var E=I(S,"[[Value]]"),_=I(S,"[[Get]]")||I(S,"[[Set]]");if(E&&_)throw new D("Property Descriptors may not be both accessor and data descriptors");return!0}};ae.exports=function(x,S,y,M){var E=w[S];if("function"!=typeof E)throw new B("unknown record type: "+S);if(!E(x,M))throw new D(y+" must be a "+S);console.log(E(x,M),M)}},{"../GetIntrinsic":14,has:28}],17:[function(k,ae,Ue){var b=Number.isNaN||function(D){return D!=D};ae.exports=Number.isFinite||function(D){return"number"==typeof D&&!b(D)&&D!==1/0&&D!==-1/0}},{}],18:[function(k,ae,Ue){ae.exports=Number.isNaN||function(D){return D!=D}},{}],19:[function(k,ae,Ue){ae.exports=function(D,B){var I=D%B;return Math.floor(I>=0?I:I+B)}},{}],20:[function(k,ae,Ue){ae.exports=function(D){return D>=0?1:-1}},{}],21:[function(k,ae,Ue){"use strict";var b=Object.prototype.toString,D=k("./helpers/isPrimitive"),B=k("is-callable"),I___DefaultValue__=function(w){var T;if((T=arguments.length>1?arguments[1]:"[object Date]"===b.call(w)?String:Number)===String||T===Number){var S,y,x=T===String?["toString","valueOf"]:["valueOf","toString"];for(y=0;y<x.length;++y)if(B(w[x[y]])&&(S=w[x[y]](),D(S)))return S;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};ae.exports=function(T){return D(T)?T:arguments.length>1?I___DefaultValue__(T,arguments[1]):I___DefaultValue__(T)}},{"./helpers/isPrimitive":22,"is-callable":32}],22:[function(k,ae,Ue){ae.exports=function(D){return null===D||"function"!=typeof D&&"object"!=typeof D}},{}],23:[function(k,ae,Ue){var b=k("dtype");ae.exports=function(B,I,w){if(!B)throw new TypeError("must specify data as first parameter");if(w=0|+(w||0),Array.isArray(B)&&B[0]&&"number"==typeof B[0][0]){var S,y,M,E,T=B[0].length,x=B.length*T;(!I||"string"==typeof I)&&(I=new(b(I||"float32"))(x+w));var _=I.length-w;if(x!==_)throw new Error("source length "+x+" ("+T+"x"+B.length+") does not match destination length "+_);for(S=0,M=w;S<B.length;S++)for(y=0;y<T;y++)I[M++]=null===B[S][y]?NaN:B[S][y]}else if(I&&"string"!=typeof I)I.set(B,w);else{var R=b(I||"float32");if(Array.isArray(B)||"array"===I)for(S=0,M=w,E=(I=new R(B.length+w)).length;M<E;M++,S++)I[M]=null===B[S]?NaN:B[S];else 0===w?I=new R(B):(I=new R(B.length+w)).set(B,w)}return I}},{dtype:13}],24:[function(k,ae,Ue){"use strict";var b=k("is-callable"),D=Object.prototype.toString,B=Object.prototype.hasOwnProperty,I=function(y,M,E){for(var _=0,R=y.length;_<R;_++)B.call(y,_)&&(null==E?M(y[_],_,y):M.call(E,y[_],_,y))},w=function(y,M,E){for(var _=0,R=y.length;_<R;_++)null==E?M(y.charAt(_),_,y):M.call(E,y.charAt(_),_,y)},T=function(y,M,E){for(var _ in y)B.call(y,_)&&(null==E?M(y[_],_,y):M.call(E,y[_],_,y))};ae.exports=function(y,M,E){if(!b(M))throw new TypeError("iterator must be a function");var _;arguments.length>=3&&(_=E),"[object Array]"===D.call(y)?I(y,M,_):"string"==typeof y?w(y,M,_):T(y,M,_)}},{"is-callable":32}],25:[function(k,ae,Ue){"use strict";var b="Function.prototype.bind called on incompatible ",D=Array.prototype.slice,B=Object.prototype.toString,I="[object Function]";ae.exports=function(T){var x=this;if("function"!=typeof x||B.call(x)!==I)throw new TypeError(b+x);for(var y,S=D.call(arguments,1),M=function(){if(this instanceof y){var O=x.apply(this,S.concat(D.call(arguments)));return Object(O)===O?O:this}return x.apply(T,S.concat(D.call(arguments)))},E=Math.max(0,x.length-S.length),_=[],R=0;R<E;R++)_.push("$"+R);if(y=Function("binder","return function ("+_.join(",")+"){ return binder.apply(this,arguments); }")(M),x.prototype){var F=function(){};F.prototype=x.prototype,y.prototype=new F,F.prototype=null}return y}},{}],26:[function(k,ae,Ue){"use strict";var b=k("./implementation");ae.exports=Function.prototype.bind||b},{"./implementation":25}],27:[function(k,ae,Ue){(function(b){var D;D="undefined"!=typeof window?window:void 0!==b?b:"undefined"!=typeof self?self:{},ae.exports=D}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(k,ae,Ue){"use strict";var b=k("function-bind");ae.exports=b.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":26}],29:[function(k,ae,Ue){Ue.read=function(b,D,B,I,w){var T,x,S=8*w-I-1,y=(1<<S)-1,M=y>>1,E=-7,_=B?w-1:0,R=B?-1:1,F=b[D+_];for(_+=R,T=F&(1<<-E)-1,F>>=-E,E+=S;E>0;T=256*T+b[D+_],_+=R,E-=8);for(x=T&(1<<-E)-1,T>>=-E,E+=I;E>0;x=256*x+b[D+_],_+=R,E-=8);if(0===T)T=1-M;else{if(T===y)return x?NaN:1/0*(F?-1:1);x+=Math.pow(2,I),T-=M}return(F?-1:1)*x*Math.pow(2,T-I)},Ue.write=function(b,D,B,I,w,T){var x,S,y,M=8*T-w-1,E=(1<<M)-1,_=E>>1,R=23===w?Math.pow(2,-24)-Math.pow(2,-77):0,F=I?0:T-1,O=I?1:-1,V=D<0||0===D&&1/D<0?1:0;for(D=Math.abs(D),isNaN(D)||D===1/0?(S=isNaN(D)?1:0,x=E):(x=Math.floor(Math.log(D)/Math.LN2),D*(y=Math.pow(2,-x))<1&&(x--,y*=2),(D+=x+_>=1?R/y:R*Math.pow(2,1-_))*y>=2&&(x++,y/=2),x+_>=E?(S=0,x=E):x+_>=1?(S=(D*y-1)*Math.pow(2,w),x+=_):(S=D*Math.pow(2,_-1)*Math.pow(2,w),x=0));w>=8;b[B+F]=255&S,F+=O,S/=256,w-=8);for(x=x<<w|S,M+=w;M>0;b[B+F]=255&x,F+=O,x/=256,M-=8);b[B+F-O]|=128*V}},{}],30:[function(k,ae,Ue){ae.exports="function"==typeof Object.create?function(D,B){B&&(D.super_=B,D.prototype=Object.create(B.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}))}:function(D,B){if(B){D.super_=B;var I=function(){};I.prototype=B.prototype,D.prototype=new I,D.prototype.constructor=D}}},{}],31:[function(k,ae,Ue){function b(B){return!!B.constructor&&"function"==typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}ae.exports=function(B){return null!=B&&(b(B)||function(B){return"function"==typeof B.readFloatLE&&"function"==typeof B.slice&&b(B.slice(0,0))}(B)||!!B._isBuffer)}},{}],32:[function(k,ae,Ue){"use strict";var b=Function.prototype.toString,D=/^\s*class\b/,B=function(M){try{var E=b.call(M);return D.test(E)}catch(_){return!1}},w=Object.prototype.toString,S="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;ae.exports=function(M){if(!M||"function"!=typeof M&&"object"!=typeof M)return!1;if("function"==typeof M&&!M.prototype)return!0;if(S)return function(M){try{return!B(M)&&(b.call(M),!0)}catch(E){return!1}}(M);if(B(M))return!1;var E=w.call(M);return"[object Function]"===E||"[object GeneratorFunction]"===E}},{}],33:[function(k,ae,Ue){ae.exports=function(B){var I=b.call(B);return"[object Function]"===I||"function"==typeof B&&"[object RegExp]"!==I||"undefined"!=typeof window&&(B===window.setTimeout||B===window.alert||B===window.confirm||B===window.prompt)};var b=Object.prototype.toString},{}],34:[function(k,ae,Ue){"use strict";ae.exports=function(b){var D=typeof b;return null!==b&&("object"===D||"function"===D)}},{}],35:[function(k,ae,Ue){var b={}.toString;ae.exports=Array.isArray||function(D){return"[object Array]"==b.call(D)}},{}],36:[function(k,ae,Ue){var b=k("word-wrapper"),D=k("xtend"),B=k("as-number"),I=["x","e","a","o","n","s","r","c","u","m","v","w","z"],w=["m","w"],T=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],x="\t".charCodeAt(0),S=" ".charCodeAt(0);function _(Ce){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(Ce)}function F(Ce){return new Function(["return function "+Ce+"() {","  return this._"+Ce,"}"].join("\n"))()}function O(Ce,He){if(!Ce.chars||0===Ce.chars.length)return null;var we=ve(Ce.chars,He);return we>=0?Ce.chars[we]:null}function oe(Ce,He,we){if(!Ce.kernings||0===Ce.kernings.length)return 0;for(var ce=Ce.kernings,Me=0;Me<ce.length;Me++){var fe=ce[Me];if(fe.first===He&&fe.second===we)return fe.amount}return 0}function ve(Ce,He,we){for(var ce=we=we||0;ce<Ce.length;ce++)if(Ce[ce].id===He)return ce;return-1}ae.exports=function(He){return new _(He)},_.prototype.update=function(Ce){if(Ce=D({measure:this._measure},Ce),this._opt=Ce,this._opt.tabSize=B(this._opt.tabSize,4),!Ce.font)throw new Error("must provide a valid bitmap font");var He=this.glyphs,we=Ce.text||"",ce=Ce.font;this._setupSpaceGlyphs(ce);var Me=b.lines(we,Ce),fe=Ce.width||0;He.length=0;var je=Me.reduce(function(bn,qn){return Math.max(bn,qn.width,fe)},0),it=0,ft=0,ht=B(Ce.lineHeight,ce.common.lineHeight),_t=ce.common.base,Bt=ht-_t,_n=Ce.letterSpacing||0,kn=ht*Me.length-Bt,Dn=function(Ce){return"center"===Ce?1:"right"===Ce?2:0}(this._opt.align);ft-=kn,this._width=je,this._height=kn,this._descender=ht-_t,this._baseline=_t,this._xHeight=function(Ce){for(var He=0;He<I.length;He++){var we=I[He].charCodeAt(0),ce=ve(Ce.chars,we);if(ce>=0)return Ce.chars[ce].height}return 0}(ce),this._capHeight=function(Ce){for(var He=0;He<T.length;He++){var we=T[He].charCodeAt(0),ce=ve(Ce.chars,we);if(ce>=0)return Ce.chars[ce].height}return 0}(ce),this._lineHeight=ht,this._ascender=ht-Bt-this._xHeight;var vi=this;Me.forEach(function(bn,qn){for(var kr,Zr=bn.end,Lr=bn.width,bs=bn.start;bs<Zr;bs++){var qr=we.charCodeAt(bs),cr=vi.getGlyph(ce,qr);if(cr){kr&&(it+=oe(ce,kr.id,cr.id));var Kr=it;1===Dn?Kr+=(je-Lr)/2:2===Dn&&(Kr+=je-Lr),He.push({position:[Kr,ft],data:cr,index:bs,line:qn}),it+=cr.xadvance+_n,kr=cr}}ft+=ht,it=0}),this._linesTotal=Me.length},_.prototype._setupSpaceGlyphs=function(Ce){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,Ce.chars&&0!==Ce.chars.length){var He=O(Ce,S)||function(Ce){for(var He=0;He<w.length;He++){var we=w[He].charCodeAt(0),ce=ve(Ce.chars,we);if(ce>=0)return Ce.chars[ce]}return 0}(Ce)||Ce.chars[0],we=this._opt.tabSize*He.xadvance;this._fallbackSpaceGlyph=He,this._fallbackTabGlyph=D(He,{x:0,y:0,xadvance:we,id:x,xoffset:0,yoffset:0,width:0,height:0})}},_.prototype.getGlyph=function(Ce,He){return O(Ce,He)||(He===x?this._fallbackTabGlyph:He===S?this._fallbackSpaceGlyph:null)},_.prototype.computeMetrics=function(Ce,He,we,ce){var _t,Me=this._opt.letterSpacing||0,fe=this._opt.font,je=0,it=0,ft=0;if(!fe.chars||0===fe.chars.length)return{start:He,end:He,width:0};we=Math.min(Ce.length,we);for(var Bt=He;Bt<we;Bt++){var ht,_n=Ce.charCodeAt(Bt);if(ht=this.getGlyph(fe,_n)){var vi=(je+=_t?oe(fe,_t.id,ht.id):0)+ht.xadvance+Me,bn=je+ht.width;if(bn>=ce||vi>=ce)break;je=vi,it=bn,_t=ht}ft++}return _t&&(it+=_t.xoffset),{start:He,end:He+ft,width:it}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(Ce){Object.defineProperty(_.prototype,Ce,{get:F(Ce),configurable:!0})})},{"as-number":2,"word-wrapper":70,xtend:73}],37:[function(k,ae,Ue){(function(b){var D=k("xhr"),B=function(){},I=k("parse-bmfont-ascii"),w=k("parse-bmfont-xml"),T=k("parse-bmfont-binary"),x=k("./lib/is-binary"),S=k("xtend"),y=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;ae.exports=function(_,R){R="function"==typeof R?R:B,"string"==typeof _?_={uri:_}:_||(_={}),_.binary&&(_=function(_){if(y)return S(_,{responseType:"arraybuffer"});if(void 0===self.XMLHttpRequest)throw new Error("your browser does not support XHR loading");var R=new self.XMLHttpRequest;return R.overrideMimeType("text/plain; charset=x-user-defined"),S({xhr:R},_)}(_)),D(_,function(O,V,Y){if(O)return R(O);if(!/^2/.test(V.statusCode))return R(new Error("http status code: "+V.statusCode));if(!Y)return R(new Error("no body result"));var Ee,ee=!1;if(function(_){return"[object ArrayBuffer]"===Object.prototype.toString.call(_)}(Y)){var oe=new Uint8Array(Y);Y=new b(oe,"binary")}x(Y)&&(ee=!0,"string"==typeof Y&&(Y=new b(Y,"binary"))),ee||(b.isBuffer(Y)&&(Y=Y.toString(_.encoding)),Y=Y.trim());try{var ve=V.headers["content-type"];Ee=ee?T(Y):/json/.test(ve)||"{"===Y.charAt(0)?JSON.parse(Y):/xml/.test(ve)||"<"===Y.charAt(0)?w(Y):I(Y)}catch(Ce){R(new Error("error parsing font "+Ce.message)),R=B}R(null,Ee)})}}).call(this,k("buffer").Buffer)},{"./lib/is-binary":38,buffer:6,"parse-bmfont-ascii":43,"parse-bmfont-binary":44,"parse-bmfont-xml":45,xhr:71,xtend:73}],38:[function(k,ae,Ue){(function(b){var D=k("buffer-equal"),B=new b([66,77,70,3]);ae.exports=function(I){return"string"==typeof I?"BMF"===I.substring(0,3):I.length>4&&D(I.slice(0,4),B)}}).call(this,k("buffer").Buffer)},{buffer:6,"buffer-equal":5}],39:[function(k,ae,Ue){"use strict";var b=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;function I(T){if(null==T)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(T)}ae.exports=function(){try{if(!Object.assign)return!1;var T=new String("abc");if(T[5]="de","5"===Object.getOwnPropertyNames(T)[0])return!1;for(var x={},S=0;S<10;S++)x["_"+String.fromCharCode(S)]=S;if("0123456789"!==Object.getOwnPropertyNames(x).map(function(E){return x[E]}).join(""))return!1;var M={};return"abcdefghijklmnopqrst".split("").forEach(function(E){M[E]=E}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},M)).join("")}catch(E){return!1}}()?Object.assign:function(T,x){for(var S,M,y=I(T),E=1;E<arguments.length;E++){for(var _ in S=Object(arguments[E]))D.call(S,_)&&(y[_]=S[_]);if(b){M=b(S);for(var R=0;R<M.length;R++)B.call(S,M[R])&&(y[M[R]]=S[M[R]])}}return y}},{}],40:[function(k,ae,Ue){"use strict";var b;if(!Object.keys){var D=Object.prototype.hasOwnProperty,B=Object.prototype.toString,I=k("./isArguments"),w=Object.prototype.propertyIsEnumerable,T=!w.call({toString:null},"toString"),x=w.call(function(){},"prototype"),S=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],y=function(R){var F=R.constructor;return F&&F.prototype===R},M={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},E=function(){if("undefined"==typeof window)return!1;for(var R in window)try{if(!M["$"+R]&&D.call(window,R)&&null!==window[R]&&"object"==typeof window[R])try{y(window[R])}catch(F){return!0}}catch(F){return!0}return!1}();b=function(F){var O=null!==F&&"object"==typeof F,V="[object Function]"===B.call(F),Y=I(F),ee=O&&"[object String]"===B.call(F),oe=[];if(!O&&!V&&!Y)throw new TypeError("Object.keys called on a non-object");var Ee=x&&V;if(ee&&F.length>0&&!D.call(F,0))for(var ve=0;ve<F.length;++ve)oe.push(String(ve));if(Y&&F.length>0)for(var Ce=0;Ce<F.length;++Ce)oe.push(String(Ce));else for(var He in F)(!Ee||"prototype"!==He)&&D.call(F,He)&&oe.push(String(He));if(T)for(var we=function(R){if("undefined"==typeof window||!E)return y(R);try{return y(R)}catch(F){return!1}}(F),ce=0;ce<S.length;++ce)(!we||"constructor"!==S[ce])&&D.call(F,S[ce])&&oe.push(S[ce]);return oe}}ae.exports=b},{"./isArguments":42}],41:[function(k,ae,Ue){"use strict";var b=Array.prototype.slice,D=k("./isArguments"),B=Object.keys,I=B?function(x){return B(x)}:k("./implementation"),w=Object.keys;I.shim=function(){return Object.keys?function(){var S=Object.keys(arguments);return S&&S.length===arguments.length}(1,2)||(Object.keys=function(y){return D(y)?w(b.call(y)):w(y)}):Object.keys=I,Object.keys||I},ae.exports=I},{"./implementation":40,"./isArguments":42}],42:[function(k,ae,Ue){"use strict";var b=Object.prototype.toString;ae.exports=function(B){var I=b.call(B),w="[object Arguments]"===I;return w||(w="[object Array]"!==I&&null!==B&&"object"==typeof B&&"number"==typeof B.length&&B.length>=0&&"[object Function]"===b.call(B.callee)),w}},{}],43:[function(k,ae,Ue){function b(I,w){if(!(I=I.replace(/\t+/g," ").trim()))return null;var T=I.indexOf(" ");if(-1===T)throw new Error("no named row at line "+w);var x=I.substring(0,T);I=(I=(I=(I=I.substring(T+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(_){return _.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var S=[],y=0;y<I.length;y++){var M=I[y];0===y?S.push({key:M[0],data:""}):y===I.length-1?S[S.length-1].data=D(M[0]):(S[S.length-1].data=D(M[0]),S.push({key:M[1],data:""}))}var E={key:x,data:{}};return S.forEach(function(_){E.data[_.key]=_.data}),E}function D(I){return I&&0!==I.length?0===I.indexOf('"')||0===I.indexOf("'")?I.substring(1,I.length-1):-1!==I.indexOf(",")?function(I){return I.split(",").map(function(w){return parseInt(w,10)})}(I):parseInt(I,10):""}ae.exports=function(w){if(!w)throw new Error("no data provided");var T={pages:[],chars:[],kernings:[]},x=(w=w.toString().trim()).split(/\r\n?|\n/g);if(0===x.length)throw new Error("no data in BMFont file");for(var S=0;S<x.length;S++){var y=b(x[S],S);if(y)if("page"===y.key){if("number"!=typeof y.data.id)throw new Error("malformed file at line "+S+" -- needs page id=N");if("string"!=typeof y.data.file)throw new Error("malformed file at line "+S+' -- needs page file="path"');T.pages[y.data.id]=y.data.file}else"chars"===y.key||"kernings"===y.key||("char"===y.key?T.chars.push(y.data):"kerning"===y.key?T.kernings.push(y.data):T[y.key]=y.data)}return T}},{}],44:[function(k,ae,Ue){var b=[66,77,70];function D(M,E,_){if(_>E.length-1)return 0;var R=E.readUInt8(_++),F=E.readInt32LE(_);switch(_+=4,R){case 1:M.info=function(M,E){var _={};_.size=M.readInt16LE(E);var R=M.readUInt8(E+2);return _.smooth=R>>7&1,_.unicode=R>>6&1,_.italic=R>>5&1,_.bold=R>>4&1,R>>3&1&&(_.fixedHeight=1),_.charset=M.readUInt8(E+3)||"",_.stretchH=M.readUInt16LE(E+4),_.aa=M.readUInt8(E+6),_.padding=[M.readInt8(E+7),M.readInt8(E+8),M.readInt8(E+9),M.readInt8(E+10)],_.spacing=[M.readInt8(E+11),M.readInt8(E+12)],_.outline=M.readUInt8(E+13),_.face=function(M,E){return S(M,E).toString("utf8")}(M,E+14),_}(E,_);break;case 2:M.common=function(M,E){var _={};return _.lineHeight=M.readUInt16LE(E),_.base=M.readUInt16LE(E+2),_.scaleW=M.readUInt16LE(E+4),_.scaleH=M.readUInt16LE(E+6),_.pages=M.readUInt16LE(E+8),M.readUInt8(E+10),_.packed=0,_.alphaChnl=M.readUInt8(E+11),_.redChnl=M.readUInt8(E+12),_.greenChnl=M.readUInt8(E+13),_.blueChnl=M.readUInt8(E+14),_}(E,_);break;case 3:M.pages=function(M,E,_){for(var R=[],F=S(M,E),O=F.length+1,V=_/O,Y=0;Y<V;Y++)R[Y]=M.slice(E,E+F.length).toString("utf8"),E+=O;return R}(E,_,F);break;case 4:M.chars=function(M,E,_){for(var R=[],F=_/20,O=0;O<F;O++){var V={},Y=20*O;V.id=M.readUInt32LE(E+0+Y),V.x=M.readUInt16LE(E+4+Y),V.y=M.readUInt16LE(E+6+Y),V.width=M.readUInt16LE(E+8+Y),V.height=M.readUInt16LE(E+10+Y),V.xoffset=M.readInt16LE(E+12+Y),V.yoffset=M.readInt16LE(E+14+Y),V.xadvance=M.readInt16LE(E+16+Y),V.page=M.readUInt8(E+18+Y),V.chnl=M.readUInt8(E+19+Y),R[O]=V}return R}(E,_,F);break;case 5:M.kernings=function(M,E,_){for(var R=[],F=_/10,O=0;O<F;O++){var V={},Y=10*O;V.first=M.readUInt32LE(E+0+Y),V.second=M.readUInt32LE(E+4+Y),V.amount=M.readInt16LE(E+8+Y),R[O]=V}return R}(E,_,F)}return 5+F}function S(M,E){for(var _=E;_<M.length&&0!==M[_];_++);return M.slice(E,_)}ae.exports=function(E){if(E.length<6)throw new Error("invalid buffer length for BMFont");if(!b.every(function(Y,ee){return E.readUInt8(ee)===Y}))throw new Error("BMFont missing BMF byte header");var R=3;if(E.readUInt8(R++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var O={kernings:[],chars:[]},V=0;V<5;V++)R+=D(O,E,R);return O}},{}],45:[function(k,ae,Ue){var b=k("./parse-attribs"),D=k("xml-parse-from-string"),B={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function I(x){return function(x){for(var S=[],y=0;y<x.attributes.length;y++)S.push(x.attributes[y]);return S}(x).reduce(function(y,M){return y[function(x){return B[x.toLowerCase()]||x}(M.nodeName)]=M.nodeValue,y},{})}ae.exports=function(S){S=S.toString();var y=D(S),M={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(Y){var ee=y.getElementsByTagName(Y)[0];ee&&(M[Y]=b(I(ee)))});var E=y.getElementsByTagName("pages")[0];if(!E)throw new Error("malformed file -- no <pages> element");for(var _=E.getElementsByTagName("page"),R=0;R<_.length;R++){var F=_[R],O=parseInt(F.getAttribute("id"),10),V=F.getAttribute("file");if(isNaN(O))throw new Error('malformed file -- page "id" attribute is NaN');if(!V)throw new Error('malformed file -- needs page "file" attribute');M.pages[parseInt(O,10)]=V}return["chars","kernings"].forEach(function(Y){var ee=y.getElementsByTagName(Y)[0];if(ee)for(var oe=Y.substring(0,Y.length-1),Ee=ee.getElementsByTagName(oe),ve=0;ve<Ee.length;ve++)M[Y].push(b(I(Ee[ve])))}),M}},{"./parse-attribs":46,"xml-parse-from-string":72}],46:[function(k,ae,Ue){var b="chasrset";ae.exports=function(I){for(var w in b in I&&(I.charset=I[b],delete I[b]),I)"face"===w||"charset"===w||(I[w]="padding"===w||"spacing"===w?I[w].split(",").map(function(I){return parseInt(I,10)}):parseInt(I[w],10));return I}},{}],47:[function(k,ae,Ue){var b=k("string.prototype.trim"),D=k("for-each");ae.exports=function(I){if(!I)return{};var w={};return D(b(I).split("\n"),function(T){var x=T.indexOf(":"),S=b(T.slice(0,x)).toLowerCase(),y=b(T.slice(x+1));void 0===w[S]?w[S]=y:function(I){return"[object Array]"===Object.prototype.toString.call(I)}(w[S])?w[S].push(y):w[S]=[w[S],y]}),w}},{"for-each":24,"string.prototype.trim":53}],48:[function(k,ae,Ue){(function(b){var D=b.performance||{},B=function(){for(var I=["now","webkitNow","msNow","mozNow","oNow"];I.length;){var w=I.shift();if(w in D)return D[w].bind(D)}var T=Date.now||function(){return(new Date).getTime()},x=(D.timing||{}).navigationStart||T();return function(){return T()-x}}();B.performanceNow=D.now,B.noConflict=function(){D.now=B.performanceNow},B.conflict=function(){D.now=B},B.conflict(),ae.exports=B}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(k,ae,Ue){var D,B,b=ae.exports={};function I(){throw new Error("setTimeout has not been defined")}function w(){throw new Error("clearTimeout has not been defined")}function T(V){if(D===setTimeout)return setTimeout(V,0);if((D===I||!D)&&setTimeout)return D=setTimeout,setTimeout(V,0);try{return D(V,0)}catch(Y){try{return D.call(null,V,0)}catch(ee){return D.call(this,V,0)}}}!function(){try{D="function"==typeof setTimeout?setTimeout:I}catch(V){D=I}try{B="function"==typeof clearTimeout?clearTimeout:w}catch(V){B=w}}();var M,S=[],y=!1,E=-1;function _(){!y||!M||(y=!1,M.length?S=M.concat(S):E=-1,S.length&&R())}function R(){if(!y){var V=T(_);y=!0;for(var Y=S.length;Y;){for(M=S,S=[];++E<Y;)M&&M[E].run();E=-1,Y=S.length}M=null,y=!1,function(V){if(B===clearTimeout)return clearTimeout(V);if((B===w||!B)&&clearTimeout)return B=clearTimeout,clearTimeout(V);try{B(V)}catch(Y){try{return B.call(null,V)}catch(ee){return B.call(this,V)}}}(V)}}function F(V,Y){this.fun=V,this.array=Y}function O(){}b.nextTick=function(V){var Y=new Array(arguments.length-1);if(arguments.length>1)for(var ee=1;ee<arguments.length;ee++)Y[ee-1]=arguments[ee];S.push(new F(V,Y)),1===S.length&&!y&&T(R)},F.prototype.run=function(){this.fun.apply(null,this.array)},b.title="browser",b.browser=!0,b.env={},b.argv=[],b.version="",b.versions={},b.on=O,b.addListener=O,b.once=O,b.off=O,b.removeListener=O,b.removeAllListeners=O,b.emit=O,b.prependListener=O,b.prependOnceListener=O,b.listeners=function(V){return[]},b.binding=function(V){throw new Error("process.binding is not supported")},b.cwd=function(){return"/"},b.chdir=function(V){throw new Error("process.chdir is not supported")},b.umask=function(){return 0}},{}],50:[function(k,ae,Ue){(function(b){!function(D){var B=setTimeout,I="function"==typeof b&&b||function(F){B(F,1)};function w(F,O){return function(){F.apply(O,arguments)}}var T=Array.isArray||function(F){return"[object Array]"===Object.prototype.toString.call(F)};function x(F){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof F)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],R(F,w(y,this),w(M,this))}function S(F){var O=this;null!==this._state?I(function(){var V=O._state?F.onFulfilled:F.onRejected;if(null!==V){var Y;try{Y=V(O._value)}catch(ee){return void F.reject(ee)}F.resolve(Y)}else(O._state?F.resolve:F.reject)(O._value)}):this._deferreds.push(F)}function y(F){try{if(F===this)throw new TypeError("A promise cannot be resolved with itself.");if(F&&("object"==typeof F||"function"==typeof F)){var O=F.then;if("function"==typeof O)return void R(w(O,F),w(y,this),w(M,this))}this._state=!0,this._value=F,E.call(this)}catch(V){M.call(this,V)}}function M(F){this._state=!1,this._value=F,E.call(this)}function E(){for(var F=0,O=this._deferreds.length;F<O;F++)S.call(this,this._deferreds[F]);this._deferreds=null}function _(F,O,V,Y){this.onFulfilled="function"==typeof F?F:null,this.onRejected="function"==typeof O?O:null,this.resolve=V,this.reject=Y}function R(F,O,V){var Y=!1;try{F(function(ee){Y||(Y=!0,O(ee))},function(ee){Y||(Y=!0,V(ee))})}catch(ee){if(Y)return;Y=!0,V(ee)}}x.prototype.catch=function(F){return this.then(null,F)},x.prototype.then=function(F,O){var V=this;return new x(function(Y,ee){S.call(V,new _(F,O,Y,ee))})},x.all=function(){var F=Array.prototype.slice.call(1===arguments.length&&T(arguments[0])?arguments[0]:arguments);return new x(function(O,V){if(0===F.length)return O([]);var Y=F.length;function ee(Ee,ve){try{if(ve&&("object"==typeof ve||"function"==typeof ve)){var Ce=ve.then;if("function"==typeof Ce)return void Ce.call(ve,function(He){ee(Ee,He)},V)}F[Ee]=ve,0==--Y&&O(F)}catch(He){V(He)}}for(var oe=0;oe<F.length;oe++)ee(oe,F[oe])})},x.resolve=function(F){return F&&"object"==typeof F&&F.constructor===x?F:new x(function(O){O(F)})},x.reject=function(F){return new x(function(O,V){V(F)})},x.race=function(F){return new x(function(O,V){for(var Y=0,ee=F.length;Y<ee;Y++)F[Y].then(O,V)})},x._setImmediateFn=function(O){I=O},void 0!==ae&&ae.exports?ae.exports=x:D.Promise||(D.Promise=x)}(this)}).call(this,k("timers").setImmediate)},{timers:68}],51:[function(k,ae,Ue){var b=k("dtype"),D=k("an-array"),B=k("is-buffer"),I=[0,2,3],w=[2,1,3];ae.exports=function(x,S){(!x||!D(x)&&!B(x))&&(S=x||{},x=null);for(var E=(S="number"==typeof S?{count:S}:S||{}).start||0,_=!1!==S.clockwise?I:w,R=_[0],F=_[1],O=_[2],V=6*("number"==typeof S.count?S.count:1),Y=x||new(b("string"==typeof S.type?S.type:"uint16"))(V),ee=0,oe=0;ee<V;ee+=6,oe+=4){var Ee=ee+E;Y[Ee+0]=oe+0,Y[Ee+1]=oe+1,Y[Ee+2]=oe+2,Y[Ee+3]=oe+R,Y[Ee+4]=oe+F,Y[Ee+5]=oe+O}return Y}},{"an-array":1,dtype:13,"is-buffer":31}],52:[function(k,ae,Ue){"use strict";var b=k("function-bind"),D=k("es-abstract/es5"),B=b.call(Function.call,String.prototype.replace),I=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,w=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;ae.exports=function(){var x=D.ToString(D.CheckObjectCoercible(this));return B(B(x,I,""),w,"")}},{"es-abstract/es5":15,"function-bind":26}],53:[function(k,ae,Ue){"use strict";var b=k("function-bind"),D=k("define-properties"),B=k("./implementation"),I=k("./polyfill"),w=k("./shim"),T=b.call(Function.call,I());D(T,{getPolyfill:I,implementation:B,shim:w}),ae.exports=T},{"./implementation":52,"./polyfill":54,"./shim":55,"define-properties":11,"function-bind":26}],54:[function(k,ae,Ue){"use strict";var b=k("./implementation");ae.exports=function(){return String.prototype.trim&&"\u200b"==="\u200b".trim()?String.prototype.trim:b}},{"./implementation":52}],55:[function(k,ae,Ue){"use strict";var b=k("define-properties"),D=k("./polyfill");ae.exports=function(){var I=D();return b(String.prototype,{trim:I},{trim:function(){return String.prototype.trim!==I}}),I}},{"./polyfill":54,"define-properties":11}],56:[function(k,ae,Ue){"use strict";var b={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},D={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},B=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],I={CSS:{},springs:{}};function w(Ae,Fe,ke){return Math.min(Math.max(Ae,Fe),ke)}function T(Ae,Fe){return Ae.indexOf(Fe)>-1}function x(Ae,Fe){return Ae.apply(null,Fe)}var S=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,y=/^rgb/,M=/^hsl/,E={arr:function(Ae){return Array.isArray(Ae)},obj:function(Ae){return T(Object.prototype.toString.call(Ae),"Object")},pth:function(Ae){return E.obj(Ae)&&Ae.hasOwnProperty("totalLength")},svg:function(Ae){return Ae instanceof SVGElement},inp:function(Ae){return Ae instanceof HTMLInputElement},dom:function(Ae){return Ae.nodeType||E.svg(Ae)},str:function(Ae){return"string"==typeof Ae},fnc:function(Ae){return"function"==typeof Ae},und:function(Ae){return void 0===Ae},hex:function(Ae){return S.test(Ae)},rgb:function(Ae){return y.test(Ae)},hsl:function(Ae){return M.test(Ae)},col:function(Ae){return E.hex(Ae)||E.rgb(Ae)||E.hsl(Ae)},key:function(Ae){return!b.hasOwnProperty(Ae)&&!D.hasOwnProperty(Ae)&&"targets"!==Ae&&"keyframes"!==Ae}},_=/\(([^)]+)\)/;function R(Ae){var Fe=_.exec(Ae);return Fe?Fe[1].split(",").map(function(ke){return parseFloat(ke)}):[]}function F(Ae,Fe){var ke=R(Ae),ot=w(E.und(ke[0])?1:ke[0],.1,100),at=w(E.und(ke[1])?100:ke[1],.1,100),Ct=w(E.und(ke[2])?10:ke[2],.1,100),Ut=w(E.und(ke[3])?0:ke[3],.1,100),mn=Math.sqrt(at/ot),Qt=Ct/(2*Math.sqrt(at*ot)),Rt=Qt<1?mn*Math.sqrt(1-Qt*Qt):0,Hn=Qt<1?(Qt*mn-Ut)/Rt:-Ut+mn;function Ci(hr){var Ji=Fe?Fe*hr/1e3:hr;return Ji=Qt<1?Math.exp(-Ji*Qt*mn)*(1*Math.cos(Rt*Ji)+Hn*Math.sin(Rt*Ji)):(1+Hn*Ji)*Math.exp(-Ji*mn),0===hr||1===hr?hr:1-Ji}return Fe?Ci:function(){var hr=I.springs[Ae];if(hr)return hr;for(var Ji=1/6,Sr=0,ds=0;;)if(1===Ci(Sr+=Ji)){if(++ds>=16)break}else ds=0;var Js=Sr*Ji*1e3;return I.springs[Ae]=Js,Js}}function O(Ae,Fe){void 0===Ae&&(Ae=1),void 0===Fe&&(Fe=.5);var ke=w(Ae,1,10),ot=w(Fe,.1,2);return function(at){return 0===at||1===at?at:-ke*Math.pow(2,10*(at-1))*Math.sin((at-1-ot/(2*Math.PI)*Math.asin(1/ke))*(2*Math.PI)/ot)}}function V(Ae){return void 0===Ae&&(Ae=10),function(Fe){return Math.round(Fe*Ae)*(1/Ae)}}var Y=function(){function ke(Bn,Hn){return 1-3*Hn+3*Bn}function ot(Bn,Hn){return 3*Hn-6*Bn}function at(Bn){return 3*Bn}function Ct(Bn,Hn,Ci){return((ke(Hn,Ci)*Bn+ot(Hn,Ci))*Bn+at(Hn))*Bn}function Ut(Bn,Hn,Ci){return 3*ke(Hn,Ci)*Bn*Bn+2*ot(Hn,Ci)*Bn+at(Hn)}return function(Bn,Hn,Ci,Tr){if(0<=Bn&&Bn<=1&&0<=Ci&&Ci<=1){var hr=new Float32Array(11);if(Bn!==Hn||Ci!==Tr)for(var Ji=0;Ji<11;++Ji)hr[Ji]=Ct(.1*Ji,Bn,Ci);return function(ds){return Bn===Hn&&Ci===Tr||0===ds||1===ds?ds:Ct(function(ds){for(var Js=0,Ri=1,ar=10;Ri!==ar&&hr[Ri]<=ds;++Ri)Js+=.1;--Ri;var ho=Js+(ds-hr[Ri])/(hr[Ri+1]-hr[Ri])*.1,Jr=Ut(ho,Bn,Ci);return Jr>=.001?function(Bn,Hn,Ci,Tr){for(var hr=0;hr<4;++hr){var Ji=Ut(Hn,Ci,Tr);if(0===Ji)return Hn;Hn-=(Ct(Hn,Ci,Tr)-Bn)/Ji}return Hn}(ds,ho,Bn,Ci):0===Jr?ho:function(Bn,Hn,Ci,Tr,hr){var Ji,Sr,ds=0;do{(Ji=Ct(Sr=Hn+(Ci-Hn)/2,Tr,hr)-Bn)>0?Ci=Sr:Hn=Sr}while(Math.abs(Ji)>1e-7&&++ds<10);return Sr}(ds,Js,Js+.1,Bn,Ci)}(ds),Hn,Tr)}}}}(),ee=function(){var Ae=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],Fe={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],O],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(Ut,mn){return function(Qt){return 1-O(Ut,mn)(1-Qt)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(Ut,mn){return function(Qt){return Qt<.5?O(Ut,mn)(2*Qt)/2:1-O(Ut,mn)(-2*Qt+2)/2}}]},ke={linear:[.25,.25,.75,.75]};for(var ot in Fe)for(var at=0,Ct=Fe[ot].length;at<Ct;at++)ke["ease"+ot+Ae[at]]=Fe[ot][at];return ke}();function oe(Ae,Fe){if(E.fnc(Ae))return Ae;var ke=Ae.split("(")[0],ot=ee[ke],at=R(Ae);switch(ke){case"spring":return F(Ae,Fe);case"cubicBezier":return x(Y,at);case"steps":return x(V,at);default:return E.fnc(ot)?x(ot,at):x(Y,ot)}}function Ee(Ae){try{return document.querySelectorAll(Ae)}catch(ke){return}}var ve=[];function Ce(Ae,Fe){for(var ke=ve,ot=Ae.length,at=arguments.length>=2?arguments[1]:void 0,Ct=0;Ct<ot;Ct++)if(Ct in Ae){var Ut=Ae[Ct];Fe.call(at,Ut,Ct,Ae)&&ke.push(Ut)}return(ve=Ae).length=0,ke}function He(Ae,Fe){Fe||(Fe=[]);for(var ke=0,ot=Ae.length;ke<ot;ke++){var at=Ae[ke];Array.isArray(at)?He(at,Fe):Fe.push(at)}return Fe}function we(Ae){return E.arr(Ae)?Ae:(E.str(Ae)&&(Ae=Ee(Ae)||Ae),Ae instanceof NodeList||Ae instanceof HTMLCollection?[].slice.call(Ae):[Ae])}function ce(Ae,Fe){return Ae.some(function(ke){return ke===Fe})}function Me(Ae){var Fe={};for(var ke in Ae)Fe[ke]=Ae[ke];return Fe}function fe(Ae,Fe){var ke=Me(Ae);for(var ot in Ae)ke[ot]=Fe.hasOwnProperty(ot)?Fe[ot]:Ae[ot];return ke}function je(Ae,Fe){var ke=Me(Ae);for(var ot in Fe)ke[ot]=E.und(Ae[ot])?Fe[ot]:Ae[ot];return ke}var it=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;var ht=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,_t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;var _n=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,kn=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function vi(Ae){return E.rgb(Ae)?function(Ae){var Fe=it.exec(Ae);return Fe?"rgba("+Fe[1]+",1)":Ae}(Ae):E.hex(Ae)?function(Ae){var Fe=Ae.replace(ht,function(Ut,mn,Qt,Rt){return mn+mn+Qt+Qt+Rt+Rt}),ke=_t.exec(Fe);return"rgba("+parseInt(ke[1],16)+","+parseInt(ke[2],16)+","+parseInt(ke[3],16)+",1)"}(Ae):E.hsl(Ae)?function(Ae){var mn,Qt,Rt,Fe=_n.exec(Ae)||kn.exec(Ae),ke=parseInt(Fe[1],10)/360,ot=parseInt(Fe[2],10)/100,at=parseInt(Fe[3],10)/100,Ct=Fe[4]||1;function Ut(Ci,Tr,hr){return hr<0&&(hr+=1),hr>1&&(hr-=1),hr<1/6?Ci+6*(Tr-Ci)*hr:hr<.5?Tr:hr<2/3?Ci+(Tr-Ci)*(2/3-hr)*6:Ci}if(0==ot)mn=Qt=Rt=at;else{var Bn=at<.5?at*(1+ot):at+ot-at*ot,Hn=2*at-Bn;mn=Ut(Hn,Bn,ke+1/3),Qt=Ut(Hn,Bn,ke),Rt=Ut(Hn,Bn,ke-1/3)}return"rgba("+255*mn+","+255*Qt+","+255*Rt+","+Ct+")"}(Ae):void 0}var bn=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function qn(Ae){var Fe=bn.exec(Ae);if(Fe)return Fe[2]}function Zr(Ae,Fe){return E.fnc(Ae)?Ae(Fe.target,Fe.id,Fe.total):Ae}function Lr(Ae,Fe){return Ae.getAttribute(Fe)}function kr(Ae,Fe,ke){if(ce([ke,"deg","rad","turn"],qn(Fe)))return Fe;var at=I.CSS[Fe+ke];if(!E.und(at))return at;var Ut=document.createElement(Ae.tagName),mn=Ae.parentNode&&Ae.parentNode!==document?Ae.parentNode:document.body;mn.appendChild(Ut),Ut.style.position="absolute",Ut.style.width=100+ke;var Qt=100/Ut.offsetWidth;mn.removeChild(Ut);var Rt=Qt*parseFloat(Fe);return I.CSS[Fe+ke]=Rt,Rt}function bs(Ae,Fe,ke){if(Fe in Ae.style){var ot=Fe.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),at=Ae.style[Fe]||getComputedStyle(Ae).getPropertyValue(ot)||"0";return ke?kr(Ae,at,ke):at}}function qr(Ae,Fe){return E.dom(Ae)&&!E.inp(Ae)&&(Lr(Ae,Fe)||E.svg(Ae)&&Ae[Fe])?"attribute":E.dom(Ae)&&ce(B,Fe)?"transform":E.dom(Ae)&&"transform"!==Fe&&bs(Ae,Fe)?"css":null!=Ae[Fe]?"object":void 0}var cr=/(\w+)\(([^)]*)\)/g;function Kr(Ae){if(E.dom(Ae)){for(var ot,Fe=Ae.style.transform||"",ke=new Map;ot=cr.exec(Fe);)ke.set(ot[1],ot[2]);return ke}}function Es(Ae,Fe,ke,ot){var at=T(Fe,"scale")?1:0+function(Ae){return T(Ae,"translate")||"perspective"===Ae?"px":T(Ae,"rotate")||T(Ae,"skew")?"deg":void 0}(Fe),Ct=Kr(Ae).get(Fe)||at;return ke&&(ke.transforms.list.set(Fe,Ct),ke.transforms.last=Fe),ot?kr(Ae,Ct,ot):Ct}function cn(Ae,Fe,ke,ot){switch(qr(Ae,Fe)){case"transform":return Es(Ae,Fe,ot,ke);case"css":return bs(Ae,Fe,ke);case"attribute":return Lr(Ae,Fe);default:return Ae[Fe]||0}}var le=/^(\*=|\+=|-=)/;function he(Ae,Fe){var ke=le.exec(Ae);if(!ke)return Ae;var ot=qn(Ae)||0,at=parseFloat(Fe),Ct=parseFloat(Ae.replace(ke[0],""));switch(ke[0][0]){case"+":return at+Ct+ot;case"-":return at-Ct+ot;case"*":return at*Ct+ot}}var Se=/\s/g;function me(Ae,Fe){if(E.col(Ae))return vi(Ae);var ke=qn(Ae),ot=ke?Ae.substr(0,Ae.length-ke.length):Ae;return Fe&&!Se.test(Ae)?ot+Fe:ot}function Re(Ae,Fe){return Math.sqrt(Math.pow(Fe.x-Ae.x,2)+Math.pow(Fe.y-Ae.y,2))}function de(Ae){for(var ot,Fe=Ae.points,ke=0,at=0;at<Fe.numberOfItems;at++){var Ct=Fe.getItem(at);at>0&&(ke+=Re(ot,Ct)),ot=Ct}return ke}function Ye(Ae){if(Ae.getTotalLength)return Ae.getTotalLength();switch(Ae.tagName.toLowerCase()){case"circle":return function(Ae){return 2*Math.PI*Lr(Ae,"r")}(Ae);case"rect":return function(Ae){return 2*Lr(Ae,"width")+2*Lr(Ae,"height")}(Ae);case"line":return function(Ae){return Re({x:Lr(Ae,"x1"),y:Lr(Ae,"y1")},{x:Lr(Ae,"x2"),y:Lr(Ae,"y2")})}(Ae);case"polyline":return de(Ae);case"polygon":return function(Ae){var Fe=Ae.points;return de(Ae)+Re(Fe.getItem(Fe.numberOfItems-1),Fe.getItem(0))}(Ae)}}function un(Ae,Fe){var ke=Fe||{},ot=ke.el||function(Ae){for(var Fe=Ae.parentNode;E.svg(Fe)&&E.svg((Fe=Fe.parentNode).parentNode););return Fe}(Ae),at=ot.getBoundingClientRect(),Ct=Lr(ot,"viewBox"),Ut=at.width,mn=at.height,Qt=ke.viewBox||(Ct?Ct.split(" "):[0,0,Ut,mn]);return{el:ot,viewBox:Qt,x:Qt[0]/1,y:Qt[1]/1,w:Ut/Qt[2],h:mn/Qt[3]}}function dn(Ae,Fe){function ke(mn){return void 0===mn&&(mn=0),Ae.el.getPointAtLength(Fe+mn>=1?Fe+mn:0)}var ot=un(Ae.el,Ae.svg),at=ke(),Ct=ke(-1),Ut=ke(1);switch(Ae.property){case"x":return(at.x-ot.x)*ot.w;case"y":return(at.y-ot.y)*ot.h;case"angle":return 180*Math.atan2(Ut.y-Ct.y,Ut.x-Ct.x)/Math.PI}}var rn=/-?\d*\.?\d+/g;function On(Ae,Fe){var ke=me(E.pth(Ae)?Ae.totalLength:Ae,Fe)+"";return{original:ke,numbers:ke.match(rn)?ke.match(rn).map(Number):[0],strings:E.str(Ae)||Fe?ke.split(rn):[]}}function Nn(Ae){return Ce(Ae?He(E.arr(Ae)?Ae.map(we):we(Ae)):[],function(ke,ot,at){return at.indexOf(ke)===ot})}function Pn(Ae){var Fe=Nn(Ae);return Fe.map(function(ke,ot){return{target:ke,id:ot,total:Fe.length,transforms:{list:Kr(ke)}}})}var Ar=/^spring/;function di(Ae,Fe){var ke=Me(Fe);if(Ar.test(ke.easing)&&(ke.duration=F(ke.easing)),E.arr(Ae)){var ot=Ae.length;2!==ot||E.obj(Ae[0])?E.fnc(Fe.duration)||(ke.duration=Fe.duration/ot):Ae={value:Ae}}var Ct=E.arr(Ae)?Ae:[Ae];return Ct.map(function(Ut,mn){var Qt=E.obj(Ut)&&!E.pth(Ut)?Ut:{value:Ut};return E.und(Qt.delay)&&(Qt.delay=mn?0:Fe.delay),E.und(Qt.endDelay)&&(Qt.endDelay=mn===Ct.length-1?Fe.endDelay:0),Qt}).map(function(Ut){return je(Ut,ke)})}function Nt(Ae,Fe){var ke=[],ot=Fe.keyframes;for(var at in ot&&(Fe=je(function(Ae){for(var Fe=Ce(He(Ae.map(function(Ct){return Object.keys(Ct)})),function(Ct){return E.key(Ct)}).reduce(function(Ct,Ut){return Ct.indexOf(Ut)<0&&Ct.push(Ut),Ct},[]),ke={},ot=function(Ct){var Ut=Fe[Ct];ke[Ut]=Ae.map(function(mn){var Qt={};for(var Rt in mn)E.key(Rt)?Rt==Ut&&(Qt.value=mn[Rt]):Qt[Rt]=mn[Rt];return Qt})},at=0;at<Fe.length;at++)ot(at);return ke}(ot),Fe)),Fe)E.key(at)&&ke.push({name:at,tweens:di(Fe[at],Ae)});return ke}function Fn(Ae,Fe){var ke;return Ae.tweens.map(function(ot){var at=function(Ae,Fe){var ke={};for(var ot in Ae){var at=Zr(Ae[ot],Fe);E.arr(at)&&1===(at=at.map(function(Ct){return Zr(Ct,Fe)})).length&&(at=at[0]),ke[ot]=at}return ke.duration=parseFloat(ke.duration),ke.delay=parseFloat(ke.delay),ke}(ot,Fe),Ct=at.value,Ut=E.arr(Ct)?Ct[1]:Ct,mn=qn(Ut),Qt=cn(Fe.target,Ae.name,mn,Fe),Rt=ke?ke.to.original:Qt,Bn=E.arr(Ct)?Ct[0]:Rt,Hn=qn(Bn)||qn(Qt),Ci=mn||Hn;return E.und(Ut)&&(Ut=Rt),at.from=On(Bn,Ci),at.to=On(he(Ut,Bn),Ci),at.start=ke?ke.end:0,at.end=at.start+at.delay+at.duration+at.endDelay,at.easing=oe(at.easing,at.duration),at.isPath=E.pth(Ct),at.isColor=E.col(at.from.original),at.isColor&&(at.round=1),ke=at,at})}var sn={css:function(Ae,Fe,ke){return Ae.style[Fe]=ke},attribute:function(Ae,Fe,ke){return Ae.setAttribute(Fe,ke)},object:function(Ae,Fe,ke){return Ae[Fe]=ke},transform:function(Ae,Fe,ke,ot,at){if(ot.list.set(Fe,ke),Fe===ot.last||at){var Ct="";ot.list.forEach(function(Ut,mn){Ct+=mn+"("+Ut+") "}),Ae.style.transform=Ct}}};function Sn(Ae,Fe){for(var ke=Pn(Ae),ot=0,at=ke.length;ot<at;ot++){var Ct=ke[ot];for(var Ut in Fe){var mn=Zr(Fe[Ut],Ct),Qt=Ct.target,Rt=qn(mn),Bn=cn(Qt,Ut,Rt,Ct),Ci=he(me(mn,Rt||qn(Bn)),Bn),Tr=qr(Qt,Ut);sn[Tr](Qt,Ut,Ci,Ct.transforms,!0)}}}function Ei(Ae,Fe){return Ce(He(Ae.map(function(ke){return Fe.map(function(ot){return function(Ae,Fe){var ke=qr(Ae.target,Fe.name);if(ke){var ot=Fn(Fe,Ae),at=ot[ot.length-1];return{type:ke,property:Fe.name,animatable:Ae,tweens:ot,duration:at.end,delay:ot[0].delay,endDelay:at.endDelay}}}(ke,ot)})})),function(ke){return!E.und(ke)})}function Zi(Ae,Fe){var ke=Ae.length,ot=function(Ct){return Ct.timelineOffset?Ct.timelineOffset:0},at={};return at.duration=ke?Math.max.apply(Math,Ae.map(function(Ct){return ot(Ct)+Ct.duration})):Fe.duration,at.delay=ke?Math.min.apply(Math,Ae.map(function(Ct){return ot(Ct)+Ct.delay})):Fe.delay,at.endDelay=ke?at.duration-Math.max.apply(Math,Ae.map(function(Ct){return ot(Ct)+Ct.duration-Ct.endDelay})):Fe.endDelay,at}var wi=0;var qi,Xi=[],Oi=[],er=function(){function Ae(){qi=requestAnimationFrame(Fe)}function Fe(ke){var ot=Xi.length;if(ot){for(var at=0;at<ot;){var Ct=Xi[at];if(Ct.paused){var Ut=Xi.indexOf(Ct);Ut>-1&&(Xi.splice(Ut,1),ot=Xi.length)}else Ct.tick(ke);at++}Ae()}else qi=cancelAnimationFrame(qi)}return Ae}();function $e(Ae){void 0===Ae&&(Ae={});var at,Fe=0,ke=0,ot=0,Ct=0,Ut=null;function mn(){return window.Promise&&new Promise(function(Ri){return Ut=Ri})}var Qt=mn(),Rt=function(Ae){var Fe=fe(b,Ae),ke=fe(D,Ae),ot=Nt(ke,Ae),at=Pn(Ae.targets),Ct=Ei(at,ot),Ut=Zi(Ct,ke),mn=wi;return wi++,je(Fe,{id:mn,children:[],animatables:at,animations:Ct,duration:Ut.duration,delay:Ut.delay,endDelay:Ut.endDelay})}(Ae);function Bn(){Rt.reversed=!Rt.reversed;for(var Ri=0,ar=at.length;Ri<ar;Ri++)at[Ri].reversed=Rt.reversed}function Hn(Ri){return Rt.reversed?Rt.duration-Ri:Ri}function Ci(){Fe=0,ke=Hn(Rt.currentTime)*(1/$e.speed)}function Tr(Ri,ar){ar&&ar.seek(Ri-ar.timelineOffset)}function Ji(Ri){for(var ar=0,tr=Rt.animations,ho=tr.length;ar<ho;){var Jr=tr[ar],jr=Jr.animatable,K=Jr.tweens,ne=K.length-1,pe=K[ne];ne&&(pe=Ce(K,function(Hs){return Ri<Hs.end})[0]||pe);for(var xe=w(Ri-pe.start-pe.delay,0,pe.duration)/pe.duration,Ge=isNaN(xe)?1:pe.easing(xe),ut=pe.to.strings,Pt=pe.round,on=[],$t=pe.to.numbers.length,xt=void 0,Gt=0;Gt<$t;Gt++){var An=void 0,li=pe.to.numbers[Gt],yi=pe.from.numbers[Gt]||0;An=pe.isPath?dn(pe.value,Ge*li):yi+Ge*(li-yi),Pt&&(pe.isColor&&Gt>2||(An=Math.round(An*Pt)/Pt)),on.push(An)}var Li=ut.length;if(Li){xt=ut[0];for(var rr=0;rr<Li;rr++){var Kn=ut[rr+1],$r=on[rr];isNaN($r)||(xt+=Kn?$r+Kn:$r+" ")}}else xt=on[0];sn[Jr.type](jr.target,Jr.property,xt,jr.transforms),Jr.currentValue=xt,ar++}}function Sr(Ri){Rt[Ri]&&!Rt.passThrough&&Rt[Ri](Rt)}function Js(Ri){var ar=Rt.duration,tr=Rt.delay,ho=ar-Rt.endDelay,Jr=Hn(Ri);Rt.progress=w(Jr/ar*100,0,100),Rt.reversePlayback=Jr<Rt.currentTime,at&&function(Ri){if(Rt.reversePlayback)for(var tr=Ct;tr--;)Tr(Ri,at[tr]);else for(var ar=0;ar<Ct;ar++)Tr(Ri,at[ar])}(Jr),!Rt.began&&Rt.currentTime>0&&(Rt.began=!0,Sr("begin"),Sr("loopBegin")),Jr<=tr&&0!==Rt.currentTime&&Ji(0),(Jr>=ho&&Rt.currentTime!==ar||!ar)&&Ji(ar),Jr>tr&&Jr<ho?(Rt.changeBegan||(Rt.changeBegan=!0,Rt.changeCompleted=!1,Sr("changeBegin")),Sr("change"),Ji(Jr)):Rt.changeBegan&&(Rt.changeCompleted=!0,Rt.changeBegan=!1,Sr("changeComplete")),Rt.currentTime=w(Jr,0,ar),Rt.began&&Sr("update"),Ri>=ar&&(ke=0,Rt.remaining&&!0!==Rt.remaining&&Rt.remaining--,Rt.remaining?(Fe=ot,Sr("loopComplete"),Sr("loopBegin"),"alternate"===Rt.direction&&Bn()):(Rt.paused=!0,Rt.completed||(Rt.completed=!0,Sr("loopComplete"),Sr("complete"),"Promise"in window&&(Ut(),Qt=mn()))))}return Rt.reset=function(){var Ri=Rt.direction;Rt.passThrough=!1,Rt.currentTime=0,Rt.progress=0,Rt.paused=!0,Rt.began=!1,Rt.changeBegan=!1,Rt.completed=!1,Rt.changeCompleted=!1,Rt.reversePlayback=!1,Rt.reversed="reverse"===Ri,Rt.remaining=Rt.loop;for(var ar=Ct=(at=Rt.children).length;ar--;)Rt.children[ar].reset();(Rt.reversed&&!0!==Rt.loop||"alternate"===Ri&&1===Rt.loop)&&Rt.remaining++,Ji(0)},Rt.set=function(Ri,ar){return Sn(Ri,ar),Rt},Rt.tick=function(Ri){ot=Ri,Fe||(Fe=ot),Js((ot+(ke-Fe))*$e.speed)},Rt.seek=function(Ri){Js(Hn(Ri))},Rt.pause=function(){Rt.paused=!0,Ci()},Rt.play=function(){!Rt.paused||(Rt.paused=!1,Xi.push(Rt),Ci(),qi||er())},Rt.reverse=function(){Bn(),Ci()},Rt.restart=function(){Rt.reset(),Rt.play()},Rt.finished=Qt,Rt.reset(),Rt.autoplay&&Rt.play(),Rt}function bt(Ae,Fe){for(var ke=Fe.length;ke--;)ce(Ae,Fe[ke].animatable.target)&&Fe.splice(ke,1)}document.addEventListener("visibilitychange",function(){if(document.hidden){for(var Ae=0,Fe=Xi.length;Ae<Fe;Ae++)activeInstance[Ae].pause();Oi=Xi.slice(0),Xi=[]}else for(var ke=0,ot=Oi.length;ke<ot;ke++)Oi[ke].play()}),$e.version="3.0.0",$e.speed=1,$e.running=Xi,$e.remove=function(Ae){for(var Fe=Nn(Ae),ke=Xi.length;ke--;){var ot=Xi[ke],at=ot.animations,Ct=ot.children;bt(Fe,at);for(var Ut=Ct.length;Ut--;){var mn=Ct[Ut],Qt=mn.animations;bt(Fe,Qt),!Qt.length&&!mn.children.length&&Ct.splice(Ut,1)}!at.length&&!Ct.length&&ot.pause()}},$e.get=cn,$e.set=Sn,$e.convertPx=kr,$e.path=function(Ae,Fe){var ke=E.str(Ae)?Ee(Ae)[0]:Ae,ot=Fe||100;return function(at){return{property:at,el:ke,svg:un(ke),totalLength:Ye(ke)*(ot/100)}}},$e.setDashoffset=function(Ae){var Fe=Ye(Ae);return Ae.setAttribute("stroke-dasharray",Fe),Fe},$e.stagger=function(Ae,Fe){void 0===Fe&&(Fe={});var ke=Fe.direction||"normal",ot=Fe.easing?oe(Fe.easing):null,at=Fe.grid,Ct=Fe.axis,Ut=Fe.from||0,mn="first"===Ut,Qt="center"===Ut,Rt="last"===Ut,Bn=E.arr(Ae),Hn=parseFloat(Bn?Ae[0]:Ae),Ci=Bn?parseFloat(Ae[1]):0,Tr=qn(Bn?Ae[1]:Ae)||0,hr=Fe.start||0+(Bn?Hn:0),Ji=[],Sr=0;return function(ds,Js,Ri){if(mn&&(Ut=0),Qt&&(Ut=(Ri-1)/2),Rt&&(Ut=Ri-1),!Ji.length){for(var ar=0;ar<Ri;ar++){if(at){var tr=Qt?(at[0]-1)/2:Ut%at[0],ho=Qt?(at[1]-1)/2:Math.floor(Ut/at[0]),K=tr-ar%at[0],ne=ho-Math.floor(ar/at[0]),pe=Math.sqrt(K*K+ne*ne);"x"===Ct&&(pe=-K),"y"===Ct&&(pe=-ne),Ji.push(pe)}else Ji.push(Math.abs(Ut-ar));Sr=Math.max.apply(Math,Ji)}ot&&(Ji=Ji.map(function(Ge){return ot(Ge/Sr)*Sr})),"reverse"===ke&&(Ji=Ji.map(function(Ge){return Ct?Ge<0?-1*Ge:-Ge:Math.abs(Sr-Ge)}))}return hr+(Bn?(Ci-Hn)/Sr:Hn)*(Math.round(100*Ji[Js])/100)+Tr}},$e.timeline=function(Ae){void 0===Ae&&(Ae={});var Fe=$e(Ae);return Fe.duration=0,Fe.add=function(ke,ot){var at=Xi.indexOf(Fe),Ct=Fe.children;function Ut(Ci){Ci.passThrough=!0}at>-1&&Xi.splice(at,1);for(var mn=0;mn<Ct.length;mn++)Ut(Ct[mn]);var Qt=je(ke,fe(D,Ae));Qt.targets=Qt.targets||Ae.targets;var Rt=Fe.duration;Qt.autoplay=!1,Qt.direction=Fe.direction,Qt.timelineOffset=E.und(ot)?Rt:he(ot,Rt),Ut(Fe),Fe.seek(Qt.timelineOffset);var Bn=$e(Qt);Ut(Bn),Ct.push(Bn);var Hn=Zi(Ct,Ae);return Fe.delay=Hn.delay,Fe.endDelay=Hn.endDelay,Fe.duration=Hn.duration,Fe.seek(0),Fe.reset(),Fe.autoplay&&Fe.play(),Fe},Fe},$e.easing=oe,$e.penner=ee,$e.random=function(Ae,Fe){return Math.floor(Math.random()*(Fe-Ae+1))+Ae},ae.exports=$e},{}],57:[function(k,ae,Ue){var b;b=this,function(b){"use strict";const D="137",H=300,Tn=1e3,dn=1001,rn=1002,On=1003,vt=1006,Fn=1008,Sn=1009,Zi=1012,ur=1014,Xi=1015,Oi=1016,Un=1020,bt=1023,os=1026,Ae=1027,Ut=33776,mn=33777,Qt=33778,Rt=33779,K=37816,Gt=2300,An=2301,yi=2400,Li=2401,rr=2402,ts=3e3,br=3001,Th=35044,Sh=35048,$a="300 es";class el{addEventListener(n,r){void 0===this._listeners&&(this._listeners={});const l=this._listeners;void 0===l[n]&&(l[n]=[]),-1===l[n].indexOf(r)&&l[n].push(r)}hasEventListener(n,r){if(void 0===this._listeners)return!1;const l=this._listeners;return void 0!==l[n]&&-1!==l[n].indexOf(r)}removeEventListener(n,r){if(void 0===this._listeners)return;const c=this._listeners[n];if(void 0!==c){const f=c.indexOf(r);-1!==f&&c.splice(f,1)}}dispatchEvent(n){if(void 0===this._listeners)return;const l=this._listeners[n.type];if(void 0!==l){n.target=this;const c=l.slice(0);for(let f=0,m=c.length;f<m;f++)c[f].call(this,n);n.target=null}}}const Ws=[];for(let h=0;h<256;h++)Ws[h]=(h<16?"0":"")+h.toString(16);let ac=1234567;const bo=Math.PI/180,Fs=180/Math.PI;function Xo(){const h=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,l=4294967295*Math.random()|0;return(Ws[255&h]+Ws[h>>8&255]+Ws[h>>16&255]+Ws[h>>24&255]+"-"+Ws[255&n]+Ws[n>>8&255]+"-"+Ws[n>>16&15|64]+Ws[n>>24&255]+"-"+Ws[63&r|128]+Ws[r>>8&255]+"-"+Ws[r>>16&255]+Ws[r>>24&255]+Ws[255&l]+Ws[l>>8&255]+Ws[l>>16&255]+Ws[l>>24&255]).toUpperCase()}function Po(h,n,r){return Math.max(n,Math.min(r,h))}function $f(h,n){return(h%n+n)%n}function Rh(h,n,r){return(1-r)*h+r*n}function Pu(h){return 0==(h&h-1)&&0!==h}function Xm(h){return Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function jm(h){return Math.pow(2,Math.floor(Math.log(h)/Math.LN2))}var iv=Object.freeze({__proto__:null,DEG2RAD:bo,RAD2DEG:Fs,generateUUID:Xo,clamp:Po,euclideanModulo:$f,mapLinear:function(h,n,r,l,c){return l+(h-n)*(c-l)/(r-n)},inverseLerp:function(h,n,r){return h!==n?(r-h)/(n-h):0},lerp:Rh,damp:function(h,n,r,l){return Rh(h,n,1-Math.exp(-r*l))},pingpong:function(h,n=1){return n-Math.abs($f(h,2*n)-n)},smoothstep:function(h,n,r){return h<=n?0:h>=r?1:(h=(h-n)/(r-n))*h*(3-2*h)},smootherstep:function(h,n,r){return h<=n?0:h>=r?1:(h=(h-n)/(r-n))*h*h*(h*(6*h-15)+10)},randInt:function(h,n){return h+Math.floor(Math.random()*(n-h+1))},randFloat:function(h,n){return h+Math.random()*(n-h)},randFloatSpread:function(h){return h*(.5-Math.random())},seededRandom:function(h){return void 0!==h&&(ac=h%2147483647),ac=16807*ac%2147483647,(ac-1)/2147483646},degToRad:function(h){return h*bo},radToDeg:function(h){return h*Fs},isPowerOfTwo:Pu,ceilPowerOfTwo:Xm,floorPowerOfTwo:jm,setQuaternionFromProperEuler:function(h,n,r,l,c){const f=Math.cos,m=Math.sin,g=f(r/2),C=m(r/2),L=f((n+l)/2),G=m((n+l)/2),z=f((n-l)/2),X=m((n-l)/2),Q=f((l-n)/2),re=m((l-n)/2);switch(c){case"XYX":h.set(g*G,C*z,C*X,g*L);break;case"YZY":h.set(C*X,g*G,C*z,g*L);break;case"ZXZ":h.set(C*z,C*X,g*G,g*L);break;case"XZX":h.set(g*G,C*re,C*Q,g*L);break;case"YXY":h.set(C*Q,g*G,C*re,g*L);break;case"ZYZ":h.set(C*re,C*Q,g*G,g*L);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+c)}}});class st{constructor(n=0,r=0){this.x=n,this.y=r}get width(){return this.x}set width(n){this.x=n}get height(){return this.y}set height(n){this.y=n}set(n,r){return this.x=n,this.y=r,this}setScalar(n){return this.x=n,this.y=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setComponent(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y)}copy(n){return this.x=n.x,this.y=n.y,this}add(n,r){return void 0!==r?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this)}addScalar(n){return this.x+=n,this.y+=n,this}addVectors(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this}addScaledVector(n,r){return this.x+=n.x*r,this.y+=n.y*r,this}sub(n,r){return void 0!==r?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this)}subScalar(n){return this.x-=n,this.y-=n,this}subVectors(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divide(n){return this.x/=n.x,this.y/=n.y,this}divideScalar(n){return this.multiplyScalar(1/n)}applyMatrix3(n){const r=this.x,l=this.y,c=n.elements;return this.x=c[0]*r+c[3]*l+c[6],this.y=c[1]*r+c[4]*l+c[7],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this}clamp(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this}clampScalar(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this}clampLength(n,r){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(n,Math.min(r,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const r=this.x-n.x,l=this.y-n.y;return r*r+l*l}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this}lerpVectors(n,r,l){return this.x=n.x+(r.x-n.x)*l,this.y=n.y+(r.y-n.y)*l,this}equals(n){return n.x===this.x&&n.y===this.y}fromArray(n,r=0){return this.x=n[r],this.y=n[r+1],this}toArray(n=[],r=0){return n[r]=this.x,n[r+1]=this.y,n}fromBufferAttribute(n,r,l){return void 0!==l&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this}rotateAround(n,r){const l=Math.cos(r),c=Math.sin(r),f=this.x-n.x,m=this.y-n.y;return this.x=f*l-m*c+n.x,this.y=f*c+m*l+n.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}st.prototype.isVector2=!0;class Hr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(n,r,l,c,f,m,g,C,L){const G=this.elements;return G[0]=n,G[1]=c,G[2]=g,G[3]=r,G[4]=f,G[5]=C,G[6]=l,G[7]=m,G[8]=L,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(n){const r=this.elements,l=n.elements;return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],this}extractBasis(n,r,l){return n.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),l.setFromMatrix3Column(this,2),this}setFromMatrix4(n){const r=n.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,r){const l=n.elements,c=r.elements,f=this.elements,m=l[0],g=l[3],C=l[6],L=l[1],G=l[4],z=l[7],X=l[2],Q=l[5],re=l[8],ue=c[0],Te=c[3],se=c[6],J=c[1],Be=c[4],be=c[7],Ve=c[2],Ze=c[5],dt=c[8];return f[0]=m*ue+g*J+C*Ve,f[3]=m*Te+g*Be+C*Ze,f[6]=m*se+g*be+C*dt,f[1]=L*ue+G*J+z*Ve,f[4]=L*Te+G*Be+z*Ze,f[7]=L*se+G*be+z*dt,f[2]=X*ue+Q*J+re*Ve,f[5]=X*Te+Q*Be+re*Ze,f[8]=X*se+Q*be+re*dt,this}multiplyScalar(n){const r=this.elements;return r[0]*=n,r[3]*=n,r[6]*=n,r[1]*=n,r[4]*=n,r[7]*=n,r[2]*=n,r[5]*=n,r[8]*=n,this}determinant(){const n=this.elements,r=n[0],l=n[1],c=n[2],f=n[3],m=n[4],g=n[5],C=n[6],L=n[7],G=n[8];return r*m*G-r*g*L-l*f*G+l*g*C+c*f*L-c*m*C}invert(){const n=this.elements,r=n[0],l=n[1],c=n[2],f=n[3],m=n[4],g=n[5],C=n[6],L=n[7],G=n[8],z=G*m-g*L,X=g*C-G*f,Q=L*f-m*C,re=r*z+l*X+c*Q;if(0===re)return this.set(0,0,0,0,0,0,0,0,0);const ue=1/re;return n[0]=z*ue,n[1]=(c*L-G*l)*ue,n[2]=(g*l-c*m)*ue,n[3]=X*ue,n[4]=(G*r-c*C)*ue,n[5]=(c*f-g*r)*ue,n[6]=Q*ue,n[7]=(l*C-L*r)*ue,n[8]=(m*r-l*f)*ue,this}transpose(){let n;const r=this.elements;return n=r[1],r[1]=r[3],r[3]=n,n=r[2],r[2]=r[6],r[6]=n,n=r[5],r[5]=r[7],r[7]=n,this}getNormalMatrix(n){return this.setFromMatrix4(n).invert().transpose()}transposeIntoArray(n){const r=this.elements;return n[0]=r[0],n[1]=r[3],n[2]=r[6],n[3]=r[1],n[4]=r[4],n[5]=r[7],n[6]=r[2],n[7]=r[5],n[8]=r[8],this}setUvTransform(n,r,l,c,f,m,g){const C=Math.cos(f),L=Math.sin(f);return this.set(l*C,l*L,-l*(C*m+L*g)+m+n,-c*L,c*C,-c*(-L*m+C*g)+g+r,0,0,1),this}scale(n,r){const l=this.elements;return l[0]*=n,l[3]*=n,l[6]*=n,l[1]*=r,l[4]*=r,l[7]*=r,this}rotate(n){const r=Math.cos(n),l=Math.sin(n),c=this.elements,f=c[0],m=c[3],g=c[6],C=c[1],L=c[4],G=c[7];return c[0]=r*f+l*C,c[3]=r*m+l*L,c[6]=r*g+l*G,c[1]=-l*f+r*C,c[4]=-l*m+r*L,c[7]=-l*g+r*G,this}translate(n,r){const l=this.elements;return l[0]+=n*l[2],l[3]+=n*l[5],l[6]+=n*l[8],l[1]+=r*l[2],l[4]+=r*l[5],l[7]+=r*l[8],this}equals(n){const r=this.elements,l=n.elements;for(let c=0;c<9;c++)if(r[c]!==l[c])return!1;return!0}fromArray(n,r=0){for(let l=0;l<9;l++)this.elements[l]=n[l+r];return this}toArray(n=[],r=0){const l=this.elements;return n[r]=l[0],n[r+1]=l[1],n[r+2]=l[2],n[r+3]=l[3],n[r+4]=l[4],n[r+5]=l[5],n[r+6]=l[6],n[r+7]=l[7],n[r+8]=l[8],n}clone(){return(new this.constructor).fromArray(this.elements)}}function tp(h){for(let n=h.length-1;n>=0;--n)if(h[n]>65535)return!0;return!1}Hr.prototype.isMatrix3=!0;const rv={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ma(h,n){return new rv[h](n)}function _l(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}const lc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Jo={h:0,s:0,l:0},Iu={h:0,s:0,l:0};function aa(h,n,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?h+6*(n-h)*r:r<.5?n:r<2/3?h+6*(n-h)*(2/3-r):h}function zc(h){return h<.04045?.0773993808*h:Math.pow(.9478672986*h+.0521327014,2.4)}function to(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}let Ml,zn=(()=>{class h{constructor(r,l,c){return void 0===l&&void 0===c?this.set(r):this.setRGB(r,l,c)}set(r){return r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r),this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(255&r)/255,this}setRGB(r,l,c){return this.r=r,this.g=l,this.b=c,this}setHSL(r,l,c){if(r=$f(r,1),l=Po(l,0,1),c=Po(c,0,1),0===l)this.r=this.g=this.b=c;else{const f=c<=.5?c*(1+l):c+l-c*l,m=2*c-f;this.r=aa(m,f,r+1/3),this.g=aa(m,f,r),this.b=aa(m,f,r-1/3)}return this}setStyle(r){function l(f){void 0!==f&&parseFloat(f)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let c;if(c=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(r)){let f;const g=c[2];switch(c[1]){case"rgb":case"rgba":if(f=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(255,parseInt(f[1],10))/255,this.g=Math.min(255,parseInt(f[2],10))/255,this.b=Math.min(255,parseInt(f[3],10))/255,l(f[4]),this;if(f=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(f[1],10))/100,this.g=Math.min(100,parseInt(f[2],10))/100,this.b=Math.min(100,parseInt(f[3],10))/100,l(f[4]),this;break;case"hsl":case"hsla":if(f=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g)){const C=parseFloat(f[1])/360,L=parseInt(f[2],10)/100,G=parseInt(f[3],10)/100;return l(f[4]),this.setHSL(C,L,G)}}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(r)){const f=c[1],m=f.length;if(3===m)return this.r=parseInt(f.charAt(0)+f.charAt(0),16)/255,this.g=parseInt(f.charAt(1)+f.charAt(1),16)/255,this.b=parseInt(f.charAt(2)+f.charAt(2),16)/255,this;if(6===m)return this.r=parseInt(f.charAt(0)+f.charAt(1),16)/255,this.g=parseInt(f.charAt(2)+f.charAt(3),16)/255,this.b=parseInt(f.charAt(4)+f.charAt(5),16)/255,this}return r&&r.length>0?this.setColorName(r):this}setColorName(r){const l=lc[r.toLowerCase()];return void 0!==l?this.setHex(l):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=zc(r.r),this.g=zc(r.g),this.b=zc(r.b),this}copyLinearToSRGB(r){return this.r=to(r.r),this.g=to(r.g),this.b=to(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(r){const l=this.r,c=this.g,f=this.b,m=Math.max(l,c,f),g=Math.min(l,c,f);let C,L;const G=(g+m)/2;if(g===m)C=0,L=0;else{const z=m-g;switch(L=G<=.5?z/(m+g):z/(2-m-g),m){case l:C=(c-f)/z+(c<f?6:0);break;case c:C=(f-l)/z+2;break;case f:C=(l-c)/z+4}C/=6}return r.h=C,r.s=L,r.l=G,r}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(r,l,c){return this.getHSL(Jo),Jo.h+=r,Jo.s+=l,Jo.l+=c,this.setHSL(Jo.h,Jo.s,Jo.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,l){return this.r=r.r+l.r,this.g=r.g+l.g,this.b=r.b+l.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,l){return this.r+=(r.r-this.r)*l,this.g+=(r.g-this.g)*l,this.b+=(r.b-this.b)*l,this}lerpColors(r,l,c){return this.r=r.r+(l.r-r.r)*c,this.g=r.g+(l.g-r.g)*c,this.b=r.b+(l.b-r.b)*c,this}lerpHSL(r,l){this.getHSL(Jo),r.getHSL(Iu);const c=Rh(Jo.h,Iu.h,l),f=Rh(Jo.s,Iu.s,l),m=Rh(Jo.l,Iu.l,l);return this.setHSL(c,f,m),this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,l=0){return this.r=r[l],this.g=r[l+1],this.b=r[l+2],this}toArray(r=[],l=0){return r[l]=this.r,r[l+1]=this.g,r[l+2]=this.b,r}fromBufferAttribute(r,l){return this.r=r.getX(l),this.g=r.getY(l),this.b=r.getZ(l),!0===r.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return h.NAMES=lc,h})();zn.prototype.isColor=!0,zn.prototype.r=1,zn.prototype.g=1,zn.prototype.b=1;class tl{static getDataURL(n){if(/^data:/i.test(n.src)||"undefined"==typeof HTMLCanvasElement)return n.src;let r;if(n instanceof HTMLCanvasElement)r=n;else{void 0===Ml&&(Ml=_l("canvas")),Ml.width=n.width,Ml.height=n.height;const l=Ml.getContext("2d");n instanceof ImageData?l.putImageData(n,0,0):l.drawImage(n,0,0,n.width,n.height),r=Ml}return r.width>2048||r.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),r.toDataURL("image/jpeg",.6)):r.toDataURL("image/png")}static sRGBToLinear(n){if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&n instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap){const r=_l("canvas");r.width=n.width,r.height=n.height;const l=r.getContext("2d");l.drawImage(n,0,0,n.width,n.height);const c=l.getImageData(0,0,n.width,n.height),f=c.data;for(let m=0;m<f.length;m++)f[m]=255*zc(f[m]/255);return l.putImageData(c,0,0),r}if(n.data){const r=n.data.slice(0);for(let l=0;l<r.length;l++)r[l]=r instanceof Uint8Array||r instanceof Uint8ClampedArray?Math.floor(255*zc(r[l]/255)):zc(r[l]);return{data:r,width:n.width,height:n.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}}let Fd=0;class Rn extends el{constructor(n=Rn.DEFAULT_IMAGE,r=Rn.DEFAULT_MAPPING,l=dn,c=dn,f=vt,m=Fn,g=bt,C=Sn,L=1,G=ts){super(),Object.defineProperty(this,"id",{value:Fd++}),this.uuid=Xo(),this.name="",this.image=n,this.mipmaps=[],this.mapping=r,this.wrapS=l,this.wrapT=c,this.magFilter=f,this.minFilter=m,this.anisotropy=L,this.format=g,this.internalFormat=null,this.type=C,this.offset=new st(0,0),this.repeat=new st(1,1),this.center=new st(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Hr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=G,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(n){return this.name=n.name,this.image=n.image,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.encoding=n.encoding,this.userData=JSON.parse(JSON.stringify(n.userData)),this}toJSON(n){const r=void 0===n||"string"==typeof n;if(!r&&void 0!==n.textures[this.uuid])return n.textures[this.uuid];const l={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const c=this.image;if(void 0===c.uuid&&(c.uuid=Xo()),!r&&void 0===n.images[c.uuid]){let f;if(Array.isArray(c)){f=[];for(let m=0,g=c.length;m<g;m++)f.push(cc(c[m].isDataTexture?c[m].image:c[m]))}else f=cc(c);n.images[c.uuid]={uuid:c.uuid,url:f}}l.image=c.uuid}return"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),r||(n.textures[this.uuid]=l),l}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(n){if(this.mapping!==H)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case Tn:n.x=n.x-Math.floor(n.x);break;case dn:n.x=n.x<0?0:1;break;case rn:n.x=1===Math.abs(Math.floor(n.x)%2)?Math.ceil(n.x)-n.x:n.x-Math.floor(n.x)}if(n.y<0||n.y>1)switch(this.wrapT){case Tn:n.y=n.y-Math.floor(n.y);break;case dn:n.y=n.y<0?0:1;break;case rn:n.y=1===Math.abs(Math.floor(n.y)%2)?Math.ceil(n.y)-n.y:n.y-Math.floor(n.y)}return this.flipY&&(n.y=1-n.y),n}set needsUpdate(n){!0===n&&this.version++}}function cc(h){return"undefined"!=typeof HTMLImageElement&&h instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&h instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&h instanceof ImageBitmap?tl.getDataURL(h):h.data?{data:Array.prototype.slice.call(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Rn.DEFAULT_IMAGE=void 0,Rn.DEFAULT_MAPPING=H,Rn.prototype.isTexture=!0;class Or{constructor(n=0,r=0,l=0,c=1){this.x=n,this.y=r,this.z=l,this.w=c}get width(){return this.z}set width(n){this.z=n}get height(){return this.w}set height(n){this.w=n}set(n,r,l,c){return this.x=n,this.y=r,this.z=l,this.w=c,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this.w=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setW(n){return this.w=n,this}setComponent(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;case 3:this.w=r;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=void 0!==n.w?n.w:1,this}add(n,r){return void 0!==r?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this)}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this}addVectors(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this.z=n.z+r.z,this.w=n.w+r.w,this}addScaledVector(n,r){return this.x+=n.x*r,this.y+=n.y*r,this.z+=n.z*r,this.w+=n.w*r,this}sub(n,r){return void 0!==r?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this)}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this}subVectors(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this.z=n.z-r.z,this.w=n.w-r.w,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this}applyMatrix4(n){const r=this.x,l=this.y,c=this.z,f=this.w,m=n.elements;return this.x=m[0]*r+m[4]*l+m[8]*c+m[12]*f,this.y=m[1]*r+m[5]*l+m[9]*c+m[13]*f,this.z=m[2]*r+m[6]*l+m[10]*c+m[14]*f,this.w=m[3]*r+m[7]*l+m[11]*c+m[15]*f,this}divideScalar(n){return this.multiplyScalar(1/n)}setAxisAngleFromQuaternion(n){this.w=2*Math.acos(n.w);const r=Math.sqrt(1-n.w*n.w);return r<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/r,this.y=n.y/r,this.z=n.z/r),this}setAxisAngleFromRotationMatrix(n){let r,l,c,f;const m=.01,g=.1,C=n.elements,L=C[0],G=C[4],z=C[8],X=C[1],Q=C[5],re=C[9],ue=C[2],Te=C[6],se=C[10];if(Math.abs(G-X)<m&&Math.abs(z-ue)<m&&Math.abs(re-Te)<m){if(Math.abs(G+X)<g&&Math.abs(z+ue)<g&&Math.abs(re+Te)<g&&Math.abs(L+Q+se-3)<g)return this.set(1,0,0,0),this;r=Math.PI;const Be=(L+1)/2,be=(Q+1)/2,Ve=(se+1)/2,Ze=(G+X)/4,dt=(z+ue)/4,yt=(re+Te)/4;return Be>be&&Be>Ve?Be<m?(l=0,c=.707106781,f=.707106781):(l=Math.sqrt(Be),c=Ze/l,f=dt/l):be>Ve?be<m?(l=.707106781,c=0,f=.707106781):(c=Math.sqrt(be),l=Ze/c,f=yt/c):Ve<m?(l=.707106781,c=.707106781,f=0):(f=Math.sqrt(Ve),l=dt/f,c=yt/f),this.set(l,c,f,r),this}let J=Math.sqrt((Te-re)*(Te-re)+(z-ue)*(z-ue)+(X-G)*(X-G));return Math.abs(J)<.001&&(J=1),this.x=(Te-re)/J,this.y=(z-ue)/J,this.z=(X-G)/J,this.w=Math.acos((L+Q+se-1)/2),this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this}clamp(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this.z=Math.max(n.z,Math.min(r.z,this.z)),this.w=Math.max(n.w,Math.min(r.w,this.w)),this}clampScalar(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this.z=Math.max(n,Math.min(r,this.z)),this.w=Math.max(n,Math.min(r,this.w)),this}clampLength(n,r){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(n,Math.min(r,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this.z+=(n.z-this.z)*r,this.w+=(n.w-this.w)*r,this}lerpVectors(n,r,l){return this.x=n.x+(r.x-n.x)*l,this.y=n.y+(r.y-n.y)*l,this.z=n.z+(r.z-n.z)*l,this.w=n.w+(r.w-n.w)*l,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w}fromArray(n,r=0){return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this.w=n[r+3],this}toArray(n=[],r=0){return n[r]=this.x,n[r+1]=this.y,n[r+2]=this.z,n[r+3]=this.w,n}fromBufferAttribute(n,r,l){return void 0!==l&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this.z=n.getZ(r),this.w=n.getW(r),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Or.prototype.isVector4=!0;class Ro extends el{constructor(n,r,l={}){super(),this.width=n,this.height=r,this.depth=1,this.scissor=new Or(0,0,n,r),this.scissorTest=!1,this.viewport=new Or(0,0,n,r),this.texture=new Rn(void 0,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:n,height:r,depth:1},this.texture.generateMipmaps=void 0!==l.generateMipmaps&&l.generateMipmaps,this.texture.internalFormat=void 0!==l.internalFormat?l.internalFormat:null,this.texture.minFilter=void 0!==l.minFilter?l.minFilter:vt,this.depthBuffer=void 0===l.depthBuffer||l.depthBuffer,this.stencilBuffer=void 0!==l.stencilBuffer&&l.stencilBuffer,this.depthTexture=void 0!==l.depthTexture?l.depthTexture:null}setTexture(n){n.image={width:this.width,height:this.height,depth:this.depth},this.texture=n}setSize(n,r,l=1){(this.width!==n||this.height!==r||this.depth!==l)&&(this.width=n,this.height=r,this.depth=l,this.texture.image.width=n,this.texture.image.height=r,this.texture.image.depth=l,this.dispose()),this.viewport.set(0,0,n,r),this.scissor.set(0,0,n,r)}clone(){return(new this.constructor).copy(this)}copy(n){return this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.copy(n.viewport),this.texture=n.texture.clone(),this.texture.image=Object.assign({},n.texture.image),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ro.prototype.isWebGLRenderTarget=!0;class Od extends Ro{constructor(n,r,l){super(n,r);const c=this.texture;this.texture=[];for(let f=0;f<l;f++)this.texture[f]=c.clone()}setSize(n,r,l=1){if(this.width!==n||this.height!==r||this.depth!==l){this.width=n,this.height=r,this.depth=l;for(let c=0,f=this.texture.length;c<f;c++)this.texture[c].image.width=n,this.texture[c].image.height=r,this.texture[c].image.depth=l;this.dispose()}return this.viewport.set(0,0,n,r),this.scissor.set(0,0,n,r),this}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.texture.length=0;for(let r=0,l=n.texture.length;r<l;r++)this.texture[r]=n.texture[r].clone();return this}}Od.prototype.isWebGLMultipleRenderTargets=!0;class Ud extends Ro{constructor(n,r,l={}){super(n,r,l),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===l.ignoreDepth||l.ignoreDepth,this.useRenderToTexture=void 0!==l.useRenderToTexture&&l.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(n){return super.copy.call(this,n),this.samples=n.samples,this.useRenderToTexture=n.useRenderToTexture,this.useRenderbuffer=n.useRenderbuffer,this}}Ud.prototype.isWebGLMultisampleRenderTarget=!0;class as{constructor(n=0,r=0,l=0,c=1){this._x=n,this._y=r,this._z=l,this._w=c}static slerp(n,r,l,c){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),l.slerpQuaternions(n,r,c)}static slerpFlat(n,r,l,c,f,m,g){let C=l[c+0],L=l[c+1],G=l[c+2],z=l[c+3];const X=f[m+0],Q=f[m+1],re=f[m+2],ue=f[m+3];if(0===g)return n[r+0]=C,n[r+1]=L,n[r+2]=G,void(n[r+3]=z);if(1===g)return n[r+0]=X,n[r+1]=Q,n[r+2]=re,void(n[r+3]=ue);if(z!==ue||C!==X||L!==Q||G!==re){let Te=1-g;const se=C*X+L*Q+G*re+z*ue,J=se>=0?1:-1,Be=1-se*se;if(Be>Number.EPSILON){const Ve=Math.sqrt(Be),Ze=Math.atan2(Ve,se*J);Te=Math.sin(Te*Ze)/Ve,g=Math.sin(g*Ze)/Ve}const be=g*J;if(C=C*Te+X*be,L=L*Te+Q*be,G=G*Te+re*be,z=z*Te+ue*be,Te===1-g){const Ve=1/Math.sqrt(C*C+L*L+G*G+z*z);C*=Ve,L*=Ve,G*=Ve,z*=Ve}}n[r]=C,n[r+1]=L,n[r+2]=G,n[r+3]=z}static multiplyQuaternionsFlat(n,r,l,c,f,m){const g=l[c],C=l[c+1],L=l[c+2],G=l[c+3],z=f[m],X=f[m+1],Q=f[m+2],re=f[m+3];return n[r]=g*re+G*z+C*Q-L*X,n[r+1]=C*re+G*X+L*z-g*Q,n[r+2]=L*re+G*Q+g*X-C*z,n[r+3]=G*re-g*z-C*X-L*Q,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,r,l,c){return this._x=n,this._y=r,this._z=l,this._w=c,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,r){if(!n||!n.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const l=n._x,c=n._y,f=n._z,m=n._order,g=Math.cos,C=Math.sin,L=g(l/2),G=g(c/2),z=g(f/2),X=C(l/2),Q=C(c/2),re=C(f/2);switch(m){case"XYZ":this._x=X*G*z+L*Q*re,this._y=L*Q*z-X*G*re,this._z=L*G*re+X*Q*z,this._w=L*G*z-X*Q*re;break;case"YXZ":this._x=X*G*z+L*Q*re,this._y=L*Q*z-X*G*re,this._z=L*G*re-X*Q*z,this._w=L*G*z+X*Q*re;break;case"ZXY":this._x=X*G*z-L*Q*re,this._y=L*Q*z+X*G*re,this._z=L*G*re+X*Q*z,this._w=L*G*z-X*Q*re;break;case"ZYX":this._x=X*G*z-L*Q*re,this._y=L*Q*z+X*G*re,this._z=L*G*re-X*Q*z,this._w=L*G*z+X*Q*re;break;case"YZX":this._x=X*G*z+L*Q*re,this._y=L*Q*z+X*G*re,this._z=L*G*re-X*Q*z,this._w=L*G*z-X*Q*re;break;case"XZY":this._x=X*G*z-L*Q*re,this._y=L*Q*z-X*G*re,this._z=L*G*re+X*Q*z,this._w=L*G*z+X*Q*re;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+m)}return!1!==r&&this._onChangeCallback(),this}setFromAxisAngle(n,r){const l=r/2,c=Math.sin(l);return this._x=n.x*c,this._y=n.y*c,this._z=n.z*c,this._w=Math.cos(l),this._onChangeCallback(),this}setFromRotationMatrix(n){const r=n.elements,l=r[0],c=r[4],f=r[8],m=r[1],g=r[5],C=r[9],L=r[2],G=r[6],z=r[10],X=l+g+z;if(X>0){const Q=.5/Math.sqrt(X+1);this._w=.25/Q,this._x=(G-C)*Q,this._y=(f-L)*Q,this._z=(m-c)*Q}else if(l>g&&l>z){const Q=2*Math.sqrt(1+l-g-z);this._w=(G-C)/Q,this._x=.25*Q,this._y=(c+m)/Q,this._z=(f+L)/Q}else if(g>z){const Q=2*Math.sqrt(1+g-l-z);this._w=(f-L)/Q,this._x=(c+m)/Q,this._y=.25*Q,this._z=(C+G)/Q}else{const Q=2*Math.sqrt(1+z-l-g);this._w=(m-c)/Q,this._x=(f+L)/Q,this._y=(C+G)/Q,this._z=.25*Q}return this._onChangeCallback(),this}setFromUnitVectors(n,r){let l=n.dot(r)+1;return l<Number.EPSILON?(l=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=l):(this._x=0,this._y=-n.z,this._z=n.y,this._w=l)):(this._x=n.y*r.z-n.z*r.y,this._y=n.z*r.x-n.x*r.z,this._z=n.x*r.y-n.y*r.x,this._w=l),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(Po(this.dot(n),-1,1)))}rotateTowards(n,r){const l=this.angleTo(n);if(0===l)return this;const c=Math.min(1,r/l);return this.slerp(n,c),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return 0===n?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n,r){return void 0!==r?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(n,r)):this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,r){const l=n._x,c=n._y,f=n._z,m=n._w,g=r._x,C=r._y,L=r._z,G=r._w;return this._x=l*G+m*g+c*L-f*C,this._y=c*G+m*C+f*g-l*L,this._z=f*G+m*L+l*C-c*g,this._w=m*G-l*g-c*C-f*L,this._onChangeCallback(),this}slerp(n,r){if(0===r)return this;if(1===r)return this.copy(n);const l=this._x,c=this._y,f=this._z,m=this._w;let g=m*n._w+l*n._x+c*n._y+f*n._z;if(g<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,g=-g):this.copy(n),g>=1)return this._w=m,this._x=l,this._y=c,this._z=f,this;const C=1-g*g;if(C<=Number.EPSILON){const Q=1-r;return this._w=Q*m+r*this._w,this._x=Q*l+r*this._x,this._y=Q*c+r*this._y,this._z=Q*f+r*this._z,this.normalize(),this._onChangeCallback(),this}const L=Math.sqrt(C),G=Math.atan2(L,g),z=Math.sin((1-r)*G)/L,X=Math.sin(r*G)/L;return this._w=m*z+this._w*X,this._x=l*z+this._x*X,this._y=c*z+this._y*X,this._z=f*z+this._z*X,this._onChangeCallback(),this}slerpQuaternions(n,r,l){return this.copy(n).slerp(r,l)}random(){const n=Math.random(),r=Math.sqrt(1-n),l=Math.sqrt(n),c=2*Math.PI*Math.random(),f=2*Math.PI*Math.random();return this.set(r*Math.cos(c),l*Math.sin(f),l*Math.cos(f),r*Math.sin(c))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,r=0){return this._x=n[r],this._y=n[r+1],this._z=n[r+2],this._w=n[r+3],this._onChangeCallback(),this}toArray(n=[],r=0){return n[r]=this._x,n[r+1]=this._y,n[r+2]=this._z,n[r+3]=this._w,n}fromBufferAttribute(n,r){return this._x=n.getX(r),this._y=n.getY(r),this._z=n.getZ(r),this._w=n.getW(r),this}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}}as.prototype.isQuaternion=!0;class Oe{constructor(n=0,r=0,l=0){this.x=n,this.y=r,this.z=l}set(n,r,l){return void 0===l&&(l=this.z),this.x=n,this.y=r,this.z=l,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setComponent(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}add(n,r){return void 0!==r?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this)}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this}addVectors(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this.z=n.z+r.z,this}addScaledVector(n,r){return this.x+=n.x*r,this.y+=n.y*r,this.z+=n.z*r,this}sub(n,r){return void 0!==r?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this)}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this}subVectors(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this.z=n.z-r.z,this}multiply(n,r){return void 0!==r?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(n,r)):(this.x*=n.x,this.y*=n.y,this.z*=n.z,this)}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this}multiplyVectors(n,r){return this.x=n.x*r.x,this.y=n.y*r.y,this.z=n.z*r.z,this}applyEuler(n){return n&&n.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Lh.setFromEuler(n))}applyAxisAngle(n,r){return this.applyQuaternion(Lh.setFromAxisAngle(n,r))}applyMatrix3(n){const r=this.x,l=this.y,c=this.z,f=n.elements;return this.x=f[0]*r+f[3]*l+f[6]*c,this.y=f[1]*r+f[4]*l+f[7]*c,this.z=f[2]*r+f[5]*l+f[8]*c,this}applyNormalMatrix(n){return this.applyMatrix3(n).normalize()}applyMatrix4(n){const r=this.x,l=this.y,c=this.z,f=n.elements,m=1/(f[3]*r+f[7]*l+f[11]*c+f[15]);return this.x=(f[0]*r+f[4]*l+f[8]*c+f[12])*m,this.y=(f[1]*r+f[5]*l+f[9]*c+f[13])*m,this.z=(f[2]*r+f[6]*l+f[10]*c+f[14])*m,this}applyQuaternion(n){const r=this.x,l=this.y,c=this.z,f=n.x,m=n.y,g=n.z,C=n.w,L=C*r+m*c-g*l,G=C*l+g*r-f*c,z=C*c+f*l-m*r,X=-f*r-m*l-g*c;return this.x=L*C+X*-f+G*-g-z*-m,this.y=G*C+X*-m+z*-f-L*-g,this.z=z*C+X*-g+L*-m-G*-f,this}project(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)}unproject(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)}transformDirection(n){const r=this.x,l=this.y,c=this.z,f=n.elements;return this.x=f[0]*r+f[4]*l+f[8]*c,this.y=f[1]*r+f[5]*l+f[9]*c,this.z=f[2]*r+f[6]*l+f[10]*c,this.normalize()}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this}divideScalar(n){return this.multiplyScalar(1/n)}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this}clamp(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this.z=Math.max(n.z,Math.min(r.z,this.z)),this}clampScalar(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this.z=Math.max(n,Math.min(r,this.z)),this}clampLength(n,r){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(n,Math.min(r,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this.z+=(n.z-this.z)*r,this}lerpVectors(n,r,l){return this.x=n.x+(r.x-n.x)*l,this.y=n.y+(r.y-n.y)*l,this.z=n.z+(r.z-n.z)*l,this}cross(n,r){return void 0!==r?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(n,r)):this.crossVectors(this,n)}crossVectors(n,r){const l=n.x,c=n.y,f=n.z,m=r.x,g=r.y,C=r.z;return this.x=c*C-f*g,this.y=f*m-l*C,this.z=l*g-c*m,this}projectOnVector(n){const r=n.lengthSq();if(0===r)return this.set(0,0,0);const l=n.dot(this)/r;return this.copy(n).multiplyScalar(l)}projectOnPlane(n){return Io.copy(this).projectOnVector(n),this.sub(Io)}reflect(n){return this.sub(Io.copy(n).multiplyScalar(2*this.dot(n)))}angleTo(n){const r=Math.sqrt(this.lengthSq()*n.lengthSq());if(0===r)return Math.PI/2;const l=this.dot(n)/r;return Math.acos(Po(l,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const r=this.x-n.x,l=this.y-n.y,c=this.z-n.z;return r*r+l*l+c*c}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)}setFromSpherical(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)}setFromSphericalCoords(n,r,l){const c=Math.sin(r)*n;return this.x=c*Math.sin(l),this.y=Math.cos(r)*n,this.z=c*Math.cos(l),this}setFromCylindrical(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)}setFromCylindricalCoords(n,r,l){return this.x=n*Math.sin(r),this.y=l,this.z=n*Math.cos(r),this}setFromMatrixPosition(n){const r=n.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this}setFromMatrixScale(n){const r=this.setFromMatrixColumn(n,0).length(),l=this.setFromMatrixColumn(n,1).length(),c=this.setFromMatrixColumn(n,2).length();return this.x=r,this.y=l,this.z=c,this}setFromMatrixColumn(n,r){return this.fromArray(n.elements,4*r)}setFromMatrix3Column(n,r){return this.fromArray(n.elements,3*r)}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z}fromArray(n,r=0){return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this}toArray(n=[],r=0){return n[r]=this.x,n[r+1]=this.y,n[r+2]=this.z,n}fromBufferAttribute(n,r,l){return void 0!==l&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this.z=n.getZ(r),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const n=2*(Math.random()-.5),r=Math.random()*Math.PI*2,l=Math.sqrt(1-n**2);return this.x=l*Math.cos(r),this.y=l*Math.sin(r),this.z=n,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Oe.prototype.isVector3=!0;const Io=new Oe,Lh=new as;class la{constructor(n=new Oe(1/0,1/0,1/0),r=new Oe(-1/0,-1/0,-1/0)){this.min=n,this.max=r}set(n,r){return this.min.copy(n),this.max.copy(r),this}setFromArray(n){let r=1/0,l=1/0,c=1/0,f=-1/0,m=-1/0,g=-1/0;for(let C=0,L=n.length;C<L;C+=3){const G=n[C],z=n[C+1],X=n[C+2];G<r&&(r=G),z<l&&(l=z),X<c&&(c=X),G>f&&(f=G),z>m&&(m=z),X>g&&(g=X)}return this.min.set(r,l,c),this.max.set(f,m,g),this}setFromBufferAttribute(n){let r=1/0,l=1/0,c=1/0,f=-1/0,m=-1/0,g=-1/0;for(let C=0,L=n.count;C<L;C++){const G=n.getX(C),z=n.getY(C),X=n.getZ(C);G<r&&(r=G),z<l&&(l=z),X<c&&(c=X),G>f&&(f=G),z>m&&(m=z),X>g&&(g=X)}return this.min.set(r,l,c),this.max.set(f,m,g),this}setFromPoints(n){this.makeEmpty();for(let r=0,l=n.length;r<l;r++)this.expandByPoint(n[r]);return this}setFromCenterAndSize(n,r){const l=Vc.copy(r).multiplyScalar(.5);return this.min.copy(n).sub(l),this.max.copy(n).add(l),this}setFromObject(n,r=!1){return this.makeEmpty(),this.expandByObject(n,r)}clone(){return(new this.constructor).copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,r=!1){n.updateWorldMatrix(!1,!1);const l=n.geometry;if(void 0!==l)if(r&&null!=l.attributes&&void 0!==l.attributes.position){const f=l.attributes.position;for(let m=0,g=f.count;m<g;m++)Vc.fromBufferAttribute(f,m).applyMatrix4(n.matrixWorld),this.expandByPoint(Vc)}else null===l.boundingBox&&l.computeBoundingBox(),np.copy(l.boundingBox),np.applyMatrix4(n.matrixWorld),this.union(np);const c=n.children;for(let f=0,m=c.length;f<m;f++)this.expandByObject(c[f],r);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,r){return r.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,Vc),Vc.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let r,l;return n.normal.x>0?(r=n.normal.x*this.min.x,l=n.normal.x*this.max.x):(r=n.normal.x*this.max.x,l=n.normal.x*this.min.x),n.normal.y>0?(r+=n.normal.y*this.min.y,l+=n.normal.y*this.max.y):(r+=n.normal.y*this.max.y,l+=n.normal.y*this.min.y),n.normal.z>0?(r+=n.normal.z*this.min.z,l+=n.normal.z*this.max.z):(r+=n.normal.z*this.max.z,l+=n.normal.z*this.min.z),r<=-n.constant&&l>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(Sa),Bu.subVectors(this.max,Sa),no.subVectors(n.a,Sa),ze.subVectors(n.b,Sa),uc.subVectors(n.c,Sa),Tl.subVectors(ze,no),Eo.subVectors(uc,ze),jo.subVectors(no,uc);let r=[0,-Tl.z,Tl.y,0,-Eo.z,Eo.y,0,-jo.z,jo.y,Tl.z,0,-Tl.x,Eo.z,0,-Eo.x,jo.z,0,-jo.x,-Tl.y,Tl.x,0,-Eo.y,Eo.x,0,-jo.y,jo.x,0];return!(!hc(r,no,ze,uc,Bu)||(r=[1,0,0,0,1,0,0,0,1],!hc(r,no,ze,uc,Bu)))&&(Sl.crossVectors(Tl,Eo),r=[Sl.x,Sl.y,Sl.z],hc(r,no,ze,uc,Bu))}clampPoint(n,r){return r.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return Vc.copy(n).clamp(this.min,this.max).sub(n).length()}getBoundingSphere(n){return this.getCenter(n.center),n.radius=.5*this.getSize(Vc).length(),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()||(Ta[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),Ta[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),Ta[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),Ta[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),Ta[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),Ta[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),Ta[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),Ta[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(Ta)),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}la.prototype.isBox3=!0;const Ta=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe],Vc=new Oe,np=new la,no=new Oe,ze=new Oe,uc=new Oe,Tl=new Oe,Eo=new Oe,jo=new Oe,Sa=new Oe,Bu=new Oe,Sl=new Oe,ma=new Oe;function hc(h,n,r,l,c){for(let f=0,m=h.length-3;f<=m;f+=3){ma.fromArray(h,f);const g=c.x*Math.abs(ma.x)+c.y*Math.abs(ma.y)+c.z*Math.abs(ma.z),C=n.dot(ma),L=r.dot(ma),G=l.dot(ma);if(Math.max(-Math.max(C,L,G),Math.min(C,L,G))>g)return!1}return!0}const dc=new la,Cl=new Oe,nl=new Oe,Wc=new Oe;class Ca{constructor(n=new Oe,r=-1){this.center=n,this.radius=r}set(n,r){return this.center.copy(n),this.radius=r,this}setFromPoints(n,r){const l=this.center;void 0!==r?l.copy(r):dc.setFromPoints(n).getCenter(l);let c=0;for(let f=0,m=n.length;f<m;f++)c=Math.max(c,l.distanceToSquared(n[f]));return this.radius=Math.sqrt(c),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const r=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=r*r}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,r){const l=this.center.distanceToSquared(n);return r.copy(n),l>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){Wc.subVectors(n,this.center);const r=Wc.lengthSq();if(r>this.radius*this.radius){const l=Math.sqrt(r),c=.5*(l-this.radius);this.center.add(Wc.multiplyScalar(c/l)),this.radius+=c}return this}union(n){return!0===this.center.equals(n.center)?nl.set(0,0,1).multiplyScalar(n.radius):nl.subVectors(n.center,this.center).normalize().multiplyScalar(n.radius),this.expandByPoint(Cl.copy(n.center).add(nl)),this.expandByPoint(Cl.copy(n.center).sub(nl)),this}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ga=new Oe,Rl=new Oe,Fu=new Oe,fc=new Oe,Nd=new Oe,Xc=new Oe,Dh=new Oe;class $o{constructor(n=new Oe,r=new Oe(0,0,-1)){this.origin=n,this.direction=r}set(n,r){return this.origin.copy(n),this.direction.copy(r),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,r){return r.copy(this.direction).multiplyScalar(n).add(this.origin)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,ga)),this}closestPointToPoint(n,r){r.subVectors(n,this.origin);const l=r.dot(this.direction);return l<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(l).add(this.origin)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const r=ga.subVectors(n,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(n):(ga.copy(this.direction).multiplyScalar(r).add(this.origin),ga.distanceToSquared(n))}distanceSqToSegment(n,r,l,c){Rl.copy(n).add(r).multiplyScalar(.5),Fu.copy(r).sub(n).normalize(),fc.copy(this.origin).sub(Rl);const f=.5*n.distanceTo(r),m=-this.direction.dot(Fu),g=fc.dot(this.direction),C=-fc.dot(Fu),L=fc.lengthSq(),G=Math.abs(1-m*m);let z,X,Q,re;if(G>0)if(z=m*C-g,X=m*g-C,re=f*G,z>=0)if(X>=-re)if(X<=re){const ue=1/G;z*=ue,X*=ue,Q=z*(z+m*X+2*g)+X*(m*z+X+2*C)+L}else X=f,z=Math.max(0,-(m*X+g)),Q=-z*z+X*(X+2*C)+L;else X=-f,z=Math.max(0,-(m*X+g)),Q=-z*z+X*(X+2*C)+L;else X<=-re?(z=Math.max(0,-(-m*f+g)),X=z>0?-f:Math.min(Math.max(-f,-C),f),Q=-z*z+X*(X+2*C)+L):X<=re?(z=0,X=Math.min(Math.max(-f,-C),f),Q=X*(X+2*C)+L):(z=Math.max(0,-(m*f+g)),X=z>0?f:Math.min(Math.max(-f,-C),f),Q=-z*z+X*(X+2*C)+L);else X=m>0?-f:f,z=Math.max(0,-(m*X+g)),Q=-z*z+X*(X+2*C)+L;return l&&l.copy(this.direction).multiplyScalar(z).add(this.origin),c&&c.copy(Fu).multiplyScalar(X).add(Rl),Q}intersectSphere(n,r){ga.subVectors(n.center,this.origin);const l=ga.dot(this.direction),c=ga.dot(ga)-l*l,f=n.radius*n.radius;if(c>f)return null;const m=Math.sqrt(f-c),g=l-m,C=l+m;return g<0&&C<0?null:this.at(g<0?C:g,r)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const r=n.normal.dot(this.direction);if(0===r)return 0===n.distanceToPoint(this.origin)?0:null;const l=-(this.origin.dot(n.normal)+n.constant)/r;return l>=0?l:null}intersectPlane(n,r){const l=this.distanceToPlane(n);return null===l?null:this.at(l,r)}intersectsPlane(n){const r=n.distanceToPoint(this.origin);return 0===r||n.normal.dot(this.direction)*r<0}intersectBox(n,r){let l,c,f,m,g,C;const L=1/this.direction.x,G=1/this.direction.y,z=1/this.direction.z,X=this.origin;return L>=0?(l=(n.min.x-X.x)*L,c=(n.max.x-X.x)*L):(l=(n.max.x-X.x)*L,c=(n.min.x-X.x)*L),G>=0?(f=(n.min.y-X.y)*G,m=(n.max.y-X.y)*G):(f=(n.max.y-X.y)*G,m=(n.min.y-X.y)*G),l>m||f>c||((f>l||l!=l)&&(l=f),(m<c||c!=c)&&(c=m),z>=0?(g=(n.min.z-X.z)*z,C=(n.max.z-X.z)*z):(g=(n.max.z-X.z)*z,C=(n.min.z-X.z)*z),l>C||g>c)||((g>l||l!=l)&&(l=g),(C<c||c!=c)&&(c=C),c<0)?null:this.at(l>=0?l:c,r)}intersectsBox(n){return null!==this.intersectBox(n,ga)}intersectTriangle(n,r,l,c,f){Nd.subVectors(r,n),Xc.subVectors(l,n),Dh.crossVectors(Nd,Xc);let g,m=this.direction.dot(Dh);if(m>0){if(c)return null;g=1}else{if(!(m<0))return null;g=-1,m=-m}fc.subVectors(this.origin,n);const C=g*this.direction.dot(Xc.crossVectors(fc,Xc));if(C<0)return null;const L=g*this.direction.dot(Nd.cross(fc));if(L<0||C+L>m)return null;const G=-g*fc.dot(Dh);return G<0?null:this.at(G/m,f)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ri{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(n,r,l,c,f,m,g,C,L,G,z,X,Q,re,ue,Te){const se=this.elements;return se[0]=n,se[4]=r,se[8]=l,se[12]=c,se[1]=f,se[5]=m,se[9]=g,se[13]=C,se[2]=L,se[6]=G,se[10]=z,se[14]=X,se[3]=Q,se[7]=re,se[11]=ue,se[15]=Te,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ri).fromArray(this.elements)}copy(n){const r=this.elements,l=n.elements;return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],this}copyPosition(n){const r=this.elements,l=n.elements;return r[12]=l[12],r[13]=l[13],r[14]=l[14],this}setFromMatrix3(n){const r=n.elements;return this.set(r[0],r[3],r[6],0,r[1],r[4],r[7],0,r[2],r[5],r[8],0,0,0,0,1),this}extractBasis(n,r,l){return n.setFromMatrixColumn(this,0),r.setFromMatrixColumn(this,1),l.setFromMatrixColumn(this,2),this}makeBasis(n,r,l){return this.set(n.x,r.x,l.x,0,n.y,r.y,l.y,0,n.z,r.z,l.z,0,0,0,0,1),this}extractRotation(n){const r=this.elements,l=n.elements,c=1/pc.setFromMatrixColumn(n,0).length(),f=1/pc.setFromMatrixColumn(n,1).length(),m=1/pc.setFromMatrixColumn(n,2).length();return r[0]=l[0]*c,r[1]=l[1]*c,r[2]=l[2]*c,r[3]=0,r[4]=l[4]*f,r[5]=l[5]*f,r[6]=l[6]*f,r[7]=0,r[8]=l[8]*m,r[9]=l[9]*m,r[10]=l[10]*m,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}makeRotationFromEuler(n){n&&n.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const r=this.elements,l=n.x,c=n.y,f=n.z,m=Math.cos(l),g=Math.sin(l),C=Math.cos(c),L=Math.sin(c),G=Math.cos(f),z=Math.sin(f);if("XYZ"===n.order){const X=m*G,Q=m*z,re=g*G,ue=g*z;r[0]=C*G,r[4]=-C*z,r[8]=L,r[1]=Q+re*L,r[5]=X-ue*L,r[9]=-g*C,r[2]=ue-X*L,r[6]=re+Q*L,r[10]=m*C}else if("YXZ"===n.order){const X=C*G,Q=C*z,re=L*G,ue=L*z;r[0]=X+ue*g,r[4]=re*g-Q,r[8]=m*L,r[1]=m*z,r[5]=m*G,r[9]=-g,r[2]=Q*g-re,r[6]=ue+X*g,r[10]=m*C}else if("ZXY"===n.order){const X=C*G,Q=C*z,re=L*G,ue=L*z;r[0]=X-ue*g,r[4]=-m*z,r[8]=re+Q*g,r[1]=Q+re*g,r[5]=m*G,r[9]=ue-X*g,r[2]=-m*L,r[6]=g,r[10]=m*C}else if("ZYX"===n.order){const X=m*G,Q=m*z,re=g*G,ue=g*z;r[0]=C*G,r[4]=re*L-Q,r[8]=X*L+ue,r[1]=C*z,r[5]=ue*L+X,r[9]=Q*L-re,r[2]=-L,r[6]=g*C,r[10]=m*C}else if("YZX"===n.order){const X=m*C,Q=m*L,re=g*C,ue=g*L;r[0]=C*G,r[4]=ue-X*z,r[8]=re*z+Q,r[1]=z,r[5]=m*G,r[9]=-g*G,r[2]=-L*G,r[6]=Q*z+re,r[10]=X-ue*z}else if("XZY"===n.order){const X=m*C,Q=m*L,re=g*C,ue=g*L;r[0]=C*G,r[4]=-z,r[8]=L*G,r[1]=X*z+ue,r[5]=m*G,r[9]=Q*z-re,r[2]=re*z-Q,r[6]=g*G,r[10]=ue*z+X}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}makeRotationFromQuaternion(n){return this.compose(mc,n,ip)}lookAt(n,r,l){const c=this.elements;return wo.subVectors(n,r),0===wo.lengthSq()&&(wo.z=1),wo.normalize(),Ra.crossVectors(l,wo),0===Ra.lengthSq()&&(1===Math.abs(l.z)?wo.x+=1e-4:wo.z+=1e-4,wo.normalize(),Ra.crossVectors(l,wo)),Ra.normalize(),Ou.crossVectors(wo,Ra),c[0]=Ra.x,c[4]=Ou.x,c[8]=wo.x,c[1]=Ra.y,c[5]=Ou.y,c[9]=wo.y,c[2]=Ra.z,c[6]=Ou.z,c[10]=wo.z,this}multiply(n,r){return void 0!==r?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(n,r)):this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,r){const l=n.elements,c=r.elements,f=this.elements,m=l[0],g=l[4],C=l[8],L=l[12],G=l[1],z=l[5],X=l[9],Q=l[13],re=l[2],ue=l[6],Te=l[10],se=l[14],J=l[3],Be=l[7],be=l[11],Ve=l[15],Ze=c[0],dt=c[4],yt=c[8],It=c[12],Ht=c[1],_e=c[5],Ke=c[9],Et=c[13],Mt=c[2],At=c[6],Ft=c[10],en=c[14],Cn=c[3],xi=c[7],Di=c[11],ci=c[15];return f[0]=m*Ze+g*Ht+C*Mt+L*Cn,f[4]=m*dt+g*_e+C*At+L*xi,f[8]=m*yt+g*Ke+C*Ft+L*Di,f[12]=m*It+g*Et+C*en+L*ci,f[1]=G*Ze+z*Ht+X*Mt+Q*Cn,f[5]=G*dt+z*_e+X*At+Q*xi,f[9]=G*yt+z*Ke+X*Ft+Q*Di,f[13]=G*It+z*Et+X*en+Q*ci,f[2]=re*Ze+ue*Ht+Te*Mt+se*Cn,f[6]=re*dt+ue*_e+Te*At+se*xi,f[10]=re*yt+ue*Ke+Te*Ft+se*Di,f[14]=re*It+ue*Et+Te*en+se*ci,f[3]=J*Ze+Be*Ht+be*Mt+Ve*Cn,f[7]=J*dt+Be*_e+be*At+Ve*xi,f[11]=J*yt+Be*Ke+be*Ft+Ve*Di,f[15]=J*It+Be*Et+be*en+Ve*ci,this}multiplyScalar(n){const r=this.elements;return r[0]*=n,r[4]*=n,r[8]*=n,r[12]*=n,r[1]*=n,r[5]*=n,r[9]*=n,r[13]*=n,r[2]*=n,r[6]*=n,r[10]*=n,r[14]*=n,r[3]*=n,r[7]*=n,r[11]*=n,r[15]*=n,this}determinant(){const n=this.elements,r=n[0],l=n[4],c=n[8],f=n[12],m=n[1],g=n[5],C=n[9],L=n[13],G=n[2],z=n[6],X=n[10],Q=n[14];return n[3]*(+f*C*z-c*L*z-f*g*X+l*L*X+c*g*Q-l*C*Q)+n[7]*(+r*C*Q-r*L*X+f*m*X-c*m*Q+c*L*G-f*C*G)+n[11]*(+r*L*z-r*g*Q-f*m*z+l*m*Q+f*g*G-l*L*G)+n[15]*(-c*g*G-r*C*z+r*g*X+c*m*z-l*m*X+l*C*G)}transpose(){const n=this.elements;let r;return r=n[1],n[1]=n[4],n[4]=r,r=n[2],n[2]=n[8],n[8]=r,r=n[6],n[6]=n[9],n[9]=r,r=n[3],n[3]=n[12],n[12]=r,r=n[7],n[7]=n[13],n[13]=r,r=n[11],n[11]=n[14],n[14]=r,this}setPosition(n,r,l){const c=this.elements;return n.isVector3?(c[12]=n.x,c[13]=n.y,c[14]=n.z):(c[12]=n,c[13]=r,c[14]=l),this}invert(){const n=this.elements,r=n[0],l=n[1],c=n[2],f=n[3],m=n[4],g=n[5],C=n[6],L=n[7],G=n[8],z=n[9],X=n[10],Q=n[11],re=n[12],ue=n[13],Te=n[14],se=n[15],J=z*Te*L-ue*X*L+ue*C*Q-g*Te*Q-z*C*se+g*X*se,Be=re*X*L-G*Te*L-re*C*Q+m*Te*Q+G*C*se-m*X*se,be=G*ue*L-re*z*L+re*g*Q-m*ue*Q-G*g*se+m*z*se,Ve=re*z*C-G*ue*C-re*g*X+m*ue*X+G*g*Te-m*z*Te,Ze=r*J+l*Be+c*be+f*Ve;if(0===Ze)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const dt=1/Ze;return n[0]=J*dt,n[1]=(ue*X*f-z*Te*f-ue*c*Q+l*Te*Q+z*c*se-l*X*se)*dt,n[2]=(g*Te*f-ue*C*f+ue*c*L-l*Te*L-g*c*se+l*C*se)*dt,n[3]=(z*C*f-g*X*f-z*c*L+l*X*L+g*c*Q-l*C*Q)*dt,n[4]=Be*dt,n[5]=(G*Te*f-re*X*f+re*c*Q-r*Te*Q-G*c*se+r*X*se)*dt,n[6]=(re*C*f-m*Te*f-re*c*L+r*Te*L+m*c*se-r*C*se)*dt,n[7]=(m*X*f-G*C*f+G*c*L-r*X*L-m*c*Q+r*C*Q)*dt,n[8]=be*dt,n[9]=(re*z*f-G*ue*f-re*l*Q+r*ue*Q+G*l*se-r*z*se)*dt,n[10]=(m*ue*f-re*g*f+re*l*L-r*ue*L-m*l*se+r*g*se)*dt,n[11]=(G*g*f-m*z*f-G*l*L+r*z*L+m*l*Q-r*g*Q)*dt,n[12]=Ve*dt,n[13]=(G*ue*c-re*z*c+re*l*X-r*ue*X-G*l*Te+r*z*Te)*dt,n[14]=(re*g*c-m*ue*c-re*l*C+r*ue*C+m*l*Te-r*g*Te)*dt,n[15]=(m*z*c-G*g*c+G*l*C-r*z*C-m*l*X+r*g*X)*dt,this}scale(n){const r=this.elements,l=n.x,c=n.y,f=n.z;return r[0]*=l,r[4]*=c,r[8]*=f,r[1]*=l,r[5]*=c,r[9]*=f,r[2]*=l,r[6]*=c,r[10]*=f,r[3]*=l,r[7]*=c,r[11]*=f,this}getMaxScaleOnAxis(){const n=this.elements;return Math.sqrt(Math.max(n[0]*n[0]+n[1]*n[1]+n[2]*n[2],n[4]*n[4]+n[5]*n[5]+n[6]*n[6],n[8]*n[8]+n[9]*n[9]+n[10]*n[10]))}makeTranslation(n,r,l){return this.set(1,0,0,n,0,1,0,r,0,0,1,l,0,0,0,1),this}makeRotationX(n){const r=Math.cos(n),l=Math.sin(n);return this.set(1,0,0,0,0,r,-l,0,0,l,r,0,0,0,0,1),this}makeRotationY(n){const r=Math.cos(n),l=Math.sin(n);return this.set(r,0,l,0,0,1,0,0,-l,0,r,0,0,0,0,1),this}makeRotationZ(n){const r=Math.cos(n),l=Math.sin(n);return this.set(r,-l,0,0,l,r,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(n,r){const l=Math.cos(r),c=Math.sin(r),f=1-l,m=n.x,g=n.y,C=n.z,L=f*m,G=f*g;return this.set(L*m+l,L*g-c*C,L*C+c*g,0,L*g+c*C,G*g+l,G*C-c*m,0,L*C-c*g,G*C+c*m,f*C*C+l,0,0,0,0,1),this}makeScale(n,r,l){return this.set(n,0,0,0,0,r,0,0,0,0,l,0,0,0,0,1),this}makeShear(n,r,l,c,f,m){return this.set(1,l,f,0,n,1,m,0,r,c,1,0,0,0,0,1),this}compose(n,r,l){const c=this.elements,f=r._x,m=r._y,g=r._z,C=r._w,L=f+f,G=m+m,z=g+g,X=f*L,Q=f*G,re=f*z,ue=m*G,Te=m*z,se=g*z,J=C*L,Be=C*G,be=C*z,Ve=l.x,Ze=l.y,dt=l.z;return c[0]=(1-(ue+se))*Ve,c[1]=(Q+be)*Ve,c[2]=(re-Be)*Ve,c[3]=0,c[4]=(Q-be)*Ze,c[5]=(1-(X+se))*Ze,c[6]=(Te+J)*Ze,c[7]=0,c[8]=(re+Be)*dt,c[9]=(Te-J)*dt,c[10]=(1-(X+ue))*dt,c[11]=0,c[12]=n.x,c[13]=n.y,c[14]=n.z,c[15]=1,this}decompose(n,r,l){const c=this.elements;let f=pc.set(c[0],c[1],c[2]).length();const m=pc.set(c[4],c[5],c[6]).length(),g=pc.set(c[8],c[9],c[10]).length();this.determinant()<0&&(f=-f),n.x=c[12],n.y=c[13],n.z=c[14],ea.copy(this);const L=1/f,G=1/m,z=1/g;return ea.elements[0]*=L,ea.elements[1]*=L,ea.elements[2]*=L,ea.elements[4]*=G,ea.elements[5]*=G,ea.elements[6]*=G,ea.elements[8]*=z,ea.elements[9]*=z,ea.elements[10]*=z,r.setFromRotationMatrix(ea),l.x=f,l.y=m,l.z=g,this}makePerspective(n,r,l,c,f,m){void 0===m&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const g=this.elements,L=2*f/(l-c),G=(r+n)/(r-n),z=(l+c)/(l-c),X=-(m+f)/(m-f),Q=-2*m*f/(m-f);return g[0]=2*f/(r-n),g[4]=0,g[8]=G,g[12]=0,g[1]=0,g[5]=L,g[9]=z,g[13]=0,g[2]=0,g[6]=0,g[10]=X,g[14]=Q,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(n,r,l,c,f,m){const g=this.elements,C=1/(r-n),L=1/(l-c),G=1/(m-f),z=(r+n)*C,X=(l+c)*L,Q=(m+f)*G;return g[0]=2*C,g[4]=0,g[8]=0,g[12]=-z,g[1]=0,g[5]=2*L,g[9]=0,g[13]=-X,g[2]=0,g[6]=0,g[10]=-2*G,g[14]=-Q,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(n){const r=this.elements,l=n.elements;for(let c=0;c<16;c++)if(r[c]!==l[c])return!1;return!0}fromArray(n,r=0){for(let l=0;l<16;l++)this.elements[l]=n[l+r];return this}toArray(n=[],r=0){const l=this.elements;return n[r]=l[0],n[r+1]=l[1],n[r+2]=l[2],n[r+3]=l[3],n[r+4]=l[4],n[r+5]=l[5],n[r+6]=l[6],n[r+7]=l[7],n[r+8]=l[8],n[r+9]=l[9],n[r+10]=l[10],n[r+11]=l[11],n[r+12]=l[12],n[r+13]=l[13],n[r+14]=l[14],n[r+15]=l[15],n}}ri.prototype.isMatrix4=!0;const pc=new Oe,ea=new ri,mc=new Oe(0,0,0),ip=new Oe(1,1,1),Ra=new Oe,Ou=new Oe,wo=new Oe,_i=new ri,jc=new as;class Bo{constructor(n=0,r=0,l=0,c=Bo.DefaultOrder){this._x=n,this._y=r,this._z=l,this._order=c}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get order(){return this._order}set order(n){this._order=n,this._onChangeCallback()}set(n,r,l,c=this._order){return this._x=n,this._y=r,this._z=l,this._order=c,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this}setFromRotationMatrix(n,r=this._order,l=!0){const c=n.elements,f=c[0],m=c[4],g=c[8],C=c[1],L=c[5],G=c[9],z=c[2],X=c[6],Q=c[10];switch(r){case"XYZ":this._y=Math.asin(Po(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-G,Q),this._z=Math.atan2(-m,f)):(this._x=Math.atan2(X,L),this._z=0);break;case"YXZ":this._x=Math.asin(-Po(G,-1,1)),Math.abs(G)<.9999999?(this._y=Math.atan2(g,Q),this._z=Math.atan2(C,L)):(this._y=Math.atan2(-z,f),this._z=0);break;case"ZXY":this._x=Math.asin(Po(X,-1,1)),Math.abs(X)<.9999999?(this._y=Math.atan2(-z,Q),this._z=Math.atan2(-m,L)):(this._y=0,this._z=Math.atan2(C,f));break;case"ZYX":this._y=Math.asin(-Po(z,-1,1)),Math.abs(z)<.9999999?(this._x=Math.atan2(X,Q),this._z=Math.atan2(C,f)):(this._x=0,this._z=Math.atan2(-m,L));break;case"YZX":this._z=Math.asin(Po(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-G,L),this._y=Math.atan2(-z,f)):(this._x=0,this._y=Math.atan2(g,Q));break;case"XZY":this._z=Math.asin(-Po(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(X,L),this._y=Math.atan2(g,f)):(this._x=Math.atan2(-G,Q),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!0===l&&this._onChangeCallback(),this}setFromQuaternion(n,r,l){return _i.makeRotationFromQuaternion(n),this.setFromRotationMatrix(_i,r,l)}setFromVector3(n,r=this._order){return this.set(n.x,n.y,n.z,r)}reorder(n){return jc.setFromEuler(this),this.setFromQuaternion(jc,n)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order}fromArray(n){return this._x=n[0],this._y=n[1],this._z=n[2],void 0!==n[3]&&(this._order=n[3]),this._onChangeCallback(),this}toArray(n=[],r=0){return n[r]=this._x,n[r+1]=this._y,n[r+2]=this._z,n[r+3]=this._order,n}toVector3(n){return n?n.set(this._x,this._y,this._z):new Oe(this._x,this._y,this._z)}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}}Bo.prototype.isEuler=!0,Bo.DefaultOrder="XYZ",Bo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class kd{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return 0!=(this.mask&n.mask)}isEnabled(n){return 0!=(this.mask&(1<<n|0))}}let sv=0;const Ll=new Oe,Dl=new as,io=new ri,Ph=new Oe,Uu=new Oe,Yc=new Oe,rp=new as,Ym=new Oe(1,0,0),sp=new Oe(0,1,0),Qc=new Oe(0,0,1),Pl={type:"added"},Ih={type:"removed"};class Er extends el{constructor(){super(),Object.defineProperty(this,"id",{value:sv++}),this.uuid=Xo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Er.DefaultUp.clone();const n=new Oe,r=new Bo,l=new as,c=new Oe(1,1,1);r._onChange(function(){l.setFromEuler(r,!1)}),l._onChange(function(){r.setFromQuaternion(l,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:l},scale:{configurable:!0,enumerable:!0,value:c},modelViewMatrix:{value:new ri},normalMatrix:{value:new Hr}}),this.matrix=new ri,this.matrixWorld=new ri,this.matrixAutoUpdate=Er.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new kd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(n){return this.quaternion.premultiply(n),this}setRotationFromAxisAngle(n,r){this.quaternion.setFromAxisAngle(n,r)}setRotationFromEuler(n){this.quaternion.setFromEuler(n,!0)}setRotationFromMatrix(n){this.quaternion.setFromRotationMatrix(n)}setRotationFromQuaternion(n){this.quaternion.copy(n)}rotateOnAxis(n,r){return Dl.setFromAxisAngle(n,r),this.quaternion.multiply(Dl),this}rotateOnWorldAxis(n,r){return Dl.setFromAxisAngle(n,r),this.quaternion.premultiply(Dl),this}rotateX(n){return this.rotateOnAxis(Ym,n)}rotateY(n){return this.rotateOnAxis(sp,n)}rotateZ(n){return this.rotateOnAxis(Qc,n)}translateOnAxis(n,r){return Ll.copy(n).applyQuaternion(this.quaternion),this.position.add(Ll.multiplyScalar(r)),this}translateX(n){return this.translateOnAxis(Ym,n)}translateY(n){return this.translateOnAxis(sp,n)}translateZ(n){return this.translateOnAxis(Qc,n)}localToWorld(n){return n.applyMatrix4(this.matrixWorld)}worldToLocal(n){return n.applyMatrix4(io.copy(this.matrixWorld).invert())}lookAt(n,r,l){n.isVector3?Ph.copy(n):Ph.set(n,r,l);const c=this.parent;this.updateWorldMatrix(!0,!1),Uu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?io.lookAt(Uu,Ph,this.up):io.lookAt(Ph,Uu,this.up),this.quaternion.setFromRotationMatrix(io),c&&(io.extractRotation(c.matrixWorld),Dl.setFromRotationMatrix(io),this.quaternion.premultiply(Dl.invert()))}add(n){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(null!==n.parent&&n.parent.remove(n),n.parent=this,this.children.push(n),n.dispatchEvent(Pl)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)}remove(n){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.remove(arguments[l]);return this}const r=this.children.indexOf(n);return-1!==r&&(n.parent=null,this.children.splice(r,1),n.dispatchEvent(Ih)),this}removeFromParent(){const n=this.parent;return null!==n&&n.remove(this),this}clear(){for(let n=0;n<this.children.length;n++){const r=this.children[n];r.parent=null,r.dispatchEvent(Ih)}return this.children.length=0,this}attach(n){return this.updateWorldMatrix(!0,!1),io.copy(this.matrixWorld).invert(),null!==n.parent&&(n.parent.updateWorldMatrix(!0,!1),io.multiply(n.parent.matrixWorld)),n.applyMatrix4(io),this.add(n),n.updateWorldMatrix(!1,!0),this}getObjectById(n){return this.getObjectByProperty("id",n)}getObjectByName(n){return this.getObjectByProperty("name",n)}getObjectByProperty(n,r){if(this[n]===r)return this;for(let l=0,c=this.children.length;l<c;l++){const m=this.children[l].getObjectByProperty(n,r);if(void 0!==m)return m}}getWorldPosition(n){return this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uu,n,Yc),n}getWorldScale(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uu,rp,n),n}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return n.set(r[8],r[9],r[10]).normalize()}raycast(){}traverse(n){n(this);const r=this.children;for(let l=0,c=r.length;l<c;l++)r[l].traverse(n)}traverseVisible(n){if(!1===this.visible)return;n(this);const r=this.children;for(let l=0,c=r.length;l<c;l++)r[l].traverseVisible(n)}traverseAncestors(n){const r=this.parent;null!==r&&(n(r),r.traverseAncestors(n))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0);const r=this.children;for(let l=0,c=r.length;l<c;l++)r[l].updateMatrixWorld(n)}updateWorldMatrix(n,r){const l=this.parent;if(!0===n&&null!==l&&l.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===r){const c=this.children;for(let f=0,m=c.length;f<m;f++)c[f].updateWorldMatrix(!1,!0)}}toJSON(n){const r=void 0===n||"string"==typeof n,l={};r&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},l.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const c={};function f(g,C){return void 0===g[C.uuid]&&(g[C.uuid]=C.toJSON(n)),C.uuid}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),!0===this.castShadow&&(c.castShadow=!0),!0===this.receiveShadow&&(c.receiveShadow=!0),!1===this.visible&&(c.visible=!1),!1===this.frustumCulled&&(c.frustumCulled=!1),0!==this.renderOrder&&(c.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(c.userData=this.userData),c.layers=this.layers.mask,c.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(c.matrixAutoUpdate=!1),this.isInstancedMesh&&(c.type="InstancedMesh",c.count=this.count,c.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(c.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?c.background=this.background.toJSON():this.background.isTexture&&(c.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&(c.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){c.geometry=f(n.geometries,this.geometry);const g=this.geometry.parameters;if(void 0!==g&&void 0!==g.shapes){const C=g.shapes;if(Array.isArray(C))for(let L=0,G=C.length;L<G;L++)f(n.shapes,C[L]);else f(n.shapes,C)}}if(this.isSkinnedMesh&&(c.bindMode=this.bindMode,c.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(f(n.skeletons,this.skeleton),c.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const g=[];for(let C=0,L=this.material.length;C<L;C++)g.push(f(n.materials,this.material[C]));c.material=g}else c.material=f(n.materials,this.material);if(this.children.length>0){c.children=[];for(let g=0;g<this.children.length;g++)c.children.push(this.children[g].toJSON(n).object)}if(this.animations.length>0){c.animations=[];for(let g=0;g<this.animations.length;g++)c.animations.push(f(n.animations,this.animations[g]))}if(r){const g=m(n.geometries),C=m(n.materials),L=m(n.textures),G=m(n.images),z=m(n.shapes),X=m(n.skeletons),Q=m(n.animations);g.length>0&&(l.geometries=g),C.length>0&&(l.materials=C),L.length>0&&(l.textures=L),G.length>0&&(l.images=G),z.length>0&&(l.shapes=z),X.length>0&&(l.skeletons=X),Q.length>0&&(l.animations=Q)}return l.object=c,l;function m(g){const C=[];for(const L in g){const G=g[L];delete G.metadata,C.push(G)}return C}}clone(n){return(new this.constructor).copy(this,n)}copy(n,r=!0){if(this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.userData=JSON.parse(JSON.stringify(n.userData)),!0===r)for(let l=0;l<n.children.length;l++)this.add(n.children[l].clone());return this}}Er.DefaultUp=new Oe(0,1,0),Er.DefaultMatrixAutoUpdate=!0,Er.prototype.isObject3D=!0;const La=new Oe,Il=new Oe,Hd=new Oe,il=new Oe,Zc=new Oe,Nu=new Oe,op=new Oe,ns=new Oe,ca=new Oe,Da=new Oe;class Xs{constructor(n=new Oe,r=new Oe,l=new Oe){this.a=n,this.b=r,this.c=l}static getNormal(n,r,l,c){c.subVectors(l,r),La.subVectors(n,r),c.cross(La);const f=c.lengthSq();return f>0?c.multiplyScalar(1/Math.sqrt(f)):c.set(0,0,0)}static getBarycoord(n,r,l,c,f){La.subVectors(c,r),Il.subVectors(l,r),Hd.subVectors(n,r);const m=La.dot(La),g=La.dot(Il),C=La.dot(Hd),L=Il.dot(Il),G=Il.dot(Hd),z=m*L-g*g;if(0===z)return f.set(-2,-1,-1);const X=1/z,Q=(L*C-g*G)*X,re=(m*G-g*C)*X;return f.set(1-Q-re,re,Q)}static containsPoint(n,r,l,c){return this.getBarycoord(n,r,l,c,il),il.x>=0&&il.y>=0&&il.x+il.y<=1}static getUV(n,r,l,c,f,m,g,C){return this.getBarycoord(n,r,l,c,il),C.set(0,0),C.addScaledVector(f,il.x),C.addScaledVector(m,il.y),C.addScaledVector(g,il.z),C}static isFrontFacing(n,r,l,c){return La.subVectors(l,r),Il.subVectors(n,r),La.cross(Il).dot(c)<0}set(n,r,l){return this.a.copy(n),this.b.copy(r),this.c.copy(l),this}setFromPointsAndIndices(n,r,l,c){return this.a.copy(n[r]),this.b.copy(n[l]),this.c.copy(n[c]),this}setFromAttributeAndIndices(n,r,l,c){return this.a.fromBufferAttribute(n,r),this.b.fromBufferAttribute(n,l),this.c.fromBufferAttribute(n,c),this}clone(){return(new this.constructor).copy(this)}copy(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this}getArea(){return La.subVectors(this.c,this.b),Il.subVectors(this.a,this.b),.5*La.cross(Il).length()}getMidpoint(n){return n.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(n){return Xs.getNormal(this.a,this.b,this.c,n)}getPlane(n){return n.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(n,r){return Xs.getBarycoord(n,this.a,this.b,this.c,r)}getUV(n,r,l,c,f){return Xs.getUV(n,this.a,this.b,this.c,r,l,c,f)}containsPoint(n){return Xs.containsPoint(n,this.a,this.b,this.c)}isFrontFacing(n){return Xs.isFrontFacing(this.a,this.b,this.c,n)}intersectsBox(n){return n.intersectsTriangle(this)}closestPointToPoint(n,r){const l=this.a,c=this.b,f=this.c;let m,g;Zc.subVectors(c,l),Nu.subVectors(f,l),ns.subVectors(n,l);const C=Zc.dot(ns),L=Nu.dot(ns);if(C<=0&&L<=0)return r.copy(l);ca.subVectors(n,c);const G=Zc.dot(ca),z=Nu.dot(ca);if(G>=0&&z<=G)return r.copy(c);const X=C*z-G*L;if(X<=0&&C>=0&&G<=0)return m=C/(C-G),r.copy(l).addScaledVector(Zc,m);Da.subVectors(n,f);const Q=Zc.dot(Da),re=Nu.dot(Da);if(re>=0&&Q<=re)return r.copy(f);const ue=Q*L-C*re;if(ue<=0&&L>=0&&re<=0)return g=L/(L-re),r.copy(l).addScaledVector(Nu,g);const Te=G*re-Q*z;if(Te<=0&&z-G>=0&&Q-re>=0)return op.subVectors(f,c),g=(z-G)/(z-G+(Q-re)),r.copy(c).addScaledVector(op,g);const se=1/(Te+ue+X);return m=ue*se,g=X*se,r.copy(l).addScaledVector(Zc,m).addScaledVector(Nu,g)}equals(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)}}let Bl=0;class js extends el{constructor(){super(),Object.defineProperty(this,"id",{value:Bl++}),this.uuid=Xo(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.alphaWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(void 0!==n)for(const r in n){const l=n[r];if(void 0===l){console.warn("THREE.Material: '"+r+"' parameter is undefined.");continue}if("shading"===r){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===l;continue}const c=this[r];void 0!==c?c&&c.isColor?c.set(l):c&&c.isVector3&&l&&l.isVector3?c.copy(l):this[r]=l:console.warn("THREE."+this.type+": '"+r+"' is not a property of this material.")}}toJSON(n){const r=void 0===n||"string"==typeof n;r&&(n={textures:{},images:{}});const l={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function c(f){const m=[];for(const g in f){const C=f[g];delete C.metadata,m.push(C)}return m}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),this.color&&this.color.isColor&&(l.color=this.color.getHex()),void 0!==this.roughness&&(l.roughness=this.roughness),void 0!==this.metalness&&(l.metalness=this.metalness),void 0!==this.sheen&&(l.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(l.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(l.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(l.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(l.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(l.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(l.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(l.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(l.shininess=this.shininess),void 0!==this.clearcoat&&(l.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(l.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(l.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(l.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(l.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,l.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(l.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(l.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(l.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(l.lightMap=this.lightMap.toJSON(n).uuid,l.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(l.aoMap=this.aoMap.toJSON(n).uuid,l.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(l.bumpMap=this.bumpMap.toJSON(n).uuid,l.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(l.normalMap=this.normalMap.toJSON(n).uuid,l.normalMapType=this.normalMapType,l.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(l.displacementMap=this.displacementMap.toJSON(n).uuid,l.displacementScale=this.displacementScale,l.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(l.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(l.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(l.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(l.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(l.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(l.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(l.envMap=this.envMap.toJSON(n).uuid,void 0!==this.combine&&(l.combine=this.combine)),void 0!==this.envMapIntensity&&(l.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(l.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(l.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(l.gradientMap=this.gradientMap.toJSON(n).uuid),void 0!==this.transmission&&(l.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(l.transmissionMap=this.transmissionMap.toJSON(n).uuid),void 0!==this.thickness&&(l.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(l.thicknessMap=this.thicknessMap.toJSON(n).uuid),void 0!==this.attenuationDistance&&(l.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(l.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(l.size=this.size),null!==this.shadowSide&&(l.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(l.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(l.blending=this.blending),0!==this.side&&(l.side=this.side),this.vertexColors&&(l.vertexColors=!0),this.opacity<1&&(l.opacity=this.opacity),!0===this.transparent&&(l.transparent=this.transparent),l.depthFunc=this.depthFunc,l.depthTest=this.depthTest,l.depthWrite=this.depthWrite,l.colorWrite=this.colorWrite,l.alphaWrite=this.alphaWrite,l.stencilWrite=this.stencilWrite,l.stencilWriteMask=this.stencilWriteMask,l.stencilFunc=this.stencilFunc,l.stencilRef=this.stencilRef,l.stencilFuncMask=this.stencilFuncMask,l.stencilFail=this.stencilFail,l.stencilZFail=this.stencilZFail,l.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(l.rotation=this.rotation),!0===this.polygonOffset&&(l.polygonOffset=!0),0!==this.polygonOffsetFactor&&(l.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(l.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(l.linewidth=this.linewidth),void 0!==this.dashSize&&(l.dashSize=this.dashSize),void 0!==this.gapSize&&(l.gapSize=this.gapSize),void 0!==this.scale&&(l.scale=this.scale),!0===this.dithering&&(l.dithering=!0),this.alphaTest>0&&(l.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(l.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(l.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(l.wireframe=this.wireframe),this.wireframeLinewidth>1&&(l.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(l.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(l.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(l.flatShading=this.flatShading),!1===this.visible&&(l.visible=!1),!1===this.toneMapped&&(l.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),r){const f=c(n.textures),m=c(n.images);f.length>0&&(l.textures=f),m.length>0&&(l.images=m)}return l}clone(){return(new this.constructor).copy(this)}copy(n){this.name=n.name,this.fog=n.fog,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const r=n.clippingPlanes;let l=null;if(null!==r){const c=r.length;l=new Array(c);for(let f=0;f!==c;++f)l[f]=r[f].clone()}return this.clippingPlanes=l,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.alphaWrite=n.alphaWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){!0===n&&this.version++}}js.prototype.isMaterial=!0;class ta extends js{constructor(n){super(),this.type="MeshBasicMaterial",this.color=new zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this}}ta.prototype.isMeshBasicMaterial=!0;const ws=new Oe,ku=new st;class Gr{constructor(n,r,l){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=n,this.itemSize=r,this.count=void 0!==n?n.length/r:0,this.normalized=!0===l,this.usage=Th,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(n){!0===n&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this}copyAt(n,r,l){n*=this.itemSize,l*=r.itemSize;for(let c=0,f=this.itemSize;c<f;c++)this.array[n+c]=r.array[l+c];return this}copyArray(n){return this.array.set(n),this}copyColorsArray(n){const r=this.array;let l=0;for(let c=0,f=n.length;c<f;c++){let m=n[c];void 0===m&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",c),m=new zn),r[l++]=m.r,r[l++]=m.g,r[l++]=m.b}return this}copyVector2sArray(n){const r=this.array;let l=0;for(let c=0,f=n.length;c<f;c++){let m=n[c];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",c),m=new st),r[l++]=m.x,r[l++]=m.y}return this}copyVector3sArray(n){const r=this.array;let l=0;for(let c=0,f=n.length;c<f;c++){let m=n[c];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",c),m=new Oe),r[l++]=m.x,r[l++]=m.y,r[l++]=m.z}return this}copyVector4sArray(n){const r=this.array;let l=0;for(let c=0,f=n.length;c<f;c++){let m=n[c];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",c),m=new Or),r[l++]=m.x,r[l++]=m.y,r[l++]=m.z,r[l++]=m.w}return this}applyMatrix3(n){if(2===this.itemSize)for(let r=0,l=this.count;r<l;r++)ku.fromBufferAttribute(this,r),ku.applyMatrix3(n),this.setXY(r,ku.x,ku.y);else if(3===this.itemSize)for(let r=0,l=this.count;r<l;r++)ws.fromBufferAttribute(this,r),ws.applyMatrix3(n),this.setXYZ(r,ws.x,ws.y,ws.z);return this}applyMatrix4(n){for(let r=0,l=this.count;r<l;r++)ws.x=this.getX(r),ws.y=this.getY(r),ws.z=this.getZ(r),ws.applyMatrix4(n),this.setXYZ(r,ws.x,ws.y,ws.z);return this}applyNormalMatrix(n){for(let r=0,l=this.count;r<l;r++)ws.x=this.getX(r),ws.y=this.getY(r),ws.z=this.getZ(r),ws.applyNormalMatrix(n),this.setXYZ(r,ws.x,ws.y,ws.z);return this}transformDirection(n){for(let r=0,l=this.count;r<l;r++)ws.x=this.getX(r),ws.y=this.getY(r),ws.z=this.getZ(r),ws.transformDirection(n),this.setXYZ(r,ws.x,ws.y,ws.z);return this}set(n,r=0){return this.array.set(n,r),this}getX(n){return this.array[n*this.itemSize]}setX(n,r){return this.array[n*this.itemSize]=r,this}getY(n){return this.array[n*this.itemSize+1]}setY(n,r){return this.array[n*this.itemSize+1]=r,this}getZ(n){return this.array[n*this.itemSize+2]}setZ(n,r){return this.array[n*this.itemSize+2]=r,this}getW(n){return this.array[n*this.itemSize+3]}setW(n,r){return this.array[n*this.itemSize+3]=r,this}setXY(n,r,l){return this.array[0+(n*=this.itemSize)]=r,this.array[n+1]=l,this}setXYZ(n,r,l,c){return this.array[0+(n*=this.itemSize)]=r,this.array[n+1]=l,this.array[n+2]=c,this}setXYZW(n,r,l,c,f){return this.array[0+(n*=this.itemSize)]=r,this.array[n+1]=l,this.array[n+2]=c,this.array[n+3]=f,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(n.name=this.name),this.usage!==Th&&(n.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(n.updateRange=this.updateRange),n}}Gr.prototype.isBufferAttribute=!0;class Gd extends Gr{constructor(n,r,l){super(new Int8Array(n),r,l)}}class ro extends Gr{constructor(n,r,l){super(new Uint8Array(n),r,l)}}class Qm extends Gr{constructor(n,r,l){super(new Uint8ClampedArray(n),r,l)}}class so extends Gr{constructor(n,r,l){super(new Int16Array(n),r,l)}}class Pa extends Gr{constructor(n,r,l){super(new Uint16Array(n),r,l)}}class oo extends Gr{constructor(n,r,l){super(new Int32Array(n),r,l)}}class qc extends Gr{constructor(n,r,l){super(new Uint32Array(n),r,l)}}class ls extends Gr{constructor(n,r,l){super(new Uint16Array(n),r,l)}}ls.prototype.isFloat16BufferAttribute=!0;class Mi extends Gr{constructor(n,r,l){super(new Float32Array(n),r,l)}}class ov extends Gr{constructor(n,r,l){super(new Float64Array(n),r,l)}}let MA=0;const Ia=new ri,zd=new Er,Bh=new Oe,na=new la,Fh=new la,Vn=new Oe;class ji extends el{constructor(){super(),Object.defineProperty(this,"id",{value:MA++}),this.uuid=Xo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(n){return this.index=Array.isArray(n)?new(tp(n)?qc:Pa)(n,1):n,this}getAttribute(n){return this.attributes[n]}setAttribute(n,r){return this.attributes[n]=r,this}deleteAttribute(n){return delete this.attributes[n],this}hasAttribute(n){return void 0!==this.attributes[n]}addGroup(n,r,l=0){this.groups.push({start:n,count:r,materialIndex:l})}clearGroups(){this.groups=[]}setDrawRange(n,r){this.drawRange.start=n,this.drawRange.count=r}applyMatrix4(n){const r=this.attributes.position;void 0!==r&&(r.applyMatrix4(n),r.needsUpdate=!0);const l=this.attributes.normal;if(void 0!==l){const f=(new Hr).getNormalMatrix(n);l.applyNormalMatrix(f),l.needsUpdate=!0}const c=this.attributes.tangent;return void 0!==c&&(c.transformDirection(n),c.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(n){return Ia.makeRotationFromQuaternion(n),this.applyMatrix4(Ia),this}rotateX(n){return Ia.makeRotationX(n),this.applyMatrix4(Ia),this}rotateY(n){return Ia.makeRotationY(n),this.applyMatrix4(Ia),this}rotateZ(n){return Ia.makeRotationZ(n),this.applyMatrix4(Ia),this}translate(n,r,l){return Ia.makeTranslation(n,r,l),this.applyMatrix4(Ia),this}scale(n,r,l){return Ia.makeScale(n,r,l),this.applyMatrix4(Ia),this}lookAt(n){return zd.lookAt(n),zd.updateMatrix(),this.applyMatrix4(zd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Bh).negate(),this.translate(Bh.x,Bh.y,Bh.z),this}setFromPoints(n){const r=[];for(let l=0,c=n.length;l<c;l++){const f=n[l];r.push(f.x,f.y,f.z||0)}return this.setAttribute("position",new Mi(r,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new la);const n=this.attributes.position,r=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Oe(-1/0,-1/0,-1/0),new Oe(1/0,1/0,1/0));if(void 0!==n){if(this.boundingBox.setFromBufferAttribute(n),r)for(let l=0,c=r.length;l<c;l++)na.setFromBufferAttribute(r[l]),this.morphTargetsRelative?(Vn.addVectors(this.boundingBox.min,na.min),this.boundingBox.expandByPoint(Vn),Vn.addVectors(this.boundingBox.max,na.max),this.boundingBox.expandByPoint(Vn)):(this.boundingBox.expandByPoint(na.min),this.boundingBox.expandByPoint(na.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ca);const n=this.attributes.position,r=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Oe,1/0);if(n){const l=this.boundingSphere.center;if(na.setFromBufferAttribute(n),r)for(let f=0,m=r.length;f<m;f++)Fh.setFromBufferAttribute(r[f]),this.morphTargetsRelative?(Vn.addVectors(na.min,Fh.min),na.expandByPoint(Vn),Vn.addVectors(na.max,Fh.max),na.expandByPoint(Vn)):(na.expandByPoint(Fh.min),na.expandByPoint(Fh.max));na.getCenter(l);let c=0;for(let f=0,m=n.count;f<m;f++)Vn.fromBufferAttribute(n,f),c=Math.max(c,l.distanceToSquared(Vn));if(r)for(let f=0,m=r.length;f<m;f++){const g=r[f],C=this.morphTargetsRelative;for(let L=0,G=g.count;L<G;L++)Vn.fromBufferAttribute(g,L),C&&(Bh.fromBufferAttribute(n,L),Vn.add(Bh)),c=Math.max(c,l.distanceToSquared(Vn))}this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const n=this.index,r=this.attributes;if(null===n||void 0===r.position||void 0===r.normal||void 0===r.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const l=n.array,c=r.position.array,f=r.normal.array,m=r.uv.array,g=c.length/3;void 0===r.tangent&&this.setAttribute("tangent",new Gr(new Float32Array(4*g),4));const C=r.tangent.array,L=[],G=[];for(let Ht=0;Ht<g;Ht++)L[Ht]=new Oe,G[Ht]=new Oe;const z=new Oe,X=new Oe,Q=new Oe,re=new st,ue=new st,Te=new st,se=new Oe,J=new Oe;function Be(Ht,_e,Ke){z.fromArray(c,3*Ht),X.fromArray(c,3*_e),Q.fromArray(c,3*Ke),re.fromArray(m,2*Ht),ue.fromArray(m,2*_e),Te.fromArray(m,2*Ke),X.sub(z),Q.sub(z),ue.sub(re),Te.sub(re);const Et=1/(ue.x*Te.y-Te.x*ue.y);!isFinite(Et)||(se.copy(X).multiplyScalar(Te.y).addScaledVector(Q,-ue.y).multiplyScalar(Et),J.copy(Q).multiplyScalar(ue.x).addScaledVector(X,-Te.x).multiplyScalar(Et),L[Ht].add(se),L[_e].add(se),L[Ke].add(se),G[Ht].add(J),G[_e].add(J),G[Ke].add(J))}let be=this.groups;0===be.length&&(be=[{start:0,count:l.length}]);for(let Ht=0,_e=be.length;Ht<_e;++Ht){const Ke=be[Ht],Et=Ke.start;for(let At=Et,Ft=Et+Ke.count;At<Ft;At+=3)Be(l[At+0],l[At+1],l[At+2])}const Ve=new Oe,Ze=new Oe,dt=new Oe,yt=new Oe;function It(Ht){dt.fromArray(f,3*Ht),yt.copy(dt);const _e=L[Ht];Ve.copy(_e),Ve.sub(dt.multiplyScalar(dt.dot(_e))).normalize(),Ze.crossVectors(yt,_e);const Et=Ze.dot(G[Ht])<0?-1:1;C[4*Ht]=Ve.x,C[4*Ht+1]=Ve.y,C[4*Ht+2]=Ve.z,C[4*Ht+3]=Et}for(let Ht=0,_e=be.length;Ht<_e;++Ht){const Ke=be[Ht],Et=Ke.start;for(let At=Et,Ft=Et+Ke.count;At<Ft;At+=3)It(l[At+0]),It(l[At+1]),It(l[At+2])}}computeVertexNormals(){const n=this.index,r=this.getAttribute("position");if(void 0!==r){let l=this.getAttribute("normal");if(void 0===l)l=new Gr(new Float32Array(3*r.count),3),this.setAttribute("normal",l);else for(let X=0,Q=l.count;X<Q;X++)l.setXYZ(X,0,0,0);const c=new Oe,f=new Oe,m=new Oe,g=new Oe,C=new Oe,L=new Oe,G=new Oe,z=new Oe;if(n)for(let X=0,Q=n.count;X<Q;X+=3){const re=n.getX(X+0),ue=n.getX(X+1),Te=n.getX(X+2);c.fromBufferAttribute(r,re),f.fromBufferAttribute(r,ue),m.fromBufferAttribute(r,Te),G.subVectors(m,f),z.subVectors(c,f),G.cross(z),g.fromBufferAttribute(l,re),C.fromBufferAttribute(l,ue),L.fromBufferAttribute(l,Te),g.add(G),C.add(G),L.add(G),l.setXYZ(re,g.x,g.y,g.z),l.setXYZ(ue,C.x,C.y,C.z),l.setXYZ(Te,L.x,L.y,L.z)}else for(let X=0,Q=r.count;X<Q;X+=3)c.fromBufferAttribute(r,X+0),f.fromBufferAttribute(r,X+1),m.fromBufferAttribute(r,X+2),G.subVectors(m,f),z.subVectors(c,f),G.cross(z),l.setXYZ(X+0,G.x,G.y,G.z),l.setXYZ(X+1,G.x,G.y,G.z),l.setXYZ(X+2,G.x,G.y,G.z);this.normalizeNormals(),l.needsUpdate=!0}}merge(n,r){if(!n||!n.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",n);void 0===r&&(r=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const l=this.attributes;for(const c in l){if(void 0===n.attributes[c])continue;const m=l[c].array,g=n.attributes[c],C=g.array,L=g.itemSize*r,G=Math.min(C.length,m.length-L);for(let z=0,X=L;z<G;z++,X++)m[X]=C[z]}return this}normalizeNormals(){const n=this.attributes.normal;for(let r=0,l=n.count;r<l;r++)Vn.fromBufferAttribute(n,r),Vn.normalize(),n.setXYZ(r,Vn.x,Vn.y,Vn.z)}toNonIndexed(){function n(g,C){const L=g.array,G=g.itemSize,z=g.normalized,X=new L.constructor(C.length*G);let Q=0,re=0;for(let ue=0,Te=C.length;ue<Te;ue++){Q=g.isInterleavedBufferAttribute?C[ue]*g.data.stride+g.offset:C[ue]*G;for(let se=0;se<G;se++)X[re++]=L[Q++]}return new Gr(X,G,z)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const r=new ji,l=this.index.array,c=this.attributes;for(const g in c){const L=n(c[g],l);r.setAttribute(g,L)}const f=this.morphAttributes;for(const g in f){const C=[],L=f[g];for(let G=0,z=L.length;G<z;G++){const Q=n(L[G],l);C.push(Q)}r.morphAttributes[g]=C}r.morphTargetsRelative=this.morphTargetsRelative;const m=this.groups;for(let g=0,C=m.length;g<C;g++){const L=m[g];r.addGroup(L.start,L.count,L.materialIndex)}return r}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),void 0!==this.parameters){const C=this.parameters;for(const L in C)void 0!==C[L]&&(n[L]=C[L]);return n}n.data={attributes:{}};const r=this.index;null!==r&&(n.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});const l=this.attributes;for(const C in l)n.data.attributes[C]=l[C].toJSON(n.data);const c={};let f=!1;for(const C in this.morphAttributes){const L=this.morphAttributes[C],G=[];for(let z=0,X=L.length;z<X;z++)G.push(L[z].toJSON(n.data));G.length>0&&(c[C]=G,f=!0)}f&&(n.data.morphAttributes=c,n.data.morphTargetsRelative=this.morphTargetsRelative);const m=this.groups;m.length>0&&(n.data.groups=JSON.parse(JSON.stringify(m)));const g=this.boundingSphere;return null!==g&&(n.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),n}clone(){return(new this.constructor).copy(this)}copy(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const r={};this.name=n.name;const l=n.index;null!==l&&this.setIndex(l.clone(r));const c=n.attributes;for(const L in c)this.setAttribute(L,c[L].clone(r));const f=n.morphAttributes;for(const L in f){const G=[],z=f[L];for(let X=0,Q=z.length;X<Q;X++)G.push(z[X].clone(r));this.morphAttributes[L]=G}this.morphTargetsRelative=n.morphTargetsRelative;const m=n.groups;for(let L=0,G=m.length;L<G;L++){const z=m[L];this.addGroup(z.start,z.count,z.materialIndex)}const g=n.boundingBox;null!==g&&(this.boundingBox=g.clone());const C=n.boundingSphere;return null!==C&&(this.boundingSphere=C.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,void 0!==n.parameters&&(this.parameters=Object.assign({},n.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}ji.prototype.isBufferGeometry=!0;const Zm=new ri,Fo=new $o,Oh=new Ca,ua=new Oe,go=new Oe,va=new Oe,vo=new Oe,Hi=new Oe,Vd=new Oe,Fl=new Oe,Hu=new Oe,Ba=new Oe,Fa=new st,Oa=new st,Gu=new st,Uh=new Oe,zu=new Oe;class Ys extends Er{constructor(n=new ji,r=new ta){super(),this.type="Mesh",this.geometry=n,this.material=r,this.updateMorphTargets()}copy(n){return super.copy(n),void 0!==n.morphTargetInfluences&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),void 0!==n.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=n.material,this.geometry=n.geometry,this}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const r=n.morphAttributes,l=Object.keys(r);if(l.length>0){const c=r[l[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,m=c.length;f<m;f++){const g=c[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=f}}}}else{const r=n.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(n,r){const l=this.geometry,c=this.material,f=this.matrixWorld;if(void 0===c||(null===l.boundingSphere&&l.computeBoundingSphere(),Oh.copy(l.boundingSphere),Oh.applyMatrix4(f),!1===n.ray.intersectsSphere(Oh))||(Zm.copy(f).invert(),Fo.copy(n.ray).applyMatrix4(Zm),null!==l.boundingBox&&!1===Fo.intersectsBox(l.boundingBox)))return;let m;if(l.isBufferGeometry){const g=l.index,C=l.attributes.position,L=l.morphAttributes.position,G=l.morphTargetsRelative,z=l.attributes.uv,X=l.attributes.uv2,Q=l.groups,re=l.drawRange;if(null!==g)if(Array.isArray(c))for(let ue=0,Te=Q.length;ue<Te;ue++){const se=Q[ue],J=c[se.materialIndex];for(let Ve=Math.max(se.start,re.start),Ze=Math.min(g.count,Math.min(se.start+se.count,re.start+re.count));Ve<Ze;Ve+=3){const dt=g.getX(Ve),yt=g.getX(Ve+1),It=g.getX(Ve+2);m=Kc(this,J,n,Fo,C,L,G,z,X,dt,yt,It),m&&(m.faceIndex=Math.floor(Ve/3),m.face.materialIndex=se.materialIndex,r.push(m))}}else for(let se=Math.max(0,re.start),J=Math.min(g.count,re.start+re.count);se<J;se+=3){const Be=g.getX(se),be=g.getX(se+1),Ve=g.getX(se+2);m=Kc(this,c,n,Fo,C,L,G,z,X,Be,be,Ve),m&&(m.faceIndex=Math.floor(se/3),r.push(m))}else if(void 0!==C)if(Array.isArray(c))for(let ue=0,Te=Q.length;ue<Te;ue++){const se=Q[ue],J=c[se.materialIndex];for(let Ve=Math.max(se.start,re.start),Ze=Math.min(C.count,Math.min(se.start+se.count,re.start+re.count));Ve<Ze;Ve+=3)m=Kc(this,J,n,Fo,C,L,G,z,X,Ve,Ve+1,Ve+2),m&&(m.faceIndex=Math.floor(Ve/3),m.face.materialIndex=se.materialIndex,r.push(m))}else for(let se=Math.max(0,re.start),J=Math.min(C.count,re.start+re.count);se<J;se+=3)m=Kc(this,c,n,Fo,C,L,G,z,X,se,se+1,se+2),m&&(m.faceIndex=Math.floor(se/3),r.push(m))}else l.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Kc(h,n,r,l,c,f,m,g,C,L,G,z){ua.fromBufferAttribute(c,L),go.fromBufferAttribute(c,G),va.fromBufferAttribute(c,z);const X=h.morphTargetInfluences;if(f&&X){Fl.set(0,0,0),Hu.set(0,0,0),Ba.set(0,0,0);for(let re=0,ue=f.length;re<ue;re++){const Te=X[re],se=f[re];0!==Te&&(vo.fromBufferAttribute(se,L),Hi.fromBufferAttribute(se,G),Vd.fromBufferAttribute(se,z),m?(Fl.addScaledVector(vo,Te),Hu.addScaledVector(Hi,Te),Ba.addScaledVector(Vd,Te)):(Fl.addScaledVector(vo.sub(ua),Te),Hu.addScaledVector(Hi.sub(go),Te),Ba.addScaledVector(Vd.sub(va),Te)))}ua.add(Fl),go.add(Hu),va.add(Ba)}h.isSkinnedMesh&&(h.boneTransform(L,ua),h.boneTransform(G,go),h.boneTransform(z,va));const Q=function(h,n,r,l,c,f,m,g){let C;if(C=1===n.side?l.intersectTriangle(m,f,c,!0,g):l.intersectTriangle(c,f,m,2!==n.side,g),null===C)return null;zu.copy(g),zu.applyMatrix4(h.matrixWorld);const L=r.ray.origin.distanceTo(zu);return L<r.near||L>r.far?null:{distance:L,point:zu.clone(),object:h}}(h,n,r,l,ua,go,va,Uh);if(Q){g&&(Fa.fromBufferAttribute(g,L),Oa.fromBufferAttribute(g,G),Gu.fromBufferAttribute(g,z),Q.uv=Xs.getUV(Uh,ua,go,va,Fa,Oa,Gu,new st)),C&&(Fa.fromBufferAttribute(C,L),Oa.fromBufferAttribute(C,G),Gu.fromBufferAttribute(C,z),Q.uv2=Xs.getUV(Uh,ua,go,va,Fa,Oa,Gu,new st));const re={a:L,b:G,c:z,normal:new Oe,materialIndex:0};Xs.getNormal(ua,go,va,re.normal),Q.face=re}return Q}Ys.prototype.isMesh=!0;class ya extends ji{constructor(n=1,r=1,l=1,c=1,f=1,m=1){super(),this.type="BoxGeometry",this.parameters={width:n,height:r,depth:l,widthSegments:c,heightSegments:f,depthSegments:m};const g=this;c=Math.floor(c),f=Math.floor(f),m=Math.floor(m);const C=[],L=[],G=[],z=[];let X=0,Q=0;function re(ue,Te,se,J,Be,be,Ve,Ze,dt,yt,It){const Ht=be/dt,_e=Ve/yt,Ke=be/2,Et=Ve/2,Mt=Ze/2,At=dt+1,Ft=yt+1;let en=0,Cn=0;const xi=new Oe;for(let Di=0;Di<Ft;Di++){const ci=Di*_e-Et;for(let hn=0;hn<At;hn++)xi[ue]=(hn*Ht-Ke)*J,xi[Te]=ci*Be,xi[se]=Mt,L.push(xi.x,xi.y,xi.z),xi[ue]=0,xi[Te]=0,xi[se]=Ze>0?1:-1,G.push(xi.x,xi.y,xi.z),z.push(hn/dt),z.push(1-Di/yt),en+=1}for(let Di=0;Di<yt;Di++)for(let ci=0;ci<dt;ci++){const Zn=X+ci+At*(Di+1),Ni=X+(ci+1)+At*(Di+1),mt=X+(ci+1)+At*Di;C.push(X+ci+At*Di,Zn,mt),C.push(Zn,Ni,mt),Cn+=6}g.addGroup(Q,Cn,It),Q+=Cn,X+=en}re("z","y","x",-1,-1,l,r,n,m,f,0),re("z","y","x",1,-1,l,r,-n,m,f,1),re("x","z","y",1,1,n,l,r,c,m,2),re("x","z","y",1,-1,n,l,-r,c,m,3),re("x","y","z",1,-1,n,r,l,c,f,4),re("x","y","z",-1,-1,n,r,-l,c,f,5),this.setIndex(C),this.setAttribute("position",new Mi(L,3)),this.setAttribute("normal",new Mi(G,3)),this.setAttribute("uv",new Mi(z,2))}static fromJSON(n){return new ya(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)}}function Ol(h){const n={};for(const r in h){n[r]={};for(const l in h[r]){const c=h[r][l];n[r][l]=c&&(c.isColor||c.isMatrix3||c.isMatrix4||c.isVector2||c.isVector3||c.isVector4||c.isTexture||c.isQuaternion)?c.clone():Array.isArray(c)?c.slice():c}}return n}function _o(h){const n={};for(let r=0;r<h.length;r++){const l=Ol(h[r]);for(const c in l)n[c]=l[c]}return n}const Xd={clone:Ol,merge:_o};class Ul extends js{constructor(n){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==n&&(void 0!==n.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(n))}copy(n){return super.copy(n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=Ol(n.uniforms),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.lights=n.lights,this.clipping=n.clipping,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this}toJSON(n){const r=super.toJSON(n);r.glslVersion=this.glslVersion,r.uniforms={};for(const c in this.uniforms){const m=this.uniforms[c].value;r.uniforms[c]=m&&m.isTexture?{type:"t",value:m.toJSON(n).uuid}:m&&m.isColor?{type:"c",value:m.getHex()}:m&&m.isVector2?{type:"v2",value:m.toArray()}:m&&m.isVector3?{type:"v3",value:m.toArray()}:m&&m.isVector4?{type:"v4",value:m.toArray()}:m&&m.isMatrix3?{type:"m3",value:m.toArray()}:m&&m.isMatrix4?{type:"m4",value:m.toArray()}:{value:m}}Object.keys(this.defines).length>0&&(r.defines=this.defines),r.vertexShader=this.vertexShader,r.fragmentShader=this.fragmentShader;const l={};for(const c in this.extensions)!0===this.extensions[c]&&(l[c]=!0);return Object.keys(l).length>0&&(r.extensions=l),r}}Ul.prototype.isShaderMaterial=!0;class gc extends Er{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ri,this.projectionMatrix=new ri,this.projectionMatrixInverse=new ri}copy(n,r){return super.copy(n,r),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return n.set(-r[8],-r[9],-r[10]).normalize()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,r){super.updateWorldMatrix(n,r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}gc.prototype.isCamera=!0;class Ss extends gc{constructor(n=50,r=1,l=.1,c=2e3){super(),this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=l,this.far=c,this.focus=10,this.aspect=r,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,r){return super.copy(n,r),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=null===n.view?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const r=.5*this.getFilmHeight()/n;this.fov=2*Fs*Math.atan(r),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(.5*bo*this.fov);return.5*this.getFilmHeight()/n}getEffectiveFOV(){return 2*Fs*Math.atan(Math.tan(.5*bo*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(n,r,l,c,f,m){this.aspect=n/r,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=r,this.view.offsetX=l,this.view.offsetY=c,this.view.width=f,this.view.height=m,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let r=n*Math.tan(.5*bo*this.fov)/this.zoom,l=2*r,c=this.aspect*l,f=-.5*c;const m=this.view;if(null!==this.view&&this.view.enabled){const C=m.fullWidth,L=m.fullHeight;f+=m.offsetX*c/C,r-=m.offsetY*l/L,c*=m.width/C,l*=m.height/L}const g=this.filmOffset;0!==g&&(f+=n*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(f,f+c,r,r-l,n,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const r=super.toJSON(n);return r.object.fov=this.fov,r.object.zoom=this.zoom,r.object.near=this.near,r.object.far=this.far,r.object.focus=this.focus,r.object.aspect=this.aspect,null!==this.view&&(r.object.view=Object.assign({},this.view)),r.object.filmGauge=this.filmGauge,r.object.filmOffset=this.filmOffset,r}}Ss.prototype.isPerspectiveCamera=!0;class Nh extends Er{constructor(n,r,l){if(super(),this.type="CubeCamera",!0!==l.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=l;const c=new Ss(90,1,n,r);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Oe(1,0,0)),this.add(c);const f=new Ss(90,1,n,r);f.layers=this.layers,f.up.set(0,-1,0),f.lookAt(new Oe(-1,0,0)),this.add(f);const m=new Ss(90,1,n,r);m.layers=this.layers,m.up.set(0,0,1),m.lookAt(new Oe(0,1,0)),this.add(m);const g=new Ss(90,1,n,r);g.layers=this.layers,g.up.set(0,0,-1),g.lookAt(new Oe(0,-1,0)),this.add(g);const C=new Ss(90,1,n,r);C.layers=this.layers,C.up.set(0,-1,0),C.lookAt(new Oe(0,0,1)),this.add(C);const L=new Ss(90,1,n,r);L.layers=this.layers,L.up.set(0,-1,0),L.lookAt(new Oe(0,0,-1)),this.add(L)}update(n,r){null===this.parent&&this.updateMatrixWorld();const l=this.renderTarget,[c,f,m,g,C,L]=this.children,G=n.xr.enabled,z=n.getRenderTarget();n.xr.enabled=!1;const X=l.texture.generateMipmaps;l.texture.generateMipmaps=!1,n.setRenderTarget(l,0),n.render(r,c),n.setRenderTarget(l,1),n.render(r,f),n.setRenderTarget(l,2),n.render(r,m),n.setRenderTarget(l,3),n.render(r,g),n.setRenderTarget(l,4),n.render(r,C),l.texture.generateMipmaps=X,n.setRenderTarget(l,5),n.render(r,L),n.setRenderTarget(z),n.xr.enabled=G,l.texture.needsPMREMUpdate=!0}}class Vu extends Rn{constructor(n,r,l,c,f,m,g,C,L,G){super(n=void 0!==n?n:[],r=void 0!==r?r:301,l,c,f,m,g,C,L,G),this.flipY=!1}get images(){return this.image}set images(n){this.image=n}}Vu.prototype.isCubeTexture=!0;class Yd extends Ro{constructor(n,r,l){Number.isInteger(r)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),r=l),super(n,n,r),this.texture=new Vu(void 0,(r=r||{}).mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:vt}fromEquirectangularTexture(n,r){this.texture.type=r.type,this.texture.format=bt,this.texture.encoding=r.encoding,this.texture.generateMipmaps=r.generateMipmaps,this.texture.minFilter=r.minFilter,this.texture.magFilter=r.magFilter;const l_uniforms={tEquirect:{value:null}},l_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",l_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",c=new ya(5,5,5),f=new Ul({name:"CubemapFromEquirect",uniforms:Ol(l_uniforms),vertexShader:l_vertexShader,fragmentShader:l_fragmentShader,side:1,blending:0});f.uniforms.tEquirect.value=r;const m=new Ys(c,f),g=r.minFilter;return r.minFilter===Fn&&(r.minFilter=vt),new Nh(1,10,this).update(n,m),r.minFilter=g,m.geometry.dispose(),m.material.dispose(),this}clear(n,r,l,c){const f=n.getRenderTarget();for(let m=0;m<6;m++)n.setRenderTarget(this,m),n.clear(r,l,c);n.setRenderTarget(f)}}Yd.prototype.isWebGLCubeRenderTarget=!0;const Ho=new Oe,kh=new Oe,Oo=new Hr;class Yo{constructor(n=new Oe(1,0,0),r=0){this.normal=n,this.constant=r}set(n,r){return this.normal.copy(n),this.constant=r,this}setComponents(n,r,l,c){return this.normal.set(n,r,l),this.constant=c,this}setFromNormalAndCoplanarPoint(n,r){return this.normal.copy(n),this.constant=-r.dot(this.normal),this}setFromCoplanarPoints(n,r,l){const c=Ho.subVectors(l,r).cross(kh.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(c,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,r){return r.copy(this.normal).multiplyScalar(-this.distanceToPoint(n)).add(n)}intersectLine(n,r){const l=n.delta(Ho),c=this.normal.dot(l);if(0===c)return 0===this.distanceToPoint(n.start)?r.copy(n.start):null;const f=-(n.start.dot(this.normal)+this.constant)/c;return f<0||f>1?null:r.copy(l).multiplyScalar(f).add(n.start)}intersectsLine(n){const r=this.distanceToPoint(n.start),l=this.distanceToPoint(n.end);return r<0&&l>0||l<0&&r>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,r){const l=r||Oo.getNormalMatrix(n),c=this.coplanarPoint(Ho).applyMatrix4(n),f=this.normal.applyMatrix3(l).normalize();return this.constant=-c.dot(f),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Yo.prototype.isPlane=!0;const Na=new Ca,Wu=new Oe;class Nl{constructor(n=new Yo,r=new Yo,l=new Yo,c=new Yo,f=new Yo,m=new Yo){this.planes=[n,r,l,c,f,m]}set(n,r,l,c,f,m){const g=this.planes;return g[0].copy(n),g[1].copy(r),g[2].copy(l),g[3].copy(c),g[4].copy(f),g[5].copy(m),this}copy(n){const r=this.planes;for(let l=0;l<6;l++)r[l].copy(n.planes[l]);return this}setFromProjectionMatrix(n){const r=this.planes,l=n.elements,c=l[0],f=l[1],m=l[2],g=l[3],C=l[4],L=l[5],G=l[6],z=l[7],X=l[8],Q=l[9],re=l[10],ue=l[11],Te=l[12],se=l[13],J=l[14],Be=l[15];return r[0].setComponents(g-c,z-C,ue-X,Be-Te).normalize(),r[1].setComponents(g+c,z+C,ue+X,Be+Te).normalize(),r[2].setComponents(g+f,z+L,ue+Q,Be+se).normalize(),r[3].setComponents(g-f,z-L,ue-Q,Be-se).normalize(),r[4].setComponents(g-m,z-G,ue-re,Be-J).normalize(),r[5].setComponents(g+m,z+G,ue+re,Be+J).normalize(),this}intersectsObject(n){const r=n.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),Na.copy(r.boundingSphere).applyMatrix4(n.matrixWorld),this.intersectsSphere(Na)}intersectsSprite(n){return Na.center.set(0,0,0),Na.radius=.7071067811865476,Na.applyMatrix4(n.matrixWorld),this.intersectsSphere(Na)}intersectsSphere(n){const r=this.planes,l=n.center,c=-n.radius;for(let f=0;f<6;f++)if(r[f].distanceToPoint(l)<c)return!1;return!0}intersectsBox(n){const r=this.planes;for(let l=0;l<6;l++){const c=r[l];if(Wu.x=c.normal.x>0?n.max.x:n.min.x,Wu.y=c.normal.y>0?n.max.y:n.min.y,Wu.z=c.normal.z>0?n.max.z:n.min.z,c.distanceToPoint(Wu)<0)return!1}return!0}containsPoint(n){const r=this.planes;for(let l=0;l<6;l++)if(r[l].distanceToPoint(n)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Qd(){let h=null,n=!1,r=null,l=null;function c(f,m){r(f,m),l=h.requestAnimationFrame(c)}return{start:function(){!0!==n&&null!==r&&(l=h.requestAnimationFrame(c),n=!0)},stop:function(){h.cancelAnimationFrame(l),n=!1},setAnimationLoop:function(f){r=f},setContext:function(f){h=f}}}function ap(h,n){const r=n.isWebGL2,l=new WeakMap;return{get:function(L){return L.isInterleavedBufferAttribute&&(L=L.data),l.get(L)},remove:function(L){L.isInterleavedBufferAttribute&&(L=L.data);const G=l.get(L);G&&(h.deleteBuffer(G.buffer),l.delete(L))},update:function(L,G){if(L.isGLBufferAttribute){const X=l.get(L);return void((!X||X.version<L.version)&&l.set(L,{buffer:L.buffer,type:L.type,bytesPerElement:L.elementSize,version:L.version}))}L.isInterleavedBufferAttribute&&(L=L.data);const z=l.get(L);void 0===z?l.set(L,function(L,G){const z=L.array,X=L.usage,Q=h.createBuffer();h.bindBuffer(G,Q),h.bufferData(G,z,X),L.onUploadCallback();let re=h.FLOAT;return z instanceof Float32Array?re=h.FLOAT:z instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):z instanceof Uint16Array?L.isFloat16BufferAttribute?r?re=h.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):re=h.UNSIGNED_SHORT:z instanceof Int16Array?re=h.SHORT:z instanceof Uint32Array?re=h.UNSIGNED_INT:z instanceof Int32Array?re=h.INT:z instanceof Int8Array?re=h.BYTE:(z instanceof Uint8Array||z instanceof Uint8ClampedArray)&&(re=h.UNSIGNED_BYTE),{buffer:Q,type:re,bytesPerElement:z.BYTES_PER_ELEMENT,version:L.version}}(L,G)):z.version<L.version&&(function(L,G,z){const X=G.array,Q=G.updateRange;h.bindBuffer(z,L),-1===Q.count?h.bufferSubData(z,0,X):(r?h.bufferSubData(z,Q.offset*X.BYTES_PER_ELEMENT,X,Q.offset,Q.count):h.bufferSubData(z,Q.offset*X.BYTES_PER_ELEMENT,X.subarray(Q.offset,Q.offset+Q.count)),Q.count=-1)}(z.buffer,L,G),z.version=L.version)}}}class Jc extends ji{constructor(n=1,r=1,l=1,c=1){super(),this.type="PlaneGeometry",this.parameters={width:n,height:r,widthSegments:l,heightSegments:c};const f=n/2,m=r/2,g=Math.floor(l),C=Math.floor(c),L=g+1,G=C+1,z=n/g,X=r/C,Q=[],re=[],ue=[],Te=[];for(let se=0;se<G;se++){const J=se*X-m;for(let Be=0;Be<L;Be++)re.push(Be*z-f,-J,0),ue.push(0,0,1),Te.push(Be/g),Te.push(1-se/C)}for(let se=0;se<C;se++)for(let J=0;J<g;J++){const be=J+L*(se+1),Ve=J+1+L*(se+1),Ze=J+1+L*se;Q.push(J+L*se,be,Ze),Q.push(be,Ve,Ze)}this.setIndex(Q),this.setAttribute("position",new Mi(re,3)),this.setAttribute("normal",new Mi(ue,3)),this.setAttribute("uv",new Mi(Te,2))}static fromJSON(n){return new Jc(n.width,n.height,n.widthSegments,n.heightSegments)}}const Ur={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Jn={common:{diffuse:{value:new zn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Hr},uv2Transform:{value:new Hr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new st(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hr}},sprite:{diffuse:{value:new zn(16777215)},opacity:{value:1},center:{value:new st(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hr}}},rl={basic:{uniforms:_o([Jn.common,Jn.specularmap,Jn.envmap,Jn.aomap,Jn.lightmap,Jn.fog]),vertexShader:Ur.meshbasic_vert,fragmentShader:Ur.meshbasic_frag},lambert:{uniforms:_o([Jn.common,Jn.specularmap,Jn.envmap,Jn.aomap,Jn.lightmap,Jn.emissivemap,Jn.fog,Jn.lights,{emissive:{value:new zn(0)}}]),vertexShader:Ur.meshlambert_vert,fragmentShader:Ur.meshlambert_frag},phong:{uniforms:_o([Jn.common,Jn.specularmap,Jn.envmap,Jn.aomap,Jn.lightmap,Jn.emissivemap,Jn.bumpmap,Jn.normalmap,Jn.displacementmap,Jn.fog,Jn.lights,{emissive:{value:new zn(0)},specular:{value:new zn(1118481)},shininess:{value:30}}]),vertexShader:Ur.meshphong_vert,fragmentShader:Ur.meshphong_frag},standard:{uniforms:_o([Jn.common,Jn.envmap,Jn.aomap,Jn.lightmap,Jn.emissivemap,Jn.bumpmap,Jn.normalmap,Jn.displacementmap,Jn.roughnessmap,Jn.metalnessmap,Jn.fog,Jn.lights,{emissive:{value:new zn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ur.meshphysical_vert,fragmentShader:Ur.meshphysical_frag},toon:{uniforms:_o([Jn.common,Jn.aomap,Jn.lightmap,Jn.emissivemap,Jn.bumpmap,Jn.normalmap,Jn.displacementmap,Jn.gradientmap,Jn.fog,Jn.lights,{emissive:{value:new zn(0)}}]),vertexShader:Ur.meshtoon_vert,fragmentShader:Ur.meshtoon_frag},matcap:{uniforms:_o([Jn.common,Jn.bumpmap,Jn.normalmap,Jn.displacementmap,Jn.fog,{matcap:{value:null}}]),vertexShader:Ur.meshmatcap_vert,fragmentShader:Ur.meshmatcap_frag},points:{uniforms:_o([Jn.points,Jn.fog]),vertexShader:Ur.points_vert,fragmentShader:Ur.points_frag},dashed:{uniforms:_o([Jn.common,Jn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ur.linedashed_vert,fragmentShader:Ur.linedashed_frag},depth:{uniforms:_o([Jn.common,Jn.displacementmap]),vertexShader:Ur.depth_vert,fragmentShader:Ur.depth_frag},normal:{uniforms:_o([Jn.common,Jn.bumpmap,Jn.normalmap,Jn.displacementmap,{opacity:{value:1}}]),vertexShader:Ur.meshnormal_vert,fragmentShader:Ur.meshnormal_frag},sprite:{uniforms:_o([Jn.sprite,Jn.fog]),vertexShader:Ur.sprite_vert,fragmentShader:Ur.sprite_frag},background:{uniforms:{uvTransform:{value:new Hr},t2D:{value:null}},vertexShader:Ur.background_vert,fragmentShader:Ur.background_frag},cube:{uniforms:_o([Jn.envmap,{opacity:{value:1}}]),vertexShader:Ur.cube_vert,fragmentShader:Ur.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ur.equirect_vert,fragmentShader:Ur.equirect_frag},distanceRGBA:{uniforms:_o([Jn.common,Jn.displacementmap,{referencePosition:{value:new Oe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ur.distanceRGBA_vert,fragmentShader:Ur.distanceRGBA_frag},shadow:{uniforms:_o([Jn.lights,Jn.fog,{color:{value:new zn(0)},opacity:{value:1}}]),vertexShader:Ur.shadow_vert,fragmentShader:Ur.shadow_frag}};function FA(h,n,r,l,c,f){const m=new zn(0);let C,L,g=!0===c?0:1,G=null,z=0,X=null;function re(ue,Te){r.buffers.color.setClear(ue.r,ue.g,ue.b,Te,f)}return{getClearColor:function(){return m},setClearColor:function(ue,Te=1){m.set(ue),g=Te,re(m,g)},getClearAlpha:function(){return g},setClearAlpha:function(ue){g=ue,re(m,g)},render:function(ue,Te){let se=!1,J=!0===Te.isScene?Te.background:null;J&&J.isTexture&&(J=n.get(J));const Be=h.xr,be=Be.getSession&&Be.getSession();be&&"additive"===be.environmentBlendMode&&(J=null),null===J?re(m,g):J&&J.isColor&&(re(J,1),se=!0),(h.autoClear||se)&&h.clear(h.autoClearColor,h.autoClearDepth,h.autoClearStencil),J&&(J.isCubeTexture||306===J.mapping)?(void 0===L&&(L=new Ys(new ya(1,1,1),new Ul({name:"BackgroundCubeMaterial",uniforms:Ol(rl.cube.uniforms),vertexShader:rl.cube.vertexShader,fragmentShader:rl.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),L.geometry.deleteAttribute("normal"),L.geometry.deleteAttribute("uv"),L.onBeforeRender=function(Ve,Ze,dt){this.matrixWorld.copyPosition(dt.matrixWorld)},Object.defineProperty(L.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(L)),L.material.uniforms.envMap.value=J,L.material.uniforms.flipEnvMap.value=J.isCubeTexture&&!1===J.isRenderTargetTexture?-1:1,(G!==J||z!==J.version||X!==h.toneMapping)&&(L.material.needsUpdate=!0,G=J,z=J.version,X=h.toneMapping),ue.unshift(L,L.geometry,L.material,0,0,null)):J&&J.isTexture&&(void 0===C&&(C=new Ys(new Jc(2,2),new Ul({name:"BackgroundMaterial",uniforms:Ol(rl.background.uniforms),vertexShader:rl.background.vertexShader,fragmentShader:rl.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),Object.defineProperty(C.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(C)),C.material.uniforms.t2D.value=J,!0===J.matrixAutoUpdate&&J.updateMatrix(),C.material.uniforms.uvTransform.value.copy(J.matrix),(G!==J||z!==J.version||X!==h.toneMapping)&&(C.material.needsUpdate=!0,G=J,z=J.version,X=h.toneMapping),ue.unshift(C,C.geometry,C.material,0,0,null))}}}function OA(h,n,r,l){const c=h.getParameter(h.MAX_VERTEX_ATTRIBS),f=l.isWebGL2?null:n.get("OES_vertex_array_object"),m=l.isWebGL2||null!==f,g={},C=ue(null);let L=C;function X(Et){return l.isWebGL2?h.bindVertexArray(Et):f.bindVertexArrayOES(Et)}function Q(Et){return l.isWebGL2?h.deleteVertexArray(Et):f.deleteVertexArrayOES(Et)}function ue(Et){const Mt=[],At=[],Ft=[];for(let en=0;en<c;en++)Mt[en]=0,At[en]=0,Ft[en]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Mt,enabledAttributes:At,attributeDivisors:Ft,object:Et,attributes:{},index:null}}function J(){const Et=L.newAttributes;for(let Mt=0,At=Et.length;Mt<At;Mt++)Et[Mt]=0}function Be(Et){be(Et,0)}function be(Et,Mt){const Ft=L.enabledAttributes,en=L.attributeDivisors;L.newAttributes[Et]=1,0===Ft[Et]&&(h.enableVertexAttribArray(Et),Ft[Et]=1),en[Et]!==Mt&&((l.isWebGL2?h:n.get("ANGLE_instanced_arrays"))[l.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Et,Mt),en[Et]=Mt)}function Ve(){const Et=L.newAttributes,Mt=L.enabledAttributes;for(let At=0,Ft=Mt.length;At<Ft;At++)Mt[At]!==Et[At]&&(h.disableVertexAttribArray(At),Mt[At]=0)}function Ze(Et,Mt,At,Ft,en,Cn){!0!==l.isWebGL2||At!==h.INT&&At!==h.UNSIGNED_INT?h.vertexAttribPointer(Et,Mt,At,Ft,en,Cn):h.vertexAttribIPointer(Et,Mt,At,en,Cn)}function _e(){Ke(),L!==C&&(L=C,X(L.object))}function Ke(){C.geometry=null,C.program=null,C.wireframe=!1}return{setup:function(Et,Mt,At,Ft,en){let Cn=!1;if(m){const xi=function(Et,Mt,At){const Ft=!0===At.wireframe;let en=g[Et.id];void 0===en&&(en={},g[Et.id]=en);let Cn=en[Mt.id];void 0===Cn&&(Cn={},en[Mt.id]=Cn);let xi=Cn[Ft];return void 0===xi&&(xi=ue(l.isWebGL2?h.createVertexArray():f.createVertexArrayOES()),Cn[Ft]=xi),xi}(Ft,At,Mt);L!==xi&&(L=xi,X(L.object)),Cn=function(Et,Mt){const At=L.attributes,Ft=Et.attributes;let en=0;for(const Cn in Ft){const xi=At[Cn],Di=Ft[Cn];if(void 0===xi||xi.attribute!==Di||xi.data!==Di.data)return!0;en++}return L.attributesNum!==en||L.index!==Mt}(Ft,en),Cn&&function(Et,Mt){const At={},Ft=Et.attributes;let en=0;for(const Cn in Ft){const xi=Ft[Cn],Di={};Di.attribute=xi,xi.data&&(Di.data=xi.data),At[Cn]=Di,en++}L.attributes=At,L.attributesNum=en,L.index=Mt}(Ft,en)}else{const xi=!0===Mt.wireframe;(L.geometry!==Ft.id||L.program!==At.id||L.wireframe!==xi)&&(L.geometry=Ft.id,L.program=At.id,L.wireframe=xi,Cn=!0)}!0===Et.isInstancedMesh&&(Cn=!0),null!==en&&r.update(en,h.ELEMENT_ARRAY_BUFFER),Cn&&(function(Et,Mt,At,Ft){if(!1===l.isWebGL2&&(Et.isInstancedMesh||Ft.isInstancedBufferGeometry)&&null===n.get("ANGLE_instanced_arrays"))return;J();const en=Ft.attributes,Cn=At.getAttributes(),xi=Mt.defaultAttributeValues;for(const Di in Cn){const ci=Cn[Di];if(ci.location>=0){let hn=en[Di];if(void 0===hn&&("instanceMatrix"===Di&&Et.instanceMatrix&&(hn=Et.instanceMatrix),"instanceColor"===Di&&Et.instanceColor&&(hn=Et.instanceColor)),void 0!==hn){const Zn=hn.normalized,Ni=hn.itemSize,mt=r.get(hn);if(void 0===mt)continue;const Vi=mt.buffer,pi=mt.type,ki=mt.bytesPerElement;if(hn.isInterleavedBufferAttribute){const ui=hn.data,dr=ui.stride,Yi=hn.offset;if(ui&&ui.isInstancedInterleavedBuffer){for(let an=0;an<ci.locationSize;an++)be(ci.location+an,ui.meshPerAttribute);!0!==Et.isInstancedMesh&&void 0===Ft._maxInstanceCount&&(Ft._maxInstanceCount=ui.meshPerAttribute*ui.count)}else for(let an=0;an<ci.locationSize;an++)Be(ci.location+an);h.bindBuffer(h.ARRAY_BUFFER,Vi);for(let an=0;an<ci.locationSize;an++)Ze(ci.location+an,Ni/ci.locationSize,pi,Zn,dr*ki,(Yi+Ni/ci.locationSize*an)*ki)}else{if(hn.isInstancedBufferAttribute){for(let ui=0;ui<ci.locationSize;ui++)be(ci.location+ui,hn.meshPerAttribute);!0!==Et.isInstancedMesh&&void 0===Ft._maxInstanceCount&&(Ft._maxInstanceCount=hn.meshPerAttribute*hn.count)}else for(let ui=0;ui<ci.locationSize;ui++)Be(ci.location+ui);h.bindBuffer(h.ARRAY_BUFFER,Vi);for(let ui=0;ui<ci.locationSize;ui++)Ze(ci.location+ui,Ni/ci.locationSize,pi,Zn,Ni*ki,Ni/ci.locationSize*ui*ki)}}else if(void 0!==xi){const Zn=xi[Di];if(void 0!==Zn)switch(Zn.length){case 2:h.vertexAttrib2fv(ci.location,Zn);break;case 3:h.vertexAttrib3fv(ci.location,Zn);break;case 4:h.vertexAttrib4fv(ci.location,Zn);break;default:h.vertexAttrib1fv(ci.location,Zn)}}}}Ve()}(Et,Mt,At,Ft),null!==en&&h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r.get(en).buffer))},reset:_e,resetDefaultState:Ke,dispose:function(){_e();for(const Et in g){const Mt=g[Et];for(const At in Mt){const Ft=Mt[At];for(const en in Ft)Q(Ft[en].object),delete Ft[en];delete Mt[At]}delete g[Et]}},releaseStatesOfGeometry:function(Et){if(void 0===g[Et.id])return;const Mt=g[Et.id];for(const At in Mt){const Ft=Mt[At];for(const en in Ft)Q(Ft[en].object),delete Ft[en];delete Mt[At]}delete g[Et.id]},releaseStatesOfProgram:function(Et){for(const Mt in g){const At=g[Mt];if(void 0===At[Et.id])continue;const Ft=At[Et.id];for(const en in Ft)Q(Ft[en].object),delete Ft[en];delete At[Et.id]}},initAttributes:J,enableAttribute:Be,disableUnusedAttributes:Ve}}function UA(h,n,r,l){const c=l.isWebGL2;let f;this.setMode=function(L){f=L},this.render=function(L,G){h.drawArrays(f,L,G),r.update(G,f,1)},this.renderInstances=function(L,G,z){if(0===z)return;let X,Q;if(c)X=h,Q="drawArraysInstanced";else if(X=n.get("ANGLE_instanced_arrays"),Q="drawArraysInstancedANGLE",null===X)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");X[Q](f,L,G,z),r.update(G,f,z)}}function NA(h,n,r){let l;function f(dt){if("highp"===dt){if(h.getShaderPrecisionFormat(h.VERTEX_SHADER,h.HIGH_FLOAT).precision>0&&h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT).precision>0)return"highp";dt="mediump"}return"mediump"===dt&&h.getShaderPrecisionFormat(h.VERTEX_SHADER,h.MEDIUM_FLOAT).precision>0&&h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const m="undefined"!=typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&h instanceof WebGL2ComputeRenderingContext;let g=void 0!==r.precision?r.precision:"highp";const C=f(g);C!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",C,"instead."),g=C);const L=m||n.has("WEBGL_draw_buffers"),G=!0===r.logarithmicDepthBuffer,z=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS),X=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Q=h.getParameter(h.MAX_TEXTURE_SIZE),re=h.getParameter(h.MAX_CUBE_MAP_TEXTURE_SIZE),ue=h.getParameter(h.MAX_VERTEX_ATTRIBS),Te=h.getParameter(h.MAX_VERTEX_UNIFORM_VECTORS),se=h.getParameter(h.MAX_VARYING_VECTORS),J=h.getParameter(h.MAX_FRAGMENT_UNIFORM_VECTORS),Be=X>0,be=m||n.has("OES_texture_float");return{isWebGL2:m,drawBuffers:L,getMaxAnisotropy:function(){if(void 0!==l)return l;if(!0===n.has("EXT_texture_filter_anisotropic")){const dt=n.get("EXT_texture_filter_anisotropic");l=h.getParameter(dt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else l=0;return l},getMaxPrecision:f,precision:g,logarithmicDepthBuffer:G,maxTextures:z,maxVertexTextures:X,maxTextureSize:Q,maxCubemapSize:re,maxAttributes:ue,maxVertexUniforms:Te,maxVaryings:se,maxFragmentUniforms:J,vertexTextures:Be,floatFragmentTextures:be,floatVertexTextures:Be&&be,maxSamples:m?h.getParameter(h.MAX_SAMPLES):0}}function kA(h){const n=this;let r=null,l=0,c=!1,f=!1;const m=new Yo,g=new Hr,C={value:null,needsUpdate:!1};function L(){C.value!==r&&(C.value=r,C.needsUpdate=l>0),n.numPlanes=l,n.numIntersection=0}function G(z,X,Q,re){const ue=null!==z?z.length:0;let Te=null;if(0!==ue){if(Te=C.value,!0!==re||null===Te){const se=Q+4*ue,J=X.matrixWorldInverse;g.getNormalMatrix(J),(null===Te||Te.length<se)&&(Te=new Float32Array(se));for(let Be=0,be=Q;Be!==ue;++Be,be+=4)m.copy(z[Be]).applyMatrix4(J,g),m.normal.toArray(Te,be),Te[be+3]=m.constant}C.value=Te,C.needsUpdate=!0}return n.numPlanes=ue,n.numIntersection=0,Te}this.uniform=C,this.numPlanes=0,this.numIntersection=0,this.init=function(z,X,Q){const re=0!==z.length||X||0!==l||c;return c=X,r=G(z,Q,0),l=z.length,re},this.beginShadows=function(){f=!0,G(null)},this.endShadows=function(){f=!1,L()},this.setState=function(z,X,Q){const re=z.clippingPlanes,ue=z.clipIntersection,Te=z.clipShadows,se=h.get(z);if(!c||null===re||0===re.length||f&&!Te)f?G(null):L();else{const J=f?0:l,Be=4*J;let be=se.clippingState||null;C.value=be,be=G(re,X,Be,Q);for(let Ve=0;Ve!==Be;++Ve)be[Ve]=r[Ve];se.clippingState=be,this.numIntersection=ue?this.numPlanes:0,this.numPlanes+=J}}}function HA(h){let n=new WeakMap;function r(m,g){return 303===g?m.mapping=301:304===g&&(m.mapping=302),m}function c(m){const g=m.target;g.removeEventListener("dispose",c);const C=n.get(g);void 0!==C&&(n.delete(g),C.dispose())}return{get:function(m){if(m&&m.isTexture&&!1===m.isRenderTargetTexture){const g=m.mapping;if(303===g||304===g){if(n.has(m))return r(n.get(m).texture,m.mapping);{const C=m.image;if(C&&C.height>0){const L=new Yd(C.height/2);return L.fromEquirectangularTexture(h,m),n.set(m,L),m.addEventListener("dispose",c),r(L.texture,m.mapping)}return null}}}return m},dispose:function(){n=new WeakMap}}}rl.physical={uniforms:_o([rl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new st(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new zn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new st},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new zn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new zn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ur.meshphysical_vert,fragmentShader:Ur.meshphysical_frag};class wr extends gc{constructor(n=-1,r=1,l=1,c=-1,f=.1,m=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=r,this.top=l,this.bottom=c,this.near=f,this.far=m,this.updateProjectionMatrix()}copy(n,r){return super.copy(n,r),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=null===n.view?null:Object.assign({},n.view),this}setViewOffset(n,r,l,c,f,m){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=r,this.view.offsetX=l,this.view.offsetY=c,this.view.width=f,this.view.height=m,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),l=(this.right+this.left)/2,c=(this.top+this.bottom)/2;let f=l-n,m=l+n,g=c+r,C=c-r;if(null!==this.view&&this.view.enabled){const L=(this.right-this.left)/this.view.fullWidth/this.zoom,G=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f+=L*this.view.offsetX,m=f+L*this.view.width,g-=G*this.view.offsetY,C=g-G*this.view.height}this.projectionMatrix.makeOrthographic(f,m,g,C,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const r=super.toJSON(n);return r.object.zoom=this.zoom,r.object.left=this.left,r.object.right=this.right,r.object.top=this.top,r.object.bottom=this.bottom,r.object.near=this.near,r.object.far=this.far,null!==this.view&&(r.object.view=Object.assign({},this.view)),r}}wr.prototype.isOrthographicCamera=!0;class Xn extends Ul{constructor(n){super(n),this.type="RawShaderMaterial"}}Xn.prototype.isRawShaderMaterial=!0;const sl=Math.pow(2,8),Km=[.125,.215,.35,.446,.526,.582],Jm=5+Km.length,lp=new wr,{_lodPlanes:ol,_sizeLods:$c,_sigmas:Gh}=$m(),yc=new zn;let zh=null;const xc=(1+Math.sqrt(5))/2,Ac=1/xc,bc=[new Oe(1,1,1),new Oe(-1,1,1),new Oe(1,1,-1),new Oe(-1,1,-1),new Oe(0,xc,Ac),new Oe(0,xc,-Ac),new Oe(Ac,0,xc),new Oe(-Ac,0,xc),new Oe(xc,Ac,0),new Oe(-xc,Ac,0)];class Ec{constructor(n){this._renderer=n,this._pingPongRenderTarget=null,this._blurMaterial=function(h){const n=new Float32Array(h),r=new Oe(0,1,0);return new Xn({name:"SphericalGaussianBlur",defines:{n:h},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(n,r=0,l=.1,c=100){zh=this._renderer.getRenderTarget();const f=this._allocateTargets();return this._sceneToCubeUV(n,l,c,f),r>0&&this._blur(f,0,0,r),this._applyPMREM(f),this._cleanup(f),f}fromEquirectangular(n,r=null){return this._fromTexture(n,r)}fromCubemap(n,r=null){return this._fromTexture(n,r)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=tg(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Vh(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let n=0;n<ol.length;n++)ol[n].dispose()}_cleanup(n){this._renderer.setRenderTarget(zh),n.scissorTest=!1,Kd(n,0,0,n.width,n.height)}_fromTexture(n,r){zh=this._renderer.getRenderTarget();const l=r||this._allocateTargets(n);return this._textureToCubeUV(n,l),this._applyPMREM(l),this._cleanup(l),l}_allocateTargets(n){const r={magFilter:vt,minFilter:vt,generateMipmaps:!1,type:Oi,format:bt,encoding:ts,depthBuffer:!1},l=cp(r);return l.depthBuffer=!n,null===this._pingPongRenderTarget&&(this._pingPongRenderTarget=cp(r)),l}_compileMaterial(n){const r=new Ys(ol[0],n);this._renderer.compile(r,lp)}_sceneToCubeUV(n,r,l,c){const g=new Ss(90,1,r,l),C=[1,-1,1,1,1,1],L=[1,1,1,-1,-1,-1],G=this._renderer,z=G.autoClear,X=G.toneMapping;G.getClearColor(yc),G.toneMapping=0,G.autoClear=!1;const Q=new ta({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),re=new Ys(new ya,Q);let ue=!1;const Te=n.background;Te?Te.isColor&&(Q.color.copy(Te),n.background=null,ue=!0):(Q.color.copy(yc),ue=!0);for(let se=0;se<6;se++){const J=se%3;0===J?(g.up.set(0,C[se],0),g.lookAt(L[se],0,0)):1===J?(g.up.set(0,0,C[se]),g.lookAt(0,L[se],0)):(g.up.set(0,C[se],0),g.lookAt(0,0,L[se])),Kd(c,J*sl,se>2?sl:0,sl,sl),G.setRenderTarget(c),ue&&G.render(re,g),G.render(n,g)}re.geometry.dispose(),re.material.dispose(),G.toneMapping=X,G.autoClear=z,n.background=Te}_textureToCubeUV(n,r){const l=this._renderer,c=301===n.mapping||302===n.mapping;c?(null===this._cubemapShader&&(this._cubemapShader=tg()),this._cubemapShader.uniforms.flipEnvMap.value=!1===n.isRenderTargetTexture?-1:1):null===this._equirectShader&&(this._equirectShader=Vh());const f=c?this._cubemapShader:this._equirectShader,m=new Ys(ol[0],f),g=f.uniforms;g.envMap.value=n,c||g.texelSize.value.set(1/n.image.width,1/n.image.height),Kd(r,0,0,3*sl,2*sl),l.setRenderTarget(r),l.render(m,lp)}_applyPMREM(n){const r=this._renderer,l=r.autoClear;r.autoClear=!1;for(let c=1;c<Jm;c++){const f=Math.sqrt(Gh[c]*Gh[c]-Gh[c-1]*Gh[c-1]);this._blur(n,c-1,c,f,bc[(c-1)%bc.length])}r.autoClear=l}_blur(n,r,l,c,f){const m=this._pingPongRenderTarget;this._halfBlur(n,m,r,l,c,"latitudinal",f),this._halfBlur(m,n,l,l,c,"longitudinal",f)}_halfBlur(n,r,l,c,f,m,g){const C=this._renderer,L=this._blurMaterial;"latitudinal"!==m&&"longitudinal"!==m&&console.error("blur direction must be either latitudinal or longitudinal!");const z=new Ys(ol[c],L),X=L.uniforms,Q=$c[l]-1,re=isFinite(f)?Math.PI/(2*Q):2*Math.PI/39,ue=f/re,Te=isFinite(f)?1+Math.floor(3*ue):20;Te>20&&console.warn(`sigmaRadians, ${f}, is too large and will clip, as it requested ${Te} samples when the maximum is set to 20`);const se=[];let J=0;for(let Ze=0;Ze<20;++Ze){const dt=Ze/ue,yt=Math.exp(-dt*dt/2);se.push(yt),0===Ze?J+=yt:Ze<Te&&(J+=2*yt)}for(let Ze=0;Ze<se.length;Ze++)se[Ze]=se[Ze]/J;X.envMap.value=n.texture,X.samples.value=Te,X.weights.value=se,X.latitudinal.value="latitudinal"===m,g&&(X.poleAxis.value=g),X.dTheta.value=re,X.mipInt.value=8-l;const Be=$c[c];Kd(r,3*Math.max(0,sl-2*Be),(0===c?0:2*sl)+2*Be*(c>4?c-8+4:0),3*Be,2*Be),C.setRenderTarget(r),C.render(z,lp)}}function $m(){const h=[],n=[],r=[];let l=8;for(let c=0;c<Jm;c++){const f=Math.pow(2,l);n.push(f);let m=1/f;c>4?m=Km[c-8+4-1]:0===c&&(m=0),r.push(m);const g=1/(f-1),C=-g/2,L=1+g/2,G=[C,C,L,C,L,L,C,C,L,L,C,L],z=6,X=6,Q=3,re=2,ue=1,Te=new Float32Array(Q*X*z),se=new Float32Array(re*X*z),J=new Float32Array(ue*X*z);for(let be=0;be<z;be++){const Ve=be%3*2/3-1,Ze=be>2?0:-1;Te.set([Ve,Ze,0,Ve+2/3,Ze,0,Ve+2/3,Ze+1,0,Ve,Ze,0,Ve+2/3,Ze+1,0,Ve,Ze+1,0],Q*X*be),se.set(G,re*X*be),J.set([be,be,be,be,be,be],ue*X*be)}const Be=new ji;Be.setAttribute("position",new Gr(Te,Q)),Be.setAttribute("uv",new Gr(se,re)),Be.setAttribute("faceIndex",new Gr(J,ue)),h.push(Be),l>4&&l--}return{_lodPlanes:h,_sizeLods:n,_sigmas:r}}function cp(h){const n=new Ro(3*sl,3*sl,h);return n.texture.mapping=306,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Kd(h,n,r,l,c){h.viewport.set(n,r,l,c),h.scissor.set(n,r,l,c)}function Vh(){const h=new st(1,1);return new Xn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:h}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = texture2D ( envMap, uv ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function tg(){return new Xn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ng(h){let n=new WeakMap,r=null;function f(g){const C=g.target;C.removeEventListener("dispose",f);const L=n.get(C);void 0!==L&&(n.delete(C),L.dispose())}return{get:function(g){if(g&&g.isTexture){const C=g.mapping,L=303===C||304===C,G=301===C||302===C;if(L||G){if(g.isRenderTargetTexture&&!0===g.needsPMREMUpdate){g.needsPMREMUpdate=!1;let z=n.get(g);return null===r&&(r=new Ec(h)),z=L?r.fromEquirectangular(g,z):r.fromCubemap(g,z),n.set(g,z),z.texture}if(n.has(g))return n.get(g).texture;{const z=g.image;if(L&&z&&z.height>0||G&&z&&function(g){let C=0;const L=6;for(let G=0;G<L;G++)void 0!==g[G]&&C++;return C===L}(z)){null===r&&(r=new Ec(h));const X=L?r.fromEquirectangular(g):r.fromCubemap(g);return n.set(g,X),g.addEventListener("dispose",f),X.texture}return null}}}return g},dispose:function(){n=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function up(h){const n={};function r(l){if(void 0!==n[l])return n[l];let c;switch(l){case"WEBGL_depth_texture":c=h.getExtension("WEBGL_depth_texture")||h.getExtension("MOZ_WEBGL_depth_texture")||h.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":c=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":c=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":c=h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:c=h.getExtension(l)}return n[l]=c,c}return{has:function(l){return null!==r(l)},init:function(l){l.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(l){const c=r(l);return null===c&&console.warn("THREE.WebGLRenderer: "+l+" extension not supported."),c}}}function Z0(h,n,r,l){const c={},f=new WeakMap;function m(z){const X=z.target;null!==X.index&&n.remove(X.index);for(const re in X.attributes)n.remove(X.attributes[re]);X.removeEventListener("dispose",m),delete c[X.id];const Q=f.get(X);Q&&(n.remove(Q),f.delete(X)),l.releaseStatesOfGeometry(X),!0===X.isInstancedBufferGeometry&&delete X._maxInstanceCount,r.memory.geometries--}function L(z){const X=[],Q=z.index,re=z.attributes.position;let ue=0;if(null!==Q){const J=Q.array;ue=Q.version;for(let Be=0,be=J.length;Be<be;Be+=3){const Ve=J[Be+0],Ze=J[Be+1],dt=J[Be+2];X.push(Ve,Ze,Ze,dt,dt,Ve)}}else{ue=re.version;for(let Be=0,be=re.array.length/3-1;Be<be;Be+=3){const Ve=Be+0,Ze=Be+1,dt=Be+2;X.push(Ve,Ze,Ze,dt,dt,Ve)}}const Te=new(tp(X)?qc:Pa)(X,1);Te.version=ue;const se=f.get(z);se&&n.remove(se),f.set(z,Te)}return{get:function(z,X){return!0===c[X.id]||(X.addEventListener("dispose",m),c[X.id]=!0,r.memory.geometries++),X},update:function(z){const X=z.attributes;for(const re in X)n.update(X[re],h.ARRAY_BUFFER);const Q=z.morphAttributes;for(const re in Q){const ue=Q[re];for(let Te=0,se=ue.length;Te<se;Te++)n.update(ue[Te],h.ARRAY_BUFFER)}},getWireframeAttribute:function(z){const X=f.get(z);if(X){const Q=z.index;null!==Q&&X.version<Q.version&&L(z)}else L(z);return f.get(z)}}}function q0(h,n,r,l){const c=l.isWebGL2;let f,g,C;this.setMode=function(X){f=X},this.setIndex=function(X){g=X.type,C=X.bytesPerElement},this.render=function(X,Q){h.drawElements(f,Q,g,X*C),r.update(Q,f,1)},this.renderInstances=function(X,Q,re){if(0===re)return;let ue,Te;if(c)ue=h,Te="drawElementsInstanced";else if(ue=n.get("ANGLE_instanced_arrays"),Te="drawElementsInstancedANGLE",null===ue)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");ue[Te](f,Q,g,X*C,re),r.update(Q,f,re)}}function K0(h){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(f,m,g){switch(r.calls++,m){case h.TRIANGLES:r.triangles+=g*(f/3);break;case h.LINES:r.lines+=g*(f/2);break;case h.LINE_STRIP:r.lines+=g*(f-1);break;case h.LINE_LOOP:r.lines+=g*f;break;case h.POINTS:r.points+=g*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",m)}}}}class $d extends Rn{constructor(n=null,r=1,l=1,c=1){super(null),this.image={data:n,width:r,height:l,depth:c},this.magFilter=On,this.minFilter=On,this.wrapR=dn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function J0(h,n){return h[0]-n[0]}function $0(h,n){return Math.abs(n[1])-Math.abs(h[1])}function ig(h,n){let r=1;const l=n.isInterleavedBufferAttribute?n.data.array:n.array;l instanceof Int8Array?r=127:l instanceof Int16Array?r=32767:l instanceof Int32Array?r=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",l),h.divideScalar(r)}function hp(h,n,r){const l={},c=new Float32Array(8),f=new WeakMap,m=new Oe,g=[];for(let L=0;L<8;L++)g[L]=[L,0];return{update:function(L,G,z,X){const Q=L.morphTargetInfluences;if(!0===n.isWebGL2){const re=G.morphAttributes.position.length;let ue=f.get(G);if(void 0===ue||ue.count!==re){let Ke=function(){Ht.dispose(),f.delete(G),G.removeEventListener("dispose",Ke)};void 0!==ue&&ue.texture.dispose();const J=void 0!==G.morphAttributes.normal,Be=G.morphAttributes.position,be=G.morphAttributes.normal||[],Ze=!0===J?2:1;let dt=G.attributes.position.count*Ze,yt=1;dt>n.maxTextureSize&&(yt=Math.ceil(dt/n.maxTextureSize),dt=n.maxTextureSize);const It=new Float32Array(dt*yt*4*re),Ht=new $d(It,dt,yt,re);Ht.format=bt,Ht.type=Xi,Ht.needsUpdate=!0;const _e=4*Ze;for(let Et=0;Et<re;Et++){const Mt=Be[Et],At=be[Et],Ft=dt*yt*4*Et;for(let en=0;en<Mt.count;en++){m.fromBufferAttribute(Mt,en),!0===Mt.normalized&&ig(m,Mt);const Cn=en*_e;It[Ft+Cn+0]=m.x,It[Ft+Cn+1]=m.y,It[Ft+Cn+2]=m.z,It[Ft+Cn+3]=0,!0===J&&(m.fromBufferAttribute(At,en),!0===At.normalized&&ig(m,At),It[Ft+Cn+4]=m.x,It[Ft+Cn+5]=m.y,It[Ft+Cn+6]=m.z,It[Ft+Cn+7]=0)}}ue={count:re,texture:Ht,size:new st(dt,yt)},f.set(G,ue),G.addEventListener("dispose",Ke)}let Te=0;for(let J=0;J<Q.length;J++)Te+=Q[J];const se=G.morphTargetsRelative?1:1-Te;X.getUniforms().setValue(h,"morphTargetBaseInfluence",se),X.getUniforms().setValue(h,"morphTargetInfluences",Q),X.getUniforms().setValue(h,"morphTargetsTexture",ue.texture,r),X.getUniforms().setValue(h,"morphTargetsTextureSize",ue.size)}else{const re=void 0===Q?0:Q.length;let ue=l[G.id];if(void 0===ue||ue.length!==re){ue=[];for(let be=0;be<re;be++)ue[be]=[be,0];l[G.id]=ue}for(let be=0;be<re;be++){const Ve=ue[be];Ve[0]=be,Ve[1]=Q[be]}ue.sort($0);for(let be=0;be<8;be++)be<re&&ue[be][1]?(g[be][0]=ue[be][0],g[be][1]=ue[be][1]):(g[be][0]=Number.MAX_SAFE_INTEGER,g[be][1]=0);g.sort(J0);const Te=G.morphAttributes.position,se=G.morphAttributes.normal;let J=0;for(let be=0;be<8;be++){const Ve=g[be],Ze=Ve[0],dt=Ve[1];Ze!==Number.MAX_SAFE_INTEGER&&dt?(Te&&G.getAttribute("morphTarget"+be)!==Te[Ze]&&G.setAttribute("morphTarget"+be,Te[Ze]),se&&G.getAttribute("morphNormal"+be)!==se[Ze]&&G.setAttribute("morphNormal"+be,se[Ze]),c[be]=dt,J+=dt):(Te&&!0===G.hasAttribute("morphTarget"+be)&&G.deleteAttribute("morphTarget"+be),se&&!0===G.hasAttribute("morphNormal"+be)&&G.deleteAttribute("morphNormal"+be),c[be]=0)}const Be=G.morphTargetsRelative?1:1-J;X.getUniforms().setValue(h,"morphTargetBaseInfluence",Be),X.getUniforms().setValue(h,"morphTargetInfluences",c)}}}}function ey(h,n,r,l){let c=new WeakMap;function g(C){const L=C.target;L.removeEventListener("dispose",g),r.remove(L.instanceMatrix),null!==L.instanceColor&&r.remove(L.instanceColor)}return{update:function(C){const L=l.render.frame,z=n.get(C,C.geometry);return c.get(z)!==L&&(n.update(z),c.set(z,L)),C.isInstancedMesh&&(!1===C.hasEventListener("dispose",g)&&C.addEventListener("dispose",g),r.update(C.instanceMatrix,h.ARRAY_BUFFER),null!==C.instanceColor&&r.update(C.instanceColor,h.ARRAY_BUFFER)),z},dispose:function(){c=new WeakMap}}}$d.prototype.isDataTexture2DArray=!0;class dp extends Rn{constructor(n=null,r=1,l=1,c=1){super(null),this.image={data:n,width:r,height:l,depth:c},this.magFilter=On,this.minFilter=On,this.wrapR=dn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}dp.prototype.isDataTexture3D=!0;const fp=new Rn,pp=new $d,mp=new dp,gp=new Vu,vp=[],yp=[],xp=new Float32Array(16),Ap=new Float32Array(9),bp=new Float32Array(4);function ka(h,n,r){const l=h[0];if(l<=0||l>0)return h;const c=n*r;let f=vp[c];if(void 0===f&&(f=new Float32Array(c),vp[c]=f),0!==n){l.toArray(f,0);for(let m=1,g=0;m!==n;++m)g+=r,h[m].toArray(f,g)}return f}function ms(h,n){if(h.length!==n.length)return!1;for(let r=0,l=h.length;r<l;r++)if(h[r]!==n[r])return!1;return!0}function cs(h,n){for(let r=0,l=n.length;r<l;r++)h[r]=n[r]}function eu(h,n){let r=yp[n];void 0===r&&(r=new Int32Array(n),yp[n]=r);for(let l=0;l!==n;++l)r[l]=h.allocateTextureUnit();return r}function ty(h,n){const r=this.cache;r[0]!==n&&(h.uniform1f(this.addr,n),r[0]=n)}function ny(h,n){const r=this.cache;if(void 0!==n.x)(r[0]!==n.x||r[1]!==n.y)&&(h.uniform2f(this.addr,n.x,n.y),r[0]=n.x,r[1]=n.y);else{if(ms(r,n))return;h.uniform2fv(this.addr,n),cs(r,n)}}function iy(h,n){const r=this.cache;if(void 0!==n.x)(r[0]!==n.x||r[1]!==n.y||r[2]!==n.z)&&(h.uniform3f(this.addr,n.x,n.y,n.z),r[0]=n.x,r[1]=n.y,r[2]=n.z);else if(void 0!==n.r)(r[0]!==n.r||r[1]!==n.g||r[2]!==n.b)&&(h.uniform3f(this.addr,n.r,n.g,n.b),r[0]=n.r,r[1]=n.g,r[2]=n.b);else{if(ms(r,n))return;h.uniform3fv(this.addr,n),cs(r,n)}}function ry(h,n){const r=this.cache;if(void 0!==n.x)(r[0]!==n.x||r[1]!==n.y||r[2]!==n.z||r[3]!==n.w)&&(h.uniform4f(this.addr,n.x,n.y,n.z,n.w),r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=n.w);else{if(ms(r,n))return;h.uniform4fv(this.addr,n),cs(r,n)}}function sy(h,n){const r=this.cache,l=n.elements;if(void 0===l){if(ms(r,n))return;h.uniformMatrix2fv(this.addr,!1,n),cs(r,n)}else{if(ms(r,l))return;bp.set(l),h.uniformMatrix2fv(this.addr,!1,bp),cs(r,l)}}function oy(h,n){const r=this.cache,l=n.elements;if(void 0===l){if(ms(r,n))return;h.uniformMatrix3fv(this.addr,!1,n),cs(r,n)}else{if(ms(r,l))return;Ap.set(l),h.uniformMatrix3fv(this.addr,!1,Ap),cs(r,l)}}function ay(h,n){const r=this.cache,l=n.elements;if(void 0===l){if(ms(r,n))return;h.uniformMatrix4fv(this.addr,!1,n),cs(r,n)}else{if(ms(r,l))return;xp.set(l),h.uniformMatrix4fv(this.addr,!1,xp),cs(r,l)}}function ly(h,n){const r=this.cache;r[0]!==n&&(h.uniform1i(this.addr,n),r[0]=n)}function cy(h,n){const r=this.cache;ms(r,n)||(h.uniform2iv(this.addr,n),cs(r,n))}function uy(h,n){const r=this.cache;ms(r,n)||(h.uniform3iv(this.addr,n),cs(r,n))}function hy(h,n){const r=this.cache;ms(r,n)||(h.uniform4iv(this.addr,n),cs(r,n))}function dy(h,n){const r=this.cache;r[0]!==n&&(h.uniform1ui(this.addr,n),r[0]=n)}function fy(h,n){const r=this.cache;ms(r,n)||(h.uniform2uiv(this.addr,n),cs(r,n))}function py(h,n){const r=this.cache;ms(r,n)||(h.uniform3uiv(this.addr,n),cs(r,n))}function my(h,n){const r=this.cache;ms(r,n)||(h.uniform4uiv(this.addr,n),cs(r,n))}function gy(h,n,r){const l=this.cache,c=r.allocateTextureUnit();l[0]!==c&&(h.uniform1i(this.addr,c),l[0]=c),r.safeSetTexture2D(n||fp,c)}function vy(h,n,r){const l=this.cache,c=r.allocateTextureUnit();l[0]!==c&&(h.uniform1i(this.addr,c),l[0]=c),r.setTexture3D(n||mp,c)}function yy(h,n,r){const l=this.cache,c=r.allocateTextureUnit();l[0]!==c&&(h.uniform1i(this.addr,c),l[0]=c),r.safeSetTextureCube(n||gp,c)}function xy(h,n,r){const l=this.cache,c=r.allocateTextureUnit();l[0]!==c&&(h.uniform1i(this.addr,c),l[0]=c),r.setTexture2DArray(n||pp,c)}function by(h,n){h.uniform1fv(this.addr,n)}function Ey(h,n){const r=ka(n,this.size,2);h.uniform2fv(this.addr,r)}function wy(h,n){const r=ka(n,this.size,3);h.uniform3fv(this.addr,r)}function _y(h,n){const r=ka(n,this.size,4);h.uniform4fv(this.addr,r)}function My(h,n){const r=ka(n,this.size,4);h.uniformMatrix2fv(this.addr,!1,r)}function Ty(h,n){const r=ka(n,this.size,9);h.uniformMatrix3fv(this.addr,!1,r)}function Sy(h,n){const r=ka(n,this.size,16);h.uniformMatrix4fv(this.addr,!1,r)}function Cy(h,n){h.uniform1iv(this.addr,n)}function Ry(h,n){h.uniform2iv(this.addr,n)}function Ly(h,n){h.uniform3iv(this.addr,n)}function Dy(h,n){h.uniform4iv(this.addr,n)}function Py(h,n){h.uniform1uiv(this.addr,n)}function Iy(h,n){h.uniform2uiv(this.addr,n)}function By(h,n){h.uniform3uiv(this.addr,n)}function Fy(h,n){h.uniform4uiv(this.addr,n)}function Oy(h,n,r){const l=n.length,c=eu(r,l);h.uniform1iv(this.addr,c);for(let f=0;f!==l;++f)r.safeSetTexture2D(n[f]||fp,c[f])}function Uy(h,n,r){const l=n.length,c=eu(r,l);h.uniform1iv(this.addr,c);for(let f=0;f!==l;++f)r.setTexture3D(n[f]||mp,c[f])}function Ny(h,n,r){const l=n.length,c=eu(r,l);h.uniform1iv(this.addr,c);for(let f=0;f!==l;++f)r.safeSetTextureCube(n[f]||gp,c[f])}function ky(h,n,r){const l=n.length,c=eu(r,l);h.uniform1iv(this.addr,c);for(let f=0;f!==l;++f)r.setTexture2DArray(n[f]||pp,c[f])}function Gy(h,n,r){this.id=h,this.addr=r,this.cache=[],this.setValue=function(h){switch(h){case 5126:return ty;case 35664:return ny;case 35665:return iy;case 35666:return ry;case 35674:return sy;case 35675:return oy;case 35676:return ay;case 5124:case 35670:return ly;case 35667:case 35671:return cy;case 35668:case 35672:return uy;case 35669:case 35673:return hy;case 5125:return dy;case 36294:return fy;case 36295:return py;case 36296:return my;case 35678:case 36198:case 36298:case 36306:case 35682:return gy;case 35679:case 36299:case 36307:return vy;case 35680:case 36300:case 36308:case 36293:return yy;case 36289:case 36303:case 36311:case 36292:return xy}}(n.type)}function Ep(h,n,r){this.id=h,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(h){switch(h){case 5126:return by;case 35664:return Ey;case 35665:return wy;case 35666:return _y;case 35674:return My;case 35675:return Ty;case 35676:return Sy;case 5124:case 35670:return Cy;case 35667:case 35671:return Ry;case 35668:case 35672:return Ly;case 35669:case 35673:return Dy;case 5125:return Py;case 36294:return Iy;case 36295:return By;case 36296:return Fy;case 35678:case 36198:case 36298:case 36306:case 35682:return Oy;case 35679:case 36299:case 36307:return Uy;case 35680:case 36300:case 36308:case 36293:return Ny;case 36289:case 36303:case 36311:case 36292:return ky}}(n.type)}function wp(h){this.id=h,this.seq=[],this.map={}}Ep.prototype.updateCache=function(h){const n=this.cache;h instanceof Float32Array&&n.length!==h.length&&(this.cache=new Float32Array(h.length)),cs(n,h)},wp.prototype.setValue=function(h,n,r){const l=this.seq;for(let c=0,f=l.length;c!==f;++c){const m=l[c];m.setValue(h,n[m.id],r)}};const Wh=/(\w+)(\])?(\[|\.)?/g;function _p(h,n){h.seq.push(n),h.map[n.id]=n}function zy(h,n,r){const l=h.name,c=l.length;for(Wh.lastIndex=0;;){const f=Wh.exec(l),m=Wh.lastIndex;let g=f[1];const L=f[3];if("]"===f[2]&&(g|=0),void 0===L||"["===L&&m+2===c){_p(r,void 0===L?new Gy(g,h,n):new Ep(g,h,n));break}{let z=r.map[g];void 0===z&&(z=new wp(g),_p(r,z)),r=z}}}function Zo(h,n){this.seq=[],this.map={};const r=h.getProgramParameter(n,h.ACTIVE_UNIFORMS);for(let l=0;l<r;++l){const c=h.getActiveUniform(n,l);zy(c,h.getUniformLocation(n,c.name),this)}}function Mp(h,n,r){const l=h.createShader(n);return h.shaderSource(l,r),h.compileShader(l),l}Zo.prototype.setValue=function(h,n,r,l){const c=this.map[n];void 0!==c&&c.setValue(h,r,l)},Zo.prototype.setOptional=function(h,n,r){const l=n[r];void 0!==l&&this.setValue(h,r,l)},Zo.upload=function(h,n,r,l){for(let c=0,f=n.length;c!==f;++c){const m=n[c],g=r[m.id];!1!==g.needsUpdate&&m.setValue(h,g.value,l)}},Zo.seqWithValue=function(h,n){const r=[];for(let l=0,c=h.length;l!==c;++l){const f=h[l];f.id in n&&r.push(f)}return r};let Vy=0;function Tp(h,n,r){const l=h.getShaderParameter(n,h.COMPILE_STATUS),c=h.getShaderInfoLog(n).trim();return l&&""===c?"":r.toUpperCase()+"\n\n"+c+"\n\n"+function(h){const n=h.split("\n");for(let r=0;r<n.length;r++)n[r]=r+1+": "+n[r];return n.join("\n")}(h.getShaderSource(n))}function jy(h,n){const r=function(h){switch(h){case ts:return["Linear","( value )"];case br:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",h),["Linear","( value )"]}}(n);return"vec4 "+h+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Yy(h,n){let r;switch(n){case 1:r="Linear";break;case 2:r="Reinhard";break;case 3:r="OptimizedCineon";break;case 4:r="ACESFilmic";break;case 5:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),r="Linear"}return"vec3 "+h+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Hl(h){return""!==h}function Sp(h,n){return h.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function Cp(h,n){return h.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const Ky=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xh(h){return h.replace(Ky,Jy)}function Jy(h,n){const r=Ur[n];if(void 0===r)throw new Error("Can not resolve #include <"+n+">");return Xh(r)}const $y=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ex=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rp(h){return h.replace(ex,Lp).replace($y,tx)}function tx(h,n,r,l){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Lp(0,n,r,l)}function Lp(h,n,r,l){let c="";for(let f=parseInt(n);f<parseInt(r);f++)c+=l.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return c}function Dp(h){let n="precision "+h.precision+" float;\nprecision "+h.precision+" int;";return"highp"===h.precision?n+="\n#define HIGH_PRECISION":"mediump"===h.precision?n+="\n#define MEDIUM_PRECISION":"lowp"===h.precision&&(n+="\n#define LOW_PRECISION"),n}function ox(h,n,r,l){const c=h.getContext(),f=r.defines;let m=r.vertexShader,g=r.fragmentShader;const C=function(h){let n="SHADOWMAP_TYPE_BASIC";return 1===h.shadowMapType?n="SHADOWMAP_TYPE_PCF":2===h.shadowMapType?n="SHADOWMAP_TYPE_PCF_SOFT":3===h.shadowMapType&&(n="SHADOWMAP_TYPE_VSM"),n}(r),L=function(h){let n="ENVMAP_TYPE_CUBE";if(h.envMap)switch(h.envMapMode){case 301:case 302:n="ENVMAP_TYPE_CUBE";break;case 306:case 307:n="ENVMAP_TYPE_CUBE_UV"}return n}(r),G=function(h){let n="ENVMAP_MODE_REFLECTION";if(h.envMap)switch(h.envMapMode){case 302:case 307:n="ENVMAP_MODE_REFRACTION"}return n}(r),z=function(h){let n="ENVMAP_BLENDING_NONE";if(h.envMap)switch(h.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}return n}(r),X=r.isWebGL2?"":function(h){return[h.extensionDerivatives||h.envMapCubeUV||h.bumpMap||h.tangentSpaceNormalMap||h.clearcoatNormalMap||h.flatShading||"physical"===h.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(h.extensionFragDepth||h.logarithmicDepthBuffer)&&h.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",h.extensionDrawBuffers&&h.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(h.extensionShaderTextureLOD||h.envMap||h.transmission)&&h.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hl).join("\n")}(r),Q=function(h){const n=[];for(const r in h){const l=h[r];!1!==l&&n.push("#define "+r+" "+l)}return n.join("\n")}(f),re=c.createProgram();let ue,Te,se=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(ue=[Q].filter(Hl).join("\n"),ue.length>0&&(ue+="\n"),Te=[X,Q].filter(Hl).join("\n"),Te.length>0&&(Te+="\n")):(ue=[Dp(r),"#define SHADER_NAME "+r.shaderName,Q,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+G:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+C:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hl).join("\n"),Te=[X,Dp(r),"#define SHADER_NAME "+r.shaderName,Q,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+L:"",r.envMap?"#define "+G:"",r.envMap?"#define "+z:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+C:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==r.toneMapping?"#define TONE_MAPPING":"",0!==r.toneMapping?Ur.tonemapping_pars_fragment:"",0!==r.toneMapping?Yy("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.alphaWrite?"":"#define OPAQUE",Ur.encodings_pars_fragment,jy("linearToOutputTexel",r.outputEncoding),r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Hl).join("\n")),m=Xh(m),m=Sp(m,r),m=Cp(m,r),g=Xh(g),g=Sp(g,r),g=Cp(g,r),m=Rp(m),g=Rp(g),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(se="#version 300 es\n",ue=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+ue,Te=["#define varying in",r.glslVersion===$a?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===$a?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+Te);const Be=se+Te+g,be=Mp(c,c.VERTEX_SHADER,se+ue+m),Ve=Mp(c,c.FRAGMENT_SHADER,Be);if(c.attachShader(re,be),c.attachShader(re,Ve),void 0!==r.index0AttributeName?c.bindAttribLocation(re,0,r.index0AttributeName):!0===r.morphTargets&&c.bindAttribLocation(re,0,"position"),c.linkProgram(re),h.debug.checkShaderErrors){const yt=c.getProgramInfoLog(re).trim(),It=c.getShaderInfoLog(be).trim(),Ht=c.getShaderInfoLog(Ve).trim();let _e=!0,Ke=!0;if(!1===c.getProgramParameter(re,c.LINK_STATUS)){_e=!1;const Et=Tp(c,be,"vertex"),Mt=Tp(c,Ve,"fragment");console.error("THREE.WebGLProgram: Shader Error "+c.getError()+" - VALIDATE_STATUS "+c.getProgramParameter(re,c.VALIDATE_STATUS)+"\n\nProgram Info Log: "+yt+"\n"+Et+"\n"+Mt)}else""!==yt?console.warn("THREE.WebGLProgram: Program Info Log:",yt):(""===It||""===Ht)&&(Ke=!1);Ke&&(this.diagnostics={runnable:_e,programLog:yt,vertexShader:{log:It,prefix:ue},fragmentShader:{log:Ht,prefix:Te}})}let Ze,dt;return c.deleteShader(be),c.deleteShader(Ve),this.getUniforms=function(){return void 0===Ze&&(Ze=new Zo(c,re)),Ze},this.getAttributes=function(){return void 0===dt&&(dt=function(h,n){const r={},l=h.getProgramParameter(n,h.ACTIVE_ATTRIBUTES);for(let c=0;c<l;c++){const f=h.getActiveAttrib(n,c),m=f.name;let g=1;f.type===h.FLOAT_MAT2&&(g=2),f.type===h.FLOAT_MAT3&&(g=3),f.type===h.FLOAT_MAT4&&(g=4),r[m]={type:f.type,location:h.getAttribLocation(n,m),locationSize:g}}return r}(c,re)),dt},this.destroy=function(){l.releaseStatesOfProgram(this),c.deleteProgram(re),this.program=void 0},this.name=r.shaderName,this.id=Vy++,this.cacheKey=n,this.usedTimes=1,this.program=re,this.vertexShader=be,this.fragmentShader=Ve,this}let ax=0;class lx{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(n){const l=n.fragmentShader,c=this._getShaderStage(n.vertexShader),f=this._getShaderStage(l),m=this._getShaderCacheForMaterial(n);return!1===m.has(c)&&(m.add(c),c.usedTimes++),!1===m.has(f)&&(m.add(f),f.usedTimes++),this}remove(n){const r=this.materialCache.get(n);for(const l of r)l.usedTimes--,0===l.usedTimes&&this.shaderCache.delete(l);return this.materialCache.delete(n),this}getVertexShaderID(n){return this._getShaderStage(n.vertexShader).id}getFragmentShaderID(n){return this._getShaderStage(n.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(n){const r=this.materialCache;return!1===r.has(n)&&r.set(n,new Set),r.get(n)}_getShaderStage(n){const r=this.shaderCache;if(!1===r.has(n)){const l=new cx;r.set(n,l)}return r.get(n)}}class cx{constructor(){this.id=ax++,this.usedTimes=0}}function ux(h,n,r,l,c,f,m){const g=new kd,C=new lx,L=[],G=c.isWebGL2,z=c.logarithmicDepthBuffer,X=c.floatVertexTextures,Q=c.maxVertexUniforms,re=c.vertexTextures;let ue=c.precision;const Te={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(_e,Ke,Et,Mt,At){const Ft=Mt.fog,Cn=(_e.isMeshStandardMaterial?r:n).get(_e.envMap||(_e.isMeshStandardMaterial?Mt.environment:null)),xi=Te[_e.type],Di=At.isSkinnedMesh?function(_e){const Et=_e.skeleton.bones;if(X)return 1024;{const At=Math.floor((Q-20)/4),Ft=Math.min(At,Et.length);return Ft<Et.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Et.length+" bones. This GPU supports "+Ft+"."),0):Ft}}(At):0;let ci,hn,Zn,Ni;if(null!==_e.precision&&(ue=c.getMaxPrecision(_e.precision),ue!==_e.precision&&console.warn("THREE.WebGLProgram.getParameters:",_e.precision,"not supported, using",ue,"instead.")),xi){const ui=rl[xi];ci=ui.vertexShader,hn=ui.fragmentShader}else ci=_e.vertexShader,hn=_e.fragmentShader,C.update(_e),Zn=C.getVertexShaderID(_e),Ni=C.getFragmentShaderID(_e);const mt=h.getRenderTarget(),pi=_e.clearcoat>0;return{isWebGL2:G,shaderID:xi,shaderName:_e.type,vertexShader:ci,fragmentShader:hn,defines:_e.defines,customVertexShaderID:Zn,customFragmentShaderID:Ni,isRawShaderMaterial:!0===_e.isRawShaderMaterial,glslVersion:_e.glslVersion,precision:ue,instancing:!0===At.isInstancedMesh,instancingColor:!0===At.isInstancedMesh&&null!==At.instanceColor,supportsVertexTextures:re,outputEncoding:null===mt?h.outputEncoding:!0===mt.isXRRenderTarget?mt.texture.encoding:ts,map:!!_e.map,matcap:!!_e.matcap,envMap:!!Cn,envMapMode:Cn&&Cn.mapping,envMapCubeUV:!!Cn&&(306===Cn.mapping||307===Cn.mapping),lightMap:!!_e.lightMap,aoMap:!!_e.aoMap,emissiveMap:!!_e.emissiveMap,bumpMap:!!_e.bumpMap,normalMap:!!_e.normalMap,objectSpaceNormalMap:1===_e.normalMapType,tangentSpaceNormalMap:0===_e.normalMapType,decodeVideoTexture:!!_e.map&&!0===_e.map.isVideoTexture&&_e.map.encoding===br,clearcoat:pi,clearcoatMap:pi&&!!_e.clearcoatMap,clearcoatRoughnessMap:pi&&!!_e.clearcoatRoughnessMap,clearcoatNormalMap:pi&&!!_e.clearcoatNormalMap,displacementMap:!!_e.displacementMap,roughnessMap:!!_e.roughnessMap,metalnessMap:!!_e.metalnessMap,specularMap:!!_e.specularMap,specularIntensityMap:!!_e.specularIntensityMap,specularColorMap:!!_e.specularColorMap,alphaMap:!!_e.alphaMap,alphaTest:_e.alphaTest>0,alphaWrite:_e.alphaWrite||_e.transparent,gradientMap:!!_e.gradientMap,sheen:_e.sheen>0,sheenColorMap:!!_e.sheenColorMap,sheenRoughnessMap:!!_e.sheenRoughnessMap,transmission:_e.transmission>0,transmissionMap:!!_e.transmissionMap,thicknessMap:!!_e.thicknessMap,combine:_e.combine,vertexTangents:!!_e.normalMap&&!!At.geometry&&!!At.geometry.attributes.tangent,vertexColors:_e.vertexColors,vertexAlphas:!0===_e.vertexColors&&!!At.geometry&&!!At.geometry.attributes.color&&4===At.geometry.attributes.color.itemSize,vertexUvs:!!(_e.map||_e.bumpMap||_e.normalMap||_e.specularMap||_e.alphaMap||_e.emissiveMap||_e.roughnessMap||_e.metalnessMap||_e.clearcoatMap||_e.clearcoatRoughnessMap||_e.clearcoatNormalMap||_e.displacementMap||_e.transmissionMap||_e.thicknessMap||_e.specularIntensityMap||_e.specularColorMap||_e.sheenColorMap||_e.sheenRoughnessMap),uvsVertexOnly:!(_e.map||_e.bumpMap||_e.normalMap||_e.specularMap||_e.alphaMap||_e.emissiveMap||_e.roughnessMap||_e.metalnessMap||_e.clearcoatNormalMap||_e.transmission>0||_e.transmissionMap||_e.thicknessMap||_e.specularIntensityMap||_e.specularColorMap||_e.sheen>0||_e.sheenColorMap||_e.sheenRoughnessMap||!_e.displacementMap),fog:!!Ft,useFog:_e.fog,fogExp2:Ft&&Ft.isFogExp2,flatShading:!!_e.flatShading,sizeAttenuation:_e.sizeAttenuation,logarithmicDepthBuffer:z,skinning:!0===At.isSkinnedMesh&&Di>0,maxBones:Di,useVertexTexture:X,morphTargets:!!At.geometry&&!!At.geometry.morphAttributes.position,morphNormals:!!At.geometry&&!!At.geometry.morphAttributes.normal,morphTargetsCount:At.geometry&&At.geometry.morphAttributes.position?At.geometry.morphAttributes.position.length:0,numDirLights:Ke.directional.length,numPointLights:Ke.point.length,numSpotLights:Ke.spot.length,numRectAreaLights:Ke.rectArea.length,numHemiLights:Ke.hemi.length,numDirLightShadows:Ke.directionalShadowMap.length,numPointLightShadows:Ke.pointShadowMap.length,numSpotLightShadows:Ke.spotShadowMap.length,numClippingPlanes:m.numPlanes,numClipIntersection:m.numIntersection,dithering:_e.dithering,shadowMapEnabled:h.shadowMap.enabled&&Et.length>0,shadowMapType:h.shadowMap.type,toneMapping:_e.toneMapped?h.toneMapping:0,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:_e.premultipliedAlpha,doubleSided:2===_e.side,flipSided:1===_e.side,depthPacking:void 0!==_e.depthPacking&&_e.depthPacking,index0AttributeName:_e.index0AttributeName,extensionDerivatives:_e.extensions&&_e.extensions.derivatives,extensionFragDepth:_e.extensions&&_e.extensions.fragDepth,extensionDrawBuffers:_e.extensions&&_e.extensions.drawBuffers,extensionShaderTextureLOD:_e.extensions&&_e.extensions.shaderTextureLOD,rendererExtensionFragDepth:G||l.has("EXT_frag_depth"),rendererExtensionDrawBuffers:G||l.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:G||l.has("EXT_shader_texture_lod"),customProgramCacheKey:_e.customProgramCacheKey()}},getProgramCacheKey:function(_e){const Ke=[];if(_e.shaderID?Ke.push(_e.shaderID):(Ke.push(_e.customVertexShaderID),Ke.push(_e.customFragmentShaderID)),void 0!==_e.defines)for(const Et in _e.defines)Ke.push(Et),Ke.push(_e.defines[Et]);return!1===_e.isRawShaderMaterial&&(function(_e,Ke){_e.push(Ke.precision),_e.push(Ke.outputEncoding),_e.push(Ke.envMapMode),_e.push(Ke.combine),_e.push(Ke.vertexUvs),_e.push(Ke.fogExp2),_e.push(Ke.sizeAttenuation),_e.push(Ke.maxBones),_e.push(Ke.morphTargetsCount),_e.push(Ke.numDirLights),_e.push(Ke.numPointLights),_e.push(Ke.numSpotLights),_e.push(Ke.numHemiLights),_e.push(Ke.numRectAreaLights),_e.push(Ke.numDirLightShadows),_e.push(Ke.numPointLightShadows),_e.push(Ke.numSpotLightShadows),_e.push(Ke.shadowMapType),_e.push(Ke.toneMapping),_e.push(Ke.numClippingPlanes),_e.push(Ke.numClipIntersection),_e.push(Ke.alphaWrite)}(Ke,_e),function(_e,Ke){g.disableAll(),Ke.isWebGL2&&g.enable(0),Ke.supportsVertexTextures&&g.enable(1),Ke.instancing&&g.enable(2),Ke.instancingColor&&g.enable(3),Ke.map&&g.enable(4),Ke.matcap&&g.enable(5),Ke.envMap&&g.enable(6),Ke.envMapCubeUV&&g.enable(7),Ke.lightMap&&g.enable(8),Ke.aoMap&&g.enable(9),Ke.emissiveMap&&g.enable(10),Ke.bumpMap&&g.enable(11),Ke.normalMap&&g.enable(12),Ke.objectSpaceNormalMap&&g.enable(13),Ke.tangentSpaceNormalMap&&g.enable(14),Ke.clearcoat&&g.enable(15),Ke.clearcoatMap&&g.enable(16),Ke.clearcoatRoughnessMap&&g.enable(17),Ke.clearcoatNormalMap&&g.enable(18),Ke.displacementMap&&g.enable(19),Ke.specularMap&&g.enable(20),Ke.roughnessMap&&g.enable(21),Ke.metalnessMap&&g.enable(22),Ke.gradientMap&&g.enable(23),Ke.alphaMap&&g.enable(24),Ke.alphaTest&&g.enable(25),Ke.vertexColors&&g.enable(26),Ke.vertexAlphas&&g.enable(27),Ke.vertexUvs&&g.enable(28),Ke.vertexTangents&&g.enable(29),Ke.uvsVertexOnly&&g.enable(30),Ke.fog&&g.enable(31),_e.push(g.mask),g.disableAll(),Ke.useFog&&g.enable(0),Ke.flatShading&&g.enable(1),Ke.logarithmicDepthBuffer&&g.enable(2),Ke.skinning&&g.enable(3),Ke.useVertexTexture&&g.enable(4),Ke.morphTargets&&g.enable(5),Ke.morphNormals&&g.enable(6),Ke.premultipliedAlpha&&g.enable(7),Ke.shadowMapEnabled&&g.enable(8),Ke.physicallyCorrectLights&&g.enable(9),Ke.doubleSided&&g.enable(10),Ke.flipSided&&g.enable(11),Ke.depthPacking&&g.enable(12),Ke.dithering&&g.enable(13),Ke.specularIntensityMap&&g.enable(14),Ke.specularColorMap&&g.enable(15),Ke.transmission&&g.enable(16),Ke.transmissionMap&&g.enable(17),Ke.thicknessMap&&g.enable(18),Ke.sheen&&g.enable(19),Ke.sheenColorMap&&g.enable(20),Ke.sheenRoughnessMap&&g.enable(21),Ke.decodeVideoTexture&&g.enable(22),_e.push(g.mask)}(Ke,_e),Ke.push(h.outputEncoding)),Ke.push(_e.customProgramCacheKey),Ke.join()},getUniforms:function(_e){const Ke=Te[_e.type];let Et;return Et=Ke?Xd.clone(rl[Ke].uniforms):_e.uniforms,Et},acquireProgram:function(_e,Ke){let Et;for(let Mt=0,At=L.length;Mt<At;Mt++){const Ft=L[Mt];if(Ft.cacheKey===Ke){Et=Ft,++Et.usedTimes;break}}return void 0===Et&&(Et=new ox(h,Ke,_e,f),L.push(Et)),Et},releaseProgram:function(_e){if(0==--_e.usedTimes){const Ke=L.indexOf(_e);L[Ke]=L[L.length-1],L.pop(),_e.destroy()}},releaseShaderCache:function(_e){C.remove(_e)},programs:L,dispose:function(){C.dispose()}}}function hx(){let h=new WeakMap;return{get:function(f){let m=h.get(f);return void 0===m&&(m={},h.set(f,m)),m},remove:function(f){h.delete(f)},update:function(f,m,g){h.get(f)[m]=g},dispose:function(){h=new WeakMap}}}function dx(h,n){return h.groupOrder!==n.groupOrder?h.groupOrder-n.groupOrder:h.renderOrder!==n.renderOrder?h.renderOrder-n.renderOrder:h.material.id!==n.material.id?h.material.id-n.material.id:h.z!==n.z?h.z-n.z:h.id-n.id}function rg(h,n){return h.groupOrder!==n.groupOrder?h.groupOrder-n.groupOrder:h.renderOrder!==n.renderOrder?h.renderOrder-n.renderOrder:h.z!==n.z?n.z-h.z:h.id-n.id}function Pp(){const h=[];let n=0;const r=[],l=[],c=[];function m(z,X,Q,re,ue,Te){let se=h[n];return void 0===se?(se={id:z.id,object:z,geometry:X,material:Q,groupOrder:re,renderOrder:z.renderOrder,z:ue,group:Te},h[n]=se):(se.id=z.id,se.object=z,se.geometry=X,se.material=Q,se.groupOrder=re,se.renderOrder=z.renderOrder,se.z=ue,se.group=Te),n++,se}return{opaque:r,transmissive:l,transparent:c,init:function(){n=0,r.length=0,l.length=0,c.length=0},push:function(z,X,Q,re,ue,Te){const se=m(z,X,Q,re,ue,Te);Q.transmission>0?l.push(se):!0===Q.transparent?c.push(se):r.push(se)},unshift:function(z,X,Q,re,ue,Te){const se=m(z,X,Q,re,ue,Te);Q.transmission>0?l.unshift(se):!0===Q.transparent?c.unshift(se):r.unshift(se)},finish:function(){for(let z=n,X=h.length;z<X;z++){const Q=h[z];if(null===Q.id)break;Q.id=null,Q.object=null,Q.geometry=null,Q.material=null,Q.group=null}},sort:function(z,X){r.length>1&&r.sort(z||dx),l.length>1&&l.sort(X||rg),c.length>1&&c.sort(X||rg)}}}function sg(){let h=new WeakMap;return{get:function(l,c){let f;return!1===h.has(l)?(f=new Pp,h.set(l,[f])):c>=h.get(l).length?(f=new Pp,h.get(l).push(f)):f=h.get(l)[c],f},dispose:function(){h=new WeakMap}}}function fx(){const h={};return{get:function(n){if(void 0!==h[n.id])return h[n.id];let r;switch(n.type){case"DirectionalLight":r={direction:new Oe,color:new zn};break;case"SpotLight":r={position:new Oe,direction:new Oe,color:new zn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Oe,color:new zn,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Oe,skyColor:new zn,groundColor:new zn};break;case"RectAreaLight":r={color:new zn,position:new Oe,halfWidth:new Oe,halfHeight:new Oe}}return h[n.id]=r,r}}}let mx=0;function gx(h,n){return(n.castShadow?1:0)-(h.castShadow?1:0)}function vx(h,n){const r=new fx,l=function(){const h={};return{get:function(n){if(void 0!==h[n.id])return h[n.id];let r;switch(n.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st,shadowCameraNear:1,shadowCameraFar:1e3}}return h[n.id]=r,r}}}(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let G=0;G<9;G++)c.probe.push(new Oe);const f=new Oe,m=new ri,g=new ri;return{setup:function(G,z){let X=0,Q=0,re=0;for(let It=0;It<9;It++)c.probe[It].set(0,0,0);let ue=0,Te=0,se=0,J=0,Be=0,be=0,Ve=0,Ze=0;G.sort(gx);const dt=!0!==z?Math.PI:1;for(let It=0,Ht=G.length;It<Ht;It++){const _e=G[It],Ke=_e.color,Et=_e.intensity,Mt=_e.distance,At=_e.shadow&&_e.shadow.map?_e.shadow.map.texture:null;if(_e.isAmbientLight)X+=Ke.r*Et*dt,Q+=Ke.g*Et*dt,re+=Ke.b*Et*dt;else if(_e.isLightProbe)for(let Ft=0;Ft<9;Ft++)c.probe[Ft].addScaledVector(_e.sh.coefficients[Ft],Et);else if(_e.isDirectionalLight){const Ft=r.get(_e);if(Ft.color.copy(_e.color).multiplyScalar(_e.intensity*dt),_e.castShadow){const en=_e.shadow,Cn=l.get(_e);Cn.shadowBias=en.bias,Cn.shadowNormalBias=en.normalBias,Cn.shadowRadius=en.radius,Cn.shadowMapSize=en.mapSize,c.directionalShadow[ue]=Cn,c.directionalShadowMap[ue]=At,c.directionalShadowMatrix[ue]=_e.shadow.matrix,be++}c.directional[ue]=Ft,ue++}else if(_e.isSpotLight){const Ft=r.get(_e);if(Ft.position.setFromMatrixPosition(_e.matrixWorld),Ft.color.copy(Ke).multiplyScalar(Et*dt),Ft.distance=Mt,Ft.coneCos=Math.cos(_e.angle),Ft.penumbraCos=Math.cos(_e.angle*(1-_e.penumbra)),Ft.decay=_e.decay,_e.castShadow){const en=_e.shadow,Cn=l.get(_e);Cn.shadowBias=en.bias,Cn.shadowNormalBias=en.normalBias,Cn.shadowRadius=en.radius,Cn.shadowMapSize=en.mapSize,c.spotShadow[se]=Cn,c.spotShadowMap[se]=At,c.spotShadowMatrix[se]=_e.shadow.matrix,Ze++}c.spot[se]=Ft,se++}else if(_e.isRectAreaLight){const Ft=r.get(_e);Ft.color.copy(Ke).multiplyScalar(Et),Ft.halfWidth.set(.5*_e.width,0,0),Ft.halfHeight.set(0,.5*_e.height,0),c.rectArea[J]=Ft,J++}else if(_e.isPointLight){const Ft=r.get(_e);if(Ft.color.copy(_e.color).multiplyScalar(_e.intensity*dt),Ft.distance=_e.distance,Ft.decay=_e.decay,_e.castShadow){const en=_e.shadow,Cn=l.get(_e);Cn.shadowBias=en.bias,Cn.shadowNormalBias=en.normalBias,Cn.shadowRadius=en.radius,Cn.shadowMapSize=en.mapSize,Cn.shadowCameraNear=en.camera.near,Cn.shadowCameraFar=en.camera.far,c.pointShadow[Te]=Cn,c.pointShadowMap[Te]=At,c.pointShadowMatrix[Te]=_e.shadow.matrix,Ve++}c.point[Te]=Ft,Te++}else if(_e.isHemisphereLight){const Ft=r.get(_e);Ft.skyColor.copy(_e.color).multiplyScalar(Et*dt),Ft.groundColor.copy(_e.groundColor).multiplyScalar(Et*dt),c.hemi[Be]=Ft,Be++}}J>0&&(n.isWebGL2||!0===h.has("OES_texture_float_linear")?(c.rectAreaLTC1=Jn.LTC_FLOAT_1,c.rectAreaLTC2=Jn.LTC_FLOAT_2):!0===h.has("OES_texture_half_float_linear")?(c.rectAreaLTC1=Jn.LTC_HALF_1,c.rectAreaLTC2=Jn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),c.ambient[0]=X,c.ambient[1]=Q,c.ambient[2]=re;const yt=c.hash;(yt.directionalLength!==ue||yt.pointLength!==Te||yt.spotLength!==se||yt.rectAreaLength!==J||yt.hemiLength!==Be||yt.numDirectionalShadows!==be||yt.numPointShadows!==Ve||yt.numSpotShadows!==Ze)&&(c.directional.length=ue,c.spot.length=se,c.rectArea.length=J,c.point.length=Te,c.hemi.length=Be,c.directionalShadow.length=be,c.directionalShadowMap.length=be,c.pointShadow.length=Ve,c.pointShadowMap.length=Ve,c.spotShadow.length=Ze,c.spotShadowMap.length=Ze,c.directionalShadowMatrix.length=be,c.pointShadowMatrix.length=Ve,c.spotShadowMatrix.length=Ze,yt.directionalLength=ue,yt.pointLength=Te,yt.spotLength=se,yt.rectAreaLength=J,yt.hemiLength=Be,yt.numDirectionalShadows=be,yt.numPointShadows=Ve,yt.numSpotShadows=Ze,c.version=mx++)},setupView:function(G,z){let X=0,Q=0,re=0,ue=0,Te=0;const se=z.matrixWorldInverse;for(let J=0,Be=G.length;J<Be;J++){const be=G[J];if(be.isDirectionalLight){const Ve=c.directional[X];Ve.direction.setFromMatrixPosition(be.matrixWorld),f.setFromMatrixPosition(be.target.matrixWorld),Ve.direction.sub(f),Ve.direction.transformDirection(se),X++}else if(be.isSpotLight){const Ve=c.spot[re];Ve.position.setFromMatrixPosition(be.matrixWorld),Ve.position.applyMatrix4(se),Ve.direction.setFromMatrixPosition(be.matrixWorld),f.setFromMatrixPosition(be.target.matrixWorld),Ve.direction.sub(f),Ve.direction.transformDirection(se),re++}else if(be.isRectAreaLight){const Ve=c.rectArea[ue];Ve.position.setFromMatrixPosition(be.matrixWorld),Ve.position.applyMatrix4(se),g.identity(),m.copy(be.matrixWorld),m.premultiply(se),g.extractRotation(m),Ve.halfWidth.set(.5*be.width,0,0),Ve.halfHeight.set(0,.5*be.height,0),Ve.halfWidth.applyMatrix4(g),Ve.halfHeight.applyMatrix4(g),ue++}else if(be.isPointLight){const Ve=c.point[Q];Ve.position.setFromMatrixPosition(be.matrixWorld),Ve.position.applyMatrix4(se),Q++}else if(be.isHemisphereLight){const Ve=c.hemi[Te];Ve.direction.setFromMatrixPosition(be.matrixWorld),Ve.direction.transformDirection(se),Ve.direction.normalize(),Te++}}},state:c}}function og(h,n){const r=new vx(h,n),l=[],c=[];return{init:function(){l.length=0,c.length=0},state:{lightsArray:l,shadowsArray:c,lights:r},setupLights:function(z){r.setup(l,z)},setupLightsView:function(z){r.setupView(l,z)},pushLight:function(z){l.push(z)},pushShadow:function(z){c.push(z)}}}function ag(h,n){let r=new WeakMap;return{get:function(f,m=0){let g;return!1===r.has(f)?(g=new og(h,n),r.set(f,[g])):m>=r.get(f).length?(g=new og(h,n),r.get(f).push(g)):g=r.get(f)[m],g},dispose:function(){r=new WeakMap}}}class ef extends js{constructor(n){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(n)}copy(n){return super.copy(n),this.depthPacking=n.depthPacking,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this}}ef.prototype.isMeshDepthMaterial=!0;class Yu extends js{constructor(n){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Oe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(n)}copy(n){return super.copy(n),this.referencePosition.copy(n.referencePosition),this.nearDistance=n.nearDistance,this.farDistance=n.farDistance,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this}}Yu.prototype.isMeshDistanceMaterial=!0;function lg(h,n,r){let l=new Nl;const c=new st,f=new st,m=new Or,g=new ef({depthPacking:3201}),C=new Yu,L={},G=r.maxTextureSize,z={0:1,1:0,2:2},X=new Ul({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new st},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),Q=X.clone();Q.defines.HORIZONTAL_PASS=1;const re=new ji;re.setAttribute("position",new Gr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const ue=new Ys(re,X),Te=this;function se(be,Ve){const Ze=n.update(ue);X.defines.VSM_SAMPLES!==be.blurSamples&&(X.defines.VSM_SAMPLES=be.blurSamples,Q.defines.VSM_SAMPLES=be.blurSamples,X.needsUpdate=!0,Q.needsUpdate=!0),X.uniforms.shadow_pass.value=be.map.texture,X.uniforms.resolution.value=be.mapSize,X.uniforms.radius.value=be.radius,h.setRenderTarget(be.mapPass),h.clear(),h.renderBufferDirect(Ve,null,Ze,X,ue,null),Q.uniforms.shadow_pass.value=be.mapPass.texture,Q.uniforms.resolution.value=be.mapSize,Q.uniforms.radius.value=be.radius,h.setRenderTarget(be.map),h.clear(),h.renderBufferDirect(Ve,null,Ze,Q,ue,null)}function J(be,Ve,Ze,dt,yt,It,Ht){let _e=null;const Ke=!0===dt.isPointLight?be.customDistanceMaterial:be.customDepthMaterial;if(_e=void 0!==Ke?Ke:!0===dt.isPointLight?C:g,h.localClippingEnabled&&!0===Ze.clipShadows&&0!==Ze.clippingPlanes.length||Ze.displacementMap&&0!==Ze.displacementScale||Ze.alphaMap&&Ze.alphaTest>0){const Et=_e.uuid,Mt=Ze.uuid;let At=L[Et];void 0===At&&(At={},L[Et]=At);let Ft=At[Mt];void 0===Ft&&(Ft=_e.clone(),At[Mt]=Ft),_e=Ft}return _e.visible=Ze.visible,_e.wireframe=Ze.wireframe,_e.side=3===Ht?null!==Ze.shadowSide?Ze.shadowSide:Ze.side:null!==Ze.shadowSide?Ze.shadowSide:z[Ze.side],_e.alphaMap=Ze.alphaMap,_e.alphaTest=Ze.alphaTest,_e.clipShadows=Ze.clipShadows,_e.clippingPlanes=Ze.clippingPlanes,_e.clipIntersection=Ze.clipIntersection,_e.displacementMap=Ze.displacementMap,_e.displacementScale=Ze.displacementScale,_e.displacementBias=Ze.displacementBias,_e.wireframeLinewidth=Ze.wireframeLinewidth,_e.linewidth=Ze.linewidth,!0===dt.isPointLight&&!0===_e.isMeshDistanceMaterial&&(_e.referencePosition.setFromMatrixPosition(dt.matrixWorld),_e.nearDistance=yt,_e.farDistance=It),_e}function Be(be,Ve,Ze,dt,yt){if(!1===be.visible)return;if(be.layers.test(Ve.layers)&&(be.isMesh||be.isLine||be.isPoints)&&(be.castShadow||be.receiveShadow&&3===yt)&&(!be.frustumCulled||l.intersectsObject(be))){be.modelViewMatrix.multiplyMatrices(Ze.matrixWorldInverse,be.matrixWorld);const _e=n.update(be),Ke=be.material;if(Array.isArray(Ke)){const Et=_e.groups;for(let Mt=0,At=Et.length;Mt<At;Mt++){const Ft=Et[Mt],en=Ke[Ft.materialIndex];if(en&&en.visible){const Cn=J(be,0,en,dt,Ze.near,Ze.far,yt);h.renderBufferDirect(Ze,null,_e,Cn,be,Ft)}}}else if(Ke.visible){const Et=J(be,0,Ke,dt,Ze.near,Ze.far,yt);h.renderBufferDirect(Ze,null,_e,Et,be,null)}}const Ht=be.children;for(let _e=0,Ke=Ht.length;_e<Ke;_e++)Be(Ht[_e],Ve,Ze,dt,yt)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(be,Ve,Ze){if(!1===Te.enabled||!1===Te.autoUpdate&&!1===Te.needsUpdate||0===be.length)return;const dt=h.getRenderTarget(),yt=h.getActiveCubeFace(),It=h.getActiveMipmapLevel(),Ht=h.state;Ht.setBlending(0),Ht.buffers.color.setClear(1,1,1,1),Ht.buffers.depth.setTest(!0),Ht.setScissorTest(!1);for(let _e=0,Ke=be.length;_e<Ke;_e++){const Et=be[_e],Mt=Et.shadow;if(void 0===Mt){console.warn("THREE.WebGLShadowMap:",Et,"has no shadow.");continue}if(!1===Mt.autoUpdate&&!1===Mt.needsUpdate)continue;c.copy(Mt.mapSize);const At=Mt.getFrameExtents();if(c.multiply(At),f.copy(Mt.mapSize),(c.x>G||c.y>G)&&(c.x>G&&(f.x=Math.floor(G/At.x),c.x=f.x*At.x,Mt.mapSize.x=f.x),c.y>G&&(f.y=Math.floor(G/At.y),c.y=f.y*At.y,Mt.mapSize.y=f.y)),null===Mt.map&&!Mt.isPointLightShadow&&3===this.type){const en={minFilter:vt,magFilter:vt,format:bt};Mt.map=new Ro(c.x,c.y,en),Mt.map.texture.name=Et.name+".shadowMap",Mt.mapPass=new Ro(c.x,c.y,en),Mt.camera.updateProjectionMatrix()}null===Mt.map&&(Mt.map=new Ro(c.x,c.y,{minFilter:On,magFilter:On,format:bt}),Mt.map.texture.name=Et.name+".shadowMap",Mt.camera.updateProjectionMatrix()),h.setRenderTarget(Mt.map),h.clear();const Ft=Mt.getViewportCount();for(let en=0;en<Ft;en++){const Cn=Mt.getViewport(en);m.set(f.x*Cn.x,f.y*Cn.y,f.x*Cn.z,f.y*Cn.w),Ht.viewport(m),Mt.updateMatrices(Et,en),l=Mt.getFrustum(),Be(Ve,Ze,Mt.camera,Et,this.type)}!Mt.isPointLightShadow&&3===this.type&&se(Mt,Ze),Mt.needsUpdate=!1}Te.needsUpdate=!1,h.setRenderTarget(dt,yt,It)}}function cg(h,n,r){const l=r.isWebGL2;const g=new function(){let gt=!1;const Si=new Or;let gi=null;const ir=new Or(0,0,0,0);return{setMask:function(fn){gi!==fn&&!gt&&(h.colorMask(fn,fn,fn,fn),gi=fn)},setLocked:function(fn){gt=fn},setClear:function(fn,Wi,Yr,qs,fa){!0===fa&&(fn*=qs,Wi*=qs,Yr*=qs),Si.set(fn,Wi,Yr,qs),!1===ir.equals(Si)&&(h.clearColor(fn,Wi,Yr,qs),ir.copy(Si))},reset:function(){gt=!1,gi=null,ir.set(-1,0,0,0)}}},C=new function(){let gt=!1,Si=null,gi=null,ir=null;return{setTest:function(fn){fn?mt(h.DEPTH_TEST):Vi(h.DEPTH_TEST)},setMask:function(fn){Si!==fn&&!gt&&(h.depthMask(fn),Si=fn)},setFunc:function(fn){if(gi!==fn){if(fn)switch(fn){case 0:h.depthFunc(h.NEVER);break;case 1:h.depthFunc(h.ALWAYS);break;case 2:h.depthFunc(h.LESS);break;case 3:h.depthFunc(h.LEQUAL);break;case 4:h.depthFunc(h.EQUAL);break;case 5:h.depthFunc(h.GEQUAL);break;case 6:h.depthFunc(h.GREATER);break;case 7:h.depthFunc(h.NOTEQUAL);break;default:h.depthFunc(h.LEQUAL)}else h.depthFunc(h.LEQUAL);gi=fn}},setLocked:function(fn){gt=fn},setClear:function(fn){ir!==fn&&(h.clearDepth(fn),ir=fn)},reset:function(){gt=!1,Si=null,gi=null,ir=null}}},L=new function(){let gt=!1,Si=null,gi=null,ir=null,fn=null,Wi=null,Yr=null,qs=null,fa=null;return{setTest:function(gs){gt||(gs?mt(h.STENCIL_TEST):Vi(h.STENCIL_TEST))},setMask:function(gs){Si!==gs&&!gt&&(h.stencilMask(gs),Si=gs)},setFunc:function(gs,yl,rc){(gi!==gs||ir!==yl||fn!==rc)&&(h.stencilFunc(gs,yl,rc),gi=gs,ir=yl,fn=rc)},setOp:function(gs,yl,rc){(Wi!==gs||Yr!==yl||qs!==rc)&&(h.stencilOp(gs,yl,rc),Wi=gs,Yr=yl,qs=rc)},setLocked:function(gs){gt=gs},setClear:function(gs){fa!==gs&&(h.clearStencil(gs),fa=gs)},reset:function(){gt=!1,Si=null,gi=null,ir=null,fn=null,Wi=null,Yr=null,qs=null,fa=null}}};let G={},z={},X=new WeakMap,Q=[],re=null,ue=!1,Te=null,se=null,J=null,Be=null,be=null,Ve=null,Ze=null,dt=!1,yt=null,It=null,Ht=null,_e=null,Ke=null;const Et=h.getParameter(h.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Mt=!1,At=0;const Ft=h.getParameter(h.VERSION);-1!==Ft.indexOf("WebGL")?(At=parseFloat(/^WebGL (\d)/.exec(Ft)[1]),Mt=At>=1):-1!==Ft.indexOf("OpenGL ES")&&(At=parseFloat(/^OpenGL ES (\d)/.exec(Ft)[1]),Mt=At>=2);let en=null,Cn={};const xi=h.getParameter(h.SCISSOR_BOX),Di=h.getParameter(h.VIEWPORT),ci=(new Or).fromArray(xi),hn=(new Or).fromArray(Di);function Zn(gt,Si,gi){const ir=new Uint8Array(4),fn=h.createTexture();h.bindTexture(gt,fn),h.texParameteri(gt,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(gt,h.TEXTURE_MAG_FILTER,h.NEAREST);for(let Wi=0;Wi<gi;Wi++)h.texImage2D(Si+Wi,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,ir);return fn}const Ni={};function mt(gt){!0!==G[gt]&&(h.enable(gt),G[gt]=!0)}function Vi(gt){!1!==G[gt]&&(h.disable(gt),G[gt]=!1)}Ni[h.TEXTURE_2D]=Zn(h.TEXTURE_2D,h.TEXTURE_2D,1),Ni[h.TEXTURE_CUBE_MAP]=Zn(h.TEXTURE_CUBE_MAP,h.TEXTURE_CUBE_MAP_POSITIVE_X,6),g.setClear(0,0,0,1),C.setClear(1),L.setClear(0),mt(h.DEPTH_TEST),C.setFunc(3),Gn(!1),Ai(1),mt(h.CULL_FACE),an(0);const dr={100:h.FUNC_ADD,101:h.FUNC_SUBTRACT,102:h.FUNC_REVERSE_SUBTRACT};if(l)dr[103]=h.MIN,dr[104]=h.MAX;else{const gt=n.get("EXT_blend_minmax");null!==gt&&(dr[103]=gt.MIN_EXT,dr[104]=gt.MAX_EXT)}const Yi={200:h.ZERO,201:h.ONE,202:h.SRC_COLOR,204:h.SRC_ALPHA,210:h.SRC_ALPHA_SATURATE,208:h.DST_COLOR,206:h.DST_ALPHA,203:h.ONE_MINUS_SRC_COLOR,205:h.ONE_MINUS_SRC_ALPHA,209:h.ONE_MINUS_DST_COLOR,207:h.ONE_MINUS_DST_ALPHA};function an(gt,Si,gi,ir,fn,Wi,Yr,qs){if(0!==gt){if(!1===ue&&(mt(h.BLEND),ue=!0),5===gt)fn=fn||Si,Wi=Wi||gi,Yr=Yr||ir,(Si!==se||fn!==be)&&(h.blendEquationSeparate(dr[Si],dr[fn]),se=Si,be=fn),(gi!==J||ir!==Be||Wi!==Ve||Yr!==Ze)&&(h.blendFuncSeparate(Yi[gi],Yi[ir],Yi[Wi],Yi[Yr]),J=gi,Be=ir,Ve=Wi,Ze=Yr),Te=gt,dt=null;else if(gt!==Te||qs!==dt){if((100!==se||100!==be)&&(h.blendEquation(h.FUNC_ADD),se=100,be=100),qs)switch(gt){case 1:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case 2:h.blendFunc(h.ONE,h.ONE);break;case 3:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case 4:h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",gt)}else switch(gt){case 1:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case 2:h.blendFunc(h.SRC_ALPHA,h.ONE);break;case 3:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case 4:h.blendFunc(h.ZERO,h.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",gt)}J=null,Be=null,Ve=null,Ze=null,Te=gt,dt=qs}}else!0===ue&&(Vi(h.BLEND),ue=!1)}function Gn(gt){yt!==gt&&(h.frontFace(gt?h.CW:h.CCW),yt=gt)}function Ai(gt){0!==gt?(mt(h.CULL_FACE),gt!==It&&h.cullFace(1===gt?h.BACK:2===gt?h.FRONT:h.FRONT_AND_BACK)):Vi(h.CULL_FACE),It=gt}function nr(gt,Si,gi){gt?(mt(h.POLYGON_OFFSET_FILL),(_e!==Si||Ke!==gi)&&(h.polygonOffset(Si,gi),_e=Si,Ke=gi)):Vi(h.POLYGON_OFFSET_FILL)}function zr(gt){void 0===gt&&(gt=h.TEXTURE0+Et-1),en!==gt&&(h.activeTexture(gt),en=gt)}return{buffers:{color:g,depth:C,stencil:L},enable:mt,disable:Vi,bindFramebuffer:function(gt,Si){return z[gt]!==Si&&(h.bindFramebuffer(gt,Si),z[gt]=Si,l&&(gt===h.DRAW_FRAMEBUFFER&&(z[h.FRAMEBUFFER]=Si),gt===h.FRAMEBUFFER&&(z[h.DRAW_FRAMEBUFFER]=Si)),!0)},drawBuffers:function(gt,Si){let gi=Q,ir=!1;if(gt)if(gi=X.get(Si),void 0===gi&&(gi=[],X.set(Si,gi)),gt.isWebGLMultipleRenderTargets){const fn=gt.texture;if(gi.length!==fn.length||gi[0]!==h.COLOR_ATTACHMENT0){for(let Wi=0,Yr=fn.length;Wi<Yr;Wi++)gi[Wi]=h.COLOR_ATTACHMENT0+Wi;gi.length=fn.length,ir=!0}}else gi[0]!==h.COLOR_ATTACHMENT0&&(gi[0]=h.COLOR_ATTACHMENT0,ir=!0);else gi[0]!==h.BACK&&(gi[0]=h.BACK,ir=!0);ir&&(r.isWebGL2?h.drawBuffers(gi):n.get("WEBGL_draw_buffers").drawBuffersWEBGL(gi))},useProgram:function(gt){return re!==gt&&(h.useProgram(gt),re=gt,!0)},setBlending:an,setMaterial:function(gt,Si){2===gt.side?Vi(h.CULL_FACE):mt(h.CULL_FACE);let gi=1===gt.side;Si&&(gi=!gi),Gn(gi),1===gt.blending&&!1===gt.transparent?an(0):an(gt.blending,gt.blendEquation,gt.blendSrc,gt.blendDst,gt.blendEquationAlpha,gt.blendSrcAlpha,gt.blendDstAlpha,gt.premultipliedAlpha),C.setFunc(gt.depthFunc),C.setTest(gt.depthTest),C.setMask(gt.depthWrite),g.setMask(gt.colorWrite);const ir=gt.stencilWrite;L.setTest(ir),ir&&(L.setMask(gt.stencilWriteMask),L.setFunc(gt.stencilFunc,gt.stencilRef,gt.stencilFuncMask),L.setOp(gt.stencilFail,gt.stencilZFail,gt.stencilZPass)),nr(gt.polygonOffset,gt.polygonOffsetFactor,gt.polygonOffsetUnits),!0===gt.alphaToCoverage?mt(h.SAMPLE_ALPHA_TO_COVERAGE):Vi(h.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Gn,setCullFace:Ai,setLineWidth:function(gt){gt!==Ht&&(Mt&&h.lineWidth(gt),Ht=gt)},setPolygonOffset:nr,setScissorTest:function(gt){gt?mt(h.SCISSOR_TEST):Vi(h.SCISSOR_TEST)},activeTexture:zr,bindTexture:function(gt,Si){null===en&&zr();let gi=Cn[en];void 0===gi&&(gi={type:void 0,texture:void 0},Cn[en]=gi),(gi.type!==gt||gi.texture!==Si)&&(h.bindTexture(gt,Si||Ni[gt]),gi.type=gt,gi.texture=Si)},unbindTexture:function(){const gt=Cn[en];void 0!==gt&&void 0!==gt.type&&(h.bindTexture(gt.type,null),gt.type=void 0,gt.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texStorage2D:function(){try{h.texStorage2D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texStorage3D:function(){try{h.texStorage3D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texSubImage2D:function(){try{h.texSubImage2D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},texSubImage3D:function(){try{h.texSubImage3D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},compressedTexSubImage2D:function(){try{h.compressedTexSubImage2D.apply(h,arguments)}catch(gt){console.error("THREE.WebGLState:",gt)}},scissor:function(gt){!1===ci.equals(gt)&&(h.scissor(gt.x,gt.y,gt.z,gt.w),ci.copy(gt))},viewport:function(gt){!1===hn.equals(gt)&&(h.viewport(gt.x,gt.y,gt.z,gt.w),hn.copy(gt))},reset:function(){h.disable(h.BLEND),h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.disable(h.SAMPLE_ALPHA_TO_COVERAGE),h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ZERO),h.blendFuncSeparate(h.ONE,h.ZERO,h.ONE,h.ZERO),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(h.LESS),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(h.ALWAYS,0,4294967295),h.stencilOp(h.KEEP,h.KEEP,h.KEEP),h.clearStencil(0),h.cullFace(h.BACK),h.frontFace(h.CCW),h.polygonOffset(0,0),h.activeTexture(h.TEXTURE0),h.bindFramebuffer(h.FRAMEBUFFER,null),!0===l&&(h.bindFramebuffer(h.DRAW_FRAMEBUFFER,null),h.bindFramebuffer(h.READ_FRAMEBUFFER,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),G={},en=null,Cn={},z={},X=new WeakMap,Q=[],re=null,ue=!1,Te=null,se=null,J=null,Be=null,be=null,Ve=null,Ze=null,dt=!1,yt=null,It=null,Ht=null,_e=null,Ke=null,ci.set(0,0,h.canvas.width,h.canvas.height),hn.set(0,0,h.canvas.width,h.canvas.height),g.reset(),C.reset(),L.reset()}}}function xx(h,n,r,l,c,f,m){const g=c.isWebGL2,C=c.maxTextures,L=c.maxCubemapSize,G=c.maxTextureSize,z=c.maxSamples,Q=n.has("WEBGL_multisampled_render_to_texture")?n.get("WEBGL_multisampled_render_to_texture"):void 0,re=new WeakMap;let ue,Te=!1;try{Te="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(et){}function se(et,Xe){return Te?new OffscreenCanvas(et,Xe):_l("canvas")}function J(et,Xe,tn,Qn){let Pi=1;if((et.width>Qn||et.height>Qn)&&(Pi=Qn/Math.max(et.width,et.height)),Pi<1||!0===Xe){if("undefined"!=typeof HTMLImageElement&&et instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&et instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&et instanceof ImageBitmap){const nn=Xe?jm:Math.floor,Gi=nn(Pi*et.width),Fi=nn(Pi*et.height);void 0===ue&&(ue=se(Gi,Fi));const si=tn?se(Gi,Fi):ue;return si.width=Gi,si.height=Fi,si.getContext("2d").drawImage(et,0,0,Gi,Fi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+et.width+"x"+et.height+") to ("+Gi+"x"+Fi+")."),si}return"data"in et&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+et.width+"x"+et.height+")."),et}return et}function Be(et){return Pu(et.width)&&Pu(et.height)}function Ve(et,Xe){return et.generateMipmaps&&Xe&&et.minFilter!==On&&et.minFilter!==vt}function Ze(et){h.generateMipmap(et)}function dt(et,Xe,tn,Qn,Pi=!1){if(!1===g)return Xe;if(null!==et){if(void 0!==h[et])return h[et];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let nn=Xe;return Xe===h.RED&&(tn===h.FLOAT&&(nn=h.R32F),tn===h.HALF_FLOAT&&(nn=h.R16F),tn===h.UNSIGNED_BYTE&&(nn=h.R8)),Xe===h.RG&&(tn===h.FLOAT&&(nn=h.RG32F),tn===h.HALF_FLOAT&&(nn=h.RG16F),tn===h.UNSIGNED_BYTE&&(nn=h.RG8)),Xe===h.RGBA&&(tn===h.FLOAT&&(nn=h.RGBA32F),tn===h.HALF_FLOAT&&(nn=h.RGBA16F),tn===h.UNSIGNED_BYTE&&(nn=Qn===br&&!1===Pi?h.SRGB8_ALPHA8:h.RGBA8),tn===h.UNSIGNED_SHORT_4_4_4_4&&(nn=h.RGBA4),tn===h.UNSIGNED_SHORT_5_5_5_1&&(nn=h.RGB5_A1)),(nn===h.R16F||nn===h.R32F||nn===h.RG16F||nn===h.RG32F||nn===h.RGBA16F||nn===h.RGBA32F)&&n.get("EXT_color_buffer_float"),nn}function yt(et,Xe,tn){return!0===Ve(et,tn)||et.isFramebufferTexture&&et.minFilter!==On&&et.minFilter!==vt?Math.log2(Math.max(Xe.width,Xe.height))+1:void 0!==et.mipmaps&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?Xe.mipmaps.length:1}function It(et){return et===On||1004===et||1005===et?h.NEAREST:h.LINEAR}function Ht(et){const Xe=et.target;Xe.removeEventListener("dispose",Ht),function(et){const Xe=l.get(et);void 0!==Xe.__webglInit&&(h.deleteTexture(Xe.__webglTexture),l.remove(et))}(Xe),Xe.isVideoTexture&&re.delete(Xe),m.memory.textures--}function _e(et){const Xe=et.target;Xe.removeEventListener("dispose",_e),function(et){const Xe=et.texture,tn=l.get(et),Qn=l.get(Xe);if(et){if(void 0!==Qn.__webglTexture&&(h.deleteTexture(Qn.__webglTexture),m.memory.textures--),et.depthTexture&&et.depthTexture.dispose(),et.isWebGLCubeRenderTarget)for(let Pi=0;Pi<6;Pi++)h.deleteFramebuffer(tn.__webglFramebuffer[Pi]),tn.__webglDepthbuffer&&h.deleteRenderbuffer(tn.__webglDepthbuffer[Pi]);else h.deleteFramebuffer(tn.__webglFramebuffer),tn.__webglDepthbuffer&&h.deleteRenderbuffer(tn.__webglDepthbuffer),tn.__webglMultisampledFramebuffer&&h.deleteFramebuffer(tn.__webglMultisampledFramebuffer),tn.__webglColorRenderbuffer&&h.deleteRenderbuffer(tn.__webglColorRenderbuffer),tn.__webglDepthRenderbuffer&&h.deleteRenderbuffer(tn.__webglDepthRenderbuffer);if(et.isWebGLMultipleRenderTargets)for(let Pi=0,nn=Xe.length;Pi<nn;Pi++){const Gi=l.get(Xe[Pi]);Gi.__webglTexture&&(h.deleteTexture(Gi.__webglTexture),m.memory.textures--),l.remove(Xe[Pi])}l.remove(Xe),l.remove(et)}}(Xe)}let Mt=0;function en(et,Xe){const tn=l.get(et);if(et.isVideoTexture&&function(et){const Xe=m.render.frame;re.get(et)!==Xe&&(re.set(et,Xe),et.update())}(et),et.version>0&&tn.__version!==et.version){const Qn=et.image;if(void 0===Qn)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==Qn.complete)return void mt(tn,et,Xe);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(h.TEXTURE0+Xe),r.bindTexture(h.TEXTURE_2D,tn.__webglTexture)}function Di(et,Xe){const tn=l.get(et);et.version>0&&tn.__version!==et.version?function(et,Xe,tn){if(6!==Xe.image.length)return;Ni(et,Xe),r.activeTexture(h.TEXTURE0+tn),r.bindTexture(h.TEXTURE_CUBE_MAP,et.__webglTexture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,Xe.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,Xe.unpackAlignment),h.pixelStorei(h.UNPACK_COLORSPACE_CONVERSION_WEBGL,h.NONE);const Qn=Xe&&(Xe.isCompressedTexture||Xe.image[0].isCompressedTexture),Pi=Xe.image[0]&&Xe.image[0].isDataTexture,nn=[];for(let fn=0;fn<6;fn++)nn[fn]=Qn||Pi?Pi?Xe.image[fn].image:Xe.image[fn]:J(Xe.image[fn],!1,!0,L),nn[fn]=nr(Xe,nn[fn]);const Gi=nn[0],Fi=Be(Gi)||g,si=f.convert(Xe.format,Xe.encoding),ni=f.convert(Xe.type),fr=dt(Xe.internalFormat,si,ni,Xe.encoding),gt=g&&!0!==Xe.isVideoTexture,Si=void 0===et.__version;let ir,gi=yt(Xe,Gi,Fi);if(Zn(h.TEXTURE_CUBE_MAP,Xe,Fi),Qn){gt&&Si&&r.texStorage2D(h.TEXTURE_CUBE_MAP,gi,fr,Gi.width,Gi.height);for(let fn=0;fn<6;fn++){ir=nn[fn].mipmaps;for(let Wi=0;Wi<ir.length;Wi++){const Yr=ir[Wi];Xe.format!==bt?null!==si?gt?r.compressedTexSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi,0,0,Yr.width,Yr.height,si,Yr.data):r.compressedTexImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi,fr,Yr.width,Yr.height,0,Yr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):gt?r.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi,0,0,Yr.width,Yr.height,si,ni,Yr.data):r.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi,fr,Yr.width,Yr.height,0,si,ni,Yr.data)}}}else{ir=Xe.mipmaps,gt&&Si&&(ir.length>0&&gi++,r.texStorage2D(h.TEXTURE_CUBE_MAP,gi,fr,nn[0].width,nn[0].height));for(let fn=0;fn<6;fn++)if(Pi){gt?r.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,0,0,0,nn[fn].width,nn[fn].height,si,ni,nn[fn].data):r.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,0,fr,nn[fn].width,nn[fn].height,0,si,ni,nn[fn].data);for(let Wi=0;Wi<ir.length;Wi++){const qs=ir[Wi].image[fn].image;gt?r.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi+1,0,0,qs.width,qs.height,si,ni,qs.data):r.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi+1,fr,qs.width,qs.height,0,si,ni,qs.data)}}else{gt?r.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,0,0,0,si,ni,nn[fn]):r.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,0,fr,si,ni,nn[fn]);for(let Wi=0;Wi<ir.length;Wi++){const Yr=ir[Wi];gt?r.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi+1,0,0,si,ni,Yr.image[fn]):r.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+fn,Wi+1,fr,si,ni,Yr.image[fn])}}}Ve(Xe,Fi)&&Ze(h.TEXTURE_CUBE_MAP),et.__version=Xe.version,Xe.onUpdate&&Xe.onUpdate(Xe)}(tn,et,Xe):(r.activeTexture(h.TEXTURE0+Xe),r.bindTexture(h.TEXTURE_CUBE_MAP,tn.__webglTexture))}const ci={[Tn]:h.REPEAT,[dn]:h.CLAMP_TO_EDGE,[rn]:h.MIRRORED_REPEAT},hn={[On]:h.NEAREST,1004:h.NEAREST_MIPMAP_NEAREST,1005:h.NEAREST_MIPMAP_LINEAR,[vt]:h.LINEAR,1007:h.LINEAR_MIPMAP_NEAREST,[Fn]:h.LINEAR_MIPMAP_LINEAR};function Zn(et,Xe,tn){if(tn?(h.texParameteri(et,h.TEXTURE_WRAP_S,ci[Xe.wrapS]),h.texParameteri(et,h.TEXTURE_WRAP_T,ci[Xe.wrapT]),(et===h.TEXTURE_3D||et===h.TEXTURE_2D_ARRAY)&&h.texParameteri(et,h.TEXTURE_WRAP_R,ci[Xe.wrapR]),h.texParameteri(et,h.TEXTURE_MAG_FILTER,hn[Xe.magFilter]),h.texParameteri(et,h.TEXTURE_MIN_FILTER,hn[Xe.minFilter])):(h.texParameteri(et,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(et,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),(et===h.TEXTURE_3D||et===h.TEXTURE_2D_ARRAY)&&h.texParameteri(et,h.TEXTURE_WRAP_R,h.CLAMP_TO_EDGE),(Xe.wrapS!==dn||Xe.wrapT!==dn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),h.texParameteri(et,h.TEXTURE_MAG_FILTER,It(Xe.magFilter)),h.texParameteri(et,h.TEXTURE_MIN_FILTER,It(Xe.minFilter)),Xe.minFilter!==On&&Xe.minFilter!==vt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===n.has("EXT_texture_filter_anisotropic")){const Qn=n.get("EXT_texture_filter_anisotropic");if(Xe.type===Xi&&!1===n.has("OES_texture_float_linear")||!1===g&&Xe.type===Oi&&!1===n.has("OES_texture_half_float_linear"))return;(Xe.anisotropy>1||l.get(Xe).__currentAnisotropy)&&(h.texParameterf(et,Qn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Xe.anisotropy,c.getMaxAnisotropy())),l.get(Xe).__currentAnisotropy=Xe.anisotropy)}}function Ni(et,Xe){void 0===et.__webglInit&&(et.__webglInit=!0,Xe.addEventListener("dispose",Ht),et.__webglTexture=h.createTexture(),m.memory.textures++)}function mt(et,Xe,tn){let Qn=h.TEXTURE_2D;Xe.isDataTexture2DArray&&(Qn=h.TEXTURE_2D_ARRAY),Xe.isDataTexture3D&&(Qn=h.TEXTURE_3D),Ni(et,Xe),r.activeTexture(h.TEXTURE0+tn),r.bindTexture(Qn,et.__webglTexture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,Xe.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,Xe.unpackAlignment),h.pixelStorei(h.UNPACK_COLORSPACE_CONVERSION_WEBGL,h.NONE);const Pi=function(et){return!g&&(et.wrapS!==dn||et.wrapT!==dn||et.minFilter!==On&&et.minFilter!==vt)}(Xe)&&!1===Be(Xe.image);let nn=J(Xe.image,Pi,!1,G);nn=nr(Xe,nn);const Gi=Be(nn)||g,Fi=f.convert(Xe.format,Xe.encoding);let fr,si=f.convert(Xe.type),ni=dt(Xe.internalFormat,Fi,si,Xe.encoding,Xe.isVideoTexture);Zn(Qn,Xe,Gi);const gt=Xe.mipmaps,Si=g&&!0!==Xe.isVideoTexture,gi=void 0===et.__version,ir=yt(Xe,nn,Gi);if(Xe.isDepthTexture)ni=h.DEPTH_COMPONENT,g?ni=Xe.type===Xi?h.DEPTH_COMPONENT32F:Xe.type===ur?h.DEPTH_COMPONENT24:Xe.type===Un?h.DEPTH24_STENCIL8:h.DEPTH_COMPONENT16:Xe.type===Xi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Xe.format===os&&ni===h.DEPTH_COMPONENT&&Xe.type!==Zi&&Xe.type!==ur&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Xe.type=Zi,si=f.convert(Xe.type)),Xe.format===Ae&&ni===h.DEPTH_COMPONENT&&(ni=h.DEPTH_STENCIL,Xe.type!==Un&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Xe.type=Un,si=f.convert(Xe.type))),Si&&gi?r.texStorage2D(h.TEXTURE_2D,1,ni,nn.width,nn.height):r.texImage2D(h.TEXTURE_2D,0,ni,nn.width,nn.height,0,Fi,si,null);else if(Xe.isDataTexture)if(gt.length>0&&Gi){Si&&gi&&r.texStorage2D(h.TEXTURE_2D,ir,ni,gt[0].width,gt[0].height);for(let fn=0,Wi=gt.length;fn<Wi;fn++)fr=gt[fn],Si?r.texSubImage2D(h.TEXTURE_2D,0,0,0,fr.width,fr.height,Fi,si,fr.data):r.texImage2D(h.TEXTURE_2D,fn,ni,fr.width,fr.height,0,Fi,si,fr.data);Xe.generateMipmaps=!1}else Si?(gi&&r.texStorage2D(h.TEXTURE_2D,ir,ni,nn.width,nn.height),r.texSubImage2D(h.TEXTURE_2D,0,0,0,nn.width,nn.height,Fi,si,nn.data)):r.texImage2D(h.TEXTURE_2D,0,ni,nn.width,nn.height,0,Fi,si,nn.data);else if(Xe.isCompressedTexture){Si&&gi&&r.texStorage2D(h.TEXTURE_2D,ir,ni,gt[0].width,gt[0].height);for(let fn=0,Wi=gt.length;fn<Wi;fn++)fr=gt[fn],Xe.format!==bt?null!==Fi?Si?r.compressedTexSubImage2D(h.TEXTURE_2D,fn,0,0,fr.width,fr.height,Fi,fr.data):r.compressedTexImage2D(h.TEXTURE_2D,fn,ni,fr.width,fr.height,0,fr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Si?r.texSubImage2D(h.TEXTURE_2D,fn,0,0,fr.width,fr.height,Fi,si,fr.data):r.texImage2D(h.TEXTURE_2D,fn,ni,fr.width,fr.height,0,Fi,si,fr.data)}else if(Xe.isDataTexture2DArray)Si?(gi&&r.texStorage3D(h.TEXTURE_2D_ARRAY,ir,ni,nn.width,nn.height,nn.depth),r.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,0,nn.width,nn.height,nn.depth,Fi,si,nn.data)):r.texImage3D(h.TEXTURE_2D_ARRAY,0,ni,nn.width,nn.height,nn.depth,0,Fi,si,nn.data);else if(Xe.isDataTexture3D)Si?(gi&&r.texStorage3D(h.TEXTURE_3D,ir,ni,nn.width,nn.height,nn.depth),r.texSubImage3D(h.TEXTURE_3D,0,0,0,0,nn.width,nn.height,nn.depth,Fi,si,nn.data)):r.texImage3D(h.TEXTURE_3D,0,ni,nn.width,nn.height,nn.depth,0,Fi,si,nn.data);else if(Xe.isFramebufferTexture)Si&&gi?r.texStorage2D(h.TEXTURE_2D,ir,ni,nn.width,nn.height):r.texImage2D(h.TEXTURE_2D,0,ni,nn.width,nn.height,0,Fi,si,null);else if(gt.length>0&&Gi){Si&&gi&&r.texStorage2D(h.TEXTURE_2D,ir,ni,gt[0].width,gt[0].height);for(let fn=0,Wi=gt.length;fn<Wi;fn++)fr=gt[fn],Si?r.texSubImage2D(h.TEXTURE_2D,fn,0,0,Fi,si,fr):r.texImage2D(h.TEXTURE_2D,fn,ni,Fi,si,fr);Xe.generateMipmaps=!1}else Si?(gi&&r.texStorage2D(h.TEXTURE_2D,ir,ni,nn.width,nn.height),r.texSubImage2D(h.TEXTURE_2D,0,0,0,Fi,si,nn)):r.texImage2D(h.TEXTURE_2D,0,ni,Fi,si,nn);Ve(Xe,Gi)&&Ze(Qn),et.__version=Xe.version,Xe.onUpdate&&Xe.onUpdate(Xe)}function pi(et,Xe,tn,Qn,Pi){const nn=f.convert(tn.format,tn.encoding),Gi=f.convert(tn.type),Fi=dt(tn.internalFormat,nn,Gi,tn.encoding);l.get(Xe).__hasExternalTextures||(Pi===h.TEXTURE_3D||Pi===h.TEXTURE_2D_ARRAY?r.texImage3D(Pi,0,Fi,Xe.width,Xe.height,Xe.depth,0,nn,Gi,null):r.texImage2D(Pi,0,Fi,Xe.width,Xe.height,0,nn,Gi,null)),r.bindFramebuffer(h.FRAMEBUFFER,et),Xe.useRenderToTexture?Q.framebufferTexture2DMultisampleEXT(h.FRAMEBUFFER,Qn,Pi,l.get(tn).__webglTexture,0,Ai(Xe)):h.framebufferTexture2D(h.FRAMEBUFFER,Qn,Pi,l.get(tn).__webglTexture,0),r.bindFramebuffer(h.FRAMEBUFFER,null)}function ki(et,Xe,tn){if(h.bindRenderbuffer(h.RENDERBUFFER,et),Xe.depthBuffer&&!Xe.stencilBuffer){let Qn=h.DEPTH_COMPONENT16;if(tn||Xe.useRenderToTexture){const Pi=Xe.depthTexture;Pi&&Pi.isDepthTexture&&(Pi.type===Xi?Qn=h.DEPTH_COMPONENT32F:Pi.type===ur&&(Qn=h.DEPTH_COMPONENT24));const nn=Ai(Xe);Xe.useRenderToTexture?Q.renderbufferStorageMultisampleEXT(h.RENDERBUFFER,nn,Qn,Xe.width,Xe.height):h.renderbufferStorageMultisample(h.RENDERBUFFER,nn,Qn,Xe.width,Xe.height)}else h.renderbufferStorage(h.RENDERBUFFER,Qn,Xe.width,Xe.height);h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,et)}else if(Xe.depthBuffer&&Xe.stencilBuffer){const Qn=Ai(Xe);tn&&Xe.useRenderbuffer?h.renderbufferStorageMultisample(h.RENDERBUFFER,Qn,h.DEPTH24_STENCIL8,Xe.width,Xe.height):Xe.useRenderToTexture?Q.renderbufferStorageMultisampleEXT(h.RENDERBUFFER,Qn,h.DEPTH24_STENCIL8,Xe.width,Xe.height):h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,Xe.width,Xe.height),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,et)}else{const Qn=!0===Xe.isWebGLMultipleRenderTargets?Xe.texture[0]:Xe.texture,Pi=f.convert(Qn.format,Qn.encoding),nn=f.convert(Qn.type),Gi=dt(Qn.internalFormat,Pi,nn,Qn.encoding),Fi=Ai(Xe);tn&&Xe.useRenderbuffer?h.renderbufferStorageMultisample(h.RENDERBUFFER,Fi,Gi,Xe.width,Xe.height):Xe.useRenderToTexture?Q.renderbufferStorageMultisampleEXT(h.RENDERBUFFER,Fi,Gi,Xe.width,Xe.height):h.renderbufferStorage(h.RENDERBUFFER,Gi,Xe.width,Xe.height)}h.bindRenderbuffer(h.RENDERBUFFER,null)}function dr(et){const Xe=l.get(et),tn=!0===et.isWebGLCubeRenderTarget;if(et.depthTexture&&!Xe.__autoAllocateDepthBuffer){if(tn)throw new Error("target.depthTexture not supported in Cube render targets");!function(et,Xe){if(Xe&&Xe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(h.FRAMEBUFFER,et),!Xe.depthTexture||!Xe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!l.get(Xe.depthTexture).__webglTexture||Xe.depthTexture.image.width!==Xe.width||Xe.depthTexture.image.height!==Xe.height)&&(Xe.depthTexture.image.width=Xe.width,Xe.depthTexture.image.height=Xe.height,Xe.depthTexture.needsUpdate=!0),en(Xe.depthTexture,0);const Qn=l.get(Xe.depthTexture).__webglTexture,Pi=Ai(Xe);if(Xe.depthTexture.format===os)Xe.useRenderToTexture?Q.framebufferTexture2DMultisampleEXT(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.TEXTURE_2D,Qn,0,Pi):h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.TEXTURE_2D,Qn,0);else{if(Xe.depthTexture.format!==Ae)throw new Error("Unknown depthTexture format");Xe.useRenderToTexture?Q.framebufferTexture2DMultisampleEXT(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.TEXTURE_2D,Qn,0,Pi):h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.TEXTURE_2D,Qn,0)}}(Xe.__webglFramebuffer,et)}else if(tn){Xe.__webglDepthbuffer=[];for(let Qn=0;Qn<6;Qn++)r.bindFramebuffer(h.FRAMEBUFFER,Xe.__webglFramebuffer[Qn]),Xe.__webglDepthbuffer[Qn]=h.createRenderbuffer(),ki(Xe.__webglDepthbuffer[Qn],et,!1)}else r.bindFramebuffer(h.FRAMEBUFFER,Xe.__webglFramebuffer),Xe.__webglDepthbuffer=h.createRenderbuffer(),ki(Xe.__webglDepthbuffer,et,!1);r.bindFramebuffer(h.FRAMEBUFFER,null)}function Ai(et){return g&&(et.useRenderbuffer||et.useRenderToTexture)?Math.min(z,et.samples):0}function nr(et,Xe){const tn=et.encoding,Qn=et.format,Pi=et.type;return!0===et.isCompressedTexture||!0===et.isVideoTexture||1035===et.format||tn!==ts&&(tn===br?!1===g?!0===n.has("EXT_sRGB")&&Qn===bt?(et.format=1035,et.minFilter=vt,et.generateMipmaps=!1):Xe=tl.sRGBToLinear(Xe):(Qn!==bt||Pi!==Sn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",tn)),Xe}let Qi=!1,zr=!1;this.allocateTextureUnit=function(){const et=Mt;return et>=C&&console.warn("THREE.WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+C),Mt+=1,et},this.resetTextureUnits=function(){Mt=0},this.setTexture2D=en,this.setTexture2DArray=function(et,Xe){const tn=l.get(et);et.version>0&&tn.__version!==et.version?mt(tn,et,Xe):(r.activeTexture(h.TEXTURE0+Xe),r.bindTexture(h.TEXTURE_2D_ARRAY,tn.__webglTexture))},this.setTexture3D=function(et,Xe){const tn=l.get(et);et.version>0&&tn.__version!==et.version?mt(tn,et,Xe):(r.activeTexture(h.TEXTURE0+Xe),r.bindTexture(h.TEXTURE_3D,tn.__webglTexture))},this.setTextureCube=Di,this.rebindTextures=function(et,Xe,tn){const Qn=l.get(et);void 0!==Xe&&pi(Qn.__webglFramebuffer,et,et.texture,h.COLOR_ATTACHMENT0,h.TEXTURE_2D),void 0!==tn&&dr(et)},this.setupRenderTarget=function(et){const Xe=et.texture,tn=l.get(et),Qn=l.get(Xe);et.addEventListener("dispose",_e),!0!==et.isWebGLMultipleRenderTargets&&(void 0===Qn.__webglTexture&&(Qn.__webglTexture=h.createTexture()),Qn.__version=Xe.version,m.memory.textures++);const Pi=!0===et.isWebGLCubeRenderTarget,nn=!0===et.isWebGLMultipleRenderTargets,Gi=Xe.isDataTexture3D||Xe.isDataTexture2DArray,Fi=Be(et)||g;if(Pi){tn.__webglFramebuffer=[];for(let si=0;si<6;si++)tn.__webglFramebuffer[si]=h.createFramebuffer()}else if(tn.__webglFramebuffer=h.createFramebuffer(),nn)if(c.drawBuffers){const si=et.texture;for(let ni=0,fr=si.length;ni<fr;ni++){const gt=l.get(si[ni]);void 0===gt.__webglTexture&&(gt.__webglTexture=h.createTexture(),m.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(et.useRenderbuffer)if(g){tn.__webglMultisampledFramebuffer=h.createFramebuffer(),tn.__webglColorRenderbuffer=h.createRenderbuffer(),h.bindRenderbuffer(h.RENDERBUFFER,tn.__webglColorRenderbuffer);const si=f.convert(Xe.format,Xe.encoding),ni=f.convert(Xe.type),fr=dt(Xe.internalFormat,si,ni,Xe.encoding),gt=Ai(et);h.renderbufferStorageMultisample(h.RENDERBUFFER,gt,fr,et.width,et.height),r.bindFramebuffer(h.FRAMEBUFFER,tn.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.RENDERBUFFER,tn.__webglColorRenderbuffer),h.bindRenderbuffer(h.RENDERBUFFER,null),et.depthBuffer&&(tn.__webglDepthRenderbuffer=h.createRenderbuffer(),ki(tn.__webglDepthRenderbuffer,et,!0)),r.bindFramebuffer(h.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Pi){r.bindTexture(h.TEXTURE_CUBE_MAP,Qn.__webglTexture),Zn(h.TEXTURE_CUBE_MAP,Xe,Fi);for(let si=0;si<6;si++)pi(tn.__webglFramebuffer[si],et,Xe,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+si);Ve(Xe,Fi)&&Ze(h.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(nn){const si=et.texture;for(let ni=0,fr=si.length;ni<fr;ni++){const gt=si[ni],Si=l.get(gt);r.bindTexture(h.TEXTURE_2D,Si.__webglTexture),Zn(h.TEXTURE_2D,gt,Fi),pi(tn.__webglFramebuffer,et,gt,h.COLOR_ATTACHMENT0+ni,h.TEXTURE_2D),Ve(gt,Fi)&&Ze(h.TEXTURE_2D)}r.unbindTexture()}else{let si=h.TEXTURE_2D;Gi&&(g?si=Xe.isDataTexture3D?h.TEXTURE_3D:h.TEXTURE_2D_ARRAY:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),r.bindTexture(si,Qn.__webglTexture),Zn(si,Xe,Fi),pi(tn.__webglFramebuffer,et,Xe,h.COLOR_ATTACHMENT0,si),Ve(Xe,Fi)&&Ze(si),r.unbindTexture()}et.depthBuffer&&dr(et)},this.updateRenderTargetMipmap=function(et){const Xe=Be(et)||g,tn=!0===et.isWebGLMultipleRenderTargets?et.texture:[et.texture];for(let Qn=0,Pi=tn.length;Qn<Pi;Qn++){const nn=tn[Qn];if(Ve(nn,Xe)){const Gi=et.isWebGLCubeRenderTarget?h.TEXTURE_CUBE_MAP:h.TEXTURE_2D,Fi=l.get(nn).__webglTexture;r.bindTexture(Gi,Fi),Ze(Gi),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(et){if(et.useRenderbuffer)if(g){const Xe=et.width,tn=et.height;let Qn=h.COLOR_BUFFER_BIT;const Pi=[h.COLOR_ATTACHMENT0],nn=et.stencilBuffer?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;et.depthBuffer&&Pi.push(nn),et.ignoreDepthForMultisampleCopy||(et.depthBuffer&&(Qn|=h.DEPTH_BUFFER_BIT),et.stencilBuffer&&(Qn|=h.STENCIL_BUFFER_BIT));const Gi=l.get(et);r.bindFramebuffer(h.READ_FRAMEBUFFER,Gi.__webglMultisampledFramebuffer),r.bindFramebuffer(h.DRAW_FRAMEBUFFER,Gi.__webglFramebuffer),et.ignoreDepthForMultisampleCopy&&(h.invalidateFramebuffer(h.READ_FRAMEBUFFER,[nn]),h.invalidateFramebuffer(h.DRAW_FRAMEBUFFER,[nn])),h.blitFramebuffer(0,0,Xe,tn,0,0,Xe,tn,Qn,h.NEAREST),h.invalidateFramebuffer(h.READ_FRAMEBUFFER,Pi),r.bindFramebuffer(h.READ_FRAMEBUFFER,null),r.bindFramebuffer(h.DRAW_FRAMEBUFFER,Gi.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=dr,this.setupFrameBufferTexture=pi,this.safeSetTexture2D=function(et,Xe){et&&et.isWebGLRenderTarget&&(!1===Qi&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Qi=!0),et=et.texture),en(et,Xe)},this.safeSetTextureCube=function(et,Xe){et&&et.isWebGLCubeRenderTarget&&(!1===zr&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),zr=!0),et=et.texture),Di(et,Xe)}}function ug(h,n,r){const l=r.isWebGL2;return{convert:function(f,m=null){let g;if(f===Sn)return h.UNSIGNED_BYTE;if(1017===f)return h.UNSIGNED_SHORT_4_4_4_4;if(1018===f)return h.UNSIGNED_SHORT_5_5_5_1;if(1010===f)return h.BYTE;if(1011===f)return h.SHORT;if(f===Zi)return h.UNSIGNED_SHORT;if(1013===f)return h.INT;if(f===ur)return h.UNSIGNED_INT;if(f===Xi)return h.FLOAT;if(f===Oi)return l?h.HALF_FLOAT:(g=n.get("OES_texture_half_float"),null!==g?g.HALF_FLOAT_OES:null);if(1021===f)return h.ALPHA;if(f===bt)return h.RGBA;if(1024===f)return h.LUMINANCE;if(1025===f)return h.LUMINANCE_ALPHA;if(f===os)return h.DEPTH_COMPONENT;if(f===Ae)return h.DEPTH_STENCIL;if(1028===f)return h.RED;if(1035===f)return g=n.get("EXT_sRGB"),null!==g?g.SRGB_ALPHA_EXT:null;if(1029===f)return h.RED_INTEGER;if(1030===f)return h.RG;if(1031===f)return h.RG_INTEGER;if(1033===f)return h.RGBA_INTEGER;if(f===Ut||f===mn||f===Qt||f===Rt)if(m===br){if(g=n.get("WEBGL_compressed_texture_s3tc_srgb"),null===g)return null;if(f===Ut)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(f===mn)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(f===Qt)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(f===Rt)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(g=n.get("WEBGL_compressed_texture_s3tc"),null===g)return null;if(f===Ut)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(f===mn)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(f===Qt)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(f===Rt)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===f||35841===f||35842===f||35843===f){if(g=n.get("WEBGL_compressed_texture_pvrtc"),null===g)return null;if(35840===f)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===f)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===f)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===f)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===f)return g=n.get("WEBGL_compressed_texture_etc1"),null!==g?g.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===f||37496===f){if(g=n.get("WEBGL_compressed_texture_etc"),null===g)return null;if(37492===f)return m===br?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(37496===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}if(37808===f||37809===f||37810===f||37811===f||37812===f||37813===f||37814===f||37815===f||f===K||37817===f||37818===f||37819===f||37820===f||37821===f){if(g=n.get("WEBGL_compressed_texture_astc"),null===g)return null;if(37808===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(f===K)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===f)return m===br?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===f){if(g=n.get("EXT_texture_compression_bptc"),null===g)return null;if(36492===f)return m===br?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT}return f===Un?l?h.UNSIGNED_INT_24_8:(g=n.get("WEBGL_depth_texture"),null!==g?g.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class wc extends Er{constructor(){super(),this.type="Group"}}wc.prototype.isGroup=!0;class jh extends Ss{constructor(n=[]){super(),this.cameras=n}}jh.prototype.isArrayCamera=!0;var tu=new Oe,hg=new Oe;function Fp(h){var n,r,l=this,c=null,f=null,m=null,g=[],C=new ri,L=new ri,G=1,z="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(f=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",be,!1));var X=new ri,Q=new as,re=new Oe,ue=new Ss;ue.viewport=new Or,ue.layers.enable(1);var Te=new Ss;Te.viewport=new Or,Te.layers.enable(2);var se=new jh([ue,Te]);se.layers.enable(1),se.layers.enable(2);var Be,J=new st;function be(){if(l.isPresenting=null!==c&&!0===c.isPresenting){var Ke=c.getEyeParameters("left");n=2*Ke.renderWidth*G,r=Ke.renderHeight*G,Be=h.getPixelRatio(),h.getSize(J),h.setDrawingBufferSize(n,r,1),ue.viewport.set(0,0,n/2,r),Te.viewport.set(n/2,0,n/2,r),Ht.start(),l.dispatchEvent({type:"sessionstart"})}else l.enabled&&h.setDrawingBufferSize(J.width,J.height,Be),Ht.stop(),l.dispatchEvent({type:"sessionend"})}var Ve=[],Ze=[];function dt(_e){for(var Ke=navigator.getGamepads&&navigator.getGamepads(),Et=0,Mt=Ke.length;Et<Mt;Et++){var At=Ke[Et];if(At&&("Daydream Controller"===At.id||"Gear VR Controller"===At.id||"Oculus Go Controller"===At.id||"OpenVR Gamepad"===At.id||At.id.startsWith("Oculus Touch")||At.id.startsWith("HTC Vive Focus")||At.id.startsWith("Spatial Controller"))){var Ft=At.hand;if(0===_e&&(""===Ft||"right"===Ft)||1===_e&&"left"===Ft)return At}}}function It(_e,Ke){null!==Ke&&4===Ke.length&&_e.set(Ke[0]*n,Ke[1]*r,Ke[2]*n,Ke[3]*r)}this.enabled=!1,this.getController=function(_e){var Ke=g[_e];return void 0===Ke&&((Ke=new wc).matrixAutoUpdate=!1,Ke.visible=!1,g[_e]=Ke),Ke},this.getDevice=function(){return c},this.setDevice=function(_e){void 0!==_e&&(c=_e),Ht.setContext(_e)},this.setFramebufferScaleFactor=function(_e){G=_e},this.setReferenceSpaceType=function(_e){z=_e},this.setPoseTarget=function(_e){void 0!==_e&&(m=_e)},this.getCamera=function(_e){var Ke="local-floor"===z?1.6:0;if(c.depthNear=_e.near,c.depthFar=_e.far,c.getFrameData(f),"local-floor"===z){var Et=c.stageParameters;Et?C.fromArray(Et.sittingToStandingTransform):C.makeTranslation(0,Ke,0)}var Mt=f.pose,At=null!==m?m:_e;At.matrix.copy(C),At.matrix.decompose(At.position,At.quaternion,At.scale),null!==Mt.orientation&&(Q.fromArray(Mt.orientation),At.quaternion.multiply(Q)),null!==Mt.position&&(Q.setFromRotationMatrix(C),re.fromArray(Mt.position),re.applyQuaternion(Q),At.position.add(re)),At.updateMatrixWorld();for(var Ft=At.children,en=0,Cn=Ft.length;en<Cn;en++)Ft[en].updateMatrixWorld(!0);ue.near=_e.near,Te.near=_e.near,ue.far=_e.far,Te.far=_e.far,ue.matrixWorldInverse.fromArray(f.leftViewMatrix),Te.matrixWorldInverse.fromArray(f.rightViewMatrix),L.getInverse(C),"local-floor"===z&&(ue.matrixWorldInverse.multiply(L),Te.matrixWorldInverse.multiply(L));var xi=At.parent;null!==xi&&(X.getInverse(xi.matrixWorld),ue.matrixWorldInverse.multiply(X),Te.matrixWorldInverse.multiply(X)),ue.matrixWorld.getInverse(ue.matrixWorldInverse),Te.matrixWorld.getInverse(Te.matrixWorldInverse),ue.projectionMatrix.fromArray(f.leftProjectionMatrix),Te.projectionMatrix.fromArray(f.rightProjectionMatrix),function(h,n,r){tu.setFromMatrixPosition(n.matrixWorld),hg.setFromMatrixPosition(r.matrixWorld);var l=tu.distanceTo(hg),c=n.projectionMatrix.elements,f=r.projectionMatrix.elements,m=c[14]/(c[10]-1),g=c[14]/(c[10]+1),C=(c[9]+1)/c[5],L=(c[9]-1)/c[5],G=(c[8]-1)/c[0],z=(f[8]+1)/f[0],X=m*G,Q=m*z,re=l/(-G+z),ue=re*-G;n.matrixWorld.decompose(h.position,h.quaternion,h.scale),h.translateX(ue),h.translateZ(re),h.matrixWorld.compose(h.position,h.quaternion,h.scale),h.matrixWorldInverse.getInverse(h.matrixWorld);var Te=m+re,se=g+re;h.projectionMatrix.makePerspective(X-ue,Q+(l-ue),C*g/se*Te,L*g/se*Te,Te,se)}(se,ue,Te);var Di=c.getLayers();if(Di.length){var ci=Di[0];It(ue.viewport,ci.leftBounds),It(Te.viewport,ci.rightBounds)}return function(){for(var _e=0;_e<g.length;_e++){var Ke=g[_e],Et=dt(_e);if(void 0!==Et&&void 0!==Et.pose){if(null===Et.pose)return;var Mt=Et.pose;!1===Mt.hasPosition&&Ke.position.set(.2,-.6,-.05),null!==Mt.position&&Ke.position.fromArray(Mt.position),null!==Mt.orientation&&Ke.quaternion.fromArray(Mt.orientation),Ke.matrix.compose(Ke.position,Ke.quaternion,Ke.scale),Ke.matrix.premultiply(C),Ke.matrix.decompose(Ke.position,Ke.quaternion,Ke.scale),Ke.matrixWorldNeedsUpdate=!0,Ke.visible=!0;var At="Daydream Controller"===Et.id?0:1;void 0===Ve[_e]&&(Ve[_e]=!1),Ve[_e]!==Et.buttons[At].pressed&&(Ve[_e]=Et.buttons[At].pressed,!0===Ve[_e]?Ke.dispatchEvent({type:"selectstart"}):(Ke.dispatchEvent({type:"selectend"}),Ke.dispatchEvent({type:"select"}))),At=2,void 0===Ze[_e]&&(Ze[_e]=!1),void 0!==Et.buttons[At]&&Ze[_e]!==Et.buttons[At].pressed&&(Ze[_e]=Et.buttons[At].pressed,!0===Ze[_e]?Ke.dispatchEvent({type:"squeezestart"}):(Ke.dispatchEvent({type:"squeezeend"}),Ke.dispatchEvent({type:"squeeze"})))}else Ke.visible=!1}}(),se},this.getStandingMatrix=function(){return C},this.isPresenting=!1;var Ht=new Qd;this.setAnimationLoop=function(_e){Ht.setAnimationLoop(_e),this.isPresenting&&Ht.start()},this.submitFrame=function(){this.isPresenting&&c.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",be)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")},this.addEventListener=function(){}}Object.assign(Fp.prototype,el.prototype);const Ax={type:"move"};class Op{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new wc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new wc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Oe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Oe),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new wc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Oe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Oe),this._grip}dispatchEvent(n){return null!==this._targetRay&&this._targetRay.dispatchEvent(n),null!==this._grip&&this._grip.dispatchEvent(n),null!==this._hand&&this._hand.dispatchEvent(n),this}disconnect(n){return this.dispatchEvent({type:"disconnected",data:n}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(n,r,l){let c=null,f=null,m=null;const g=this._targetRay,C=this._grip,L=this._hand;if(n&&"visible-blurred"!==r.session.visibilityState)if(null!==g&&(c=r.getPose(n.targetRaySpace,l),null!==c&&(g.matrix.fromArray(c.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),c.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(c.linearVelocity)):g.hasLinearVelocity=!1,c.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(c.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(Ax))),L&&n.hand){m=!0;for(const ue of n.hand.values()){const Te=r.getJointPose(ue,l);if(void 0===L.joints[ue.jointName]){const J=new wc;J.matrixAutoUpdate=!1,J.visible=!1,L.joints[ue.jointName]=J,L.add(J)}const se=L.joints[ue.jointName];null!==Te&&(se.matrix.fromArray(Te.transform.matrix),se.matrix.decompose(se.position,se.rotation,se.scale),se.jointRadius=Te.radius),se.visible=null!==Te}const X=L.joints["index-finger-tip"].position.distanceTo(L.joints["thumb-tip"].position),Q=.02,re=.005;L.inputState.pinching&&X>Q+re?(L.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!L.inputState.pinching&&X<=Q-re&&(L.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else null!==C&&n.gripSpace&&(f=r.getPose(n.gripSpace,l),null!==f&&(C.matrix.fromArray(f.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),f.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(f.linearVelocity)):C.hasLinearVelocity=!1,f.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(f.angularVelocity)):C.hasAngularVelocity=!1));return null!==g&&(g.visible=null!==c),null!==C&&(C.visible=null!==f),null!==L&&(L.visible=null!==m),this}}class tf extends Rn{constructor(n,r,l,c,f,m,g,C,L,G){if((G=void 0!==G?G:os)!==os&&G!==Ae)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===l&&G===os&&(l=Zi),void 0===l&&G===Ae&&(l=Un),super(null,c,f,m,g,C,G,l,L),this.image={width:n,height:r},this.magFilter=void 0!==g?g:On,this.minFilter=void 0!==C?C:On,this.flipY=!1,this.generateMipmaps=!1}}tf.prototype.isDepthTexture=!0;class vs extends el{constructor(n,r){super();const l=this;let c=null,f=1;var m=null;let g=null,C="local-floor";const L=n.extensions.has("WEBGL_multisampled_render_to_texture");let G=null;var z=[];let X=null,Q=null,re=null,ue=!1,Te=null;const se=r.getContextAttributes();let J=null,Be=null;const be=[],Ve=new Map,Ze=new Ss;Ze.layers.enable(1),Ze.viewport=new Or;const dt=new Ss;dt.layers.enable(2),dt.viewport=new Or;const yt=[Ze,dt],It=new jh;It.layers.enable(1),It.layers.enable(2);let Ht=null,_e=null;function Ke(hn){const Zn=Ve.get(hn.inputSource);Zn&&Zn.dispatchEvent({type:hn.type,data:hn.inputSource})}function Et(){Ve.forEach(function(hn,Zn){hn.disconnect(Zn)}),Ve.clear(),Ht=null,_e=null,n.setRenderTarget(J),re=null,Q=null,X=null,c=null,Be=null,ci.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function Mt(hn){const Zn=c.inputSources;for(let Ni=0;Ni<be.length;Ni++)Ve.set(Zn[Ni],be[Ni]);for(let Ni=0;Ni<hn.removed.length;Ni++){const mt=hn.removed[Ni],Vi=Ve.get(mt);Vi&&(Vi.dispatchEvent({type:"disconnected",data:mt}),Ve.delete(mt))}for(let Ni=0;Ni<hn.added.length;Ni++){const mt=hn.added[Ni],Vi=Ve.get(mt);Vi&&Vi.dispatchEvent({type:"connected",data:mt})}}this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.getCameraPose=function(){return G},this.getController=function(hn){let Zn=be[hn];return void 0===Zn&&(Zn=new Op,be[hn]=Zn),Zn.getTargetRaySpace()},this.getControllerGrip=function(hn){let Zn=be[hn];return void 0===Zn&&(Zn=new Op,be[hn]=Zn),Zn.getGripSpace()},this.getHand=function(hn){let Zn=be[hn];return void 0===Zn&&(Zn=new Op,be[hn]=Zn),Zn.getHandSpace()},this.setFramebufferScaleFactor=function(hn){f=hn,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(hn){C=hn,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g},this.getBaseLayer=function(){return null!==Q?Q:re},this.getBinding=function(){return X},this.getFrame=function(){return Te},this.getSession=function(){return c},this.setSession=function(){var hn=Ko(function*(Zn){if(c=Zn,null!==c){if(J=n.getRenderTarget(),c.addEventListener("select",Ke),c.addEventListener("selectstart",Ke),c.addEventListener("selectend",Ke),c.addEventListener("squeeze",Ke),c.addEventListener("squeezestart",Ke),c.addEventListener("squeezeend",Ke),c.addEventListener("end",Et),c.addEventListener("inputsourceschange",Mt),!0!==se.xrCompatible&&(yield r.makeXRCompatible()),void 0===c.renderState.layers||!1===n.capabilities.isWebGL2)re=new XRWebGLLayer(c,r,{antialias:void 0!==c.renderState.layers||se.antialias,alpha:se.alpha,depth:se.depth,stencil:se.stencil,framebufferScaleFactor:f}),c.updateRenderState({baseLayer:re}),Be=new Ro(re.framebufferWidth,re.framebufferHeight,{format:bt,type:Sn,encoding:n.outputEncoding});else{ue=se.antialias;let Ni=null,mt=null,Vi=null;se.depth&&(Vi=se.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,Ni=se.stencil?Ae:os,mt=se.stencil?Un:Zi);const pi={colorFormat:n.outputEncoding===br?r.SRGB8_ALPHA8:r.RGBA8,depthFormat:Vi,scaleFactor:f};X=new XRWebGLBinding(c,r),Q=X.createProjectionLayer(pi),c.updateRenderState({layers:[Q]}),Be=ue?new Ud(Q.textureWidth,Q.textureHeight,{format:bt,type:Sn,depthTexture:new tf(Q.textureWidth,Q.textureHeight,mt,void 0,void 0,void 0,void 0,void 0,void 0,Ni),stencilBuffer:se.stencil,ignoreDepth:Q.ignoreDepthValues,useRenderToTexture:L,encoding:n.outputEncoding}):new Ro(Q.textureWidth,Q.textureHeight,{format:bt,type:Sn,depthTexture:new tf(Q.textureWidth,Q.textureHeight,mt,void 0,void 0,void 0,void 0,void 0,void 0,Ni),stencilBuffer:se.stencil,ignoreDepth:Q.ignoreDepthValues,encoding:n.outputEncoding})}Be.isXRRenderTarget=!0,this.setFoveation(1),g=yield c.requestReferenceSpace(C),ci.setContext(c),ci.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}});return function(Zn){return hn.apply(this,arguments)}}(),this.addLayer=function(hn){!window.XRWebGLBinding||!this.layersEnabled||!c||(z.push(hn),this.updateLayers())},this.removeLayer=function(hn){!window.XRWebGLBinding||!this.layersEnabled||!c||(z.splice(z.indexOf(hn),1),this.updateLayers())},this.updateLayers=function(){var hn=z.map(function(Zn){return Zn});hn.unshift(c.renderState.layers[0]),c.updateRenderState({layers:hn})};const At=new Oe,Ft=new Oe;function Cn(hn,Zn){null===Zn?hn.matrixWorld.copy(hn.matrix):hn.matrixWorld.multiplyMatrices(Zn.matrixWorld,hn.matrix),hn.matrixWorldInverse.copy(hn.matrixWorld).invert()}this.setPoseTarget=function(hn){void 0!==hn&&(m=hn)},this.updateCamera=function(hn){if(null===c)return;It.near=dt.near=Ze.near=hn.near,It.far=dt.far=Ze.far=hn.far,(Ht!==It.near||_e!==It.far)&&(c.updateRenderState({depthNear:It.near,depthFar:It.far}),Ht=It.near,_e=It.far);const Zn=It.cameras;var Ni=m||hn;const mt=Ni.parent;Cn(It,mt);for(let pi=0;pi<Zn.length;pi++)Cn(Zn[pi],mt);It.matrixWorld.decompose(It.position,It.quaternion,It.scale),Ni.matrixWorld.copy(It.matrixWorld),Ni.matrix.copy(It.matrix),Ni.matrix.decompose(Ni.position,Ni.quaternion,Ni.scale);const Vi=Ni.children;for(let pi=0,ki=Vi.length;pi<ki;pi++)Vi[pi].updateMatrixWorld(!0);2===Zn.length?function(hn,Zn,Ni){At.setFromMatrixPosition(Zn.matrixWorld),Ft.setFromMatrixPosition(Ni.matrixWorld);const mt=At.distanceTo(Ft),Vi=Zn.projectionMatrix.elements,pi=Ni.projectionMatrix.elements,ki=Vi[14]/(Vi[10]-1),ui=Vi[14]/(Vi[10]+1),dr=(Vi[9]+1)/Vi[5],Yi=(Vi[9]-1)/Vi[5],an=(Vi[8]-1)/Vi[0],Yn=(pi[8]+1)/pi[0],Gn=ki*an,Ai=ki*Yn,ai=mt/(-an+Yn),nr=ai*-an;Zn.matrixWorld.decompose(hn.position,hn.quaternion,hn.scale),hn.translateX(nr),hn.translateZ(ai),hn.matrixWorld.compose(hn.position,hn.quaternion,hn.scale),hn.matrixWorldInverse.copy(hn.matrixWorld).invert();const Qi=ki+ai,zr=ui+ai;hn.projectionMatrix.makePerspective(Gn-nr,Ai+(mt-nr),dr*ui/zr*Qi,Yi*ui/zr*Qi,Qi,zr)}(It,Ze,dt):It.projectionMatrix.copy(Ze.projectionMatrix)},this.getCamera=function(){return It},this.getFoveation=function(){return null!==Q?Q.fixedFoveation:null!==re?re.fixedFoveation:void 0},this.setFoveation=function(hn){null!==Q&&(Q.fixedFoveation=hn),null!==re&&void 0!==re.fixedFoveation&&(re.fixedFoveation=hn)};let xi=null;const ci=new Qd;ci.setAnimationLoop(function(hn,Zn){if(G=Zn.getViewerPose(g),Te=Zn,null!==G){const mt=G.views;null!==re&&(n.setRenderTargetFramebuffer(Be,re.framebuffer),n.setRenderTarget(Be));let Vi=!1;mt.length!==It.cameras.length&&(It.cameras.length=0,Vi=!0);for(let pi=0;pi<mt.length;pi++){const ki=mt[pi];let ui=null;if(null!==re)ui=re.getViewport(ki);else{const Yi=X.getViewSubImage(Q,ki);ui=Yi.viewport,0===pi&&(n.setRenderTargetTextures(Be,Yi.colorTexture,Q.ignoreDepthValues?void 0:Yi.depthStencilTexture),n.setRenderTarget(Be))}const dr=yt[pi];dr.matrix.fromArray(ki.transform.matrix),dr.projectionMatrix.fromArray(ki.projectionMatrix),dr.viewport.set(ui.x,ui.y,ui.width,ui.height),0===pi&&It.matrix.copy(dr.matrix),!0===Vi&&It.cameras.push(dr)}}const Ni=c.inputSources;for(let mt=0;mt<be.length;mt++)be[mt].update(Ni[mt],Zn,g);xi&&xi(hn,Zn),Te=null}),this.setAnimationLoop=function(hn){xi=hn},this.dispose=function(){}}}function bx(h){function l(se,J){se.opacity.value=J.opacity,J.color&&se.diffuse.value.copy(J.color),J.emissive&&se.emissive.value.copy(J.emissive).multiplyScalar(J.emissiveIntensity),J.map&&(se.map.value=J.map),J.alphaMap&&(se.alphaMap.value=J.alphaMap),J.specularMap&&(se.specularMap.value=J.specularMap),J.alphaTest>0&&(se.alphaTest.value=J.alphaTest);const Be=h.get(J).envMap;let be,Ve;Be&&(se.envMap.value=Be,se.flipEnvMap.value=Be.isCubeTexture&&!1===Be.isRenderTargetTexture?-1:1,se.reflectivity.value=J.reflectivity,se.ior.value=J.ior,se.refractionRatio.value=J.refractionRatio),J.lightMap&&(se.lightMap.value=J.lightMap,se.lightMapIntensity.value=J.lightMapIntensity),J.aoMap&&(se.aoMap.value=J.aoMap,se.aoMapIntensity.value=J.aoMapIntensity),J.map?be=J.map:J.specularMap?be=J.specularMap:J.displacementMap?be=J.displacementMap:J.normalMap?be=J.normalMap:J.bumpMap?be=J.bumpMap:J.roughnessMap?be=J.roughnessMap:J.metalnessMap?be=J.metalnessMap:J.alphaMap?be=J.alphaMap:J.emissiveMap?be=J.emissiveMap:J.clearcoatMap?be=J.clearcoatMap:J.clearcoatNormalMap?be=J.clearcoatNormalMap:J.clearcoatRoughnessMap?be=J.clearcoatRoughnessMap:J.specularIntensityMap?be=J.specularIntensityMap:J.specularColorMap?be=J.specularColorMap:J.transmissionMap?be=J.transmissionMap:J.thicknessMap?be=J.thicknessMap:J.sheenColorMap?be=J.sheenColorMap:J.sheenRoughnessMap&&(be=J.sheenRoughnessMap),void 0!==be&&(be.isWebGLRenderTarget&&(be=be.texture),!0===be.matrixAutoUpdate&&be.updateMatrix(),se.uvTransform.value.copy(be.matrix)),J.aoMap?Ve=J.aoMap:J.lightMap&&(Ve=J.lightMap),void 0!==Ve&&(Ve.isWebGLRenderTarget&&(Ve=Ve.texture),!0===Ve.matrixAutoUpdate&&Ve.updateMatrix(),se.uv2Transform.value.copy(Ve.matrix))}function z(se,J){se.roughness.value=J.roughness,se.metalness.value=J.metalness,J.roughnessMap&&(se.roughnessMap.value=J.roughnessMap),J.metalnessMap&&(se.metalnessMap.value=J.metalnessMap),J.emissiveMap&&(se.emissiveMap.value=J.emissiveMap),J.bumpMap&&(se.bumpMap.value=J.bumpMap,se.bumpScale.value=J.bumpScale,1===J.side&&(se.bumpScale.value*=-1)),J.normalMap&&(se.normalMap.value=J.normalMap,se.normalScale.value.copy(J.normalScale),1===J.side&&se.normalScale.value.negate()),J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias),h.get(J).envMap&&(se.envMapIntensity.value=J.envMapIntensity)}return{refreshFogUniforms:function(se,J){se.fogColor.value.copy(J.color),J.isFog?(se.fogNear.value=J.near,se.fogFar.value=J.far):J.isFogExp2&&(se.fogDensity.value=J.density)},refreshMaterialUniforms:function(se,J,Be,be,Ve){J.isMeshBasicMaterial?l(se,J):J.isMeshLambertMaterial?(l(se,J),function(se,J){J.emissiveMap&&(se.emissiveMap.value=J.emissiveMap)}(se,J)):J.isMeshToonMaterial?(l(se,J),function(se,J){J.gradientMap&&(se.gradientMap.value=J.gradientMap),J.emissiveMap&&(se.emissiveMap.value=J.emissiveMap),J.bumpMap&&(se.bumpMap.value=J.bumpMap,se.bumpScale.value=J.bumpScale,1===J.side&&(se.bumpScale.value*=-1)),J.normalMap&&(se.normalMap.value=J.normalMap,se.normalScale.value.copy(J.normalScale),1===J.side&&se.normalScale.value.negate()),J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias)}(se,J)):J.isMeshPhongMaterial?(l(se,J),function(se,J){se.specular.value.copy(J.specular),se.shininess.value=Math.max(J.shininess,1e-4),J.emissiveMap&&(se.emissiveMap.value=J.emissiveMap),J.bumpMap&&(se.bumpMap.value=J.bumpMap,se.bumpScale.value=J.bumpScale,1===J.side&&(se.bumpScale.value*=-1)),J.normalMap&&(se.normalMap.value=J.normalMap,se.normalScale.value.copy(J.normalScale),1===J.side&&se.normalScale.value.negate()),J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias)}(se,J)):J.isMeshStandardMaterial?(l(se,J),J.isMeshPhysicalMaterial?function(se,J,Be){z(se,J),se.ior.value=J.ior,J.sheen>0&&(se.sheenColor.value.copy(J.sheenColor).multiplyScalar(J.sheen),se.sheenRoughness.value=J.sheenRoughness,J.sheenColorMap&&(se.sheenColorMap.value=J.sheenColorMap),J.sheenRoughnessMap&&(se.sheenRoughnessMap.value=J.sheenRoughnessMap)),J.clearcoat>0&&(se.clearcoat.value=J.clearcoat,se.clearcoatRoughness.value=J.clearcoatRoughness,J.clearcoatMap&&(se.clearcoatMap.value=J.clearcoatMap),J.clearcoatRoughnessMap&&(se.clearcoatRoughnessMap.value=J.clearcoatRoughnessMap),J.clearcoatNormalMap&&(se.clearcoatNormalScale.value.copy(J.clearcoatNormalScale),se.clearcoatNormalMap.value=J.clearcoatNormalMap,1===J.side&&se.clearcoatNormalScale.value.negate())),J.transmission>0&&(se.transmission.value=J.transmission,se.transmissionSamplerMap.value=Be.texture,se.transmissionSamplerSize.value.set(Be.width,Be.height),J.transmissionMap&&(se.transmissionMap.value=J.transmissionMap),se.thickness.value=J.thickness,J.thicknessMap&&(se.thicknessMap.value=J.thicknessMap),se.attenuationDistance.value=J.attenuationDistance,se.attenuationColor.value.copy(J.attenuationColor)),se.specularIntensity.value=J.specularIntensity,se.specularColor.value.copy(J.specularColor),J.specularIntensityMap&&(se.specularIntensityMap.value=J.specularIntensityMap),J.specularColorMap&&(se.specularColorMap.value=J.specularColorMap)}(se,J,Ve):z(se,J)):J.isMeshMatcapMaterial?(l(se,J),function(se,J){J.matcap&&(se.matcap.value=J.matcap),J.bumpMap&&(se.bumpMap.value=J.bumpMap,se.bumpScale.value=J.bumpScale,1===J.side&&(se.bumpScale.value*=-1)),J.normalMap&&(se.normalMap.value=J.normalMap,se.normalScale.value.copy(J.normalScale),1===J.side&&se.normalScale.value.negate()),J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias)}(se,J)):J.isMeshDepthMaterial?(l(se,J),function(se,J){J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias)}(se,J)):J.isMeshDistanceMaterial?(l(se,J),function(se,J){J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias),se.referencePosition.value.copy(J.referencePosition),se.nearDistance.value=J.nearDistance,se.farDistance.value=J.farDistance}(se,J)):J.isMeshNormalMaterial?(l(se,J),function(se,J){J.bumpMap&&(se.bumpMap.value=J.bumpMap,se.bumpScale.value=J.bumpScale,1===J.side&&(se.bumpScale.value*=-1)),J.normalMap&&(se.normalMap.value=J.normalMap,se.normalScale.value.copy(J.normalScale),1===J.side&&se.normalScale.value.negate()),J.displacementMap&&(se.displacementMap.value=J.displacementMap,se.displacementScale.value=J.displacementScale,se.displacementBias.value=J.displacementBias)}(se,J)):J.isLineBasicMaterial?(function(se,J){se.diffuse.value.copy(J.color),se.opacity.value=J.opacity}(se,J),J.isLineDashedMaterial&&function(se,J){se.dashSize.value=J.dashSize,se.totalSize.value=J.dashSize+J.gapSize,se.scale.value=J.scale}(se,J)):J.isPointsMaterial?function(se,J,Be,be){let Ve;se.diffuse.value.copy(J.color),se.opacity.value=J.opacity,se.size.value=J.size*Be,se.scale.value=.5*be,J.map&&(se.map.value=J.map),J.alphaMap&&(se.alphaMap.value=J.alphaMap),J.alphaTest>0&&(se.alphaTest.value=J.alphaTest),J.map?Ve=J.map:J.alphaMap&&(Ve=J.alphaMap),void 0!==Ve&&(!0===Ve.matrixAutoUpdate&&Ve.updateMatrix(),se.uvTransform.value.copy(Ve.matrix))}(se,J,Be,be):J.isSpriteMaterial?function(se,J){let Be;se.diffuse.value.copy(J.color),se.opacity.value=J.opacity,se.rotation.value=J.rotation,J.map&&(se.map.value=J.map),J.alphaMap&&(se.alphaMap.value=J.alphaMap),J.alphaTest>0&&(se.alphaTest.value=J.alphaTest),J.map?Be=J.map:J.alphaMap&&(Be=J.alphaMap),void 0!==Be&&(!0===Be.matrixAutoUpdate&&Be.updateMatrix(),se.uvTransform.value.copy(Be.matrix))}(se,J):J.isShadowMaterial?(se.color.value.copy(J.color),se.opacity.value=J.opacity):J.isShaderMaterial&&(J.uniformsNeedUpdate=!1)}}}function fs(h={}){const n=void 0!==h.canvas?h.canvas:function(){const h=_l("canvas");return h.style.display="block",h}(),r=void 0!==h.context?h.context:null,l=void 0!==h.alpha&&h.alpha,c=void 0===h.depth||h.depth,f=void 0===h.stencil||h.stencil,m=void 0!==h.antialias&&h.antialias,g=void 0===h.premultipliedAlpha||h.premultipliedAlpha,C=void 0!==h.preserveDrawingBuffer&&h.preserveDrawingBuffer,L=void 0!==h.powerPreference?h.powerPreference:"default",G=void 0!==h.failIfMajorPerformanceCaveat&&h.failIfMajorPerformanceCaveat;let z=null,X=null;const Q=[],re=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ts,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const ue=this;let Te=!1,se=0,J=0,Be=null,be=-1,Ve=null;const Ze=new Or,dt=new Or;let yt=null,It=n.width,Ht=n.height,_e=1,Ke=null,Et=null;const Mt=new Or(0,0,It,Ht),At=new Or(0,0,It,Ht);let Ft=!1;const en=new Nl;let Cn=!1,xi=!1,Di=null;const ci=new ri,hn=new Oe,Zn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ni(){return null===Be?_e:1}let pi,ki,ui,dr,Yi,an,Yn,Gn,Ai,ai,nr,Qi,zr,Ds,ys,et,Xe,tn,Qn,Pi,nn,Gi,Fi,mt=r;function Vi(Qe,Ot){for(let Vt=0;Vt<Qe.length;Vt++){const gn=n.getContext(Qe[Vt],Ot);if(null!==gn)return gn}return null}try{const Qe={alpha:!0,depth:c,stencil:f,antialias:m,premultipliedAlpha:g,preserveDrawingBuffer:C,powerPreference:L,failIfMajorPerformanceCaveat:G};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r137"),n.addEventListener("webglcontextlost",fr,!1),n.addEventListener("webglcontextrestored",gt,!1),null===mt){const Ot=["webgl2","webgl","experimental-webgl"];if(!0===ue.isWebGL1Renderer&&Ot.shift(),mt=Vi(Ot,Qe),null===mt)throw Vi(Ot)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===mt.getShaderPrecisionFormat&&(mt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Qe){throw console.error("THREE.WebGLRenderer: "+Qe.message),Qe}function si(){pi=new up(mt),ki=new NA(mt,pi,h),pi.init(ki),Gi=new ug(mt,pi,ki),ui=new cg(mt,pi,ki),dr=new K0(mt),Yi=new hx,an=new xx(mt,pi,ui,Yi,ki,Gi,dr),Yn=new HA(ue),Gn=new ng(ue),Ai=new ap(mt,ki),Fi=new OA(mt,pi,Ai,ki),ai=new Z0(mt,Ai,dr,Fi),nr=new ey(mt,ai,Ai,dr),Qn=new hp(mt,ki,an),et=new kA(Yi),Qi=new ux(ue,Yn,Gn,pi,ki,Fi,et),zr=new bx(Yi),Ds=new sg,ys=new ag(pi,ki),tn=new FA(ue,Yn,ui,nr,l,g),Xe=new lg(ue,nr,ki),Pi=new UA(mt,pi,dr,ki),nn=new q0(mt,pi,dr,ki),dr.programs=Qi.programs,ue.capabilities=ki,ue.extensions=pi,ue.properties=Yi,ue.renderLists=Ds,ue.shadowMap=Xe,ue.state=ui,ue.info=dr}si();const ni="undefined"!=typeof navigator&&"xr"in navigator?new vs(ue,mt):new Fp(ue);function fr(Qe){Qe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Te=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),Te=!1;const Qe=dr.autoReset,Ot=Xe.enabled,Vt=Xe.autoUpdate,zt=Xe.needsUpdate,gn=Xe.type;si(),dr.autoReset=Qe,Xe.enabled=Ot,Xe.autoUpdate=Vt,Xe.needsUpdate=zt,Xe.type=gn}function Si(Qe){const Ot=Qe.target;Ot.removeEventListener("dispose",Si),function(Qe){(function(Qe){const Ot=Yi.get(Qe).programs;void 0!==Ot&&(Ot.forEach(function(Vt){Qi.releaseProgram(Vt)}),Qe.isShaderMaterial&&Qi.releaseShaderCache(Qe))})(Qe),Yi.remove(Qe)}(Ot)}this.xr=ni,this.getContext=function(){return mt},this.getContextAttributes=function(){return mt.getContextAttributes()},this.forceContextLoss=function(){const Qe=pi.get("WEBGL_lose_context");Qe&&Qe.loseContext()},this.forceContextRestore=function(){const Qe=pi.get("WEBGL_lose_context");Qe&&Qe.restoreContext()},this.getPixelRatio=function(){return _e},this.setPixelRatio=function(Qe){void 0!==Qe&&(_e=Qe,this.setSize(It,Ht,!1))},this.getSize=function(Qe){return Qe.set(It,Ht)},this.setSize=function(Qe,Ot,Vt){ni.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(It=Qe,Ht=Ot,n.width=Math.floor(Qe*_e),n.height=Math.floor(Ot*_e),!1!==Vt&&(n.style.width=Qe+"px",n.style.height=Ot+"px"),this.setViewport(0,0,Qe,Ot))},this.getDrawingBufferSize=function(Qe){return Qe.set(It*_e,Ht*_e).floor()},this.setDrawingBufferSize=function(Qe,Ot,Vt){It=Qe,Ht=Ot,_e=Vt,n.width=Math.floor(Qe*Vt),n.height=Math.floor(Ot*Vt),this.setViewport(0,0,Qe,Ot)},this.getCurrentViewport=function(Qe){return Qe.copy(Ze)},this.getViewport=function(Qe){return Qe.copy(Mt)},this.setViewport=function(Qe,Ot,Vt,zt){Qe.isVector4?Mt.set(Qe.x,Qe.y,Qe.z,Qe.w):Mt.set(Qe,Ot,Vt,zt),ui.viewport(Ze.copy(Mt).multiplyScalar(_e).floor())},this.getScissor=function(Qe){return Qe.copy(At)},this.setScissor=function(Qe,Ot,Vt,zt){Qe.isVector4?At.set(Qe.x,Qe.y,Qe.z,Qe.w):At.set(Qe,Ot,Vt,zt),ui.scissor(dt.copy(At).multiplyScalar(_e).floor())},this.getScissorTest=function(){return Ft},this.setScissorTest=function(Qe){ui.setScissorTest(Ft=Qe)},this.setOpaqueSort=function(Qe){Ke=Qe},this.setTransparentSort=function(Qe){Et=Qe},this.getClearColor=function(Qe){return Qe.copy(tn.getClearColor())},this.setClearColor=function(){tn.setClearColor.apply(tn,arguments)},this.getClearAlpha=function(){return tn.getClearAlpha()},this.setClearAlpha=function(){tn.setClearAlpha.apply(tn,arguments)},this.clear=function(Qe,Ot,Vt){let zt=0;(void 0===Qe||Qe)&&(zt|=mt.COLOR_BUFFER_BIT),(void 0===Ot||Ot)&&(zt|=mt.DEPTH_BUFFER_BIT),(void 0===Vt||Vt)&&(zt|=mt.STENCIL_BUFFER_BIT),mt.clear(zt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",fr,!1),n.removeEventListener("webglcontextrestored",gt,!1),Ds.dispose(),ys.dispose(),Yi.dispose(),Yn.dispose(),Gn.dispose(),nr.dispose(),Fi.dispose(),Qi.dispose(),ni.dispose(),ni.removeEventListener("sessionstart",Yr),ni.removeEventListener("sessionend",qs),Di&&(Di.dispose(),Di=null),fa.stop()},this.renderBufferDirect=function(Qe,Ot,Vt,zt,gn,pr){null===Ot&&(Ot=Zn);const sr=gn.isMesh&&gn.matrixWorld.determinant()<0,Dr=function(Qe,Ot,Vt,zt,gn){!0!==Ot.isScene&&(Ot=Zn),an.resetTextureUnits();const pr=Ot.fog,Dr=null===Be?ue.outputEncoding:!0===Be.isXRRenderTarget?Be.texture.encoding:ts,Pr=(zt.isMeshStandardMaterial?Gn:Yn).get(zt.envMap||(zt.isMeshStandardMaterial?Ot.environment:null)),$n=!0===zt.vertexColors&&!!Vt.attributes.color&&4===Vt.attributes.color.itemSize,es=!!zt.normalMap&&!!Vt.attributes.tangent,rs=!!Vt.morphAttributes.position,eo=!!Vt.morphAttributes.normal,xu=Vt.morphAttributes.position?Vt.morphAttributes.position.length:0,xh=zt.toneMapped?ue.toneMapping:0,us=Yi.get(zt),xl=X.state.lights;!0!==Cn||!0!==xi&&Qe===Ve||et.setState(zt,Qe,Qe===Ve&&zt.id===be);let So=!1;zt.version===us.__version?(us.needsLights&&us.lightsStateVersion!==xl.state.version||us.outputEncoding!==Dr||gn.isInstancedMesh&&!1===us.instancing||!gn.isInstancedMesh&&!0===us.instancing||gn.isSkinnedMesh&&!1===us.skinning||!gn.isSkinnedMesh&&!0===us.skinning||us.envMap!==Pr||zt.fog&&us.fog!==pr||void 0!==us.numClippingPlanes&&(us.numClippingPlanes!==et.numPlanes||us.numIntersection!==et.numIntersection)||us.vertexAlphas!==$n||us.vertexTangents!==es||us.morphTargets!==rs||us.morphNormals!==eo||us.toneMapping!==xh||!0===ki.isWebGL2&&us.morphTargetsCount!==xu)&&(So=!0):(So=!0,us.__version=zt.version);let Al=us.currentProgram;!0===So&&(Al=Pm(zt,Ot,gn));let Wf=!1,bl=!1,sc=!1;const Vo=Al.getUniforms(),Id=us.uniforms;if(ui.useProgram(Al.program)&&(Wf=!0,bl=!0,sc=!0),zt.id!==be&&(be=zt.id,bl=!0),Wf||Ve!==Qe){if(Vo.setValue(mt,"projectionMatrix",Qe.projectionMatrix),ki.logarithmicDepthBuffer&&Vo.setValue(mt,"logDepthBufFC",2/(Math.log(Qe.far+1)/Math.LN2)),Ve!==Qe&&(Ve=Qe,bl=!0,sc=!0),zt.isShaderMaterial||zt.isMeshPhongMaterial||zt.isMeshToonMaterial||zt.isMeshStandardMaterial||zt.envMap){const Ka=Vo.map.cameraPosition;void 0!==Ka&&Ka.setValue(mt,hn.setFromMatrixPosition(Qe.matrixWorld))}(zt.isMeshPhongMaterial||zt.isMeshToonMaterial||zt.isMeshLambertMaterial||zt.isMeshBasicMaterial||zt.isMeshStandardMaterial||zt.isShaderMaterial)&&Vo.setValue(mt,"isOrthographic",!0===Qe.isOrthographicCamera),(zt.isMeshPhongMaterial||zt.isMeshToonMaterial||zt.isMeshLambertMaterial||zt.isMeshBasicMaterial||zt.isMeshStandardMaterial||zt.isShaderMaterial||zt.isShadowMaterial||gn.isSkinnedMesh)&&Vo.setValue(mt,"viewMatrix",Qe.matrixWorldInverse)}if(gn.isSkinnedMesh){Vo.setOptional(mt,gn,"bindMatrix"),Vo.setOptional(mt,gn,"bindMatrixInverse");const Ka=gn.skeleton;Ka&&(ki.floatVertexTextures?(null===Ka.boneTexture&&Ka.computeBoneTexture(),Vo.setValue(mt,"boneTexture",Ka.boneTexture,an),Vo.setValue(mt,"boneTextureSize",Ka.boneTextureSize)):Vo.setOptional(mt,Ka,"boneMatrices"))}return!!Vt&&(void 0!==Vt.morphAttributes.position||void 0!==Vt.morphAttributes.normal)&&Qn.update(gn,Vt,zt,Al),(bl||us.receiveShadow!==gn.receiveShadow)&&(us.receiveShadow=gn.receiveShadow,Vo.setValue(mt,"receiveShadow",gn.receiveShadow)),bl&&(Vo.setValue(mt,"toneMappingExposure",ue.toneMappingExposure),us.needsLights&&function(Qe,Ot){Qe.ambientLightColor.needsUpdate=Ot,Qe.lightProbe.needsUpdate=Ot,Qe.directionalLights.needsUpdate=Ot,Qe.directionalLightShadows.needsUpdate=Ot,Qe.pointLights.needsUpdate=Ot,Qe.pointLightShadows.needsUpdate=Ot,Qe.spotLights.needsUpdate=Ot,Qe.spotLightShadows.needsUpdate=Ot,Qe.rectAreaLights.needsUpdate=Ot,Qe.hemisphereLights.needsUpdate=Ot}(Id,sc),pr&&zt.fog&&zr.refreshFogUniforms(Id,pr),zr.refreshMaterialUniforms(Id,zt,_e,Ht,Di),Zo.upload(mt,us.uniformsList,Id,an)),zt.isShaderMaterial&&!0===zt.uniformsNeedUpdate&&(Zo.upload(mt,us.uniformsList,Id,an),zt.uniformsNeedUpdate=!1),zt.isSpriteMaterial&&Vo.setValue(mt,"center",gn.center),Vo.setValue(mt,"modelViewMatrix",gn.modelViewMatrix),Vo.setValue(mt,"normalMatrix",gn.normalMatrix),Vo.setValue(mt,"modelMatrix",gn.matrixWorld),Al}(Qe,Ot,Vt,zt,gn);ui.setMaterial(zt,sr);let Pr=Vt.index;const $n=Vt.attributes.position;if(null===Pr){if(void 0===$n||0===$n.count)return}else if(0===Pr.count)return;let es=1;!0===zt.wireframe&&(Pr=ai.getWireframeAttribute(Vt),es=2),Fi.setup(gn,zt,Dr,Vt,Pr);let rs,eo=Pi;null!==Pr&&(rs=Ai.get(Pr),eo=nn,eo.setIndex(rs));const xu=null!==Pr?Pr.count:$n.count,xh=Vt.drawRange.start*es,us=Vt.drawRange.count*es,xl=null!==pr?pr.start*es:0,So=null!==pr?pr.count*es:1/0,Al=Math.max(xh,xl),Wf=Math.min(xu,xh+us,xl+So)-1,bl=Math.max(0,Wf-Al+1);if(0!==bl){if(gn.isMesh)!0===zt.wireframe?(ui.setLineWidth(zt.wireframeLinewidth*Ni()),eo.setMode(mt.LINES)):eo.setMode(mt.TRIANGLES);else if(gn.isLine){let sc=zt.linewidth;void 0===sc&&(sc=1),ui.setLineWidth(sc*Ni()),eo.setMode(gn.isLineSegments?mt.LINES:gn.isLineLoop?mt.LINE_LOOP:mt.LINE_STRIP)}else gn.isPoints?eo.setMode(mt.POINTS):gn.isSprite&&eo.setMode(mt.TRIANGLES);if(gn.isInstancedMesh)eo.renderInstances(Al,bl,gn.count);else if(Vt.isInstancedBufferGeometry){const sc=Math.min(Vt.instanceCount,Vt._maxInstanceCount);eo.renderInstances(Al,bl,sc)}else eo.render(Al,bl)}},this.compile=function(Qe,Ot){X=ys.get(Qe),X.init(),re.push(X),Qe.traverseVisible(function(Vt){Vt.isLight&&Vt.layers.test(Ot.layers)&&(X.pushLight(Vt),Vt.castShadow&&X.pushShadow(Vt))}),X.setupLights(ue.physicallyCorrectLights),Qe.traverse(function(Vt){const zt=Vt.material;if(zt)if(Array.isArray(zt))for(let gn=0;gn<zt.length;gn++)Pm(zt[gn],Qe,Vt);else Pm(zt,Qe,Vt)}),re.pop(),X=null};let fn=null;function Yr(){fa.stop()}function qs(){fa.start()}const fa=new Qd;function gs(Qe,Ot,Vt,zt){if(!1===Qe.visible)return;if(Qe.layers.test(Ot.layers))if(Qe.isGroup)Vt=Qe.renderOrder;else if(Qe.isLOD)!0===Qe.autoUpdate&&Qe.update(Ot);else if(Qe.isLight)X.pushLight(Qe),Qe.castShadow&&X.pushShadow(Qe);else if(Qe.isSprite){if(!Qe.frustumCulled||en.intersectsSprite(Qe)){zt&&hn.setFromMatrixPosition(Qe.matrixWorld).applyMatrix4(ci);const sr=nr.update(Qe),Dr=Qe.material;Dr.visible&&z.push(Qe,sr,Dr,Vt,hn.z,null)}}else if((Qe.isMesh||Qe.isLine||Qe.isPoints)&&(Qe.isSkinnedMesh&&Qe.skeleton.frame!==dr.render.frame&&(Qe.skeleton.update(),Qe.skeleton.frame=dr.render.frame),!Qe.frustumCulled||en.intersectsObject(Qe))){zt&&hn.setFromMatrixPosition(Qe.matrixWorld).applyMatrix4(ci);const sr=nr.update(Qe),Dr=Qe.material;if(Array.isArray(Dr)){const Pr=sr.groups;for(let $n=0,es=Pr.length;$n<es;$n++){const rs=Pr[$n],eo=Dr[rs.materialIndex];eo&&eo.visible&&z.push(Qe,sr,eo,Vt,hn.z,rs)}}else Dr.visible&&z.push(Qe,sr,Dr,Vt,hn.z,null)}const pr=Qe.children;for(let sr=0,Dr=pr.length;sr<Dr;sr++)gs(pr[sr],Ot,Vt,zt)}function yl(Qe,Ot,Vt,zt){const gn=Qe.opaque,pr=Qe.transmissive,sr=Qe.transparent;X.setupLightsView(Vt),pr.length>0&&function(Qe,Ot,Vt){null===Di&&(Di=new(!0===m&&!0===ki.isWebGL2?Ud:Ro)(1024,1024,{generateMipmaps:!0,type:null!==Gi.convert(Oi)?Oi:Sn,minFilter:Fn,magFilter:On,wrapS:dn,wrapT:dn,useRenderToTexture:pi.has("WEBGL_multisampled_render_to_texture")}));const zt=ue.getRenderTarget();ue.setRenderTarget(Di),ue.clear();const gn=ue.toneMapping;ue.toneMapping=0,Pd(Qe,Ot,Vt),ue.toneMapping=gn,an.updateMultisampleRenderTarget(Di),an.updateRenderTargetMipmap(Di),ue.setRenderTarget(zt)}(gn,Ot,Vt),zt&&ui.viewport(Ze.copy(zt)),gn.length>0&&Pd(gn,Ot,Vt),pr.length>0&&Pd(pr,Ot,Vt),sr.length>0&&Pd(sr,Ot,Vt)}function Pd(Qe,Ot,Vt){const zt=!0===Ot.isScene?Ot.overrideMaterial:null;for(let gn=0,pr=Qe.length;gn<pr;gn++){const sr=Qe[gn],Dr=sr.object,Pr=sr.geometry,$n=null===zt?sr.material:zt,es=sr.group;Dr.layers.test(Vt.layers)&&rA(Dr,Ot,Vt,Pr,$n,es)}}function rA(Qe,Ot,Vt,zt,gn,pr){Qe.onBeforeRender(ue,Ot,Vt,zt,gn,pr),Qe.modelViewMatrix.multiplyMatrices(Vt.matrixWorldInverse,Qe.matrixWorld),Qe.normalMatrix.getNormalMatrix(Qe.modelViewMatrix),gn.onBeforeRender(ue,Ot,Vt,zt,Qe,pr),!0===gn.transparent&&2===gn.side?(gn.side=1,gn.needsUpdate=!0,ue.renderBufferDirect(Vt,Ot,zt,gn,Qe,pr),gn.side=0,gn.needsUpdate=!0,ue.renderBufferDirect(Vt,Ot,zt,gn,Qe,pr),gn.side=2):ue.renderBufferDirect(Vt,Ot,zt,gn,Qe,pr),Qe.onAfterRender(ue,Ot,Vt,zt,gn,pr)}function Pm(Qe,Ot,Vt){!0!==Ot.isScene&&(Ot=Zn);const zt=Yi.get(Qe),gn=X.state.lights,sr=gn.state.version,Dr=Qi.getParameters(Qe,gn.state,X.state.shadowsArray,Ot,Vt),Pr=Qi.getProgramCacheKey(Dr);let $n=zt.programs;zt.environment=Qe.isMeshStandardMaterial?Ot.environment:null,zt.fog=Ot.fog,zt.envMap=(Qe.isMeshStandardMaterial?Gn:Yn).get(Qe.envMap||zt.environment),void 0===$n&&(Qe.addEventListener("dispose",Si),$n=new Map,zt.programs=$n);let es=$n.get(Pr);if(void 0!==es){if(zt.currentProgram===es&&zt.lightsStateVersion===sr)return Vf(Qe,Dr),es}else Dr.uniforms=Qi.getUniforms(Qe),Qe.onBuild(Vt,Dr,ue),Qe.onBeforeCompile(Dr,ue),es=Qi.acquireProgram(Dr,Pr),$n.set(Pr,es),zt.uniforms=Dr.uniforms;const rs=zt.uniforms;(!Qe.isShaderMaterial&&!Qe.isRawShaderMaterial||!0===Qe.clipping)&&(rs.clippingPlanes=et.uniform),Vf(Qe,Dr),zt.needsLights=function(Qe){return Qe.isMeshLambertMaterial||Qe.isMeshToonMaterial||Qe.isMeshPhongMaterial||Qe.isMeshStandardMaterial||Qe.isShadowMaterial||Qe.isShaderMaterial&&!0===Qe.lights}(Qe),zt.lightsStateVersion=sr,zt.needsLights&&(rs.ambientLightColor.value=gn.state.ambient,rs.lightProbe.value=gn.state.probe,rs.directionalLights.value=gn.state.directional,rs.directionalLightShadows.value=gn.state.directionalShadow,rs.spotLights.value=gn.state.spot,rs.spotLightShadows.value=gn.state.spotShadow,rs.rectAreaLights.value=gn.state.rectArea,rs.ltc_1.value=gn.state.rectAreaLTC1,rs.ltc_2.value=gn.state.rectAreaLTC2,rs.pointLights.value=gn.state.point,rs.pointLightShadows.value=gn.state.pointShadow,rs.hemisphereLights.value=gn.state.hemi,rs.directionalShadowMap.value=gn.state.directionalShadowMap,rs.directionalShadowMatrix.value=gn.state.directionalShadowMatrix,rs.spotShadowMap.value=gn.state.spotShadowMap,rs.spotShadowMatrix.value=gn.state.spotShadowMatrix,rs.pointShadowMap.value=gn.state.pointShadowMap,rs.pointShadowMatrix.value=gn.state.pointShadowMatrix);const eo=es.getUniforms(),xu=Zo.seqWithValue(eo.seq,rs);return zt.currentProgram=es,zt.uniformsList=xu,es}function Vf(Qe,Ot){const Vt=Yi.get(Qe);Vt.outputEncoding=Ot.outputEncoding,Vt.instancing=Ot.instancing,Vt.skinning=Ot.skinning,Vt.morphTargets=Ot.morphTargets,Vt.morphNormals=Ot.morphNormals,Vt.morphTargetsCount=Ot.morphTargetsCount,Vt.numClippingPlanes=Ot.numClippingPlanes,Vt.numIntersection=Ot.numClipIntersection,Vt.vertexAlphas=Ot.vertexAlphas,Vt.vertexTangents=Ot.vertexTangents,Vt.toneMapping=Ot.toneMapping}var Qe;fa.setAnimationLoop(function(Qe){fn&&fn(Qe)}),"undefined"!=typeof window&&fa.setContext(window),this.setAnimationLoop=function(Qe){fn=Qe,ni.setAnimationLoop(Qe),null===Qe?fa.stop():fa.start()},ni.addEventListener("sessionstart",Yr),ni.addEventListener("sessionend",qs),this.render=function(Qe,Ot){if(void 0===Ot||!0===Ot.isCamera){if(!0!==Te){if(!0===Qe.autoUpdate&&Qe.updateMatrixWorld(),null===Ot.parent&&Ot.updateMatrixWorld(),!0===ni.enabled&&!0===ni.isPresenting&&(!0===ni.cameraAutoUpdate&&ni.updateCamera(Ot),Ot=ni.getCamera()),!0===Qe.isScene&&Qe.onBeforeRender(ue,Qe,Ot,Be),X=ys.get(Qe,re.length),X.init(),re.push(X),ci.multiplyMatrices(Ot.projectionMatrix,Ot.matrixWorldInverse),en.setFromProjectionMatrix(ci),xi=this.localClippingEnabled,Cn=et.init(this.clippingPlanes,xi,Ot),z=Ds.get(Qe,Q.length),z.init(),Q.push(z),gs(Qe,Ot,0,ue.sortObjects),z.finish(),!0===ue.sortObjects&&z.sort(Ke,Et),!0===Cn&&et.beginShadows(),Xe.render(X.state.shadowsArray,Qe,Ot),!0===Cn&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),tn.render(z,Qe),X.setupLights(ue.physicallyCorrectLights),Ot.isArrayCamera){const zt=Ot.cameras;for(let gn=0,pr=zt.length;gn<pr;gn++){const sr=zt[gn];yl(z,Qe,sr,sr.viewport)}}else yl(z,Qe,Ot);null!==Be&&(an.updateMultisampleRenderTarget(Be),an.updateRenderTargetMipmap(Be)),!0===Qe.isScene&&Qe.onAfterRender(ue,Qe,Ot),ui.buffers.depth.setTest(!0),ui.buffers.depth.setMask(!0),ui.buffers.color.setMask(!0),ui.setPolygonOffset(!1),ni.enabled&&ni.submitFrame&&ni.submitFrame(),Fi.resetDefaultState(),be=-1,Ve=null,re.pop(),X=re.length>0?re[re.length-1]:null,Q.pop(),z=Q.length>0?Q[Q.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setTexture2D=(Qe=!1,function(Vt,zt){Vt&&Vt.isWebGLRenderTarget&&(Qe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Qe=!0),Vt=Vt.texture),an.setTexture2D(Vt,zt)}),this.getActiveCubeFace=function(){return se},this.getActiveMipmapLevel=function(){return J},this.getRenderTarget=function(){return Be},this.setRenderTargetTextures=function(Qe,Ot,Vt){Yi.get(Qe.texture).__webglTexture=Ot,Yi.get(Qe.depthTexture).__webglTexture=Vt;const zt=Yi.get(Qe);zt.__hasExternalTextures=!0,zt.__hasExternalTextures&&(zt.__autoAllocateDepthBuffer=void 0===Vt,zt.__autoAllocateDepthBuffer||Qe.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),Qe.useRenderToTexture=!1,Qe.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(Qe,Ot){const Vt=Yi.get(Qe);Vt.__webglFramebuffer=Ot,Vt.__useDefaultFramebuffer=void 0===Ot},this.setRenderTarget=function(Qe,Ot=0,Vt=0){Be=Qe,se=Ot,J=Vt;let zt=!0;if(Qe){const Pr=Yi.get(Qe);void 0!==Pr.__useDefaultFramebuffer?(ui.bindFramebuffer(mt.FRAMEBUFFER,null),zt=!1):void 0===Pr.__webglFramebuffer?an.setupRenderTarget(Qe):Pr.__hasExternalTextures&&an.rebindTextures(Qe,Yi.get(Qe.texture).__webglTexture,Yi.get(Qe.depthTexture).__webglTexture)}let gn=null,pr=!1,sr=!1;if(Qe){const Pr=Qe.texture;(Pr.isDataTexture3D||Pr.isDataTexture2DArray)&&(sr=!0);const $n=Yi.get(Qe).__webglFramebuffer;Qe.isWebGLCubeRenderTarget?(gn=$n[Ot],pr=!0):gn=Qe.useRenderbuffer?Yi.get(Qe).__webglMultisampledFramebuffer:$n,Ze.copy(Qe.viewport),dt.copy(Qe.scissor),yt=Qe.scissorTest}else Ze.copy(Mt).multiplyScalar(_e).floor(),dt.copy(At).multiplyScalar(_e).floor(),yt=Ft;if(ui.bindFramebuffer(mt.FRAMEBUFFER,gn)&&ki.drawBuffers&&zt&&ui.drawBuffers(Qe,gn),ui.viewport(Ze),ui.scissor(dt),ui.setScissorTest(yt),pr){const Pr=Yi.get(Qe.texture);mt.framebufferTexture2D(mt.FRAMEBUFFER,mt.COLOR_ATTACHMENT0,mt.TEXTURE_CUBE_MAP_POSITIVE_X+Ot,Pr.__webglTexture,Vt)}else if(sr){const Pr=Yi.get(Qe.texture);mt.framebufferTextureLayer(mt.FRAMEBUFFER,mt.COLOR_ATTACHMENT0,Pr.__webglTexture,Vt||0,Ot||0)}be=-1},this.readRenderTargetPixels=function(Qe,Ot,Vt,zt,gn,pr,sr){if(!Qe||!Qe.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Dr=Yi.get(Qe).__webglFramebuffer;if(Qe.isWebGLCubeRenderTarget&&void 0!==sr&&(Dr=Dr[sr]),Dr){ui.bindFramebuffer(mt.FRAMEBUFFER,Dr);try{const Pr=Qe.texture,$n=Pr.format,es=Pr.type;if($n!==bt&&Gi.convert($n)!==mt.getParameter(mt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const rs=es===Oi&&(pi.has("EXT_color_buffer_half_float")||ki.isWebGL2&&pi.has("EXT_color_buffer_float"));if(!(es===Sn||Gi.convert(es)===mt.getParameter(mt.IMPLEMENTATION_COLOR_READ_TYPE)||es===Xi&&(ki.isWebGL2||pi.has("OES_texture_float")||pi.has("WEBGL_color_buffer_float"))||rs))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");mt.checkFramebufferStatus(mt.FRAMEBUFFER)===mt.FRAMEBUFFER_COMPLETE?Ot>=0&&Ot<=Qe.width-zt&&Vt>=0&&Vt<=Qe.height-gn&&mt.readPixels(Ot,Vt,zt,gn,Gi.convert($n),Gi.convert(es),pr):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Pr=null!==Be?Yi.get(Be).__webglFramebuffer:null;ui.bindFramebuffer(mt.FRAMEBUFFER,Pr)}}},this.copyFramebufferToTexture=function(Qe,Ot,Vt=0){if(!0!==Ot.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const zt=Math.pow(2,-Vt),gn=Math.floor(Ot.image.width*zt),pr=Math.floor(Ot.image.height*zt);an.setTexture2D(Ot,0),mt.copyTexSubImage2D(mt.TEXTURE_2D,Vt,0,0,Qe.x,Qe.y,gn,pr),ui.unbindTexture()},this.copyTextureToTexture=function(Qe,Ot,Vt,zt=0){const gn=Ot.image.width,pr=Ot.image.height,sr=Gi.convert(Vt.format),Dr=Gi.convert(Vt.type);an.setTexture2D(Vt,0),mt.pixelStorei(mt.UNPACK_FLIP_Y_WEBGL,Vt.flipY),mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Vt.premultiplyAlpha),mt.pixelStorei(mt.UNPACK_ALIGNMENT,Vt.unpackAlignment),Ot.isDataTexture?mt.texSubImage2D(mt.TEXTURE_2D,zt,Qe.x,Qe.y,gn,pr,sr,Dr,Ot.image.data):Ot.isCompressedTexture?mt.compressedTexSubImage2D(mt.TEXTURE_2D,zt,Qe.x,Qe.y,Ot.mipmaps[0].width,Ot.mipmaps[0].height,sr,Ot.mipmaps[0].data):mt.texSubImage2D(mt.TEXTURE_2D,zt,Qe.x,Qe.y,sr,Dr,Ot.image),0===zt&&Vt.generateMipmaps&&mt.generateMipmap(mt.TEXTURE_2D),ui.unbindTexture()},this.copyTextureToTexture3D=function(Qe,Ot,Vt,zt,gn=0){if(ue.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const pr=Qe.max.x-Qe.min.x+1,sr=Qe.max.y-Qe.min.y+1,Dr=Qe.max.z-Qe.min.z+1,Pr=Gi.convert(zt.format),$n=Gi.convert(zt.type);let es;if(zt.isDataTexture3D)an.setTexture3D(zt,0),es=mt.TEXTURE_3D;else{if(!zt.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");an.setTexture2DArray(zt,0),es=mt.TEXTURE_2D_ARRAY}mt.pixelStorei(mt.UNPACK_FLIP_Y_WEBGL,zt.flipY),mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,zt.premultiplyAlpha),mt.pixelStorei(mt.UNPACK_ALIGNMENT,zt.unpackAlignment);const rs=mt.getParameter(mt.UNPACK_ROW_LENGTH),eo=mt.getParameter(mt.UNPACK_IMAGE_HEIGHT),xu=mt.getParameter(mt.UNPACK_SKIP_PIXELS),xh=mt.getParameter(mt.UNPACK_SKIP_ROWS),us=mt.getParameter(mt.UNPACK_SKIP_IMAGES),xl=Vt.isCompressedTexture?Vt.mipmaps[0]:Vt.image;mt.pixelStorei(mt.UNPACK_ROW_LENGTH,xl.width),mt.pixelStorei(mt.UNPACK_IMAGE_HEIGHT,xl.height),mt.pixelStorei(mt.UNPACK_SKIP_PIXELS,Qe.min.x),mt.pixelStorei(mt.UNPACK_SKIP_ROWS,Qe.min.y),mt.pixelStorei(mt.UNPACK_SKIP_IMAGES,Qe.min.z),Vt.isDataTexture||Vt.isDataTexture3D?mt.texSubImage3D(es,gn,Ot.x,Ot.y,Ot.z,pr,sr,Dr,Pr,$n,xl.data):Vt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),mt.compressedTexSubImage3D(es,gn,Ot.x,Ot.y,Ot.z,pr,sr,Dr,Pr,xl.data)):mt.texSubImage3D(es,gn,Ot.x,Ot.y,Ot.z,pr,sr,Dr,Pr,$n,xl),mt.pixelStorei(mt.UNPACK_ROW_LENGTH,rs),mt.pixelStorei(mt.UNPACK_IMAGE_HEIGHT,eo),mt.pixelStorei(mt.UNPACK_SKIP_PIXELS,xu),mt.pixelStorei(mt.UNPACK_SKIP_ROWS,xh),mt.pixelStorei(mt.UNPACK_SKIP_IMAGES,us),0===gn&&zt.generateMipmaps&&mt.generateMipmap(es),ui.unbindTexture()},this.initTexture=function(Qe){an.setTexture2D(Qe,0),ui.unbindTexture()},this.resetState=function(){se=0,J=0,Be=null,ui.reset(),Fi.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}fs.prototype.isWebGLRenderer=!0;class nu extends fs{}nu.prototype.isWebGL1Renderer=!0;class al{constructor(n,r=25e-5){this.name="",this.color=new zn(n),this.density=r}clone(){return new al(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}al.prototype.isFogExp2=!0;class Mo{constructor(n,r=1,l=1e3){this.name="",this.color=new zn(n),this.near=r,this.far=l}clone(){return new Mo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Mo.prototype.isFog=!0;class ll extends Er{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(n,r){return super.copy(n,r),null!==n.background&&(this.background=n.background.clone()),null!==n.environment&&(this.environment=n.environment.clone()),null!==n.fog&&(this.fog=n.fog.clone()),null!==n.overrideMaterial&&(this.overrideMaterial=n.overrideMaterial.clone()),this.autoUpdate=n.autoUpdate,this.matrixAutoUpdate=n.matrixAutoUpdate,this}toJSON(n){const r=super.toJSON(n);return null!==this.fog&&(r.object.fog=this.fog.toJSON()),r}}ll.prototype.isScene=!0;class Gl{constructor(n,r){this.array=n,this.stride=r,this.count=void 0!==n?n.length/r:0,this.usage=Th,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Xo()}onUploadCallback(){}set needsUpdate(n){!0===n&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,r,l){n*=this.stride,l*=r.stride;for(let c=0,f=this.stride;c<f;c++)this.array[n+c]=r.array[l+c];return this}set(n,r=0){return this.array.set(n,r),this}clone(n){void 0===n.arrayBuffers&&(n.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xo()),void 0===n.arrayBuffers[this.array.buffer._uuid]&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const r=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),l=new this.constructor(r,this.stride);return l.setUsage(this.usage),l}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return void 0===n.arrayBuffers&&(n.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xo()),void 0===n.arrayBuffers[this.array.buffer._uuid]&&(n.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Gl.prototype.isInterleavedBuffer=!0;const Cs=new Oe;class xa{constructor(n,r,l,c=!1){this.name="",this.data=n,this.itemSize=r,this.offset=l,this.normalized=!0===c}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(n){this.data.needsUpdate=n}applyMatrix4(n){for(let r=0,l=this.data.count;r<l;r++)Cs.x=this.getX(r),Cs.y=this.getY(r),Cs.z=this.getZ(r),Cs.applyMatrix4(n),this.setXYZ(r,Cs.x,Cs.y,Cs.z);return this}applyNormalMatrix(n){for(let r=0,l=this.count;r<l;r++)Cs.x=this.getX(r),Cs.y=this.getY(r),Cs.z=this.getZ(r),Cs.applyNormalMatrix(n),this.setXYZ(r,Cs.x,Cs.y,Cs.z);return this}transformDirection(n){for(let r=0,l=this.count;r<l;r++)Cs.x=this.getX(r),Cs.y=this.getY(r),Cs.z=this.getZ(r),Cs.transformDirection(n),this.setXYZ(r,Cs.x,Cs.y,Cs.z);return this}setX(n,r){return this.data.array[n*this.data.stride+this.offset]=r,this}setY(n,r){return this.data.array[n*this.data.stride+this.offset+1]=r,this}setZ(n,r){return this.data.array[n*this.data.stride+this.offset+2]=r,this}setW(n,r){return this.data.array[n*this.data.stride+this.offset+3]=r,this}getX(n){return this.data.array[n*this.data.stride+this.offset]}getY(n){return this.data.array[n*this.data.stride+this.offset+1]}getZ(n){return this.data.array[n*this.data.stride+this.offset+2]}getW(n){return this.data.array[n*this.data.stride+this.offset+3]}setXY(n,r,l){return this.data.array[(n=n*this.data.stride+this.offset)+0]=r,this.data.array[n+1]=l,this}setXYZ(n,r,l,c){return this.data.array[(n=n*this.data.stride+this.offset)+0]=r,this.data.array[n+1]=l,this.data.array[n+2]=c,this}setXYZW(n,r,l,c,f){return this.data.array[(n=n*this.data.stride+this.offset)+0]=r,this.data.array[n+1]=l,this.data.array[n+2]=c,this.data.array[n+3]=f,this}clone(n){if(void 0===n){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let l=0;l<this.count;l++){const c=l*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)r.push(this.data.array[c+f])}return new Gr(new this.array.constructor(r),this.itemSize,this.normalized)}return void 0===n.interleavedBuffers&&(n.interleavedBuffers={}),void 0===n.interleavedBuffers[this.data.uuid]&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new xa(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(n){if(void 0===n){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let l=0;l<this.count;l++){const c=l*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)r.push(this.data.array[c+f])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:r,normalized:this.normalized}}return void 0===n.interleavedBuffers&&(n.interleavedBuffers={}),void 0===n.interleavedBuffers[this.data.uuid]&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}xa.prototype.isInterleavedBufferAttribute=!0;class zl extends js{constructor(n){super(),this.type="SpriteMaterial",this.color=new zn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this}}let Ha;zl.prototype.isSpriteMaterial=!0;const cl=new Oe,ul=new Oe,iu=new Oe,Vl=new st,Wl=new st,Yh=new ri,Qh=new Oe,ru=new Oe,Zh=new Oe,Up=new st,Qu=new st,qh=new st;class Kh extends Er{constructor(n){if(super(),this.type="Sprite",void 0===Ha){Ha=new ji;const r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),l=new Gl(r,5);Ha.setIndex([0,1,2,0,2,3]),Ha.setAttribute("position",new xa(l,3,0,!1)),Ha.setAttribute("uv",new xa(l,2,3,!1))}this.geometry=Ha,this.material=void 0!==n?n:new zl,this.center=new st(.5,.5)}raycast(n,r){null===n.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ul.setFromMatrixScale(this.matrixWorld),Yh.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),iu.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ul.multiplyScalar(-iu.z);const l=this.material.rotation;let c,f;0!==l&&(f=Math.cos(l),c=Math.sin(l));const m=this.center;rf(Qh.set(-.5,-.5,0),iu,m,ul,c,f),rf(ru.set(.5,-.5,0),iu,m,ul,c,f),rf(Zh.set(.5,.5,0),iu,m,ul,c,f),Up.set(0,0),Qu.set(1,0),qh.set(1,1);let g=n.ray.intersectTriangle(Qh,ru,Zh,!1,cl);if(null===g&&(rf(ru.set(-.5,.5,0),iu,m,ul,c,f),Qu.set(0,1),g=n.ray.intersectTriangle(Qh,Zh,ru,!1,cl),null===g))return;const C=n.ray.origin.distanceTo(cl);C<n.near||C>n.far||r.push({distance:C,point:cl.clone(),uv:Xs.getUV(cl,Qh,ru,Zh,Up,Qu,qh,new st),face:null,object:this})}copy(n){return super.copy(n),void 0!==n.center&&this.center.copy(n.center),this.material=n.material,this}}function rf(h,n,r,l,c,f){Vl.subVectors(h,r).addScalar(.5).multiply(l),void 0!==c?(Wl.x=f*Vl.x-c*Vl.y,Wl.y=c*Vl.x+f*Vl.y):Wl.copy(Vl),h.copy(n),h.x+=Wl.x,h.y+=Wl.y,h.applyMatrix4(Yh)}Kh.prototype.isSprite=!0;const Jh=new Oe,Np=new Oe;class kp extends Er{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const r=n.levels;for(let l=0,c=r.length;l<c;l++){const f=r[l];this.addLevel(f.object.clone(),f.distance)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,r=0){r=Math.abs(r);const l=this.levels;let c;for(c=0;c<l.length&&!(r<l[c].distance);c++);return l.splice(c,0,{distance:r,object:n}),this.add(n),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const r=this.levels;if(r.length>0){let l,c;for(l=1,c=r.length;l<c&&!(n<r[l].distance);l++);return r[l-1].object}return null}raycast(n,r){if(this.levels.length>0){Jh.setFromMatrixPosition(this.matrixWorld);const c=n.ray.origin.distanceTo(Jh);this.getObjectForDistance(c).raycast(n,r)}}update(n){const r=this.levels;if(r.length>1){Jh.setFromMatrixPosition(n.matrixWorld),Np.setFromMatrixPosition(this.matrixWorld);const l=Jh.distanceTo(Np)/n.zoom;let c,f;for(r[0].object.visible=!0,c=1,f=r.length;c<f&&l>=r[c].distance;c++)r[c-1].object.visible=!1,r[c].object.visible=!0;for(this._currentLevel=c-1;c<f;c++)r[c].object.visible=!1}}toJSON(n){const r=super.toJSON(n);!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[];const l=this.levels;for(let c=0,f=l.length;c<f;c++){const m=l[c];r.object.levels.push({object:m.object.uuid,distance:m.distance})}return r}}const dg=new Oe,Hp=new Or,sf=new Or,Gp=new Oe,su=new ri;class $h extends Ys{constructor(n,r){super(n,r),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ri,this.bindMatrixInverse=new ri}copy(n){return super.copy(n),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,this}bind(n,r){this.skeleton=n,void 0===r&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),r=this.matrixWorld),this.bindMatrix.copy(r),this.bindMatrixInverse.copy(r).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Or,r=this.geometry.attributes.skinWeight;for(let l=0,c=r.count;l<c;l++){n.x=r.getX(l),n.y=r.getY(l),n.z=r.getZ(l),n.w=r.getW(l);const f=1/n.manhattanLength();f!==1/0?n.multiplyScalar(f):n.set(1,0,0,0),r.setXYZW(l,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(n,r){const l=this.skeleton,c=this.geometry;Hp.fromBufferAttribute(c.attributes.skinIndex,n),sf.fromBufferAttribute(c.attributes.skinWeight,n),dg.copy(r).applyMatrix4(this.bindMatrix),r.set(0,0,0);for(let f=0;f<4;f++){const m=sf.getComponent(f);if(0!==m){const g=Hp.getComponent(f);su.multiplyMatrices(l.bones[g].matrixWorld,l.boneInverses[g]),r.addScaledVector(Gp.copy(dg).applyMatrix4(su),m)}}return r.applyMatrix4(this.bindMatrixInverse)}}$h.prototype.isSkinnedMesh=!0;class of extends Er{constructor(){super(),this.type="Bone"}}of.prototype.isBone=!0;class Xl extends Rn{constructor(n=null,r=1,l=1,c,f,m,g,C,L=On,G=On,z,X){super(null,m,g,C,L,G,c,f,z,X),this.image={data:n,width:r,height:l},this.magFilter=L,this.minFilter=G,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Xl.prototype.isDataTexture=!0;const ou=new ri,fg=new ri;class ed{constructor(n=[],r=[]){this.uuid=Xo(),this.bones=n.slice(0),this.boneInverses=r,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const n=this.bones,r=this.boneInverses;if(this.boneMatrices=new Float32Array(16*n.length),0===r.length)this.calculateInverses();else if(n.length!==r.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let l=0,c=this.bones.length;l<c;l++)this.boneInverses.push(new ri)}}calculateInverses(){this.boneInverses.length=0;for(let n=0,r=this.bones.length;n<r;n++){const l=new ri;this.bones[n]&&l.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(l)}}pose(){for(let n=0,r=this.bones.length;n<r;n++){const l=this.bones[n];l&&l.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,r=this.bones.length;n<r;n++){const l=this.bones[n];l&&(l.parent&&l.parent.isBone?(l.matrix.copy(l.parent.matrixWorld).invert(),l.matrix.multiply(l.matrixWorld)):l.matrix.copy(l.matrixWorld),l.matrix.decompose(l.position,l.quaternion,l.scale))}}update(){const n=this.bones,r=this.boneInverses,l=this.boneMatrices,c=this.boneTexture;for(let f=0,m=n.length;f<m;f++)ou.multiplyMatrices(n[f]?n[f].matrixWorld:fg,r[f]),ou.toArray(l,16*f);null!==c&&(c.needsUpdate=!0)}clone(){return new ed(this.bones,this.boneInverses)}computeBoneTexture(){let n=Math.sqrt(4*this.bones.length);n=Xm(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(this.boneMatrices);const l=new Xl(r,n,n,bt,Xi);return l.needsUpdate=!0,this.boneMatrices=r,this.boneTexture=l,this.boneTextureSize=n,this}getBoneByName(n){for(let r=0,l=this.bones.length;r<l;r++){const c=this.bones[r];if(c.name===n)return c}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,r){this.uuid=n.uuid;for(let l=0,c=n.bones.length;l<c;l++){const f=n.bones[l];let m=r[f];void 0===m&&(console.warn("THREE.Skeleton: No bone found with UUID:",f),m=new of),this.bones.push(m),this.boneInverses.push((new ri).fromArray(n.boneInverses[l]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;const r=this.bones,l=this.boneInverses;for(let c=0,f=r.length;c<f;c++)n.bones.push(r[c].uuid),n.boneInverses.push(l[c].toArray());return n}}class hl extends Gr{constructor(n,r,l,c=1){"number"==typeof l&&(c=l,l=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(n,r,l),this.meshPerAttribute=c}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}}hl.prototype.isInstancedBufferAttribute=!0;const Zu=new ri,zp=new ri,xo=[],qu=new Ys;class af extends Ys{constructor(n,r,l){super(n,r),this.instanceMatrix=new hl(new Float32Array(16*l),16),this.instanceColor=null,this.count=l,this.frustumCulled=!1}copy(n){return super.copy(n),this.instanceMatrix.copy(n.instanceMatrix),null!==n.instanceColor&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,this}getColorAt(n,r){r.fromArray(this.instanceColor.array,3*n)}getMatrixAt(n,r){r.fromArray(this.instanceMatrix.array,16*n)}raycast(n,r){const l=this.matrixWorld,c=this.count;if(qu.geometry=this.geometry,qu.material=this.material,void 0!==qu.material)for(let f=0;f<c;f++){this.getMatrixAt(f,Zu),zp.multiplyMatrices(l,Zu),qu.matrixWorld=zp,qu.raycast(n,xo);for(let m=0,g=xo.length;m<g;m++){const C=xo[m];C.instanceId=f,C.object=this,r.push(C)}xo.length=0}}setColorAt(n,r){null===this.instanceColor&&(this.instanceColor=new hl(new Float32Array(3*this.instanceMatrix.count),3)),r.toArray(this.instanceColor.array,3*n)}setMatrixAt(n,r){r.toArray(this.instanceMatrix.array,16*n)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}af.prototype.isInstancedMesh=!0;class To extends js{constructor(n){super(),this.type="LineBasicMaterial",this.color=new zn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this}}To.prototype.isLineBasicMaterial=!0;const lf=new Oe,td=new Oe,_c=new ri,cf=new $o,nd=new Ca;class ia extends Er{constructor(n=new ji,r=new To){super(),this.type="Line",this.geometry=n,this.material=r,this.updateMorphTargets()}copy(n){return super.copy(n),this.material=n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.isBufferGeometry)if(null===n.index){const r=n.attributes.position,l=[0];for(let c=1,f=r.count;c<f;c++)lf.fromBufferAttribute(r,c-1),td.fromBufferAttribute(r,c),l[c]=l[c-1],l[c]+=lf.distanceTo(td);n.setAttribute("lineDistance",new Mi(l,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(n,r){const l=this.geometry,c=this.matrixWorld,f=n.params.Line.threshold,m=l.drawRange;if(null===l.boundingSphere&&l.computeBoundingSphere(),nd.copy(l.boundingSphere),nd.applyMatrix4(c),nd.radius+=f,!1===n.ray.intersectsSphere(nd))return;_c.copy(c).invert(),cf.copy(n.ray).applyMatrix4(_c);const g=f/((this.scale.x+this.scale.y+this.scale.z)/3),C=g*g,L=new Oe,G=new Oe,z=new Oe,X=new Oe,Q=this.isLineSegments?2:1;if(l.isBufferGeometry){const re=l.index,Te=l.attributes.position;if(null!==re)for(let Be=Math.max(0,m.start),be=Math.min(re.count,m.start+m.count)-1;Be<be;Be+=Q){const Ve=re.getX(Be),Ze=re.getX(Be+1);if(L.fromBufferAttribute(Te,Ve),G.fromBufferAttribute(Te,Ze),cf.distanceSqToSegment(L,G,X,z)>C)continue;X.applyMatrix4(this.matrixWorld);const yt=n.ray.origin.distanceTo(X);yt<n.near||yt>n.far||r.push({distance:yt,point:z.clone().applyMatrix4(this.matrixWorld),index:Be,face:null,faceIndex:null,object:this})}else for(let Be=Math.max(0,m.start),be=Math.min(Te.count,m.start+m.count)-1;Be<be;Be+=Q){if(L.fromBufferAttribute(Te,Be),G.fromBufferAttribute(Te,Be+1),cf.distanceSqToSegment(L,G,X,z)>C)continue;X.applyMatrix4(this.matrixWorld);const Ze=n.ray.origin.distanceTo(X);Ze<n.near||Ze>n.far||r.push({distance:Ze,point:z.clone().applyMatrix4(this.matrixWorld),index:Be,face:null,faceIndex:null,object:this})}}else l.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const r=n.morphAttributes,l=Object.keys(r);if(l.length>0){const c=r[l[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,m=c.length;f<m;f++){const g=c[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=f}}}}else{const r=n.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ia.prototype.isLine=!0;const Vp=new Oe,uf=new Oe;class qo extends ia{constructor(n,r){super(n,r),this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.isBufferGeometry)if(null===n.index){const r=n.attributes.position,l=[];for(let c=0,f=r.count;c<f;c+=2)Vp.fromBufferAttribute(r,c),uf.fromBufferAttribute(r,c+1),l[c]=0===c?0:l[c-1],l[c+1]=l[c]+Vp.distanceTo(uf);n.setAttribute("lineDistance",new Mi(l,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}qo.prototype.isLineSegments=!0;class id extends ia{constructor(n,r){super(n,r),this.type="LineLoop"}}id.prototype.isLineLoop=!0;class dl extends js{constructor(n){super(),this.type="PointsMaterial",this.color=new zn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this}}dl.prototype.isPointsMaterial=!0;const rd=new ri,hf=new $o,sd=new Ca,df=new Oe;class od extends Er{constructor(n=new ji,r=new dl){super(),this.type="Points",this.geometry=n,this.material=r,this.updateMorphTargets()}copy(n){return super.copy(n),this.material=n.material,this.geometry=n.geometry,this}raycast(n,r){const l=this.geometry,c=this.matrixWorld,f=n.params.Points.threshold,m=l.drawRange;if(null===l.boundingSphere&&l.computeBoundingSphere(),sd.copy(l.boundingSphere),sd.applyMatrix4(c),sd.radius+=f,!1===n.ray.intersectsSphere(sd))return;rd.copy(c).invert(),hf.copy(n.ray).applyMatrix4(rd);const g=f/((this.scale.x+this.scale.y+this.scale.z)/3),C=g*g;if(l.isBufferGeometry){const L=l.index,z=l.attributes.position;if(null!==L)for(let re=Math.max(0,m.start),ue=Math.min(L.count,m.start+m.count);re<ue;re++){const Te=L.getX(re);df.fromBufferAttribute(z,Te),Wp(df,Te,C,c,n,r,this)}else for(let re=Math.max(0,m.start),ue=Math.min(z.count,m.start+m.count);re<ue;re++)df.fromBufferAttribute(z,re),Wp(df,re,C,c,n,r,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const r=n.morphAttributes,l=Object.keys(r);if(l.length>0){const c=r[l[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,m=c.length;f<m;f++){const g=c[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=f}}}}else{const r=n.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Wp(h,n,r,l,c,f,m){const g=hf.distanceSqToPoint(h);if(g<r){const C=new Oe;hf.closestPointToPoint(h,C),C.applyMatrix4(l);const L=c.ray.origin.distanceTo(C);if(L<c.near||L>c.far)return;f.push({distance:L,distanceToRay:Math.sqrt(g),point:C,index:n,face:null,object:m})}}od.prototype.isPoints=!0;class pg extends Rn{constructor(n,r,l,c,f,m,g,C,L){super(n,r,l,c,f,m,g,C,L),this.minFilter=void 0!==m?m:vt,this.magFilter=void 0!==f?f:vt,this.generateMipmaps=!1;const G=this;"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback(function z(){G.needsUpdate=!0,n.requestVideoFrameCallback(z)})}clone(){return new this.constructor(this.image).copy(this)}update(){const n=this.image;"requestVideoFrameCallback"in n==0&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}pg.prototype.isVideoTexture=!0;class ha extends Rn{constructor(n,r,l){super({width:n,height:r}),this.format=l,this.magFilter=On,this.minFilter=On,this.generateMipmaps=!1,this.needsUpdate=!0}}ha.prototype.isFramebufferTexture=!0;class Ku extends Rn{constructor(n,r,l,c,f,m,g,C,L,G,z,X){super(null,m,g,C,L,G,c,f,z,X),this.image={width:r,height:l},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}}Ku.prototype.isCompressedTexture=!0;class Xp extends Rn{constructor(n,r,l,c,f,m,g,C,L){super(n,r,l,c,f,m,g,C,L),this.needsUpdate=!0}}Xp.prototype.isCanvasTexture=!0;class Mc extends ji{constructor(n=1,r=8,l=0,c=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:r,thetaStart:l,thetaLength:c},r=Math.max(3,r);const f=[],m=[],g=[],C=[],L=new Oe,G=new st;m.push(0,0,0),g.push(0,0,1),C.push(.5,.5);for(let z=0,X=3;z<=r;z++,X+=3){const Q=l+z/r*c;L.x=n*Math.cos(Q),L.y=n*Math.sin(Q),m.push(L.x,L.y,L.z),g.push(0,0,1),G.x=(m[X]/n+1)/2,G.y=(m[X+1]/n+1)/2,C.push(G.x,G.y)}for(let z=1;z<=r;z++)f.push(z,z+1,0);this.setIndex(f),this.setAttribute("position",new Mi(m,3)),this.setAttribute("normal",new Mi(g,3)),this.setAttribute("uv",new Mi(C,2))}static fromJSON(n){return new Mc(n.radius,n.segments,n.thetaStart,n.thetaLength)}}class Ga extends ji{constructor(n=1,r=1,l=1,c=8,f=1,m=!1,g=0,C=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:n,radiusBottom:r,height:l,radialSegments:c,heightSegments:f,openEnded:m,thetaStart:g,thetaLength:C};const L=this;c=Math.floor(c),f=Math.floor(f);const G=[],z=[],X=[],Q=[];let re=0;const ue=[],Te=l/2;let se=0;function Be(be){const Ve=re,Ze=new st,dt=new Oe;let yt=0;const It=!0===be?n:r,Ht=!0===be?1:-1;for(let Ke=1;Ke<=c;Ke++)z.push(0,Te*Ht,0),X.push(0,Ht,0),Q.push(.5,.5),re++;const _e=re;for(let Ke=0;Ke<=c;Ke++){const Mt=Ke/c*C+g,At=Math.cos(Mt),Ft=Math.sin(Mt);dt.x=It*Ft,dt.y=Te*Ht,dt.z=It*At,z.push(dt.x,dt.y,dt.z),X.push(0,Ht,0),Ze.x=.5*At+.5,Ze.y=.5*Ft*Ht+.5,Q.push(Ze.x,Ze.y),re++}for(let Ke=0;Ke<c;Ke++){const Et=Ve+Ke,Mt=_e+Ke;!0===be?G.push(Mt,Mt+1,Et):G.push(Mt+1,Mt,Et),yt+=3}L.addGroup(se,yt,!0===be?1:2),se+=yt}(function(){const be=new Oe,Ve=new Oe;let Ze=0;const dt=(r-n)/l;for(let yt=0;yt<=f;yt++){const It=[],Ht=yt/f,_e=Ht*(r-n)+n;for(let Ke=0;Ke<=c;Ke++){const Et=Ke/c,Mt=Et*C+g,At=Math.sin(Mt),Ft=Math.cos(Mt);Ve.x=_e*At,Ve.y=-Ht*l+Te,Ve.z=_e*Ft,z.push(Ve.x,Ve.y,Ve.z),be.set(At,dt,Ft).normalize(),X.push(be.x,be.y,be.z),Q.push(Et,1-Ht),It.push(re++)}ue.push(It)}for(let yt=0;yt<c;yt++)for(let It=0;It<f;It++){const _e=ue[It+1][yt],Ke=ue[It+1][yt+1],Et=ue[It][yt+1];G.push(ue[It][yt],_e,Et),G.push(_e,Ke,Et),Ze+=6}L.addGroup(se,Ze,0),se+=Ze})(),!1===m&&(n>0&&Be(!0),r>0&&Be(!1)),this.setIndex(G),this.setAttribute("position",new Mi(z,3)),this.setAttribute("normal",new Mi(X,3)),this.setAttribute("uv",new Mi(Q,2))}static fromJSON(n){return new Ga(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class Tc extends Ga{constructor(n=1,r=1,l=8,c=1,f=!1,m=0,g=2*Math.PI){super(0,n,r,l,c,f,m,g),this.type="ConeGeometry",this.parameters={radius:n,height:r,radialSegments:l,heightSegments:c,openEnded:f,thetaStart:m,thetaLength:g}}static fromJSON(n){return new Tc(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class Aa extends ji{constructor(n=[],r=[],l=1,c=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:r,radius:l,detail:c};const f=[],m=[];function C(J,Be,be,Ve){const Ze=Ve+1,dt=[];for(let yt=0;yt<=Ze;yt++){dt[yt]=[];const It=J.clone().lerp(be,yt/Ze),Ht=Be.clone().lerp(be,yt/Ze),_e=Ze-yt;for(let Ke=0;Ke<=_e;Ke++)dt[yt][Ke]=0===Ke&&yt===Ze?It:It.clone().lerp(Ht,Ke/_e)}for(let yt=0;yt<Ze;yt++)for(let It=0;It<2*(Ze-yt)-1;It++){const Ht=Math.floor(It/2);It%2==0?(X(dt[yt][Ht+1]),X(dt[yt+1][Ht]),X(dt[yt][Ht])):(X(dt[yt][Ht+1]),X(dt[yt+1][Ht+1]),X(dt[yt+1][Ht]))}}function X(J){f.push(J.x,J.y,J.z)}function Q(J,Be){const be=3*J;Be.x=n[be+0],Be.y=n[be+1],Be.z=n[be+2]}function ue(J,Be,be,Ve){Ve<0&&1===J.x&&(m[Be]=J.x-1),0===be.x&&0===be.z&&(m[Be]=Ve/2/Math.PI+.5)}function Te(J){return Math.atan2(J.z,-J.x)}function se(J){return Math.atan2(-J.y,Math.sqrt(J.x*J.x+J.z*J.z))}(function(J){const Be=new Oe,be=new Oe,Ve=new Oe;for(let Ze=0;Ze<r.length;Ze+=3)Q(r[Ze+0],Be),Q(r[Ze+1],be),Q(r[Ze+2],Ve),C(Be,be,Ve,J)})(c),function(J){const Be=new Oe;for(let be=0;be<f.length;be+=3)Be.x=f[be+0],Be.y=f[be+1],Be.z=f[be+2],Be.normalize().multiplyScalar(J),f[be+0]=Be.x,f[be+1]=Be.y,f[be+2]=Be.z}(l),function(){const J=new Oe;for(let Be=0;Be<f.length;Be+=3){J.x=f[Be+0],J.y=f[Be+1],J.z=f[Be+2];const be=Te(J)/2/Math.PI+.5,Ve=se(J)/Math.PI+.5;m.push(be,1-Ve)}(function(){const J=new Oe,Be=new Oe,be=new Oe,Ve=new Oe,Ze=new st,dt=new st,yt=new st;for(let It=0,Ht=0;It<f.length;It+=9,Ht+=6){J.set(f[It+0],f[It+1],f[It+2]),Be.set(f[It+3],f[It+4],f[It+5]),be.set(f[It+6],f[It+7],f[It+8]),Ze.set(m[Ht+0],m[Ht+1]),dt.set(m[Ht+2],m[Ht+3]),yt.set(m[Ht+4],m[Ht+5]),Ve.copy(J).add(Be).add(be).divideScalar(3);const _e=Te(Ve);ue(Ze,Ht+0,J,_e),ue(dt,Ht+2,Be,_e),ue(yt,Ht+4,be,_e)}})(),function(){for(let J=0;J<m.length;J+=6){const Be=m[J+0],be=m[J+2],Ve=m[J+4],Ze=Math.max(Be,be,Ve),dt=Math.min(Be,be,Ve);Ze>.9&&dt<.1&&(Be<.2&&(m[J+0]+=1),be<.2&&(m[J+2]+=1),Ve<.2&&(m[J+4]+=1))}}()}(),this.setAttribute("position",new Mi(f,3)),this.setAttribute("normal",new Mi(f.slice(),3)),this.setAttribute("uv",new Mi(m,2)),0===c?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(n){return new Aa(n.vertices,n.indices,n.radius,n.details)}}class Sc extends Aa{constructor(n=1,r=0){const l=(1+Math.sqrt(5))/2,c=1/l;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-c,-l,0,-c,l,0,c,-l,0,c,l,-c,-l,0,-c,l,0,c,-l,0,c,l,0,-l,0,-c,l,0,-c,-l,0,c,l,0,c],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,r),this.type="DodecahedronGeometry",this.parameters={radius:n,detail:r}}static fromJSON(n){return new Sc(n.radius,n.detail)}}const ad=new Oe,ld=new Oe,jp=new Oe,ff=new Xs;class Yp extends ji{constructor(n=null,r=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:n,thresholdAngle:r},null!==n){const c=Math.pow(10,4),f=Math.cos(bo*r),m=n.getIndex(),g=n.getAttribute("position"),C=m?m.count:g.count,L=[0,0,0],G=["a","b","c"],z=new Array(3),X={},Q=[];for(let re=0;re<C;re+=3){m?(L[0]=m.getX(re),L[1]=m.getX(re+1),L[2]=m.getX(re+2)):(L[0]=re,L[1]=re+1,L[2]=re+2);const{a:ue,b:Te,c:se}=ff;if(ue.fromBufferAttribute(g,L[0]),Te.fromBufferAttribute(g,L[1]),se.fromBufferAttribute(g,L[2]),ff.getNormal(jp),z[0]=`${Math.round(ue.x*c)},${Math.round(ue.y*c)},${Math.round(ue.z*c)}`,z[1]=`${Math.round(Te.x*c)},${Math.round(Te.y*c)},${Math.round(Te.z*c)}`,z[2]=`${Math.round(se.x*c)},${Math.round(se.y*c)},${Math.round(se.z*c)}`,z[0]!==z[1]&&z[1]!==z[2]&&z[2]!==z[0])for(let J=0;J<3;J++){const Be=(J+1)%3,be=z[J],Ve=z[Be],Ze=ff[G[J]],dt=ff[G[Be]],yt=`${be}_${Ve}`,It=`${Ve}_${be}`;It in X&&X[It]?(jp.dot(X[It].normal)<=f&&(Q.push(Ze.x,Ze.y,Ze.z),Q.push(dt.x,dt.y,dt.z)),X[It]=null):yt in X||(X[yt]={index0:L[J],index1:L[Be],normal:jp.clone()})}}for(const re in X)if(X[re]){const{index0:ue,index1:Te}=X[re];ad.fromBufferAttribute(g,ue),ld.fromBufferAttribute(g,Te),Q.push(ad.x,ad.y,ad.z),Q.push(ld.x,ld.y,ld.z)}this.setAttribute("position",new Mi(Q,3))}}}class Uo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(n,r){const l=this.getUtoTmapping(n);return this.getPoint(l,r)}getPoints(n=5){const r=[];for(let l=0;l<=n;l++)r.push(this.getPoint(l/n));return r}getSpacedPoints(n=5){const r=[];for(let l=0;l<=n;l++)r.push(this.getPointAt(l/n));return r}getLength(){const n=this.getLengths();return n[n.length-1]}getLengths(n=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const r=[];let l,c=this.getPoint(0),f=0;r.push(0);for(let m=1;m<=n;m++)l=this.getPoint(m/n),f+=l.distanceTo(c),r.push(f),c=l;return this.cacheArcLengths=r,r}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(n,r){const l=this.getLengths();let c=0;const f=l.length;let m;m=r||n*l[f-1];let L,g=0,C=f-1;for(;g<=C;)if(c=Math.floor(g+(C-g)/2),L=l[c]-m,L<0)g=c+1;else{if(!(L>0)){C=c;break}C=c-1}if(c=C,l[c]===m)return c/(f-1);const G=l[c];return(c+(m-G)/(l[c+1]-G))/(f-1)}getTangent(n,r){const l=1e-4;let c=n-l,f=n+l;c<0&&(c=0),f>1&&(f=1);const m=this.getPoint(c),g=this.getPoint(f),C=r||(m.isVector2?new st:new Oe);return C.copy(g).sub(m).normalize(),C}getTangentAt(n,r){const l=this.getUtoTmapping(n);return this.getTangent(l,r)}computeFrenetFrames(n,r){const l=new Oe,c=[],f=[],m=[],g=new Oe,C=new ri;for(let Q=0;Q<=n;Q++)c[Q]=this.getTangentAt(Q/n,new Oe);f[0]=new Oe,m[0]=new Oe;let L=Number.MAX_VALUE;const G=Math.abs(c[0].x),z=Math.abs(c[0].y),X=Math.abs(c[0].z);G<=L&&(L=G,l.set(1,0,0)),z<=L&&(L=z,l.set(0,1,0)),X<=L&&l.set(0,0,1),g.crossVectors(c[0],l).normalize(),f[0].crossVectors(c[0],g),m[0].crossVectors(c[0],f[0]);for(let Q=1;Q<=n;Q++){if(f[Q]=f[Q-1].clone(),m[Q]=m[Q-1].clone(),g.crossVectors(c[Q-1],c[Q]),g.length()>Number.EPSILON){g.normalize();const re=Math.acos(Po(c[Q-1].dot(c[Q]),-1,1));f[Q].applyMatrix4(C.makeRotationAxis(g,re))}m[Q].crossVectors(c[Q],f[Q])}if(!0===r){let Q=Math.acos(Po(f[0].dot(f[n]),-1,1));Q/=n,c[0].dot(g.crossVectors(f[0],f[n]))>0&&(Q=-Q);for(let re=1;re<=n;re++)f[re].applyMatrix4(C.makeRotationAxis(c[re],Q*re)),m[re].crossVectors(c[re],f[re])}return{tangents:c,normals:f,binormals:m}}clone(){return(new this.constructor).copy(this)}copy(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}toJSON(){const n={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n}fromJSON(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}}class cd extends Uo{constructor(n=0,r=0,l=1,c=1,f=0,m=2*Math.PI,g=!1,C=0){super(),this.type="EllipseCurve",this.aX=n,this.aY=r,this.xRadius=l,this.yRadius=c,this.aStartAngle=f,this.aEndAngle=m,this.aClockwise=g,this.aRotation=C}getPoint(n,r){const l=r||new st,c=2*Math.PI;let f=this.aEndAngle-this.aStartAngle;const m=Math.abs(f)<Number.EPSILON;for(;f<0;)f+=c;for(;f>c;)f-=c;f<Number.EPSILON&&(f=m?0:c),!0===this.aClockwise&&!m&&(f===c?f=-c:f-=c);const g=this.aStartAngle+n*f;let C=this.aX+this.xRadius*Math.cos(g),L=this.aY+this.yRadius*Math.sin(g);if(0!==this.aRotation){const G=Math.cos(this.aRotation),z=Math.sin(this.aRotation),X=C-this.aX,Q=L-this.aY;C=X*G-Q*z+this.aX,L=X*z+Q*G+this.aY}return l.set(C,L)}copy(n){return super.copy(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}toJSON(){const n=super.toJSON();return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n}fromJSON(n){return super.fromJSON(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}}cd.prototype.isEllipseCurve=!0;class Qp extends cd{constructor(n,r,l,c,f,m){super(n,r,l,l,c,f,m),this.type="ArcCurve"}}function Zp(){let h=0,n=0,r=0,l=0;function c(f,m,g,C){h=f,n=g,r=-3*f+3*m-2*g-C,l=2*f-2*m+g+C}return{initCatmullRom:function(f,m,g,C,L){c(m,g,L*(g-f),L*(C-m))},initNonuniformCatmullRom:function(f,m,g,C,L,G,z){let X=(m-f)/L-(g-f)/(L+G)+(g-m)/G,Q=(g-m)/G-(C-m)/(G+z)+(C-g)/z;X*=G,Q*=G,c(m,g,X,Q)},calc:function(f){const m=f*f;return h+n*f+r*m+l*(m*f)}}}Qp.prototype.isArcCurve=!0;const pf=new Oe,au=new Zp,ud=new Zp,mf=new Zp;class Ju extends Uo{constructor(n=[],r=!1,l="centripetal",c=.5){super(),this.type="CatmullRomCurve3",this.points=n,this.closed=r,this.curveType=l,this.tension=c}getPoint(n,r=new Oe){const l=r,c=this.points,f=c.length,m=(f-(this.closed?0:1))*n;let L,G,g=Math.floor(m),C=m-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/f)+1)*f:0===C&&g===f-1&&(g=f-2,C=1),this.closed||g>0?L=c[(g-1)%f]:(pf.subVectors(c[0],c[1]).add(c[0]),L=pf);const z=c[g%f],X=c[(g+1)%f];if(this.closed||g+2<f?G=c[(g+2)%f]:(pf.subVectors(c[f-1],c[f-2]).add(c[f-1]),G=pf),"centripetal"===this.curveType||"chordal"===this.curveType){const Q="chordal"===this.curveType?.5:.25;let re=Math.pow(L.distanceToSquared(z),Q),ue=Math.pow(z.distanceToSquared(X),Q),Te=Math.pow(X.distanceToSquared(G),Q);ue<1e-4&&(ue=1),re<1e-4&&(re=ue),Te<1e-4&&(Te=ue),au.initNonuniformCatmullRom(L.x,z.x,X.x,G.x,re,ue,Te),ud.initNonuniformCatmullRom(L.y,z.y,X.y,G.y,re,ue,Te),mf.initNonuniformCatmullRom(L.z,z.z,X.z,G.z,re,ue,Te)}else"catmullrom"===this.curveType&&(au.initCatmullRom(L.x,z.x,X.x,G.x,this.tension),ud.initCatmullRom(L.y,z.y,X.y,G.y,this.tension),mf.initCatmullRom(L.z,z.z,X.z,G.z,this.tension));return l.set(au.calc(C),ud.calc(C),mf.calc(C)),l}copy(n){super.copy(n),this.points=[];for(let r=0,l=n.points.length;r<l;r++)this.points.push(n.points[r].clone());return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let r=0,l=this.points.length;r<l;r++)n.points.push(this.points[r].toArray());return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let r=0,l=n.points.length;r<l;r++){const c=n.points[r];this.points.push((new Oe).fromArray(c))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function mg(h,n,r,l,c){const f=.5*(l-n),m=.5*(c-r),g=h*h;return(2*r-2*l+f+m)*(h*g)+(-3*r+3*l-2*f-m)*g+f*h+r}function lu(h,n,r,l){return function(h,n){const r=1-h;return r*r*n}(h,n)+function(h,n){return 2*(1-h)*h*n}(h,r)+function(h,n){return h*h*n}(h,l)}function Cc(h,n,r,l,c){return function(h,n){const r=1-h;return r*r*r*n}(h,n)+function(h,n){const r=1-h;return 3*r*r*h*n}(h,r)+function(h,n){return 3*(1-h)*h*h*n}(h,l)+function(h,n){return h*h*h*n}(h,c)}Ju.prototype.isCatmullRomCurve3=!0;class jl extends Uo{constructor(n=new st,r=new st,l=new st,c=new st){super(),this.type="CubicBezierCurve",this.v0=n,this.v1=r,this.v2=l,this.v3=c}getPoint(n,r=new st){const l=r,c=this.v0,f=this.v1,m=this.v2,g=this.v3;return l.set(Cc(n,c.x,f.x,m.x,g.x),Cc(n,c.y,f.y,m.y,g.y)),l}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}jl.prototype.isCubicBezierCurve=!0;class $u extends Uo{constructor(n=new Oe,r=new Oe,l=new Oe,c=new Oe){super(),this.type="CubicBezierCurve3",this.v0=n,this.v1=r,this.v2=l,this.v3=c}getPoint(n,r=new Oe){const l=r,c=this.v0,f=this.v1,m=this.v2,g=this.v3;return l.set(Cc(n,c.x,f.x,m.x,g.x),Cc(n,c.y,f.y,m.y,g.y),Cc(n,c.z,f.z,m.z,g.z)),l}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}$u.prototype.isCubicBezierCurve3=!0;class ba extends Uo{constructor(n=new st,r=new st){super(),this.type="LineCurve",this.v1=n,this.v2=r}getPoint(n,r=new st){const l=r;return 1===n?l.copy(this.v2):(l.copy(this.v2).sub(this.v1),l.multiplyScalar(n).add(this.v1)),l}getPointAt(n,r){return this.getPoint(n,r)}getTangent(n,r){const l=r||new st;return l.copy(this.v2).sub(this.v1).normalize(),l}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}ba.prototype.isLineCurve=!0;class fd extends Uo{constructor(n=new Oe,r=new Oe){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=n,this.v2=r}getPoint(n,r=new Oe){const l=r;return 1===n?l.copy(this.v2):(l.copy(this.v2).sub(this.v1),l.multiplyScalar(n).add(this.v1)),l}getPointAt(n,r){return this.getPoint(n,r)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class cu extends Uo{constructor(n=new st,r=new st,l=new st){super(),this.type="QuadraticBezierCurve",this.v0=n,this.v1=r,this.v2=l}getPoint(n,r=new st){const l=r,c=this.v0,f=this.v1,m=this.v2;return l.set(lu(n,c.x,f.x,m.x),lu(n,c.y,f.y,m.y)),l}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}cu.prototype.isQuadraticBezierCurve=!0;class uu extends Uo{constructor(n=new Oe,r=new Oe,l=new Oe){super(),this.type="QuadraticBezierCurve3",this.v0=n,this.v1=r,this.v2=l}getPoint(n,r=new Oe){const l=r,c=this.v0,f=this.v1,m=this.v2;return l.set(lu(n,c.x,f.x,m.x),lu(n,c.y,f.y,m.y),lu(n,c.z,f.z,m.z)),l}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}uu.prototype.isQuadraticBezierCurve3=!0;class eh extends Uo{constructor(n=[]){super(),this.type="SplineCurve",this.points=n}getPoint(n,r=new st){const l=r,c=this.points,f=(c.length-1)*n,m=Math.floor(f),g=f-m,C=c[0===m?m:m-1],L=c[m],G=c[m>c.length-2?c.length-1:m+1],z=c[m>c.length-3?c.length-1:m+2];return l.set(mg(g,C.x,L.x,G.x,z.x),mg(g,C.y,L.y,G.y,z.y)),l}copy(n){super.copy(n),this.points=[];for(let r=0,l=n.points.length;r<l;r++)this.points.push(n.points[r].clone());return this}toJSON(){const n=super.toJSON();n.points=[];for(let r=0,l=this.points.length;r<l;r++)n.points.push(this.points[r].toArray());return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let r=0,l=n.points.length;r<l;r++){const c=n.points[r];this.points.push((new st).fromArray(c))}return this}}eh.prototype.isSplineCurve=!0;var th=Object.freeze({__proto__:null,ArcCurve:Qp,CatmullRomCurve3:Ju,CubicBezierCurve:jl,CubicBezierCurve3:$u,EllipseCurve:cd,LineCurve:ba,LineCurve3:fd,QuadraticBezierCurve:cu,QuadraticBezierCurve3:uu,SplineCurve:eh});class $p extends Uo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(n){this.curves.push(n)}closePath(){const n=this.curves[0].getPoint(0),r=this.curves[this.curves.length-1].getPoint(1);n.equals(r)||this.curves.push(new ba(r,n))}getPoint(n,r){const l=n*this.getLength(),c=this.getCurveLengths();let f=0;for(;f<c.length;){if(c[f]>=l){const m=c[f]-l,g=this.curves[f],C=g.getLength();return g.getPointAt(0===C?0:1-m/C,r)}f++}return null}getLength(){const n=this.getCurveLengths();return n[n.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let r=0;for(let l=0,c=this.curves.length;l<c;l++)r+=this.curves[l].getLength(),n.push(r);return this.cacheLengths=n,n}getSpacedPoints(n=40){const r=[];for(let l=0;l<=n;l++)r.push(this.getPoint(l/n));return this.autoClose&&r.push(r[0]),r}getPoints(n=12){const r=[];let l;for(let c=0,f=this.curves;c<f.length;c++){const m=f[c],C=m.getPoints(m&&m.isEllipseCurve?2*n:m&&(m.isLineCurve||m.isLineCurve3)?1:m&&m.isSplineCurve?n*m.points.length:n);for(let L=0;L<C.length;L++){const G=C[L];l&&l.equals(G)||(r.push(G),l=G)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(n){super.copy(n),this.curves=[];for(let r=0,l=n.curves.length;r<l;r++)this.curves.push(n.curves[r].clone());return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let r=0,l=this.curves.length;r<l;r++)n.curves.push(this.curves[r].toJSON());return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let r=0,l=n.curves.length;r<l;r++){const c=n.curves[r];this.curves.push((new th[c.type]).fromJSON(c))}return this}}class da extends $p{constructor(n){super(),this.type="Path",this.currentPoint=new st,n&&this.setFromPoints(n)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let r=1,l=n.length;r<l;r++)this.lineTo(n[r].x,n[r].y);return this}moveTo(n,r){return this.currentPoint.set(n,r),this}lineTo(n,r){const l=new ba(this.currentPoint.clone(),new st(n,r));return this.curves.push(l),this.currentPoint.set(n,r),this}quadraticCurveTo(n,r,l,c){const f=new cu(this.currentPoint.clone(),new st(n,r),new st(l,c));return this.curves.push(f),this.currentPoint.set(l,c),this}bezierCurveTo(n,r,l,c,f,m){const g=new jl(this.currentPoint.clone(),new st(n,r),new st(l,c),new st(f,m));return this.curves.push(g),this.currentPoint.set(f,m),this}splineThru(n){const r=[this.currentPoint.clone()].concat(n),l=new eh(r);return this.curves.push(l),this.currentPoint.copy(n[n.length-1]),this}arc(n,r,l,c,f,m){return this.absarc(n+this.currentPoint.x,r+this.currentPoint.y,l,c,f,m),this}absarc(n,r,l,c,f,m){return this.absellipse(n,r,l,l,c,f,m),this}ellipse(n,r,l,c,f,m,g,C){return this.absellipse(n+this.currentPoint.x,r+this.currentPoint.y,l,c,f,m,g,C),this}absellipse(n,r,l,c,f,m,g,C){const L=new cd(n,r,l,c,f,m,g,C);if(this.curves.length>0){const z=L.getPoint(0);z.equals(this.currentPoint)||this.lineTo(z.x,z.y)}this.curves.push(L);const G=L.getPoint(1);return this.currentPoint.copy(G),this}copy(n){return super.copy(n),this.currentPoint.copy(n.currentPoint),this}toJSON(){const n=super.toJSON();return n.currentPoint=this.currentPoint.toArray(),n}fromJSON(n){return super.fromJSON(n),this.currentPoint.fromArray(n.currentPoint),this}}class fl extends da{constructor(n){super(n),this.uuid=Xo(),this.type="Shape",this.holes=[]}getPointsHoles(n){const r=[];for(let l=0,c=this.holes.length;l<c;l++)r[l]=this.holes[l].getPoints(n);return r}extractPoints(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}}copy(n){super.copy(n),this.holes=[];for(let r=0,l=n.holes.length;r<l;r++)this.holes.push(n.holes[r].clone());return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let r=0,l=this.holes.length;r<l;r++)n.holes.push(this.holes[r].toJSON());return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let r=0,l=n.holes.length;r<l;r++){const c=n.holes[r];this.holes.push((new da).fromJSON(c))}return this}}const gg_triangulate=function(h,n,r=2){const l=n&&n.length,c=l?n[0]*r:h.length;let f=Yl(h,0,c,r,!0);const m=[];if(!f||f.next===f.prev)return m;let g,C,L,G,z,X,Q;if(l&&(f=function(h,n,r,l){const c=[];let f,m,g,C,L;for(f=0,m=n.length;f<m;f++)g=n[f]*l,C=f<m-1?n[f+1]*l:h.length,L=Yl(h,g,C,l,!1),L===L.next&&(L.steiner=!0),c.push(nh(L));for(c.sort(Cx),f=0;f<c.length;f++)Rx(c[f],r),r=Ea(r,r.next);return r}(h,n,f,r)),h.length>80*r){g=L=h[0],C=G=h[1];for(let re=r;re<c;re+=r)z=h[re],X=h[re+1],z<g&&(g=z),X<C&&(C=X),z>L&&(L=z),X>G&&(G=X);Q=Math.max(L-g,G-C),Q=0!==Q?1/Q:0}return pd(f,m,r,g,C,Q),m};function Yl(h,n,r,l,c){let f,m;if(c===function(h,n,r,l){let c=0;for(let f=n,m=r-l;f<r;f+=l)c+=(h[m]-h[f])*(h[f+1]+h[m+1]),m=f;return c}(h,n,r,l)>0)for(f=n;f<r;f+=l)m=rh(f,h[f],h[f+1],m);else for(f=r-l;f>=n;f-=l)m=rh(f,h[f],h[f+1],m);return m&&md(m,m.next)&&(du(m),m=m.next),m}function Ea(h,n){if(!h)return h;n||(n=h);let l,r=h;do{if(l=!1,r.steiner||!md(r,r.next)&&0!==Rs(r.prev,r,r.next))r=r.next;else{if(du(r),r=n=r.prev,r===r.next)break;l=!0}}while(l||r!==n);return n}function pd(h,n,r,l,c,f,m){if(!h)return;!m&&f&&function(h,n,r,l){let c=h;do{null===c.z&&(c.z=tm(c.x,c.y,n,r,l)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next}while(c!==h);c.prevZ.nextZ=null,c.prevZ=null,function(h){let n,r,l,c,f,m,g,C,L=1;do{for(r=h,h=null,f=null,m=0;r;){for(m++,l=r,g=0,n=0;n<L&&(g++,l=l.nextZ,l);n++);for(C=L;g>0||C>0&&l;)0!==g&&(0===C||!l||r.z<=l.z)?(c=r,r=r.nextZ,g--):(c=l,l=l.nextZ,C--),f?f.nextZ=c:h=c,c.prevZ=f,f=c;r=l}f.nextZ=null,L*=2}while(m>1)}(c)}(h,l,c,f);let C,L,g=h;for(;h.prev!==h.next;)if(C=h.prev,L=h.next,f?_x(h,l,c,f):wx(h))n.push(C.i/r),n.push(h.i/r),n.push(L.i/r),du(h),h=L.next,g=L.next;else if((h=L)===g){m?1===m?pd(h=Mx(Ea(h),n,r),n,r,l,c,f,2):2===m&&Tx(h,n,r,l,c,f):pd(Ea(h),n,r,l,c,f,1);break}}function wx(h){const n=h.prev,r=h,l=h.next;if(Rs(n,r,l)>=0)return!1;let c=h.next.next;for(;c!==h.prev;){if(ih(n.x,n.y,r.x,r.y,l.x,l.y,c.x,c.y)&&Rs(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function _x(h,n,r,l){const c=h.prev,f=h,m=h.next;if(Rs(c,f,m)>=0)return!1;const L=c.x>f.x?c.x>m.x?c.x:m.x:f.x>m.x?f.x:m.x,G=c.y>f.y?c.y>m.y?c.y:m.y:f.y>m.y?f.y:m.y,z=tm(c.x<f.x?c.x<m.x?c.x:m.x:f.x<m.x?f.x:m.x,c.y<f.y?c.y<m.y?c.y:m.y:f.y<m.y?f.y:m.y,n,r,l),X=tm(L,G,n,r,l);let Q=h.prevZ,re=h.nextZ;for(;Q&&Q.z>=z&&re&&re.z<=X;){if(Q!==h.prev&&Q!==h.next&&ih(c.x,c.y,f.x,f.y,m.x,m.y,Q.x,Q.y)&&Rs(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,re!==h.prev&&re!==h.next&&ih(c.x,c.y,f.x,f.y,m.x,m.y,re.x,re.y)&&Rs(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;Q&&Q.z>=z;){if(Q!==h.prev&&Q!==h.next&&ih(c.x,c.y,f.x,f.y,m.x,m.y,Q.x,Q.y)&&Rs(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;re&&re.z<=X;){if(re!==h.prev&&re!==h.next&&ih(c.x,c.y,f.x,f.y,m.x,m.y,re.x,re.y)&&Rs(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function Mx(h,n,r){let l=h;do{const c=l.prev,f=l.next.next;!md(c,f)&&gd(c,l,l.next,f)&&yd(c,f)&&yd(f,c)&&(n.push(c.i/r),n.push(l.i/r),n.push(f.i/r),du(l),du(l.next),l=h=f),l=l.next}while(l!==h);return Ea(l)}function Tx(h,n,r,l,c,f){let m=h;do{let g=m.next.next;for(;g!==m.prev;){if(m.i!==g.i&&Qs(m,g)){let C=nm(m,g);return m=Ea(m,m.next),C=Ea(C,C.next),pd(m,n,r,l,c,f),void pd(C,n,r,l,c,f)}g=g.next}m=m.next}while(m!==h)}function Cx(h,n){return h.x-n.x}function Rx(h,n){if(n=function(h,n){let r=n;const l=h.x,c=h.y;let m,f=-1/0;do{if(c<=r.y&&c>=r.next.y&&r.next.y!==r.y){const X=r.x+(c-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(X<=l&&X>f){if(f=X,X===l){if(c===r.y)return r;if(c===r.next.y)return r.next}m=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!m)return null;if(l===f)return m;const g=m,C=m.x,L=m.y;let z,G=1/0;r=m;do{l>=r.x&&r.x>=C&&l!==r.x&&ih(c<L?l:f,c,C,L,c<L?f:l,c,r.x,r.y)&&(z=Math.abs(c-r.y)/(l-r.x),yd(r,h)&&(z<G||z===G&&(r.x>m.x||r.x===m.x&&Dx(m,r)))&&(m=r,G=z)),r=r.next}while(r!==g);return m}(h,n)){const r=nm(n,h);Ea(n,n.next),Ea(r,r.next)}}function Dx(h,n){return Rs(h.prev,h,n.prev)<0&&Rs(n.next,h,h.next)<0}function tm(h,n,r,l,c){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-r)*c)|h<<8))|h<<4))|h<<2))|h<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*c)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function nh(h){let n=h,r=h;do{(n.x<r.x||n.x===r.x&&n.y<r.y)&&(r=n),n=n.next}while(n!==h);return r}function ih(h,n,r,l,c,f,m,g){return(c-m)*(n-g)-(h-m)*(f-g)>=0&&(h-m)*(l-g)-(r-m)*(n-g)>=0&&(r-m)*(f-g)-(c-m)*(l-g)>=0}function Qs(h,n){return h.next.i!==n.i&&h.prev.i!==n.i&&!function(h,n){let r=h;do{if(r.i!==h.i&&r.next.i!==h.i&&r.i!==n.i&&r.next.i!==n.i&&gd(r,r.next,h,n))return!0;r=r.next}while(r!==h);return!1}(h,n)&&(yd(h,n)&&yd(n,h)&&function(h,n){let r=h,l=!1;const c=(h.x+n.x)/2,f=(h.y+n.y)/2;do{r.y>f!=r.next.y>f&&r.next.y!==r.y&&c<(r.next.x-r.x)*(f-r.y)/(r.next.y-r.y)+r.x&&(l=!l),r=r.next}while(r!==h);return l}(h,n)&&(Rs(h.prev,h,n.prev)||Rs(h,n.prev,n))||md(h,n)&&Rs(h.prev,h,h.next)>0&&Rs(n.prev,n,n.next)>0)}function Rs(h,n,r){return(n.y-h.y)*(r.x-n.x)-(n.x-h.x)*(r.y-n.y)}function md(h,n){return h.x===n.x&&h.y===n.y}function gd(h,n,r,l){const c=vf(Rs(h,n,r)),f=vf(Rs(h,n,l)),m=vf(Rs(r,l,h)),g=vf(Rs(r,l,n));return!!(c!==f&&m!==g||0===c&&hu(h,r,n)||0===f&&hu(h,l,n)||0===m&&hu(r,h,l)||0===g&&hu(r,n,l))}function hu(h,n,r){return n.x<=Math.max(h.x,r.x)&&n.x>=Math.min(h.x,r.x)&&n.y<=Math.max(h.y,r.y)&&n.y>=Math.min(h.y,r.y)}function vf(h){return h>0?1:h<0?-1:0}function yd(h,n){return Rs(h.prev,h,h.next)<0?Rs(h,n,h.next)>=0&&Rs(h,h.prev,n)>=0:Rs(h,n,h.prev)<0||Rs(h,h.next,n)<0}function nm(h,n){const r=new im(h.i,h.x,h.y),l=new im(n.i,n.x,n.y),c=h.next,f=n.prev;return h.next=n,n.prev=h,r.next=c,c.prev=r,l.next=r,r.prev=l,f.next=l,l.prev=f,l}function rh(h,n,r,l){const c=new im(h,n,r);return l?(c.next=l.next,c.prev=l,l.next.prev=c,l.next=c):(c.prev=c,c.next=c),c}function du(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function im(h,n,r){this.i=h,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class za{static area(n){const r=n.length;let l=0;for(let c=r-1,f=0;f<r;c=f++)l+=n[c].x*n[f].y-n[f].x*n[c].y;return.5*l}static isClockWise(n){return za.area(n)<0}static triangulateShape(n,r){const l=[],c=[],f=[];rm(n),Zl(l,n);let m=n.length;r.forEach(rm);for(let C=0;C<r.length;C++)c.push(m),m+=r[C].length,Zl(l,r[C]);const g=gg_triangulate(l,c);for(let C=0;C<g.length;C+=3)f.push(g.slice(C,C+3));return f}}function rm(h){const n=h.length;n>2&&h[n-1].equals(h[0])&&h.pop()}function Zl(h,n){for(let r=0;r<n.length;r++)h.push(n[r].x),h.push(n[r].y)}class pl extends ji{constructor(n=new fl([new st(.5,.5),new st(-.5,.5),new st(-.5,-.5),new st(.5,-.5)]),r={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:r},n=Array.isArray(n)?n:[n];const l=this,c=[],f=[];for(let g=0,C=n.length;g<C;g++)m(n[g]);function m(g){const C=[],L=void 0!==r.curveSegments?r.curveSegments:12,G=void 0!==r.steps?r.steps:1;let z=void 0!==r.depth?r.depth:1,X=void 0===r.bevelEnabled||r.bevelEnabled,Q=void 0!==r.bevelThickness?r.bevelThickness:.2,re=void 0!==r.bevelSize?r.bevelSize:Q-.1,ue=void 0!==r.bevelOffset?r.bevelOffset:0,Te=void 0!==r.bevelSegments?r.bevelSegments:3;const se=r.extrudePath,J=void 0!==r.UVGenerator?r.UVGenerator:Ix;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),z=r.amount);let Be,Ve,Ze,dt,yt,be=!1;se&&(Be=se.getSpacedPoints(G),be=!0,X=!1,Ve=se.computeFrenetFrames(G,!1),Ze=new Oe,dt=new Oe,yt=new Oe),X||(Te=0,Q=0,re=0,ue=0);const It=g.extractPoints(L);let Ht=It.shape;const _e=It.holes;if(!za.isClockWise(Ht)){Ht=Ht.reverse();for(let an=0,Yn=_e.length;an<Yn;an++){const Gn=_e[an];za.isClockWise(Gn)&&(_e[an]=Gn.reverse())}}const Et=za.triangulateShape(Ht,_e),Mt=Ht;for(let an=0,Yn=_e.length;an<Yn;an++)Ht=Ht.concat(_e[an]);function At(an,Yn,Gn){return Yn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Yn.clone().multiplyScalar(Gn).add(an)}const Ft=Ht.length,en=Et.length;function Cn(an,Yn,Gn){let Ai,ai,nr;const Qi=an.x-Yn.x,zr=an.y-Yn.y,Ds=Gn.x-an.x,ys=Gn.y-an.y,et=Qi*Qi+zr*zr;if(Math.abs(Qi*ys-zr*Ds)>Number.EPSILON){const tn=Math.sqrt(et),Qn=Math.sqrt(Ds*Ds+ys*ys),Pi=Yn.x-zr/tn,nn=Yn.y+Qi/tn,si=((Gn.x-ys/Qn-Pi)*ys-(Gn.y+Ds/Qn-nn)*Ds)/(Qi*ys-zr*Ds);Ai=Pi+Qi*si-an.x,ai=nn+zr*si-an.y;const ni=Ai*Ai+ai*ai;if(ni<=2)return new st(Ai,ai);nr=Math.sqrt(ni/2)}else{let tn=!1;Qi>Number.EPSILON?Ds>Number.EPSILON&&(tn=!0):Qi<-Number.EPSILON?Ds<-Number.EPSILON&&(tn=!0):Math.sign(zr)===Math.sign(ys)&&(tn=!0),tn?(Ai=-zr,ai=Qi,nr=Math.sqrt(et)):(Ai=Qi,ai=zr,nr=Math.sqrt(et/2))}return new st(Ai/nr,ai/nr)}const xi=[];for(let an=0,Yn=Mt.length,Gn=Yn-1,Ai=an+1;an<Yn;an++,Gn++,Ai++)Gn===Yn&&(Gn=0),Ai===Yn&&(Ai=0),xi[an]=Cn(Mt[an],Mt[Gn],Mt[Ai]);const Di=[];let ci,hn=xi.concat();for(let an=0,Yn=_e.length;an<Yn;an++){const Gn=_e[an];ci=[];for(let Ai=0,ai=Gn.length,nr=ai-1,Qi=Ai+1;Ai<ai;Ai++,nr++,Qi++)nr===ai&&(nr=0),Qi===ai&&(Qi=0),ci[Ai]=Cn(Gn[Ai],Gn[nr],Gn[Qi]);Di.push(ci),hn=hn.concat(ci)}for(let an=0;an<Te;an++){const Yn=an/Te,Gn=Q*Math.cos(Yn*Math.PI/2),Ai=re*Math.sin(Yn*Math.PI/2)+ue;for(let ai=0,nr=Mt.length;ai<nr;ai++){const Qi=At(Mt[ai],xi[ai],Ai);pi(Qi.x,Qi.y,-Gn)}for(let ai=0,nr=_e.length;ai<nr;ai++){const Qi=_e[ai];ci=Di[ai];for(let zr=0,Ds=Qi.length;zr<Ds;zr++){const ys=At(Qi[zr],ci[zr],Ai);pi(ys.x,ys.y,-Gn)}}}const Zn=re+ue;for(let an=0;an<Ft;an++){const Yn=X?At(Ht[an],hn[an],Zn):Ht[an];be?(dt.copy(Ve.normals[0]).multiplyScalar(Yn.x),Ze.copy(Ve.binormals[0]).multiplyScalar(Yn.y),yt.copy(Be[0]).add(dt).add(Ze),pi(yt.x,yt.y,yt.z)):pi(Yn.x,Yn.y,0)}for(let an=1;an<=G;an++)for(let Yn=0;Yn<Ft;Yn++){const Gn=X?At(Ht[Yn],hn[Yn],Zn):Ht[Yn];be?(dt.copy(Ve.normals[an]).multiplyScalar(Gn.x),Ze.copy(Ve.binormals[an]).multiplyScalar(Gn.y),yt.copy(Be[an]).add(dt).add(Ze),pi(yt.x,yt.y,yt.z)):pi(Gn.x,Gn.y,z/G*an)}for(let an=Te-1;an>=0;an--){const Yn=an/Te,Gn=Q*Math.cos(Yn*Math.PI/2),Ai=re*Math.sin(Yn*Math.PI/2)+ue;for(let ai=0,nr=Mt.length;ai<nr;ai++){const Qi=At(Mt[ai],xi[ai],Ai);pi(Qi.x,Qi.y,z+Gn)}for(let ai=0,nr=_e.length;ai<nr;ai++){const Qi=_e[ai];ci=Di[ai];for(let zr=0,Ds=Qi.length;zr<Ds;zr++){const ys=At(Qi[zr],ci[zr],Ai);be?pi(ys.x,ys.y+Be[G-1].y,Be[G-1].x+Gn):pi(ys.x,ys.y,z+Gn)}}}function Vi(an,Yn){let Gn=an.length;for(;--Gn>=0;){const Ai=Gn;let ai=Gn-1;ai<0&&(ai=an.length-1);for(let nr=0,Qi=G+2*Te;nr<Qi;nr++){const zr=Ft*nr,Ds=Ft*(nr+1);ui(Yn+Ai+zr,Yn+ai+zr,Yn+ai+Ds,Yn+Ai+Ds)}}}function pi(an,Yn,Gn){C.push(an),C.push(Yn),C.push(Gn)}function ki(an,Yn,Gn){dr(an),dr(Yn),dr(Gn);const Ai=c.length/3,ai=J.generateTopUV(l,c,Ai-3,Ai-2,Ai-1);Yi(ai[0]),Yi(ai[1]),Yi(ai[2])}function ui(an,Yn,Gn,Ai){dr(an),dr(Yn),dr(Ai),dr(Yn),dr(Gn),dr(Ai);const ai=c.length/3,nr=J.generateSideWallUV(l,c,ai-6,ai-3,ai-2,ai-1);Yi(nr[0]),Yi(nr[1]),Yi(nr[3]),Yi(nr[1]),Yi(nr[2]),Yi(nr[3])}function dr(an){c.push(C[3*an+0]),c.push(C[3*an+1]),c.push(C[3*an+2])}function Yi(an){f.push(an.x),f.push(an.y)}(function(){const an=c.length/3;if(X){let Yn=0,Gn=Ft*Yn;for(let Ai=0;Ai<en;Ai++){const ai=Et[Ai];ki(ai[2]+Gn,ai[1]+Gn,ai[0]+Gn)}Yn=G+2*Te,Gn=Ft*Yn;for(let Ai=0;Ai<en;Ai++){const ai=Et[Ai];ki(ai[0]+Gn,ai[1]+Gn,ai[2]+Gn)}}else{for(let Yn=0;Yn<en;Yn++){const Gn=Et[Yn];ki(Gn[2],Gn[1],Gn[0])}for(let Yn=0;Yn<en;Yn++){const Gn=Et[Yn];ki(Gn[0]+Ft*G,Gn[1]+Ft*G,Gn[2]+Ft*G)}}l.addGroup(an,c.length/3-an,0)})(),function(){const an=c.length/3;let Yn=0;Vi(Mt,Yn),Yn+=Mt.length;for(let Gn=0,Ai=_e.length;Gn<Ai;Gn++){const ai=_e[Gn];Vi(ai,Yn),Yn+=ai.length}l.addGroup(an,c.length/3-an,1)}()}this.setAttribute("position",new Mi(c,3)),this.setAttribute("uv",new Mi(f,2)),this.computeVertexNormals()}toJSON(){const n=super.toJSON();return function(h,n,r){if(r.shapes=[],Array.isArray(h))for(let l=0,c=h.length;l<c;l++)r.shapes.push(h[l].uuid);else r.shapes.push(h.uuid);return void 0!==n.extrudePath&&(r.options.extrudePath=n.extrudePath.toJSON()),r}(this.parameters.shapes,this.parameters.options,n)}static fromJSON(n,r){const l=[];for(let f=0,m=n.shapes.length;f<m;f++)l.push(r[n.shapes[f]]);const c=n.options.extrudePath;return void 0!==c&&(n.options.extrudePath=(new th[c.type]).fromJSON(c)),new pl(l,n.options)}}const Ix={generateTopUV:function(h,n,r,l,c){const g=n[3*l],C=n[3*l+1],L=n[3*c],G=n[3*c+1];return[new st(n[3*r],n[3*r+1]),new st(g,C),new st(L,G)]},generateSideWallUV:function(h,n,r,l,c,f){const m=n[3*r],g=n[3*r+1],C=n[3*r+2],L=n[3*l],G=n[3*l+1],z=n[3*l+2],X=n[3*c],Q=n[3*c+1],re=n[3*c+2],ue=n[3*f],Te=n[3*f+1],se=n[3*f+2];return Math.abs(g-G)<Math.abs(m-L)?[new st(m,1-C),new st(L,1-z),new st(X,1-re),new st(ue,1-se)]:[new st(g,1-C),new st(G,1-z),new st(Q,1-re),new st(Te,1-se)]}};class ml extends Aa{constructor(n=1,r=0){const l=(1+Math.sqrt(5))/2;super([-1,l,0,1,l,0,-1,-l,0,1,-l,0,0,-1,l,0,1,l,0,-1,-l,0,1,-l,l,0,-1,l,0,1,-l,0,-1,-l,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n,r),this.type="IcosahedronGeometry",this.parameters={radius:n,detail:r}}static fromJSON(n){return new ml(n.radius,n.detail)}}class ql extends ji{constructor(n=[new st(0,.5),new st(.5,0),new st(0,-.5)],r=12,l=0,c=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:n,segments:r,phiStart:l,phiLength:c},r=Math.floor(r),c=Po(c,0,2*Math.PI);const f=[],m=[],g=[],C=[],L=[],G=1/r,z=new Oe,X=new st,Q=new Oe,re=new Oe,ue=new Oe;let Te=0,se=0;for(let J=0;J<=n.length-1;J++)switch(J){case 0:Te=n[J+1].x-n[J].x,se=n[J+1].y-n[J].y,Q.x=1*se,Q.y=-Te,Q.z=0*se,ue.copy(Q),Q.normalize(),C.push(Q.x,Q.y,Q.z);break;case n.length-1:C.push(ue.x,ue.y,ue.z);break;default:Te=n[J+1].x-n[J].x,se=n[J+1].y-n[J].y,Q.x=1*se,Q.y=-Te,Q.z=0*se,re.copy(Q),Q.x+=ue.x,Q.y+=ue.y,Q.z+=ue.z,Q.normalize(),C.push(Q.x,Q.y,Q.z),ue.copy(re)}for(let J=0;J<=r;J++){const Be=l+J*G*c,be=Math.sin(Be),Ve=Math.cos(Be);for(let Ze=0;Ze<=n.length-1;Ze++)z.x=n[Ze].x*be,z.y=n[Ze].y,z.z=n[Ze].x*Ve,m.push(z.x,z.y,z.z),X.x=J/r,X.y=Ze/(n.length-1),g.push(X.x,X.y),L.push(C[3*Ze+0]*be,C[3*Ze+1],C[3*Ze+0]*Ve)}for(let J=0;J<r;J++)for(let Be=0;Be<n.length-1;Be++){const be=Be+J*n.length,Ze=be+n.length,dt=be+n.length+1,yt=be+1;f.push(be,Ze,yt),f.push(dt,yt,Ze)}this.setIndex(f),this.setAttribute("position",new Mi(m,3)),this.setAttribute("uv",new Mi(g,2)),this.setAttribute("normal",new Mi(L,3))}static fromJSON(n){return new ql(n.points,n.segments,n.phiStart,n.phiLength)}}class Va extends Aa{constructor(n=1,r=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],n,r),this.type="OctahedronGeometry",this.parameters={radius:n,detail:r}}static fromJSON(n){return new Va(n.radius,n.detail)}}class sh extends ji{constructor(n=.5,r=1,l=8,c=1,f=0,m=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:n,outerRadius:r,thetaSegments:l,phiSegments:c,thetaStart:f,thetaLength:m},l=Math.max(3,l);const g=[],C=[],L=[],G=[];let z=n;const X=(r-n)/(c=Math.max(1,c)),Q=new Oe,re=new st;for(let ue=0;ue<=c;ue++){for(let Te=0;Te<=l;Te++){const se=f+Te/l*m;Q.x=z*Math.cos(se),Q.y=z*Math.sin(se),C.push(Q.x,Q.y,Q.z),L.push(0,0,1),re.x=(Q.x/r+1)/2,re.y=(Q.y/r+1)/2,G.push(re.x,re.y)}z+=X}for(let ue=0;ue<c;ue++){const Te=ue*(l+1);for(let se=0;se<l;se++){const J=se+Te,be=J+l+1,Ve=J+l+2,Ze=J+1;g.push(J,be,Ze),g.push(be,Ve,Ze)}}this.setIndex(g),this.setAttribute("position",new Mi(C,3)),this.setAttribute("normal",new Mi(L,3)),this.setAttribute("uv",new Mi(G,2))}static fromJSON(n){return new sh(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)}}class Wa extends ji{constructor(n=new fl([new st(0,.5),new st(-.5,-.5),new st(.5,-.5)]),r=12){super(),this.type="ShapeGeometry",this.parameters={shapes:n,curveSegments:r};const l=[],c=[],f=[],m=[];let g=0,C=0;if(!1===Array.isArray(n))L(n);else for(let G=0;G<n.length;G++)L(n[G]),this.addGroup(g,C,G),g+=C,C=0;function L(G){const z=c.length/3,X=G.extractPoints(r);let Q=X.shape;const re=X.holes;!1===za.isClockWise(Q)&&(Q=Q.reverse());for(let Te=0,se=re.length;Te<se;Te++){const J=re[Te];!0===za.isClockWise(J)&&(re[Te]=J.reverse())}const ue=za.triangulateShape(Q,re);for(let Te=0,se=re.length;Te<se;Te++)Q=Q.concat(re[Te]);for(let Te=0,se=Q.length;Te<se;Te++){const J=Q[Te];c.push(J.x,J.y,0),f.push(0,0,1),m.push(J.x,J.y)}for(let Te=0,se=ue.length;Te<se;Te++){const J=ue[Te];l.push(J[0]+z,J[1]+z,J[2]+z),C+=3}}this.setIndex(l),this.setAttribute("position",new Mi(c,3)),this.setAttribute("normal",new Mi(f,3)),this.setAttribute("uv",new Mi(m,2))}toJSON(){const n=super.toJSON();return function(h,n){if(n.shapes=[],Array.isArray(h))for(let r=0,l=h.length;r<l;r++)n.shapes.push(h[r].uuid);else n.shapes.push(h.uuid);return n}(this.parameters.shapes,n)}static fromJSON(n,r){const l=[];for(let c=0,f=n.shapes.length;c<f;c++)l.push(r[n.shapes[c]]);return new Wa(l,n.curveSegments)}}class gl extends ji{constructor(n=1,r=32,l=16,c=0,f=2*Math.PI,m=0,g=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:r,heightSegments:l,phiStart:c,phiLength:f,thetaStart:m,thetaLength:g},r=Math.max(3,Math.floor(r)),l=Math.max(2,Math.floor(l));const C=Math.min(m+g,Math.PI);let L=0;const G=[],z=new Oe,X=new Oe,Q=[],re=[],ue=[],Te=[];for(let se=0;se<=l;se++){const J=[],Be=se/l;let be=0;0==se&&0==m?be=.5/r:se==l&&C==Math.PI&&(be=-.5/r);for(let Ve=0;Ve<=r;Ve++){const Ze=Ve/r;z.x=-n*Math.cos(c+Ze*f)*Math.sin(m+Be*g),z.y=n*Math.cos(m+Be*g),z.z=n*Math.sin(c+Ze*f)*Math.sin(m+Be*g),re.push(z.x,z.y,z.z),X.copy(z).normalize(),ue.push(X.x,X.y,X.z),Te.push(Ze+be,1-Be),J.push(L++)}G.push(J)}for(let se=0;se<l;se++)for(let J=0;J<r;J++){const Be=G[se][J+1],be=G[se][J],Ve=G[se+1][J],Ze=G[se+1][J+1];(0!==se||m>0)&&Q.push(Be,be,Ze),(se!==l-1||C<Math.PI)&&Q.push(be,Ve,Ze)}this.setIndex(Q),this.setAttribute("position",new Mi(re,3)),this.setAttribute("normal",new Mi(ue,3)),this.setAttribute("uv",new Mi(Te,2))}static fromJSON(n){return new gl(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)}}class Kl extends Aa{constructor(n=1,r=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],n,r),this.type="TetrahedronGeometry",this.parameters={radius:n,detail:r}}static fromJSON(n){return new Kl(n.radius,n.detail)}}class Jl extends ji{constructor(n=1,r=.4,l=8,c=6,f=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:r,radialSegments:l,tubularSegments:c,arc:f},l=Math.floor(l),c=Math.floor(c);const m=[],g=[],C=[],L=[],G=new Oe,z=new Oe,X=new Oe;for(let Q=0;Q<=l;Q++)for(let re=0;re<=c;re++){const ue=re/c*f,Te=Q/l*Math.PI*2;z.x=(n+r*Math.cos(Te))*Math.cos(ue),z.y=(n+r*Math.cos(Te))*Math.sin(ue),z.z=r*Math.sin(Te),g.push(z.x,z.y,z.z),G.x=n*Math.cos(ue),G.y=n*Math.sin(ue),X.subVectors(z,G).normalize(),C.push(X.x,X.y,X.z),L.push(re/c),L.push(Q/l)}for(let Q=1;Q<=l;Q++)for(let re=1;re<=c;re++){const Te=(c+1)*(Q-1)+re-1,se=(c+1)*(Q-1)+re,J=(c+1)*Q+re;m.push((c+1)*Q+re-1,Te,J),m.push(Te,se,J)}this.setIndex(m),this.setAttribute("position",new Mi(g,3)),this.setAttribute("normal",new Mi(C,3)),this.setAttribute("uv",new Mi(L,2))}static fromJSON(n){return new Jl(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)}}class fu extends ji{constructor(n=1,r=.4,l=64,c=8,f=2,m=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:n,tube:r,tubularSegments:l,radialSegments:c,p:f,q:m},l=Math.floor(l),c=Math.floor(c);const g=[],C=[],L=[],G=[],z=new Oe,X=new Oe,Q=new Oe,re=new Oe,ue=new Oe,Te=new Oe,se=new Oe;for(let Be=0;Be<=l;++Be){const be=Be/l*f*Math.PI*2;J(be,f,m,n,Q),J(be+.01,f,m,n,re),Te.subVectors(re,Q),se.addVectors(re,Q),ue.crossVectors(Te,se),se.crossVectors(ue,Te),ue.normalize(),se.normalize();for(let Ve=0;Ve<=c;++Ve){const Ze=Ve/c*Math.PI*2,dt=-r*Math.cos(Ze),yt=r*Math.sin(Ze);z.x=Q.x+(dt*se.x+yt*ue.x),z.y=Q.y+(dt*se.y+yt*ue.y),z.z=Q.z+(dt*se.z+yt*ue.z),C.push(z.x,z.y,z.z),X.subVectors(z,Q).normalize(),L.push(X.x,X.y,X.z),G.push(Be/l),G.push(Ve/c)}}for(let Be=1;Be<=l;Be++)for(let be=1;be<=c;be++){const Ze=(c+1)*Be+(be-1),dt=(c+1)*Be+be,yt=(c+1)*(Be-1)+be;g.push((c+1)*(Be-1)+(be-1),Ze,yt),g.push(Ze,dt,yt)}function J(Be,be,Ve,Ze,dt){const yt=Math.cos(Be),It=Math.sin(Be),Ht=Ve/be*Be,_e=Math.cos(Ht);dt.x=Ze*(2+_e)*.5*yt,dt.y=Ze*(2+_e)*It*.5,dt.z=Ze*Math.sin(Ht)*.5}this.setIndex(g),this.setAttribute("position",new Mi(C,3)),this.setAttribute("normal",new Mi(L,3)),this.setAttribute("uv",new Mi(G,2))}static fromJSON(n){return new fu(n.radius,n.tube,n.tubularSegments,n.radialSegments,n.p,n.q)}}class pu extends ji{constructor(n=new uu(new Oe(-1,-1,0),new Oe(-1,1,0),new Oe(1,1,0)),r=64,l=1,c=8,f=!1){super(),this.type="TubeGeometry",this.parameters={path:n,tubularSegments:r,radius:l,radialSegments:c,closed:f};const m=n.computeFrenetFrames(r,f);this.tangents=m.tangents,this.normals=m.normals,this.binormals=m.binormals;const g=new Oe,C=new Oe,L=new st;let G=new Oe;const z=[],X=[],Q=[],re=[];function Te(Be){G=n.getPointAt(Be/r,G);const be=m.normals[Be],Ve=m.binormals[Be];for(let Ze=0;Ze<=c;Ze++){const dt=Ze/c*Math.PI*2,yt=Math.sin(dt),It=-Math.cos(dt);C.x=It*be.x+yt*Ve.x,C.y=It*be.y+yt*Ve.y,C.z=It*be.z+yt*Ve.z,C.normalize(),X.push(C.x,C.y,C.z),g.x=G.x+l*C.x,g.y=G.y+l*C.y,g.z=G.z+l*C.z,z.push(g.x,g.y,g.z)}}(function(){for(let Be=0;Be<r;Be++)Te(Be);Te(!1===f?r:0),function(){for(let Be=0;Be<=r;Be++)for(let be=0;be<=c;be++)L.x=Be/r,L.y=be/c,Q.push(L.x,L.y)}(),function(){for(let Be=1;Be<=r;Be++)for(let be=1;be<=c;be++){const Ze=(c+1)*Be+(be-1),dt=(c+1)*Be+be,yt=(c+1)*(Be-1)+be;re.push((c+1)*(Be-1)+(be-1),Ze,yt),re.push(Ze,dt,yt)}}()})(),this.setIndex(re),this.setAttribute("position",new Mi(z,3)),this.setAttribute("normal",new Mi(X,3)),this.setAttribute("uv",new Mi(Q,2))}toJSON(){const n=super.toJSON();return n.path=this.parameters.path.toJSON(),n}static fromJSON(n){return new pu((new th[n.path.type]).fromJSON(n.path),n.tubularSegments,n.radius,n.radialSegments,n.closed)}}class Af extends ji{constructor(n=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:n},null!==n){const r=[],l=new Set,c=new Oe,f=new Oe;if(null!==n.index){const m=n.attributes.position,g=n.index;let C=n.groups;0===C.length&&(C=[{start:0,count:g.count,materialIndex:0}]);for(let L=0,G=C.length;L<G;++L){const z=C[L],X=z.start;for(let re=X,ue=X+z.count;re<ue;re+=3)for(let Te=0;Te<3;Te++){const se=g.getX(re+Te),J=g.getX(re+(Te+1)%3);c.fromBufferAttribute(m,se),f.fromBufferAttribute(m,J),!0===sm(c,f,l)&&(r.push(c.x,c.y,c.z),r.push(f.x,f.y,f.z))}}}else{const m=n.attributes.position;for(let g=0,C=m.count/3;g<C;g++)for(let L=0;L<3;L++){const z=3*g+(L+1)%3;c.fromBufferAttribute(m,3*g+L),f.fromBufferAttribute(m,z),!0===sm(c,f,l)&&(r.push(c.x,c.y,c.z),r.push(f.x,f.y,f.z))}}this.setAttribute("position",new Mi(r,3))}}}function sm(h,n,r){const l=`${h.x},${h.y},${h.z}-${n.x},${n.y},${n.z}`,c=`${n.x},${n.y},${n.z}-${h.x},${h.y},${h.z}`;return!0!==r.has(l)&&!0!==r.has(c)&&(r.add(l,c),!0)}var om=Object.freeze({__proto__:null,BoxGeometry:ya,BoxBufferGeometry:ya,CircleGeometry:Mc,CircleBufferGeometry:Mc,ConeGeometry:Tc,ConeBufferGeometry:Tc,CylinderGeometry:Ga,CylinderBufferGeometry:Ga,DodecahedronGeometry:Sc,DodecahedronBufferGeometry:Sc,EdgesGeometry:Yp,ExtrudeGeometry:pl,ExtrudeBufferGeometry:pl,IcosahedronGeometry:ml,IcosahedronBufferGeometry:ml,LatheGeometry:ql,LatheBufferGeometry:ql,OctahedronGeometry:Va,OctahedronBufferGeometry:Va,PlaneGeometry:Jc,PlaneBufferGeometry:Jc,PolyhedronGeometry:Aa,PolyhedronBufferGeometry:Aa,RingGeometry:sh,RingBufferGeometry:sh,ShapeGeometry:Wa,ShapeBufferGeometry:Wa,SphereGeometry:gl,SphereBufferGeometry:gl,TetrahedronGeometry:Kl,TetrahedronBufferGeometry:Kl,TorusGeometry:Jl,TorusBufferGeometry:Jl,TorusKnotGeometry:fu,TorusKnotBufferGeometry:fu,TubeGeometry:pu,TubeBufferGeometry:pu,WireframeGeometry:Af});class xd extends js{constructor(n){super(),this.type="ShadowMaterial",this.color=new zn(0),this.transparent=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this}}xd.prototype.isShadowMaterial=!0;class Ad extends js{constructor(n){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new zn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapIntensity=n.envMapIntensity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this}}Ad.prototype.isMeshStandardMaterial=!0;class bf extends Ad{constructor(n){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new st(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Po(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(r){this.ior=(1+.4*r)/(1-.4*r)}}),this.sheenColor=new zn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new zn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(n)}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.ior=n.ior,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}}bf.prototype.isMeshPhysicalMaterial=!0;class Ef extends js{constructor(n){super(),this.type="MeshPhongMaterial",this.color=new zn(16777215),this.specular=new zn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this}}Ef.prototype.isMeshPhongMaterial=!0;class wf extends js{constructor(n){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this}}wf.prototype.isMeshToonMaterial=!0;class _f extends js{constructor(n){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.flatShading=n.flatShading,this}}_f.prototype.isMeshNormalMaterial=!0;class Mf extends js{constructor(n){super(),this.type="MeshLambertMaterial",this.color=new zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this}}Mf.prototype.isMeshLambertMaterial=!0;class Tf extends js{constructor(n){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.flatShading=n.flatShading,this}}Tf.prototype.isMeshMatcapMaterial=!0;class am extends To{constructor(n){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}copy(n){return super.copy(n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this}}am.prototype.isLineDashedMaterial=!0;var zs=Object.freeze({__proto__:null,ShadowMaterial:xd,SpriteMaterial:zl,RawShaderMaterial:Xn,ShaderMaterial:Ul,PointsMaterial:dl,MeshPhysicalMaterial:bf,MeshStandardMaterial:Ad,MeshPhongMaterial:Ef,MeshToonMaterial:wf,MeshNormalMaterial:_f,MeshLambertMaterial:Mf,MeshDepthMaterial:ef,MeshDistanceMaterial:Yu,MeshBasicMaterial:ta,MeshMatcapMaterial:Tf,LineDashedMaterial:am,LineBasicMaterial:To,Material:js});const is={arraySlice:function(h,n,r){return is.isTypedArray(h)?new h.constructor(h.subarray(n,void 0!==r?r:h.length)):h.slice(n,r)},convertArray:function(h,n,r){return!h||!r&&h.constructor===n?h:"number"==typeof n.BYTES_PER_ELEMENT?new n(h):Array.prototype.slice.call(h)},isTypedArray:function(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)},getKeyframeOrder:function(h){const r=h.length,l=new Array(r);for(let c=0;c!==r;++c)l[c]=c;return l.sort(function(c,f){return h[c]-h[f]}),l},sortedArray:function(h,n,r){const l=h.length,c=new h.constructor(l);for(let f=0,m=0;m!==l;++f){const g=r[f]*n;for(let C=0;C!==n;++C)c[m++]=h[g+C]}return c},flattenJSON:function(h,n,r,l){let c=1,f=h[0];for(;void 0!==f&&void 0===f[l];)f=h[c++];if(void 0===f)return;let m=f[l];if(void 0!==m)if(Array.isArray(m))do{m=f[l],void 0!==m&&(n.push(f.time),r.push.apply(r,m)),f=h[c++]}while(void 0!==f);else if(void 0!==m.toArray)do{m=f[l],void 0!==m&&(n.push(f.time),m.toArray(r,r.length)),f=h[c++]}while(void 0!==f);else do{m=f[l],void 0!==m&&(n.push(f.time),r.push(m)),f=h[c++]}while(void 0!==f)},subclip:function(h,n,r,l,c=30){const f=h.clone();f.name=n;const m=[];for(let C=0;C<f.tracks.length;++C){const L=f.tracks[C],G=L.getValueSize(),z=[],X=[];for(let Q=0;Q<L.times.length;++Q){const re=L.times[Q]*c;if(!(re<r||re>=l)){z.push(L.times[Q]);for(let ue=0;ue<G;++ue)X.push(L.values[Q*G+ue])}}0!==z.length&&(L.times=is.convertArray(z,L.times.constructor),L.values=is.convertArray(X,L.values.constructor),m.push(L))}f.tracks=m;let g=1/0;for(let C=0;C<f.tracks.length;++C)g>f.tracks[C].times[0]&&(g=f.tracks[C].times[0]);for(let C=0;C<f.tracks.length;++C)f.tracks[C].shift(-1*g);return f.resetDuration(),f},makeClipAdditive:function(h,n=0,r=h,l=30){l<=0&&(l=30);const c=r.tracks.length,f=n/l;for(let m=0;m<c;++m){const g=r.tracks[m],C=g.ValueTypeName;if("bool"===C||"string"===C)continue;const L=h.tracks.find(function(se){return se.name===g.name&&se.ValueTypeName===C});if(void 0===L)continue;let G=0;const z=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(G=z/3);let X=0;const Q=L.getValueSize();L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(X=Q/3);const re=g.times.length-1;let ue;if(f<=g.times[0])ue=is.arraySlice(g.values,G,z-G);else if(f>=g.times[re]){const se=re*z+G;ue=is.arraySlice(g.values,se,se+z-G)}else{const se=g.createInterpolant(),J=G,Be=z-G;se.evaluate(f),ue=is.arraySlice(se.resultBuffer,J,Be)}"quaternion"===C&&(new as).fromArray(ue).normalize().conjugate().toArray(ue);const Te=L.times.length;for(let se=0;se<Te;++se){const J=se*Q+X;if("quaternion"===C)as.multiplyQuaternionsFlat(L.values,J,ue,0,L.values,J);else{const Be=Q-2*X;for(let be=0;be<Be;++be)L.values[J+be]-=ue[be]}}}return h.blendMode=2501,h}};class $l{constructor(n,r,l,c){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=void 0!==c?c:new r.constructor(l),this.sampleValues=r,this.valueSize=l,this.settings=null,this.DefaultSettings_={}}evaluate(n){const r=this.parameterPositions;let l=this._cachedIndex,c=r[l],f=r[l-1];e:{t:{let m;n:{i:if(!(n<c)){for(let g=l+2;;){if(void 0===c){if(n<f)break i;return l=r.length,this._cachedIndex=l,this.afterEnd_(l-1,n,f)}if(l===g)break;if(f=c,c=r[++l],n<c)break t}m=r.length;break n}if(n>=f)break e;{const g=r[1];n<g&&(l=2,f=g);for(let C=l-2;;){if(void 0===f)return this._cachedIndex=0,this.beforeStart_(0,n,c);if(l===C)break;if(c=f,f=r[--l-1],n>=f)break t}m=l,l=0}}for(;l<m;){const g=l+m>>>1;n<r[g]?m=g:l=g+1}if(c=r[l],f=r[l-1],void 0===f)return this._cachedIndex=0,this.beforeStart_(0,n,c);if(void 0===c)return l=r.length,this._cachedIndex=l,this.afterEnd_(l-1,f,n)}this._cachedIndex=l,this.intervalChanged_(l,f,c)}return this.interpolate_(l,f,n,c)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const r=this.resultBuffer,l=this.sampleValues,c=this.valueSize,f=n*c;for(let m=0;m!==c;++m)r[m]=l[f+m];return r}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}$l.prototype.beforeStart_=$l.prototype.copySampleValue_,$l.prototype.afterEnd_=$l.prototype.copySampleValue_;class lm extends $l{constructor(n,r,l,c){super(n,r,l,c),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:yi,endingEnd:yi}}intervalChanged_(n,r,l){const c=this.parameterPositions;let f=n-2,m=n+1,g=c[f],C=c[m];if(void 0===g)switch(this.getSettings_().endingStart){case Li:f=n,g=2*r-l;break;case rr:f=c.length-2,g=r+c[f]-c[f+1];break;default:f=n,g=l}if(void 0===C)switch(this.getSettings_().endingEnd){case Li:m=n,C=2*l-r;break;case rr:m=1,C=l+c[1]-c[0];break;default:m=n-1,C=r}const L=.5*(l-r),G=this.valueSize;this._weightPrev=L/(r-g),this._weightNext=L/(C-l),this._offsetPrev=f*G,this._offsetNext=m*G}interpolate_(n,r,l,c){const f=this.resultBuffer,m=this.sampleValues,g=this.valueSize,C=n*g,L=C-g,G=this._offsetPrev,z=this._offsetNext,X=this._weightPrev,Q=this._weightNext,re=(l-r)/(c-r),ue=re*re,Te=ue*re,se=-X*Te+2*X*ue-X*re,J=(1+X)*Te+(-1.5-2*X)*ue+(-.5+X)*re+1,Be=(-1-Q)*Te+(1.5+Q)*ue+.5*re,be=Q*Te-Q*ue;for(let Ve=0;Ve!==g;++Ve)f[Ve]=se*m[G+Ve]+J*m[L+Ve]+Be*m[C+Ve]+be*m[z+Ve];return f}}class cm extends $l{constructor(n,r,l,c){super(n,r,l,c)}interpolate_(n,r,l,c){const f=this.resultBuffer,m=this.sampleValues,g=this.valueSize,C=n*g,L=C-g,G=(l-r)/(c-r),z=1-G;for(let X=0;X!==g;++X)f[X]=m[L+X]*z+m[C+X]*G;return f}}class Xa extends $l{constructor(n,r,l,c){super(n,r,l,c)}interpolate_(n){return this.copySampleValue_(n-1)}}class Go{constructor(n,r,l,c){if(void 0===n)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===r||0===r.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=is.convertArray(r,this.TimeBufferType),this.values=is.convertArray(l,this.ValueBufferType),this.setInterpolation(c||this.DefaultInterpolation)}static toJSON(n){const r=n.constructor;let l;if(r.toJSON!==this.toJSON)l=r.toJSON(n);else{l={name:n.name,times:is.convertArray(n.times,Array),values:is.convertArray(n.values,Array)};const c=n.getInterpolation();c!==n.DefaultInterpolation&&(l.interpolation=c)}return l.type=n.ValueTypeName,l}InterpolantFactoryMethodDiscrete(n){return new Xa(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new cm(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new lm(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let r;switch(n){case Gt:r=this.InterpolantFactoryMethodDiscrete;break;case An:r=this.InterpolantFactoryMethodLinear;break;case 2302:r=this.InterpolantFactoryMethodSmooth}if(void 0===r){const l="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(n===this.DefaultInterpolation)throw new Error(l);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",l),this}return this.createInterpolant=r,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gt;case this.InterpolantFactoryMethodLinear:return An;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(n){if(0!==n){const r=this.times;for(let l=0,c=r.length;l!==c;++l)r[l]+=n}return this}scale(n){if(1!==n){const r=this.times;for(let l=0,c=r.length;l!==c;++l)r[l]*=n}return this}trim(n,r){const l=this.times,c=l.length;let f=0,m=c-1;for(;f!==c&&l[f]<n;)++f;for(;-1!==m&&l[m]>r;)--m;if(++m,0!==f||m!==c){f>=m&&(m=Math.max(m,1),f=m-1);const g=this.getValueSize();this.times=is.arraySlice(l,f,m),this.values=is.arraySlice(this.values,f*g,m*g)}return this}validate(){let n=!0;const r=this.getValueSize();r-Math.floor(r)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const l=this.times,c=this.values,f=l.length;0===f&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let m=null;for(let g=0;g!==f;g++){const C=l[g];if("number"==typeof C&&isNaN(C)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,C),n=!1;break}if(null!==m&&m>C){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,C,m),n=!1;break}m=C}if(void 0!==c&&is.isTypedArray(c))for(let g=0,C=c.length;g!==C;++g){const L=c[g];if(isNaN(L)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,L),n=!1;break}}return n}optimize(){const n=is.arraySlice(this.times),r=is.arraySlice(this.values),l=this.getValueSize(),c=2302===this.getInterpolation(),f=n.length-1;let m=1;for(let g=1;g<f;++g){let C=!1;const L=n[g];if(L!==n[g+1]&&(1!==g||L!==n[0]))if(c)C=!0;else{const z=g*l,X=z-l,Q=z+l;for(let re=0;re!==l;++re){const ue=r[z+re];if(ue!==r[X+re]||ue!==r[Q+re]){C=!0;break}}}if(C){if(g!==m){n[m]=n[g];const z=g*l,X=m*l;for(let Q=0;Q!==l;++Q)r[X+Q]=r[z+Q]}++m}}if(f>0){n[m]=n[f];for(let g=f*l,C=m*l,L=0;L!==l;++L)r[C+L]=r[g+L];++m}return m!==n.length?(this.times=is.arraySlice(n,0,m),this.values=is.arraySlice(r,0,m*l)):(this.times=n,this.values=r),this}clone(){const n=is.arraySlice(this.times,0),r=is.arraySlice(this.values,0),c=new(0,this.constructor)(this.name,n,r);return c.createInterpolant=this.createInterpolant,c}}Go.prototype.TimeBufferType=Float32Array,Go.prototype.ValueBufferType=Float32Array,Go.prototype.DefaultInterpolation=An;class Rc extends Go{}Rc.prototype.ValueTypeName="bool",Rc.prototype.ValueBufferType=Array,Rc.prototype.DefaultInterpolation=Gt,Rc.prototype.InterpolantFactoryMethodLinear=void 0,Rc.prototype.InterpolantFactoryMethodSmooth=void 0;class oh extends Go{}oh.prototype.ValueTypeName="color";class bd extends Go{}bd.prototype.ValueTypeName="number";class ah extends $l{constructor(n,r,l,c){super(n,r,l,c)}interpolate_(n,r,l,c){const f=this.resultBuffer,m=this.sampleValues,g=this.valueSize,C=(l-r)/(c-r);let L=n*g;for(let G=L+g;L!==G;L+=4)as.slerpFlat(f,0,m,L-g,m,L,C);return f}}class ja extends Go{InterpolantFactoryMethodLinear(n){return new ah(this.times,this.values,this.getValueSize(),n)}}ja.prototype.ValueTypeName="quaternion",ja.prototype.DefaultInterpolation=An,ja.prototype.InterpolantFactoryMethodSmooth=void 0;class vl extends Go{}vl.prototype.ValueTypeName="string",vl.prototype.ValueBufferType=Array,vl.prototype.DefaultInterpolation=Gt,vl.prototype.InterpolantFactoryMethodLinear=void 0,vl.prototype.InterpolantFactoryMethodSmooth=void 0;class Lc extends Go{}Lc.prototype.ValueTypeName="vector";class Ed{constructor(n,r=-1,l,c=2500){this.name=n,this.tracks=l,this.duration=r,this.blendMode=c,this.uuid=Xo(),this.duration<0&&this.resetDuration()}static parse(n){const r=[],l=n.tracks,c=1/(n.fps||1);for(let m=0,g=l.length;m!==g;++m)r.push(lh(l[m]).scale(c));const f=new this(n.name,n.duration,r,n.blendMode);return f.uuid=n.uuid,f}static toJSON(n){const r=[],l=n.tracks,c={name:n.name,duration:n.duration,tracks:r,uuid:n.uuid,blendMode:n.blendMode};for(let f=0,m=l.length;f!==m;++f)r.push(Go.toJSON(l[f]));return c}static CreateFromMorphTargetSequence(n,r,l,c){const f=r.length,m=[];for(let g=0;g<f;g++){let C=[],L=[];C.push((g+f-1)%f,g,(g+1)%f),L.push(0,1,0);const G=is.getKeyframeOrder(C);C=is.sortedArray(C,1,G),L=is.sortedArray(L,1,G),!c&&0===C[0]&&(C.push(f),L.push(L[0])),m.push(new bd(".morphTargetInfluences["+r[g].name+"]",C,L).scale(1/l))}return new this(n,-1,m)}static findByName(n,r){let l=n;if(!Array.isArray(n)){const c=n;l=c.geometry&&c.geometry.animations||c.animations}for(let c=0;c<l.length;c++)if(l[c].name===r)return l[c];return null}static CreateClipsFromMorphTargetSequences(n,r,l){const c={},f=/^([\w-]*?)([\d]+)$/;for(let g=0,C=n.length;g<C;g++){const L=n[g],G=L.name.match(f);if(G&&G.length>1){const z=G[1];let X=c[z];X||(c[z]=X=[]),X.push(L)}}const m=[];for(const g in c)m.push(this.CreateFromMorphTargetSequence(g,c[g],r,l));return m}static parseAnimation(n,r){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const l=function(z,X,Q,re,ue){if(0!==Q.length){const Te=[],se=[];is.flattenJSON(Q,Te,se,re),0!==Te.length&&ue.push(new z(X,Te,se))}},c=[],f=n.name||"default",m=n.fps||30,g=n.blendMode;let C=n.length||-1;const L=n.hierarchy||[];for(let z=0;z<L.length;z++){const X=L[z].keys;if(X&&0!==X.length)if(X[0].morphTargets){const Q={};let re;for(re=0;re<X.length;re++)if(X[re].morphTargets)for(let ue=0;ue<X[re].morphTargets.length;ue++)Q[X[re].morphTargets[ue]]=-1;for(const ue in Q){const Te=[],se=[];for(let J=0;J!==X[re].morphTargets.length;++J){const Be=X[re];Te.push(Be.time),se.push(Be.morphTarget===ue?1:0)}c.push(new bd(".morphTargetInfluence["+ue+"]",Te,se))}C=Q.length*(m||1)}else{const Q=".bones["+r[z].name+"]";l(Lc,Q+".position",X,"pos",c),l(ja,Q+".quaternion",X,"rot",c),l(Lc,Q+".scale",X,"scl",c)}}return 0===c.length?null:new this(f,C,c,g)}resetDuration(){let r=0;for(let l=0,c=this.tracks.length;l!==c;++l){const f=this.tracks[l];r=Math.max(r,f.times[f.times.length-1])}return this.duration=r,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let r=0;r<this.tracks.length;r++)n=n&&this.tracks[r].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let r=0;r<this.tracks.length;r++)n.push(this.tracks[r].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function lh(h){if(void 0===h.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=function(h){switch(h.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bd;case"vector":case"vector2":case"vector3":case"vector4":return Lc;case"color":return oh;case"quaternion":return ja;case"bool":case"boolean":return Rc;case"string":return vl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+h)}(h.type);if(void 0===h.times){const r=[],l=[];is.flattenJSON(h.keys,r,l,"value"),h.times=r,h.values=l}return void 0!==n.parse?n.parse(h):new n(h.name,h.times,h.values,h.interpolation)}const Dc={enabled:!1,files:{},add:function(h,n){!1!==this.enabled&&(this.files[h]=n)},get:function(h){if(!1!==this.enabled)return this.files[h]},remove:function(h){delete this.files[h]},clear:function(){this.files={}}};class um{constructor(n,r,l){const c=this;let C,f=!1,m=0,g=0;const L=[];this.onStart=void 0,this.onLoad=n,this.onProgress=r,this.onError=l,this.itemStart=function(G){g++,!1===f&&void 0!==c.onStart&&c.onStart(G,m,g),f=!0},this.itemEnd=function(G){m++,void 0!==c.onProgress&&c.onProgress(G,m,g),m===g&&(f=!1,void 0!==c.onLoad&&c.onLoad())},this.itemError=function(G){void 0!==c.onError&&c.onError(G)},this.resolveURL=function(G){return C?C(G):G},this.setURLModifier=function(G){return C=G,this},this.addHandler=function(G,z){return L.push(G,z),this},this.removeHandler=function(G){const z=L.indexOf(G);return-1!==z&&L.splice(z,2),this},this.getHandler=function(G){for(let z=0,X=L.length;z<X;z+=2){const Q=L[z],re=L[z+1];if(Q.global&&(Q.lastIndex=0),Q.test(G))return re}return null}}}const ec=new um;class Zs{constructor(n){this.manager=void 0!==n?n:ec,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,r){const l=this;return new Promise(function(c,f){l.load(n,c,r,f)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}}const zo={};class tc extends Zs{constructor(n){super(n)}load(n,r,l,c){void 0===n&&(n=""),void 0!==this.path&&(n=this.path+n),n=this.manager.resolveURL(n);const f=Dc.get(n);if(void 0!==f)return this.manager.itemStart(n),setTimeout(()=>{r&&r(f),this.manager.itemEnd(n)},0),f;if(void 0!==zo[n])return void zo[n].push({onLoad:r,onProgress:l,onError:c});zo[n]=[],zo[n].push({onLoad:r,onProgress:l,onError:c});const m=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),g=this.mimeType,C=this.responseType;fetch(m).then(L=>{if(200===L.status||0===L.status){if(0===L.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===L.body.getReader)return L;const G=zo[n],z=L.body.getReader(),X=L.headers.get("Content-Length"),Q=X?parseInt(X):0,re=0!==Q;let ue=0;const Te=new ReadableStream({start(se){!function J(){z.read().then(({done:Be,value:be})=>{if(Be)se.close();else{ue+=be.byteLength;const Ve=new ProgressEvent("progress",{lengthComputable:re,loaded:ue,total:Q});for(let Ze=0,dt=G.length;Ze<dt;Ze++){const yt=G[Ze];yt.onProgress&&yt.onProgress(Ve)}se.enqueue(be),J()}})}()}});return new Response(Te)}throw Error(`fetch for "${L.url}" responded with ${L.status}: ${L.statusText}`)}).then(L=>{switch(C){case"arraybuffer":return L.arrayBuffer();case"blob":return L.blob();case"document":return L.text().then(G=>(new DOMParser).parseFromString(G,g));case"json":return L.json();default:if(void 0===g)return L.text();{const z=/charset="?([^;"\s]*)"?/i.exec(g),X=z&&z[1]?z[1].toLowerCase():void 0,Q=new TextDecoder(X);return L.arrayBuffer().then(re=>Q.decode(re))}}}).then(L=>{Dc.add(n,L);const G=zo[n];delete zo[n];for(let z=0,X=G.length;z<X;z++){const Q=G[z];Q.onLoad&&Q.onLoad(L)}}).catch(L=>{const G=zo[n];if(void 0===G)throw this.manager.itemError(n),L;delete zo[n];for(let z=0,X=G.length;z<X;z++){const Q=G[z];Q.onError&&Q.onError(L)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}}class wd extends Zs{constructor(n){super(n)}load(n,r,l,c){void 0!==this.path&&(n=this.path+n),n=this.manager.resolveURL(n);const f=this,m=Dc.get(n);if(void 0!==m)return f.manager.itemStart(n),setTimeout(function(){r&&r(m),f.manager.itemEnd(n)},0),m;const g=_l("img");function C(){G(),Dc.add(n,this),r&&r(this),f.manager.itemEnd(n)}function L(z){G(),c&&c(z),f.manager.itemError(n),f.manager.itemEnd(n)}function G(){g.removeEventListener("load",C,!1),g.removeEventListener("error",L,!1)}return g.addEventListener("load",C,!1),g.addEventListener("error",L,!1),"data:"!==n.substr(0,5)&&void 0!==this.crossOrigin&&(g.crossOrigin=this.crossOrigin),f.manager.itemStart(n),g.src=n,g}}class Fx extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=new Vu,m=new wd(this.manager);m.setCrossOrigin(this.crossOrigin),m.setPath(this.path);let g=0;function C(L){m.load(n[L],function(G){f.images[L]=G,g++,6===g&&(f.needsUpdate=!0,r&&r(f))},void 0,c)}for(let L=0;L<n.length;++L)C(L);return f}}class yg extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=new Xl,g=new tc(this.manager);return g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(f.withCredentials),g.load(n,function(C){const L=f.parse(C);!L||(void 0!==L.image?m.image=L.image:void 0!==L.data&&(m.image.width=L.width,m.image.height=L.height,m.image.data=L.data),m.wrapS=void 0!==L.wrapS?L.wrapS:dn,m.wrapT=void 0!==L.wrapT?L.wrapT:dn,m.magFilter=void 0!==L.magFilter?L.magFilter:vt,m.minFilter=void 0!==L.minFilter?L.minFilter:vt,m.anisotropy=void 0!==L.anisotropy?L.anisotropy:1,void 0!==L.encoding&&(m.encoding=L.encoding),void 0!==L.flipY&&(m.flipY=L.flipY),void 0!==L.format&&(m.format=L.format),void 0!==L.type&&(m.type=L.type),void 0!==L.mipmaps&&(m.mipmaps=L.mipmaps,m.minFilter=Fn),1===L.mipmapCount&&(m.minFilter=vt),void 0!==L.generateMipmaps&&(m.generateMipmaps=L.generateMipmaps),m.needsUpdate=!0,r&&r(m,L))},l,c),m}}class Ya extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=new Rn,m=new wd(this.manager);return m.setCrossOrigin(this.crossOrigin),m.setPath(this.path),m.load(n,function(g){f.image=g,f.needsUpdate=!0,void 0!==r&&r(f)},l,c),f}}class wa extends Er{constructor(n,r=1){super(),this.type="Light",this.color=new zn(n),this.intensity=r}dispose(){}copy(n){return super.copy(n),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const r=super.toJSON(n);return r.object.color=this.color.getHex(),r.object.intensity=this.intensity,void 0!==this.groundColor&&(r.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(r.object.distance=this.distance),void 0!==this.angle&&(r.object.angle=this.angle),void 0!==this.decay&&(r.object.decay=this.decay),void 0!==this.penumbra&&(r.object.penumbra=this.penumbra),void 0!==this.shadow&&(r.object.shadow=this.shadow.toJSON()),r}}wa.prototype.isLight=!0;class Cf extends wa{constructor(n,r,l){super(n,l),this.type="HemisphereLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.groundColor=new zn(r)}copy(n){return wa.prototype.copy.call(this,n),this.groundColor.copy(n.groundColor),this}}Cf.prototype.isHemisphereLight=!0;const hm=new ri,dm=new Oe,Rf=new Oe;class Lf{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new st(512,512),this.map=null,this.mapPass=null,this.matrix=new ri,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nl,this._frameExtents=new st(1,1),this._viewportCount=1,this._viewports=[new Or(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const r=this.camera,l=this.matrix;dm.setFromMatrixPosition(n.matrixWorld),r.position.copy(dm),Rf.setFromMatrixPosition(n.target.matrixWorld),r.lookAt(Rf),r.updateMatrixWorld(),hm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hm),l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(r.projectionMatrix),l.multiply(r.matrixWorldInverse)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const n={};return 0!==this.bias&&(n.bias=this.bias),0!==this.normalBias&&(n.normalBias=this.normalBias),1!==this.radius&&(n.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}}class fm extends Lf{constructor(){super(new Ss(50,1,.5,500)),this.focus=1}updateMatrices(n){const r=this.camera,l=2*Fs*n.angle*this.focus,c=this.mapSize.width/this.mapSize.height,f=n.distance||r.far;(l!==r.fov||c!==r.aspect||f!==r.far)&&(r.fov=l,r.aspect=c,r.far=f,r.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}}fm.prototype.isSpotLightShadow=!0;class Df extends wa{constructor(n,r,l=0,c=Math.PI/3,f=0,m=1){super(n,r),this.type="SpotLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.target=new Er,this.distance=l,this.angle=c,this.penumbra=f,this.decay=m,this.shadow=new fm}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}Df.prototype.isSpotLight=!0;const ch=new ri,mu=new Oe,Pf=new Oe;class pm extends Lf{constructor(){super(new Ss(90,1,.5,500)),this._frameExtents=new st(4,2),this._viewportCount=6,this._viewports=[new Or(2,1,1,1),new Or(0,1,1,1),new Or(3,1,1,1),new Or(1,1,1,1),new Or(3,0,1,1),new Or(1,0,1,1)],this._cubeDirections=[new Oe(1,0,0),new Oe(-1,0,0),new Oe(0,0,1),new Oe(0,0,-1),new Oe(0,1,0),new Oe(0,-1,0)],this._cubeUps=[new Oe(0,1,0),new Oe(0,1,0),new Oe(0,1,0),new Oe(0,1,0),new Oe(0,0,1),new Oe(0,0,-1)]}updateMatrices(n,r=0){const l=this.camera,c=this.matrix,f=n.distance||l.far;f!==l.far&&(l.far=f,l.updateProjectionMatrix()),mu.setFromMatrixPosition(n.matrixWorld),l.position.copy(mu),Pf.copy(l.position),Pf.add(this._cubeDirections[r]),l.up.copy(this._cubeUps[r]),l.lookAt(Pf),l.updateMatrixWorld(),c.makeTranslation(-mu.x,-mu.y,-mu.z),ch.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ch)}}pm.prototype.isPointLightShadow=!0;class If extends wa{constructor(n,r,l=0,c=1){super(n,r),this.type="PointLight",this.distance=l,this.decay=c,this.shadow=new pm}get power(){return 4*this.intensity*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}}If.prototype.isPointLight=!0;class mm extends Lf{constructor(){super(new wr(-5,5,5,-5,.5,500))}}mm.prototype.isDirectionalLightShadow=!0;class Bf extends wa{constructor(n,r){super(n,r),this.type="DirectionalLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.target=new Er,this.shadow=new mm}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}Bf.prototype.isDirectionalLight=!0;class Ff extends wa{constructor(n,r){super(n,r),this.type="AmbientLight"}}Ff.prototype.isAmbientLight=!0;class Of extends wa{constructor(n,r,l=10,c=10){super(n,r),this.type="RectAreaLight",this.width=l,this.height=c}get power(){return this.intensity*this.width*this.height*Math.PI}set power(n){this.intensity=n/(this.width*this.height*Math.PI)}copy(n){return super.copy(n),this.width=n.width,this.height=n.height,this}toJSON(n){const r=super.toJSON(n);return r.object.width=this.width,r.object.height=this.height,r}}Of.prototype.isRectAreaLight=!0;class uh{constructor(){this.coefficients=[];for(let n=0;n<9;n++)this.coefficients.push(new Oe)}set(n){for(let r=0;r<9;r++)this.coefficients[r].copy(n[r]);return this}zero(){for(let n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this}getAt(n,r){const l=n.x,c=n.y,f=n.z,m=this.coefficients;return r.copy(m[0]).multiplyScalar(.282095),r.addScaledVector(m[1],.488603*c),r.addScaledVector(m[2],.488603*f),r.addScaledVector(m[3],.488603*l),r.addScaledVector(m[4],l*c*1.092548),r.addScaledVector(m[5],c*f*1.092548),r.addScaledVector(m[6],.315392*(3*f*f-1)),r.addScaledVector(m[7],l*f*1.092548),r.addScaledVector(m[8],.546274*(l*l-c*c)),r}getIrradianceAt(n,r){const l=n.x,c=n.y,f=n.z,m=this.coefficients;return r.copy(m[0]).multiplyScalar(.886227),r.addScaledVector(m[1],1.023328*c),r.addScaledVector(m[2],1.023328*f),r.addScaledVector(m[3],1.023328*l),r.addScaledVector(m[4],.858086*l*c),r.addScaledVector(m[5],.858086*c*f),r.addScaledVector(m[6],.743125*f*f-.247708),r.addScaledVector(m[7],.858086*l*f),r.addScaledVector(m[8],.429043*(l*l-c*c)),r}add(n){for(let r=0;r<9;r++)this.coefficients[r].add(n.coefficients[r]);return this}addScaledSH(n,r){for(let l=0;l<9;l++)this.coefficients[l].addScaledVector(n.coefficients[l],r);return this}scale(n){for(let r=0;r<9;r++)this.coefficients[r].multiplyScalar(n);return this}lerp(n,r){for(let l=0;l<9;l++)this.coefficients[l].lerp(n.coefficients[l],r);return this}equals(n){for(let r=0;r<9;r++)if(!this.coefficients[r].equals(n.coefficients[r]))return!1;return!0}copy(n){return this.set(n.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(n,r=0){const l=this.coefficients;for(let c=0;c<9;c++)l[c].fromArray(n,r+3*c);return this}toArray(n=[],r=0){const l=this.coefficients;for(let c=0;c<9;c++)l[c].toArray(n,r+3*c);return n}static getBasisAt(n,r){const l=n.x,c=n.y,f=n.z;r[0]=.282095,r[1]=.488603*c,r[2]=.488603*f,r[3]=.488603*l,r[4]=1.092548*l*c,r[5]=1.092548*c*f,r[6]=.315392*(3*f*f-1),r[7]=1.092548*l*f,r[8]=.546274*(l*l-c*c)}}uh.prototype.isSphericalHarmonics3=!0;class _d extends wa{constructor(n=new uh,r=1){super(void 0,r),this.sh=n}copy(n){return super.copy(n),this.sh.copy(n.sh),this}fromJSON(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this}toJSON(n){const r=super.toJSON(n);return r.object.sh=this.sh.toArray(),r}}_d.prototype.isLightProbe=!0;class Uf extends Zs{constructor(n){super(n),this.textures={}}load(n,r,l,c){const f=this,m=new tc(f.manager);m.setPath(f.path),m.setRequestHeader(f.requestHeader),m.setWithCredentials(f.withCredentials),m.load(n,function(g){try{r(f.parse(JSON.parse(g)))}catch(C){c?c(C):console.error(C),f.manager.itemError(n)}},l,c)}parse(n){const r=this.textures;function l(f){return void 0===r[f]&&console.warn("THREE.MaterialLoader: Undefined texture",f),r[f]}const c=new zs[n.type];if(void 0!==n.uuid&&(c.uuid=n.uuid),void 0!==n.name&&(c.name=n.name),void 0!==n.color&&void 0!==c.color&&c.color.setHex(n.color),void 0!==n.roughness&&(c.roughness=n.roughness),void 0!==n.metalness&&(c.metalness=n.metalness),void 0!==n.sheen&&(c.sheen=n.sheen),void 0!==n.sheenColor&&(c.sheenColor=(new zn).setHex(n.sheenColor)),void 0!==n.sheenRoughness&&(c.sheenRoughness=n.sheenRoughness),void 0!==n.emissive&&void 0!==c.emissive&&c.emissive.setHex(n.emissive),void 0!==n.specular&&void 0!==c.specular&&c.specular.setHex(n.specular),void 0!==n.specularIntensity&&(c.specularIntensity=n.specularIntensity),void 0!==n.specularColor&&void 0!==c.specularColor&&c.specularColor.setHex(n.specularColor),void 0!==n.shininess&&(c.shininess=n.shininess),void 0!==n.clearcoat&&(c.clearcoat=n.clearcoat),void 0!==n.clearcoatRoughness&&(c.clearcoatRoughness=n.clearcoatRoughness),void 0!==n.transmission&&(c.transmission=n.transmission),void 0!==n.thickness&&(c.thickness=n.thickness),void 0!==n.attenuationDistance&&(c.attenuationDistance=n.attenuationDistance),void 0!==n.attenuationColor&&void 0!==c.attenuationColor&&c.attenuationColor.setHex(n.attenuationColor),void 0!==n.fog&&(c.fog=n.fog),void 0!==n.flatShading&&(c.flatShading=n.flatShading),void 0!==n.blending&&(c.blending=n.blending),void 0!==n.combine&&(c.combine=n.combine),void 0!==n.side&&(c.side=n.side),void 0!==n.shadowSide&&(c.shadowSide=n.shadowSide),void 0!==n.opacity&&(c.opacity=n.opacity),void 0!==n.transparent&&(c.transparent=n.transparent),void 0!==n.alphaTest&&(c.alphaTest=n.alphaTest),void 0!==n.depthTest&&(c.depthTest=n.depthTest),void 0!==n.depthWrite&&(c.depthWrite=n.depthWrite),void 0!==n.colorWrite&&(c.colorWrite=n.colorWrite),void 0!==n.alphaWrite&&(c.alphaWrite=n.alphaWrite),void 0!==n.stencilWrite&&(c.stencilWrite=n.stencilWrite),void 0!==n.stencilWriteMask&&(c.stencilWriteMask=n.stencilWriteMask),void 0!==n.stencilFunc&&(c.stencilFunc=n.stencilFunc),void 0!==n.stencilRef&&(c.stencilRef=n.stencilRef),void 0!==n.stencilFuncMask&&(c.stencilFuncMask=n.stencilFuncMask),void 0!==n.stencilFail&&(c.stencilFail=n.stencilFail),void 0!==n.stencilZFail&&(c.stencilZFail=n.stencilZFail),void 0!==n.stencilZPass&&(c.stencilZPass=n.stencilZPass),void 0!==n.wireframe&&(c.wireframe=n.wireframe),void 0!==n.wireframeLinewidth&&(c.wireframeLinewidth=n.wireframeLinewidth),void 0!==n.wireframeLinecap&&(c.wireframeLinecap=n.wireframeLinecap),void 0!==n.wireframeLinejoin&&(c.wireframeLinejoin=n.wireframeLinejoin),void 0!==n.rotation&&(c.rotation=n.rotation),1!==n.linewidth&&(c.linewidth=n.linewidth),void 0!==n.dashSize&&(c.dashSize=n.dashSize),void 0!==n.gapSize&&(c.gapSize=n.gapSize),void 0!==n.scale&&(c.scale=n.scale),void 0!==n.polygonOffset&&(c.polygonOffset=n.polygonOffset),void 0!==n.polygonOffsetFactor&&(c.polygonOffsetFactor=n.polygonOffsetFactor),void 0!==n.polygonOffsetUnits&&(c.polygonOffsetUnits=n.polygonOffsetUnits),void 0!==n.dithering&&(c.dithering=n.dithering),void 0!==n.alphaToCoverage&&(c.alphaToCoverage=n.alphaToCoverage),void 0!==n.premultipliedAlpha&&(c.premultipliedAlpha=n.premultipliedAlpha),void 0!==n.visible&&(c.visible=n.visible),void 0!==n.toneMapped&&(c.toneMapped=n.toneMapped),void 0!==n.userData&&(c.userData=n.userData),void 0!==n.vertexColors&&(c.vertexColors="number"==typeof n.vertexColors?n.vertexColors>0:n.vertexColors),void 0!==n.uniforms)for(const f in n.uniforms){const m=n.uniforms[f];switch(c.uniforms[f]={},m.type){case"t":c.uniforms[f].value=l(m.value);break;case"c":c.uniforms[f].value=(new zn).setHex(m.value);break;case"v2":c.uniforms[f].value=(new st).fromArray(m.value);break;case"v3":c.uniforms[f].value=(new Oe).fromArray(m.value);break;case"v4":c.uniforms[f].value=(new Or).fromArray(m.value);break;case"m3":c.uniforms[f].value=(new Hr).fromArray(m.value);break;case"m4":c.uniforms[f].value=(new ri).fromArray(m.value);break;default:c.uniforms[f].value=m.value}}if(void 0!==n.defines&&(c.defines=n.defines),void 0!==n.vertexShader&&(c.vertexShader=n.vertexShader),void 0!==n.fragmentShader&&(c.fragmentShader=n.fragmentShader),void 0!==n.extensions)for(const f in n.extensions)c.extensions[f]=n.extensions[f];if(void 0!==n.shading&&(c.flatShading=1===n.shading),void 0!==n.size&&(c.size=n.size),void 0!==n.sizeAttenuation&&(c.sizeAttenuation=n.sizeAttenuation),void 0!==n.map&&(c.map=l(n.map)),void 0!==n.matcap&&(c.matcap=l(n.matcap)),void 0!==n.alphaMap&&(c.alphaMap=l(n.alphaMap)),void 0!==n.bumpMap&&(c.bumpMap=l(n.bumpMap)),void 0!==n.bumpScale&&(c.bumpScale=n.bumpScale),void 0!==n.normalMap&&(c.normalMap=l(n.normalMap)),void 0!==n.normalMapType&&(c.normalMapType=n.normalMapType),void 0!==n.normalScale){let f=n.normalScale;!1===Array.isArray(f)&&(f=[f,f]),c.normalScale=(new st).fromArray(f)}return void 0!==n.displacementMap&&(c.displacementMap=l(n.displacementMap)),void 0!==n.displacementScale&&(c.displacementScale=n.displacementScale),void 0!==n.displacementBias&&(c.displacementBias=n.displacementBias),void 0!==n.roughnessMap&&(c.roughnessMap=l(n.roughnessMap)),void 0!==n.metalnessMap&&(c.metalnessMap=l(n.metalnessMap)),void 0!==n.emissiveMap&&(c.emissiveMap=l(n.emissiveMap)),void 0!==n.emissiveIntensity&&(c.emissiveIntensity=n.emissiveIntensity),void 0!==n.specularMap&&(c.specularMap=l(n.specularMap)),void 0!==n.specularIntensityMap&&(c.specularIntensityMap=l(n.specularIntensityMap)),void 0!==n.specularColorMap&&(c.specularColorMap=l(n.specularColorMap)),void 0!==n.envMap&&(c.envMap=l(n.envMap)),void 0!==n.envMapIntensity&&(c.envMapIntensity=n.envMapIntensity),void 0!==n.reflectivity&&(c.reflectivity=n.reflectivity),void 0!==n.refractionRatio&&(c.refractionRatio=n.refractionRatio),void 0!==n.lightMap&&(c.lightMap=l(n.lightMap)),void 0!==n.lightMapIntensity&&(c.lightMapIntensity=n.lightMapIntensity),void 0!==n.aoMap&&(c.aoMap=l(n.aoMap)),void 0!==n.aoMapIntensity&&(c.aoMapIntensity=n.aoMapIntensity),void 0!==n.gradientMap&&(c.gradientMap=l(n.gradientMap)),void 0!==n.clearcoatMap&&(c.clearcoatMap=l(n.clearcoatMap)),void 0!==n.clearcoatRoughnessMap&&(c.clearcoatRoughnessMap=l(n.clearcoatRoughnessMap)),void 0!==n.clearcoatNormalMap&&(c.clearcoatNormalMap=l(n.clearcoatNormalMap)),void 0!==n.clearcoatNormalScale&&(c.clearcoatNormalScale=(new st).fromArray(n.clearcoatNormalScale)),void 0!==n.transmissionMap&&(c.transmissionMap=l(n.transmissionMap)),void 0!==n.thicknessMap&&(c.thicknessMap=l(n.thicknessMap)),void 0!==n.sheenColorMap&&(c.sheenColorMap=l(n.sheenColorMap)),void 0!==n.sheenRoughnessMap&&(c.sheenRoughnessMap=l(n.sheenRoughnessMap)),c}setTextures(n){return this.textures=n,this}}class Md{static decodeText(n){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);let r="";for(let l=0,c=n.length;l<c;l++)r+=String.fromCharCode(n[l]);try{return decodeURIComponent(escape(r))}catch(l){return r}}static extractUrlBase(n){const r=n.lastIndexOf("/");return-1===r?"./":n.substr(0,r+1)}static resolveURL(n,r){return"string"!=typeof n||""===n?"":(/^https?:\/\//i.test(r)&&/^\//.test(n)&&(r=r.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:r+n)}}class gm extends ji{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(n){return super.copy(n),this.instanceCount=n.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const n=super.toJSON(this);return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}}gm.prototype.isInstancedBufferGeometry=!0;class Ox extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=new tc(f.manager);m.setPath(f.path),m.setRequestHeader(f.requestHeader),m.setWithCredentials(f.withCredentials),m.load(n,function(g){try{r(f.parse(JSON.parse(g)))}catch(C){c?c(C):console.error(C),f.manager.itemError(n)}},l,c)}parse(n){const r={},l={};function c(Q,re){if(void 0!==r[re])return r[re];const Te=Q.interleavedBuffers[re],se=function(Q,re){if(void 0!==l[re])return l[re];const se=new Uint32Array(Q.arrayBuffers[re]).buffer;return l[re]=se,se}(Q,Te.buffer),J=Ma(Te.type,se),Be=new Gl(J,Te.stride);return Be.uuid=Te.uuid,r[re]=Be,Be}const m=n.isInstancedBufferGeometry?new gm:new ji,g=n.data.index;if(void 0!==g){const Q=Ma(g.type,g.array);m.setIndex(new Gr(Q,1))}const C=n.data.attributes;for(const Q in C){const re=C[Q];let ue;if(re.isInterleavedBufferAttribute){const Te=c(n.data,re.data);ue=new xa(Te,re.itemSize,re.offset,re.normalized)}else{const Te=Ma(re.type,re.array);ue=new(re.isInstancedBufferAttribute?hl:Gr)(Te,re.itemSize,re.normalized)}void 0!==re.name&&(ue.name=re.name),void 0!==re.usage&&ue.setUsage(re.usage),void 0!==re.updateRange&&(ue.updateRange.offset=re.updateRange.offset,ue.updateRange.count=re.updateRange.count),m.setAttribute(Q,ue)}const L=n.data.morphAttributes;if(L)for(const Q in L){const re=L[Q],ue=[];for(let Te=0,se=re.length;Te<se;Te++){const J=re[Te];let Be;if(J.isInterleavedBufferAttribute){const be=c(n.data,J.data);Be=new xa(be,J.itemSize,J.offset,J.normalized)}else{const be=Ma(J.type,J.array);Be=new Gr(be,J.itemSize,J.normalized)}void 0!==J.name&&(Be.name=J.name),ue.push(Be)}m.morphAttributes[Q]=ue}n.data.morphTargetsRelative&&(m.morphTargetsRelative=!0);const z=n.data.groups||n.data.drawcalls||n.data.offsets;if(void 0!==z)for(let Q=0,re=z.length;Q!==re;++Q){const ue=z[Q];m.addGroup(ue.start,ue.count,ue.materialIndex)}const X=n.data.boundingSphere;if(void 0!==X){const Q=new Oe;void 0!==X.center&&Q.fromArray(X.center),m.boundingSphere=new Ca(Q,X.radius)}return n.name&&(m.name=n.name),n.userData&&(m.userData=n.userData),m}}const xg={UVMapping:H,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},vm={RepeatWrapping:Tn,ClampToEdgeWrapping:dn,MirroredRepeatWrapping:rn},Ag={NearestFilter:On,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:vt,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:Fn};class Td extends Zs{constructor(n){super(n),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,r,l,c){void 0===n&&(n=""),void 0!==this.path&&(n=this.path+n),n=this.manager.resolveURL(n);const f=this,m=Dc.get(n);if(void 0!==m)return f.manager.itemStart(n),setTimeout(function(){r&&r(m),f.manager.itemEnd(n)},0),m;const g={};g.credentials="anonymous"===this.crossOrigin?"same-origin":"include",g.headers=this.requestHeader,fetch(n,g).then(function(C){return C.blob()}).then(function(C){return createImageBitmap(C,Object.assign(f.options,{colorSpaceConversion:"none"}))}).then(function(C){Dc.add(n,C),r&&r(C),f.manager.itemEnd(n)}).catch(function(C){c&&c(C),f.manager.itemError(n),f.manager.itemEnd(n)}),f.manager.itemStart(n)}}let Sd;Td.prototype.isImageBitmapLoader=!0;const ym={getContext:function(){return void 0===Sd&&(Sd=new(window.AudioContext||window.webkitAudioContext)),Sd},setContext:function(h){Sd=h}};class bg extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=new tc(this.manager);m.setResponseType("arraybuffer"),m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(n,function(g){try{const C=g.slice(0);ym.getContext().decodeAudioData(C,function(G){r(G)})}catch(C){c?c(C):console.error(C),f.manager.itemError(n)}},l,c)}}class Eg extends _d{constructor(n,r,l=1){super(void 0,l);const c=(new zn).set(n),f=(new zn).set(r),m=new Oe(c.r,c.g,c.b),g=new Oe(f.r,f.g,f.b),C=Math.sqrt(Math.PI),L=C*Math.sqrt(.75);this.sh.coefficients[0].copy(m).add(g).multiplyScalar(C),this.sh.coefficients[1].copy(m).sub(g).multiplyScalar(L)}}Eg.prototype.isHemisphereLightProbe=!0;class xm extends _d{constructor(n,r=1){super(void 0,r);const l=(new zn).set(n);this.sh.coefficients[0].set(l.r,l.g,l.b).multiplyScalar(2*Math.sqrt(Math.PI))}}xm.prototype.isAmbientLightProbe=!0;const Am=new ri,Pc=new ri,hh=new ri;class bm{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Ic(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=Ic();n=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=n}return n}}function Ic(){return("undefined"==typeof performance?Date:performance).now()}const Bc=new Oe,_g=new as,gu=new Oe,dh=new Oe;class nc extends Er{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+n;const r=this.context.createBufferSource();return r.buffer=this.buffer,r.loop=this.loop,r.loopStart=this.loopStart,r.loopEnd=this.loopEnd,r.onended=this.onEnded.bind(this),r.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=r,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,r=this.filters.length;n<r;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,r=this.filters.length;n<r;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(n){return n||(n=[]),!0===this._connected?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){if(this.detune=n,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(!1!==this.hasPlaybackControl)return this.playbackRate=n,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(!1!==this.hasPlaybackControl)return this.loop=n,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}}const Fc=new Oe,Mg=new as,vu=new Oe,fh=new Oe;class Tg{constructor(n,r=2048){this.analyser=n.context.createAnalyser(),this.analyser.fftSize=r,this.data=new Uint8Array(this.analyser.frequencyBinCount),n.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let n=0;const r=this.getFrequencyData();for(let l=0;l<r.length;l++)n+=r[l];return n/r.length}}class Nf{constructor(n,r,l){let c,f,m;switch(this.binding=n,this.valueSize=l,r){case"quaternion":c=this._slerp,f=this._slerpAdditive,m=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*l),this._workIndex=5;break;case"string":case"bool":c=this._select,f=this._select,m=this._setAdditiveIdentityOther,this.buffer=new Array(5*l);break;default:c=this._lerp,f=this._lerpAdditive,m=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*l)}this._mixBufferRegion=c,this._mixBufferRegionAdditive=f,this._setIdentity=m,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(n,r){const l=this.buffer,c=this.valueSize,f=n*c+c;let m=this.cumulativeWeight;if(0===m){for(let g=0;g!==c;++g)l[f+g]=l[g];m=r}else m+=r,this._mixBufferRegion(l,f,0,r/m,c);this.cumulativeWeight=m}accumulateAdditive(n){const r=this.buffer,l=this.valueSize,c=l*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(r,c,0,n,l),this.cumulativeWeightAdditive+=n}apply(n){const r=this.valueSize,l=this.buffer,c=n*r+r,f=this.cumulativeWeight,m=this.cumulativeWeightAdditive,g=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,f<1&&this._mixBufferRegion(l,c,r*this._origIndex,1-f,r),m>0&&this._mixBufferRegionAdditive(l,c,this._addIndex*r,1,r);for(let C=r,L=r+r;C!==L;++C)if(l[C]!==l[C+r]){g.setValue(l,c);break}}saveOriginalState(){const r=this.buffer,l=this.valueSize,c=l*this._origIndex;this.binding.getValue(r,c);for(let f=l,m=c;f!==m;++f)r[f]=r[c+f%l];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const n=this._addIndex*this.valueSize,r=n+this.valueSize;for(let l=n;l<r;l++)this.buffer[l]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const n=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let l=0;l<this.valueSize;l++)this.buffer[r+l]=this.buffer[n+l]}_select(n,r,l,c,f){if(c>=.5)for(let m=0;m!==f;++m)n[r+m]=n[l+m]}_slerp(n,r,l,c){as.slerpFlat(n,r,n,r,n,l,c)}_slerpAdditive(n,r,l,c,f){const m=this._workIndex*f;as.multiplyQuaternionsFlat(n,m,n,r,n,l),as.slerpFlat(n,r,n,r,n,m,c)}_lerp(n,r,l,c,f){const m=1-c;for(let g=0;g!==f;++g){const C=r+g;n[C]=n[C]*m+n[l+g]*c}}_lerpAdditive(n,r,l,c,f){for(let m=0;m!==f;++m){const g=r+m;n[g]=n[g]+n[l+m]*c}}}const Em="\\[\\]\\.:\\/",wm=new RegExp("["+Em+"]","g"),_m="[^"+Em+"]",Hx="[^"+Em.replace("\\.","")+"]",Gx=/((?:WC+[\/:])*)/.source.replace("WC",_m),zx=/(WCOD+)?/.source.replace("WCOD",Hx),Vx=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_m),Wx=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_m),Xx=new RegExp("^"+Gx+zx+Vx+Wx+"$"),jx=["material","materials","bones"];class Os{constructor(n,r,l){const c=l||Ls.parseTrackName(r);this._targetGroup=n,this._bindings=n.subscribe_(r,c)}getValue(n,r){this.bind();const c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(n,r)}setValue(n,r){const l=this._bindings;for(let c=this._targetGroup.nCachedObjects_,f=l.length;c!==f;++c)l[c].setValue(n,r)}bind(){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,l=n.length;r!==l;++r)n[r].bind()}unbind(){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,l=n.length;r!==l;++r)n[r].unbind()}}let Ls=(()=>{class h{constructor(r,l,c){this.path=l,this.parsedPath=c||h.parseTrackName(l),this.node=h.findNode(r,this.parsedPath.nodeName)||r,this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,l,c){return r&&r.isAnimationObjectGroup?new h.Composite(r,l,c):new h(r,l,c)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(wm,"")}static parseTrackName(r){const l=Xx.exec(r);if(!l)throw new Error("PropertyBinding: Cannot parse trackName: "+r);const c={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},f=c.nodeName&&c.nodeName.lastIndexOf(".");if(void 0!==f&&-1!==f){const m=c.nodeName.substring(f+1);-1!==jx.indexOf(m)&&(c.nodeName=c.nodeName.substring(0,f),c.objectName=m)}if(null===c.propertyName||0===c.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return c}static findNode(r,l){if(!l||""===l||"."===l||-1===l||l===r.name||l===r.uuid)return r;if(r.skeleton){const c=r.skeleton.getBoneByName(l);if(void 0!==c)return c}if(r.children){const c=function(m){for(let g=0;g<m.length;g++){const C=m[g];if(C.name===l||C.uuid===l)return C;const L=c(C.children);if(L)return L}return null},f=c(r.children);if(f)return f}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,l){r[l]=this.targetObject[this.propertyName]}_getValue_array(r,l){const c=this.resolvedProperty;for(let f=0,m=c.length;f!==m;++f)r[l++]=c[f]}_getValue_arrayElement(r,l){r[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,l){this.resolvedProperty.toArray(r,l)}_setValue_direct(r,l){this.targetObject[this.propertyName]=r[l]}_setValue_direct_setNeedsUpdate(r,l){this.targetObject[this.propertyName]=r[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,l){this.targetObject[this.propertyName]=r[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,l){const c=this.resolvedProperty;for(let f=0,m=c.length;f!==m;++f)c[f]=r[l++]}_setValue_array_setNeedsUpdate(r,l){const c=this.resolvedProperty;for(let f=0,m=c.length;f!==m;++f)c[f]=r[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,l){const c=this.resolvedProperty;for(let f=0,m=c.length;f!==m;++f)c[f]=r[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,l){this.resolvedProperty[this.propertyIndex]=r[l]}_setValue_arrayElement_setNeedsUpdate(r,l){this.resolvedProperty[this.propertyIndex]=r[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,l){this.resolvedProperty[this.propertyIndex]=r[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,l){this.resolvedProperty.fromArray(r,l)}_setValue_fromArray_setNeedsUpdate(r,l){this.resolvedProperty.fromArray(r,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,l){this.resolvedProperty.fromArray(r,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,l){this.bind(),this.getValue(r,l)}_setValue_unbound(r,l){this.bind(),this.setValue(r,l)}bind(){let r=this.node;const l=this.parsedPath,c=l.objectName,f=l.propertyName;let m=l.propertyIndex;if(r||(r=h.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(c){let G=l.objectIndex;switch(c){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let z=0;z<r.length;z++)if(r[z].name===G){G=z;break}break;default:if(void 0===r[c])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[c]}if(void 0!==G){if(void 0===r[G])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[G]}}const g=r[f];if(void 0===g)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+l.nodeName+"."+f+" but it wasn't found.",r);let C=this.Versioning.None;this.targetObject=r,void 0!==r.needsUpdate?C=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(C=this.Versioning.MatrixWorldNeedsUpdate);let L=this.BindingType.Direct;if(void 0!==m){if("morphTargetInfluences"===f){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[m]&&(m=r.morphTargetDictionary[m])}L=this.BindingType.ArrayElement,this.resolvedProperty=g,this.propertyIndex=m}else void 0!==g.fromArray&&void 0!==g.toArray?(L=this.BindingType.HasFromToArray,this.resolvedProperty=g):Array.isArray(g)?(L=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=f;this.getValue=this.GetterByBindingType[L],this.setValue=this.SetterByBindingTypeAndVersioning[L][C]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return h.Composite=Os,h})();Ls.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ls.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ls.prototype.GetterByBindingType=[Ls.prototype._getValue_direct,Ls.prototype._getValue_array,Ls.prototype._getValue_arrayElement,Ls.prototype._getValue_toArray],Ls.prototype.SetterByBindingTypeAndVersioning=[[Ls.prototype._setValue_direct,Ls.prototype._setValue_direct_setNeedsUpdate,Ls.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ls.prototype._setValue_array,Ls.prototype._setValue_array_setNeedsUpdate,Ls.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ls.prototype._setValue_arrayElement,Ls.prototype._setValue_arrayElement_setNeedsUpdate,Ls.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ls.prototype._setValue_fromArray,Ls.prototype._setValue_fromArray_setNeedsUpdate,Ls.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Sg{constructor(){this.uuid=Xo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const n={};this._indicesByUUID=n;for(let l=0,c=arguments.length;l!==c;++l)n[arguments[l].uuid]=l;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}add(){const n=this._objects,r=this._indicesByUUID,l=this._paths,c=this._parsedPaths,f=this._bindings,m=f.length;let g,C=n.length,L=this.nCachedObjects_;for(let G=0,z=arguments.length;G!==z;++G){const X=arguments[G],Q=X.uuid;let re=r[Q];if(void 0===re){re=C++,r[Q]=re,n.push(X);for(let ue=0,Te=m;ue!==Te;++ue)f[ue].push(new Ls(X,l[ue],c[ue]))}else if(re<L){g=n[re];const ue=--L,Te=n[ue];r[Te.uuid]=re,n[re]=Te,r[Q]=ue,n[ue]=X;for(let se=0,J=m;se!==J;++se){const Be=f[se];let Ve=Be[re];Be[re]=Be[ue],void 0===Ve&&(Ve=new Ls(X,l[se],c[se])),Be[ue]=Ve}}else n[re]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=L}remove(){const n=this._objects,r=this._indicesByUUID,l=this._bindings,c=l.length;let f=this.nCachedObjects_;for(let m=0,g=arguments.length;m!==g;++m){const C=arguments[m],L=C.uuid,G=r[L];if(void 0!==G&&G>=f){const z=f++,X=n[z];r[X.uuid]=G,n[G]=X,r[L]=z,n[z]=C;for(let Q=0,re=c;Q!==re;++Q){const ue=l[Q],se=ue[G];ue[G]=ue[z],ue[z]=se}}}this.nCachedObjects_=f}uncache(){const n=this._objects,r=this._indicesByUUID,l=this._bindings,c=l.length;let f=this.nCachedObjects_,m=n.length;for(let g=0,C=arguments.length;g!==C;++g){const G=arguments[g].uuid,z=r[G];if(void 0!==z)if(delete r[G],z<f){const X=--f,Q=n[X],re=--m,ue=n[re];r[Q.uuid]=z,n[z]=Q,r[ue.uuid]=X,n[X]=ue,n.pop();for(let Te=0,se=c;Te!==se;++Te){const J=l[Te],be=J[re];J[z]=J[X],J[X]=be,J.pop()}}else{const X=--m,Q=n[X];X>0&&(r[Q.uuid]=z),n[z]=Q,n.pop();for(let re=0,ue=c;re!==ue;++re){const Te=l[re];Te[z]=Te[X],Te.pop()}}}this.nCachedObjects_=f}subscribe_(n,r){const l=this._bindingsIndicesByPath;let c=l[n];const f=this._bindings;if(void 0!==c)return f[c];const m=this._paths,g=this._parsedPaths,C=this._objects,G=this.nCachedObjects_,z=new Array(C.length);c=f.length,l[n]=c,m.push(n),g.push(r),f.push(z);for(let X=G,Q=C.length;X!==Q;++X)z[X]=new Ls(C[X],n,r);return z}unsubscribe_(n){const r=this._bindingsIndicesByPath,l=r[n];if(void 0!==l){const c=this._paths,f=this._parsedPaths,m=this._bindings,g=m.length-1,C=m[g];r[n[g]]=l,m[l]=C,m.pop(),f[l]=f[g],f.pop(),c[l]=c[g],c.pop()}}}Sg.prototype.isAnimationObjectGroup=!0;class Yx{constructor(n,r,l=null,c=r.blendMode){this._mixer=n,this._clip=r,this._localRoot=l,this.blendMode=c;const f=r.tracks,m=f.length,g=new Array(m),C={endingStart:yi,endingEnd:yi};for(let L=0;L!==m;++L){const G=f[L].createInterpolant(null);g[L]=G,G.settings=C}this._interpolantSettings=C,this._interpolants=g,this._propertyBindings=new Array(m),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(n){return this._startTime=n,this}setLoop(n,r){return this.loop=n,this.repetitions=r,this}setEffectiveWeight(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(n){return this._scheduleFading(n,0,1)}fadeOut(n){return this._scheduleFading(n,1,0)}crossFadeFrom(n,r,l){if(n.fadeOut(r),this.fadeIn(r),l){const c=this._clip.duration,f=n._clip.duration,g=c/f;n.warp(1,f/c,r),this.warp(g,1,r)}return this}crossFadeTo(n,r,l){return n.crossFadeFrom(this,r,l)}stopFading(){const n=this._weightInterpolant;return null!==n&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}setEffectiveTimeScale(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(n){return this.timeScale=this._clip.duration/n,this.stopWarping()}syncWith(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()}halt(n){return this.warp(this._effectiveTimeScale,0,n)}warp(n,r,l){const c=this._mixer,f=c.time,m=this.timeScale;let g=this._timeScaleInterpolant;null===g&&(g=c._lendControlInterpolant(),this._timeScaleInterpolant=g);const C=g.parameterPositions,L=g.sampleValues;return C[0]=f,C[1]=f+l,L[0]=n/m,L[1]=r/m,this}stopWarping(){const n=this._timeScaleInterpolant;return null!==n&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(n,r,l,c){if(!this.enabled)return void this._updateWeight(n);const f=this._startTime;if(null!==f){const C=(n-f)*l;if(C<0||0===l)return;this._startTime=null,r=l*C}r*=this._updateTimeScale(n);const m=this._updateTime(r),g=this._updateWeight(n);if(g>0){const C=this._interpolants,L=this._propertyBindings;switch(this.blendMode){case 2501:for(let G=0,z=C.length;G!==z;++G)C[G].evaluate(m),L[G].accumulateAdditive(g);break;case 2500:default:for(let G=0,z=C.length;G!==z;++G)C[G].evaluate(m),L[G].accumulate(c,g)}}}_updateWeight(n){let r=0;if(this.enabled){r=this.weight;const l=this._weightInterpolant;if(null!==l){const c=l.evaluate(n)[0];r*=c,n>l.parameterPositions[1]&&(this.stopFading(),0===c&&(this.enabled=!1))}}return this._effectiveWeight=r,r}_updateTimeScale(n){let r=0;if(!this.paused){r=this.timeScale;const l=this._timeScaleInterpolant;null!==l&&(r*=l.evaluate(n)[0],n>l.parameterPositions[1]&&(this.stopWarping(),0===r?this.paused=!0:this.timeScale=r))}return this._effectiveTimeScale=r,r}_updateTime(n){const r=this._clip.duration,l=this.loop;let c=this.time+n,f=this._loopCount;const m=2202===l;if(0===n)return-1===f?c:m&&1==(1&f)?r-c:c;if(2200===l){-1===f&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(c>=r)c=r;else{if(!(c<0)){this.time=c;break e}c=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(-1===f&&(n>=0?(f=0,this._setEndings(!0,0===this.repetitions,m)):this._setEndings(0===this.repetitions,!0,m)),c>=r||c<0){const g=Math.floor(c/r);c-=r*g,f+=Math.abs(g);const C=this.repetitions-f;if(C<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,c=n>0?r:0,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(1===C){const L=n<0;this._setEndings(L,!L,m)}else this._setEndings(!1,!1,m);this._loopCount=f,this.time=c,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=c;if(m&&1==(1&f))return r-c}return c}_setEndings(n,r,l){const c=this._interpolantSettings;l?(c.endingStart=Li,c.endingEnd=Li):(c.endingStart=n?this.zeroSlopeAtStart?Li:yi:rr,c.endingEnd=r?this.zeroSlopeAtEnd?Li:yi:rr)}_scheduleFading(n,r,l){const c=this._mixer,f=c.time;let m=this._weightInterpolant;null===m&&(m=c._lendControlInterpolant(),this._weightInterpolant=m);const g=m.parameterPositions,C=m.sampleValues;return g[0]=f,C[0]=r,g[1]=f+n,C[1]=l,this}}class ic extends el{constructor(n){super(),this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(n,r){const l=n._localRoot||this._root,c=n._clip.tracks,f=c.length,m=n._propertyBindings,g=n._interpolants,C=l.uuid,L=this._bindingsByRootAndName;let G=L[C];void 0===G&&(G={},L[C]=G);for(let z=0;z!==f;++z){const X=c[z],Q=X.name;let re=G[Q];if(void 0!==re)++re.referenceCount,m[z]=re;else{if(re=m[z],void 0!==re){null===re._cacheIndex&&(++re.referenceCount,this._addInactiveBinding(re,C,Q));continue}re=new Nf(Ls.create(l,Q,r&&r._propertyBindings[z].binding.parsedPath),X.ValueTypeName,X.getValueSize()),++re.referenceCount,this._addInactiveBinding(re,C,Q),m[z]=re}g[z].resultBuffer=re.buffer}}_activateAction(n){if(!this._isActiveAction(n)){if(null===n._cacheIndex){const l=(n._localRoot||this._root).uuid,c=n._clip.uuid,f=this._actionsByClip[c];this._bindAction(n,f&&f.knownActions[0]),this._addInactiveAction(n,c,l)}const r=n._propertyBindings;for(let l=0,c=r.length;l!==c;++l){const f=r[l];0==f.useCount++&&(this._lendBinding(f),f.saveOriginalState())}this._lendAction(n)}}_deactivateAction(n){if(this._isActiveAction(n)){const r=n._propertyBindings;for(let l=0,c=r.length;l!==c;++l){const f=r[l];0==--f.useCount&&(f.restoreOriginalState(),this._takeBackBinding(f))}this._takeBackAction(n)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}}_isActiveAction(n){const r=n._cacheIndex;return null!==r&&r<this._nActiveActions}_addInactiveAction(n,r,l){const c=this._actions,f=this._actionsByClip;let m=f[r];if(void 0===m)m={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,f[r]=m;else{const g=m.knownActions;n._byClipCacheIndex=g.length,g.push(n)}n._cacheIndex=c.length,c.push(n),m.actionByRoot[l]=n}_removeInactiveAction(n){const r=this._actions,l=r[r.length-1],c=n._cacheIndex;l._cacheIndex=c,r[c]=l,r.pop(),n._cacheIndex=null;const f=n._clip.uuid,m=this._actionsByClip,g=m[f],C=g.knownActions,L=C[C.length-1],G=n._byClipCacheIndex;L._byClipCacheIndex=G,C[G]=L,C.pop(),n._byClipCacheIndex=null,delete g.actionByRoot[(n._localRoot||this._root).uuid],0===C.length&&delete m[f],this._removeInactiveBindingsForAction(n)}_removeInactiveBindingsForAction(n){const r=n._propertyBindings;for(let l=0,c=r.length;l!==c;++l){const f=r[l];0==--f.referenceCount&&this._removeInactiveBinding(f)}}_lendAction(n){const r=this._actions,l=n._cacheIndex,c=this._nActiveActions++,f=r[c];n._cacheIndex=c,r[c]=n,f._cacheIndex=l,r[l]=f}_takeBackAction(n){const r=this._actions,l=n._cacheIndex,c=--this._nActiveActions,f=r[c];n._cacheIndex=c,r[c]=n,f._cacheIndex=l,r[l]=f}_addInactiveBinding(n,r,l){const c=this._bindingsByRootAndName,f=this._bindings;let m=c[r];void 0===m&&(m={},c[r]=m),m[l]=n,n._cacheIndex=f.length,f.push(n)}_removeInactiveBinding(n){const r=this._bindings,l=n.binding,c=l.rootNode.uuid,f=l.path,m=this._bindingsByRootAndName,g=m[c],C=r[r.length-1],L=n._cacheIndex;C._cacheIndex=L,r[L]=C,r.pop(),delete g[f],0===Object.keys(g).length&&delete m[c]}_lendBinding(n){const r=this._bindings,l=n._cacheIndex,c=this._nActiveBindings++,f=r[c];n._cacheIndex=c,r[c]=n,f._cacheIndex=l,r[l]=f}_takeBackBinding(n){const r=this._bindings,l=n._cacheIndex,c=--this._nActiveBindings,f=r[c];n._cacheIndex=c,r[c]=n,f._cacheIndex=l,r[l]=f}_lendControlInterpolant(){const n=this._controlInterpolants,r=this._nActiveControlInterpolants++;let l=n[r];return void 0===l&&(l=new cm(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),l.__cacheIndex=r,n[r]=l),l}_takeBackControlInterpolant(n){const r=this._controlInterpolants,l=n.__cacheIndex,c=--this._nActiveControlInterpolants,f=r[c];n.__cacheIndex=c,r[c]=n,f.__cacheIndex=l,r[l]=f}clipAction(n,r,l){const c=r||this._root,f=c.uuid;let m="string"==typeof n?Ed.findByName(c,n):n;const g=null!==m?m.uuid:n,C=this._actionsByClip[g];let L=null;if(void 0===l&&(l=null!==m?m.blendMode:2500),void 0!==C){const z=C.actionByRoot[f];if(void 0!==z&&z.blendMode===l)return z;L=C.knownActions[0],null===m&&(m=L._clip)}if(null===m)return null;const G=new Yx(this,m,r,l);return this._bindAction(G,L),this._addInactiveAction(G,g,f),G}existingAction(n,r){const l=r||this._root,c=l.uuid,f="string"==typeof n?Ed.findByName(l,n):n,g=this._actionsByClip[f?f.uuid:n];return void 0!==g&&g.actionByRoot[c]||null}stopAllAction(){const n=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)n[l].stop();return this}update(n){const r=this._actions,l=this._nActiveActions,c=this.time+=n*=this.timeScale,f=Math.sign(n),m=this._accuIndex^=1;for(let L=0;L!==l;++L)r[L]._update(c,n,f,m);const g=this._bindings,C=this._nActiveBindings;for(let L=0;L!==C;++L)g[L].apply(m);return this}setTime(n){this.time=0;for(let r=0;r<this._actions.length;r++)this._actions[r].time=0;return this.update(n)}getRoot(){return this._root}uncacheClip(n){const r=this._actions,l=n.uuid,c=this._actionsByClip,f=c[l];if(void 0!==f){const m=f.knownActions;for(let g=0,C=m.length;g!==C;++g){const L=m[g];this._deactivateAction(L);const G=L._cacheIndex,z=r[r.length-1];L._cacheIndex=null,L._byClipCacheIndex=null,z._cacheIndex=G,r[G]=z,r.pop(),this._removeInactiveBindingsForAction(L)}delete c[l]}}uncacheRoot(n){const r=n.uuid,l=this._actionsByClip;for(const m in l){const C=l[m].actionByRoot[r];void 0!==C&&(this._deactivateAction(C),this._removeInactiveAction(C))}const f=this._bindingsByRootAndName[r];if(void 0!==f)for(const m in f){const g=f[m];g.restoreOriginalState(),this._removeInactiveBinding(g)}}uncacheAction(n,r){const l=this.existingAction(n,r);null!==l&&(this._deactivateAction(l),this._removeInactiveAction(l))}}ic.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class kf{constructor(n){"string"==typeof n&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),n=arguments[1]),this.value=n}clone(){return new kf(void 0===this.value.clone?this.value:this.value.clone())}}class Cg extends Gl{constructor(n,r,l=1){super(n,r),this.meshPerAttribute=l}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}clone(n){const r=super.clone(n);return r.meshPerAttribute=this.meshPerAttribute,r}toJSON(n){const r=super.toJSON(n);return r.isInstancedInterleavedBuffer=!0,r.meshPerAttribute=this.meshPerAttribute,r}}Cg.prototype.isInstancedInterleavedBuffer=!0;class Qx{constructor(n,r,l,c,f){this.buffer=n,this.type=r,this.itemSize=l,this.elementSize=c,this.count=f,this.version=0}set needsUpdate(n){!0===n&&this.version++}setBuffer(n){return this.buffer=n,this}setType(n,r){return this.type=n,this.elementSize=r,this}setItemSize(n){return this.itemSize=n,this}setCount(n){return this.count=n,this}}Qx.prototype.isGLBufferAttribute=!0;function Hf(h,n){return h.distance-n.distance}function Lg(h,n,r,l){if(h.layers.test(n.layers)&&h.raycast(n,r),!0===l){const c=h.children;for(let f=0,m=c.length;f<m;f++)Lg(c[f],n,r,!0)}}const ph=new st;class yu{constructor(n=new st(1/0,1/0),r=new st(-1/0,-1/0)){this.min=n,this.max=r}set(n,r){return this.min.copy(n),this.max.copy(r),this}setFromPoints(n){this.makeEmpty();for(let r=0,l=n.length;r<l;r++)this.expandByPoint(n[r]);return this}setFromCenterAndSize(n,r){const l=ph.copy(r).multiplyScalar(.5);return this.min.copy(n).sub(l),this.max.copy(n).add(l),this}clone(){return(new this.constructor).copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(n){return this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y}getParameter(n,r){return r.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y)}clampPoint(n,r){return r.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return ph.copy(n).clamp(this.min,this.max).sub(n).length()}intersect(n){return this.min.max(n.min),this.max.min(n.max),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}yu.prototype.isBox2=!0;const Cd=new Oe,Gf=new Oe;class Mm{constructor(n=new Oe,r=new Oe){this.start=n,this.end=r}set(n,r){return this.start.copy(n),this.end.copy(r),this}copy(n){return this.start.copy(n.start),this.end.copy(n.end),this}getCenter(n){return n.addVectors(this.start,this.end).multiplyScalar(.5)}delta(n){return n.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(n,r){return this.delta(r).multiplyScalar(n).add(this.start)}closestPointToPointParameter(n,r){Cd.subVectors(n,this.start),Gf.subVectors(this.end,this.start);const l=Gf.dot(Gf);let f=Gf.dot(Cd)/l;return r&&(f=Po(f,0,1)),f}closestPointToPoint(n,r,l){const c=this.closestPointToPointParameter(n,r);return this.delta(l).multiplyScalar(c).add(this.start)}applyMatrix4(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this}equals(n){return n.start.equals(this.start)&&n.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Zx=new Oe;const Qa=new Oe,mh=new ri,Tm=new ri;class Sm extends qo{constructor(n){const r=qx(n),l=new ji,c=[],f=[],m=new zn(0,0,1),g=new zn(0,1,0);for(let L=0;L<r.length;L++){const G=r[L];G.parent&&G.parent.isBone&&(c.push(0,0,0),c.push(0,0,0),f.push(m.r,m.g,m.b),f.push(g.r,g.g,g.b))}l.setAttribute("position",new Mi(c,3)),l.setAttribute("color",new Mi(f,3)),super(l,new To({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=n,this.bones=r,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(n){const r=this.bones,l=this.geometry,c=l.getAttribute("position");Tm.copy(this.root.matrixWorld).invert();for(let f=0,m=0;f<r.length;f++){const g=r[f];g.parent&&g.parent.isBone&&(mh.multiplyMatrices(Tm,g.matrixWorld),Qa.setFromMatrixPosition(mh),c.setXYZ(m,Qa.x,Qa.y,Qa.z),mh.multiplyMatrices(Tm,g.parent.matrixWorld),Qa.setFromMatrixPosition(mh),c.setXYZ(m+1,Qa.x,Qa.y,Qa.z),m+=2)}l.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(n)}}function qx(h){const n=[];h&&h.isBone&&n.push(h);for(let r=0;r<h.children.length;r++)n.push.apply(n,qx(h.children[r]));return n}const Pg=new Oe,Cm=new zn,Jx=new zn;class eA extends qo{constructor(n=10,r=10,l=4473924,c=8947848){l=new zn(l),c=new zn(c);const f=r/2,m=n/r,g=n/2,C=[],L=[];for(let X=0,Q=0,re=-g;X<=r;X++,re+=m){C.push(-g,0,re,g,0,re),C.push(re,0,-g,re,0,g);const ue=X===f?l:c;ue.toArray(L,Q),Q+=3,ue.toArray(L,Q),Q+=3,ue.toArray(L,Q),Q+=3,ue.toArray(L,Q),Q+=3}const G=new ji;G.setAttribute("position",new Mi(C,3)),G.setAttribute("color",new Mi(L,3)),super(G,new To({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Rd=new Oe,Ld=new Oe,tA=new Oe;const Us=new Oe,lo=new gc;function Vs(h,n,r,l,c,f,m){Us.set(c,f,m).unproject(l);const g=n[h];if(void 0!==g){const C=r.getAttribute("position");for(let L=0,G=g.length;L<G;L++)C.setXYZ(g[L],Us.x,Us.y,Us.z)}}const Rm=new la;class nA extends qo{constructor(n,r=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),c=new Float32Array(24),f=new ji;f.setIndex(new Gr(l,1)),f.setAttribute("position",new Gr(c,3)),super(f,new To({color:r,toneMapped:!1})),this.object=n,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(n){if(void 0!==n&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Rm.setFromObject(this.object),Rm.isEmpty())return;const r=Rm.min,l=Rm.max,c=this.geometry.attributes.position,f=c.array;f[0]=l.x,f[1]=l.y,f[2]=l.z,f[3]=r.x,f[4]=l.y,f[5]=l.z,f[6]=r.x,f[7]=r.y,f[8]=l.z,f[9]=l.x,f[10]=r.y,f[11]=l.z,f[12]=l.x,f[13]=l.y,f[14]=r.z,f[15]=r.x,f[16]=l.y,f[17]=r.z,f[18]=r.x,f[19]=r.y,f[20]=r.z,f[21]=l.x,f[22]=r.y,f[23]=r.z,c.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(n){return this.object=n,this.update(),this}copy(n){return qo.prototype.copy.call(this,n),this.object=n.object,this}}const Dd=new Oe;let gh,Fg;class iA extends qo{constructor(n=1){const r=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],c=new ji;c.setAttribute("position",new Mi(r,3)),c.setAttribute("color",new Mi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(c,new To({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(n,r,l){const c=new zn,f=this.geometry.attributes.color.array;return c.set(n),c.toArray(f,0),c.toArray(f,3),c.set(r),c.toArray(f,6),c.toArray(f,9),c.set(l),c.toArray(f,12),c.toArray(f,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Lm=new Float32Array(1),Og=new Int32Array(Lm.buffer);Uo.create=function(h,n){return console.log("THREE.Curve.create() has been deprecated"),h.prototype=Object.create(Uo.prototype),h.prototype.constructor=h,h.prototype.getPoint=n,h},da.prototype.fromPoints=function(h){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(h)},eA.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Sm.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Zs.prototype.extractUrlBase=function(h){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Md.extractUrlBase(h)},Zs.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},yu.prototype.center=function(h){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(h)},yu.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},yu.prototype.isIntersectionBox=function(h){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(h)},yu.prototype.size=function(h){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(h)},la.prototype.center=function(h){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(h)},la.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},la.prototype.isIntersectionBox=function(h){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(h)},la.prototype.isIntersectionSphere=function(h){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(h)},la.prototype.size=function(h){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(h)},Ca.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Nl.prototype.setFromMatrix=function(h){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(h)},Mm.prototype.center=function(h){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(h)},Hr.prototype.flattenToArrayOffset=function(h,n){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(h,n)},Hr.prototype.multiplyVector3=function(h){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),h.applyMatrix3(this)},Hr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Hr.prototype.applyToBufferAttribute=function(h){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),h.applyMatrix3(this)},Hr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Hr.prototype.getInverse=function(h){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(h).invert()},ri.prototype.extractPosition=function(h){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(h)},ri.prototype.flattenToArrayOffset=function(h,n){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(h,n)},ri.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Oe).setFromMatrixColumn(this,3)},ri.prototype.setRotationFromQuaternion=function(h){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(h)},ri.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ri.prototype.multiplyVector3=function(h){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ri.prototype.multiplyVector4=function(h){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ri.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ri.prototype.rotateAxis=function(h){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),h.transformDirection(this)},ri.prototype.crossVector=function(h){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ri.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ri.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ri.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ri.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ri.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ri.prototype.applyToBufferAttribute=function(h){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ri.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ri.prototype.makeFrustum=function(h,n,r,l,c,f){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(h,n,l,r,c,f)},ri.prototype.getInverse=function(h){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(h).invert()},Yo.prototype.isIntersectionLine=function(h){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(h)},as.prototype.multiplyVector3=function(h){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),h.applyQuaternion(this)},as.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},$o.prototype.isIntersectionBox=function(h){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(h)},$o.prototype.isIntersectionPlane=function(h){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(h)},$o.prototype.isIntersectionSphere=function(h){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(h)},Xs.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Xs.prototype.barycoordFromPoint=function(h,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(h,n)},Xs.prototype.midpoint=function(h){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(h)},Xs.prototypenormal=function(h){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(h)},Xs.prototype.plane=function(h){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(h)},Xs.barycoordFromPoint=function(h,n,r,l,c){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Xs.getBarycoord(h,n,r,l,c)},Xs.normal=function(h,n,r,l){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Xs.getNormal(h,n,r,l)},fl.prototype.extractAllPoints=function(h){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(h)},fl.prototype.extrude=function(h){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new pl(this,h)},fl.prototype.makeGeometry=function(h){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Wa(this,h)},st.prototype.fromAttribute=function(h,n,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,n,r)},st.prototype.distanceToManhattan=function(h){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(h)},st.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Oe.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Oe.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Oe.prototype.getPositionFromMatrix=function(h){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(h)},Oe.prototype.getScaleFromMatrix=function(h){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(h)},Oe.prototype.getColumnFromMatrix=function(h,n){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(n,h)},Oe.prototype.applyProjection=function(h){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(h)},Oe.prototype.fromAttribute=function(h,n,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,n,r)},Oe.prototype.distanceToManhattan=function(h){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(h)},Oe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Or.prototype.fromAttribute=function(h,n,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,n,r)},Or.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Er.prototype.getChildByName=function(h){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(h)},Er.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Er.prototype.translate=function(h,n){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(n,h)},Er.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Er.prototype.applyMatrix=function(h){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(h)},Object.defineProperties(Er.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(h){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=h}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Ys.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ys.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),$h.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ss.prototype.setLens=function(h,n){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==n&&(this.filmGauge=n),this.setFocalLength(h)},Object.defineProperties(wa.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(h){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=h}},shadowCameraLeft:{set:function(h){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=h}},shadowCameraRight:{set:function(h){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=h}},shadowCameraTop:{set:function(h){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=h}},shadowCameraBottom:{set:function(h){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=h}},shadowCameraNear:{set:function(h){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=h}},shadowCameraFar:{set:function(h){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=h}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(h){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=h}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(h){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=h}},shadowMapHeight:{set:function(h){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=h}}}),Object.defineProperties(Gr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Sh},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Sh)}}}),Gr.prototype.setDynamic=function(h){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===h?Sh:Th),this},Gr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Gr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ji.prototype.addIndex=function(h){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(h)},ji.prototype.addAttribute=function(h,n){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),n&&n.isBufferAttribute||n&&n.isInterleavedBufferAttribute?"index"===h?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(n),this):this.setAttribute(h,n):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(h,new Gr(arguments[1],arguments[2])))},ji.prototype.addDrawCall=function(h,n,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(h,n)},ji.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ji.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ji.prototype.removeAttribute=function(h){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(h)},ji.prototype.applyMatrix=function(h){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(h)},Object.defineProperties(ji.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Gl.prototype.setDynamic=function(h){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===h?Sh:Th),this},Gl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},pl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},pl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},pl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ll.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},kf.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(js.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new zn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(h){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===h}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(h){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=h}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ul.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(h){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=h}}}),fs.prototype.clearTarget=function(h,n,r,l){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(h),this.clear(n,r,l)},fs.prototype.animate=function(h){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(h)},fs.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},fs.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},fs.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},fs.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},fs.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},fs.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},fs.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},fs.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},fs.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},fs.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},fs.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},fs.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},fs.prototype.enableScissorTest=function(h){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(h)},fs.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},fs.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},fs.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},fs.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},fs.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},fs.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},fs.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},fs.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(fs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(h){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=h}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(h){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=h}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(h){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===h?br:ts}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(lg.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ro.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(h){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=h}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(h){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=h}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(h){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=h}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(h){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=h}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(h){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=h}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(h){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=h}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(h){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=h}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(h){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=h}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(h){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=h}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(h){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=h}}}),nc.prototype.load=function(h){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const n=this;return(new bg).load(h,function(l){n.setBuffer(l)}),this},Tg.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Nh.prototype.updateCubeMap=function(h,n){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(h,n)},Nh.prototype.clear=function(h,n,r,l){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(h,n,r,l)},tl.crossOrigin=void 0,tl.loadTexture=function(h,n,r,l){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const c=new Ya;c.setCrossOrigin(this.crossOrigin);const f=c.load(h,r,void 0,l);return n&&(f.mapping=n),f},tl.loadTextureCube=function(h,n,r,l){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const c=new Fx;c.setCrossOrigin(this.crossOrigin);const f=c.load(h,r,void 0,l);return n&&(f.mapping=n),f},tl.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},tl.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Ab={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:D}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=D),b.ACESFilmicToneMapping=4,b.AddEquation=100,b.AddOperation=2,b.AdditiveAnimationBlendMode=2501,b.AdditiveBlending=2,b.AlphaFormat=1021,b.AlwaysDepth=1,b.AlwaysStencilFunc=519,b.AmbientLight=Ff,b.AmbientLightProbe=xm,b.AnimationClip=Ed,b.AnimationLoader=class extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=new tc(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(n,function(g){try{r(f.parse(JSON.parse(g)))}catch(C){c?c(C):console.error(C),f.manager.itemError(n)}},l,c)}parse(n){const r=[];for(let l=0;l<n.length;l++){const c=Ed.parse(n[l]);r.push(c)}return r}},b.AnimationMixer=ic,b.AnimationObjectGroup=Sg,b.AnimationUtils=is,b.ArcCurve=Qp,b.ArrayCamera=jh,b.ArrowHelper=class extends Er{constructor(n=new Oe(0,0,1),r=new Oe(0,0,0),l=1,c=16776960,f=.2*l,m=.2*f){super(),this.type="ArrowHelper",void 0===gh&&(gh=new ji,gh.setAttribute("position",new Mi([0,0,0,0,1,0],3)),Fg=new Ga(0,.5,1,5,1),Fg.translate(0,-.5,0)),this.position.copy(r),this.line=new ia(gh,new To({color:c,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ys(Fg,new ta({color:c,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(l,f,m)}setDirection(n){if(n.y>.99999)this.quaternion.set(0,0,0,1);else if(n.y<-.99999)this.quaternion.set(1,0,0,0);else{Dd.set(n.z,0,-n.x).normalize();const r=Math.acos(n.y);this.quaternion.setFromAxisAngle(Dd,r)}}setLength(n,r=.2*n,l=.2*r){this.line.scale.set(1,Math.max(1e-4,n-r),1),this.line.updateMatrix(),this.cone.scale.set(l,r,l),this.cone.position.y=n,this.cone.updateMatrix()}setColor(n){this.line.material.color.set(n),this.cone.material.color.set(n)}copy(n){return super.copy(n,!1),this.line.copy(n.line),this.cone.copy(n.cone),this}},b.Audio=nc,b.AudioAnalyser=Tg,b.AudioContext=ym,b.AudioListener=class extends Er{constructor(){super(),this.type="AudioListener",this.context=ym.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bm}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const r=this.context.listener,l=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Bc,_g,gu),dh.set(0,0,-1).applyQuaternion(_g),r.positionX){const c=this.context.currentTime+this.timeDelta;r.positionX.linearRampToValueAtTime(Bc.x,c),r.positionY.linearRampToValueAtTime(Bc.y,c),r.positionZ.linearRampToValueAtTime(Bc.z,c),r.forwardX.linearRampToValueAtTime(dh.x,c),r.forwardY.linearRampToValueAtTime(dh.y,c),r.forwardZ.linearRampToValueAtTime(dh.z,c),r.upX.linearRampToValueAtTime(l.x,c),r.upY.linearRampToValueAtTime(l.y,c),r.upZ.linearRampToValueAtTime(l.z,c)}else r.setPosition(Bc.x,Bc.y,Bc.z),r.setOrientation(dh.x,dh.y,dh.z,l.x,l.y,l.z)}},b.AudioLoader=bg,b.AxesHelper=iA,b.AxisHelper=function(h){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new iA(h)},b.BackSide=1,b.BasicDepthPacking=3200,b.BasicShadowMap=0,b.BinaryTextureLoader=function(h){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new yg(h)},b.Bone=of,b.BooleanKeyframeTrack=Rc,b.BoundingBoxHelper=function(h,n){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new nA(h,n)},b.Box2=yu,b.Box3=la,b.Box3Helper=class extends qo{constructor(n,r=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),f=new ji;f.setIndex(new Gr(l,1)),f.setAttribute("position",new Mi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(f,new To({color:r,toneMapped:!1})),this.box=n,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(n){const r=this.box;r.isEmpty()||(r.getCenter(this.position),r.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(n))}},b.BoxBufferGeometry=ya,b.BoxGeometry=ya,b.BoxHelper=nA,b.BufferAttribute=Gr,b.BufferGeometry=ji,b.BufferGeometryLoader=Ox,b.ByteType=1010,b.Cache=Dc,b.Camera=gc,b.CameraHelper=class extends qo{constructor(n){const r=new ji,l=new To({color:16777215,vertexColors:!0,toneMapped:!1}),c=[],f=[],m={},g=new zn(16755200),C=new zn(16711680),L=new zn(43775),G=new zn(16777215),z=new zn(3355443);function X(re,ue,Te){Q(re,Te),Q(ue,Te)}function Q(re,ue){c.push(0,0,0),f.push(ue.r,ue.g,ue.b),void 0===m[re]&&(m[re]=[]),m[re].push(c.length/3-1)}X("n1","n2",g),X("n2","n4",g),X("n4","n3",g),X("n3","n1",g),X("f1","f2",g),X("f2","f4",g),X("f4","f3",g),X("f3","f1",g),X("n1","f1",g),X("n2","f2",g),X("n3","f3",g),X("n4","f4",g),X("p","n1",C),X("p","n2",C),X("p","n3",C),X("p","n4",C),X("u1","u2",L),X("u2","u3",L),X("u3","u1",L),X("c","t",G),X("p","c",z),X("cn1","cn2",z),X("cn3","cn4",z),X("cf1","cf2",z),X("cf3","cf4",z),r.setAttribute("position",new Mi(c,3)),r.setAttribute("color",new Mi(f,3)),super(r,l),this.type="CameraHelper",this.camera=n,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=m,this.update()}update(){const n=this.geometry,r=this.pointMap;lo.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Vs("c",r,n,lo,0,0,-1),Vs("t",r,n,lo,0,0,1),Vs("n1",r,n,lo,-1,-1,-1),Vs("n2",r,n,lo,1,-1,-1),Vs("n3",r,n,lo,-1,1,-1),Vs("n4",r,n,lo,1,1,-1),Vs("f1",r,n,lo,-1,-1,1),Vs("f2",r,n,lo,1,-1,1),Vs("f3",r,n,lo,-1,1,1),Vs("f4",r,n,lo,1,1,1),Vs("u1",r,n,lo,.7,1.1,-1),Vs("u2",r,n,lo,-.7,1.1,-1),Vs("u3",r,n,lo,0,2,-1),Vs("cf1",r,n,lo,-1,0,1),Vs("cf2",r,n,lo,1,0,1),Vs("cf3",r,n,lo,0,-1,1),Vs("cf4",r,n,lo,0,1,1),Vs("cn1",r,n,lo,-1,0,-1),Vs("cn2",r,n,lo,1,0,-1),Vs("cn3",r,n,lo,0,-1,-1),Vs("cn4",r,n,lo,0,1,-1),n.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},b.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},b.CanvasTexture=Xp,b.CatmullRomCurve3=Ju,b.CineonToneMapping=3,b.CircleBufferGeometry=Mc,b.CircleGeometry=Mc,b.ClampToEdgeWrapping=dn,b.Clock=bm,b.Color=zn,b.ColorKeyframeTrack=oh,b.CompressedTexture=Ku,b.CompressedTextureLoader=class extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=[],g=new Ku,C=new tc(this.manager);C.setPath(this.path),C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setWithCredentials(f.withCredentials);let L=0;function G(z){C.load(n[z],function(X){const Q=f.parse(X,!0);m[z]={width:Q.width,height:Q.height,format:Q.format,mipmaps:Q.mipmaps},L+=1,6===L&&(1===Q.mipmapCount&&(g.minFilter=vt),g.image=m,g.format=Q.format,g.needsUpdate=!0,r&&r(g))},l,c)}if(Array.isArray(n))for(let z=0,X=n.length;z<X;++z)G(z);else C.load(n,function(z){const X=f.parse(z,!0);if(X.isCubemap){const Q=X.mipmaps.length/X.mipmapCount;for(let re=0;re<Q;re++){m[re]={mipmaps:[]};for(let ue=0;ue<X.mipmapCount;ue++)m[re].mipmaps.push(X.mipmaps[re*X.mipmapCount+ue]),m[re].format=X.format,m[re].width=X.width,m[re].height=X.height}g.image=m}else g.image.width=X.width,g.image.height=X.height,g.mipmaps=X.mipmaps;1===X.mipmapCount&&(g.minFilter=vt),g.format=X.format,g.needsUpdate=!0,r&&r(g)},l,c);return g}},b.ConeBufferGeometry=Tc,b.ConeGeometry=Tc,b.CubeCamera=Nh,b.CubeReflectionMapping=301,b.CubeRefractionMapping=302,b.CubeTexture=Vu,b.CubeTextureLoader=Fx,b.CubeUVReflectionMapping=306,b.CubeUVRefractionMapping=307,b.CubicBezierCurve=jl,b.CubicBezierCurve3=$u,b.CubicInterpolant=lm,b.CullFaceBack=1,b.CullFaceFront=2,b.CullFaceFrontBack=3,b.CullFaceNone=0,b.Curve=Uo,b.CurvePath=$p,b.CustomBlending=5,b.CustomToneMapping=5,b.CylinderBufferGeometry=Ga,b.CylinderGeometry=Ga,b.Cylindrical=class{constructor(n=1,r=0,l=0){return this.radius=n,this.theta=r,this.y=l,this}set(n,r,l){return this.radius=n,this.theta=r,this.y=l,this}copy(n){return this.radius=n.radius,this.theta=n.theta,this.y=n.y,this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,r,l){return this.radius=Math.sqrt(n*n+l*l),this.theta=Math.atan2(n,l),this.y=r,this}clone(){return(new this.constructor).copy(this)}},b.DataTexture=Xl,b.DataTexture2DArray=$d,b.DataTexture3D=dp,b.DataTextureLoader=yg,b.DataUtils=class{static toHalfFloat(n){n>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),n=65504),Lm[0]=n;const r=Og[0];let l=r>>16&32768,c=r>>12&2047;const f=r>>23&255;return f<103?l:f>142?(l|=31744,l|=(255==f?0:1)&&8388607&r,l):f<113?(c|=2048,l|=(c>>114-f)+(c>>113-f&1),l):(l|=f-112<<10|c>>1,l+=1&c,l)}},b.DecrementStencilOp=7683,b.DecrementWrapStencilOp=34056,b.DefaultLoadingManager=ec,b.DepthFormat=os,b.DepthStencilFormat=Ae,b.DepthTexture=tf,b.DirectionalLight=Bf,b.DirectionalLightHelper=class extends Er{constructor(n,r,l){super(),this.light=n,this.light.updateMatrixWorld(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,void 0===r&&(r=1);let c=new ji;c.setAttribute("position",new Mi([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));const f=new To({fog:!1,toneMapped:!1});this.lightPlane=new ia(c,f),this.add(this.lightPlane),c=new ji,c.setAttribute("position",new Mi([0,0,0,0,0,1],3)),this.targetLine=new ia(c,f),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Rd.setFromMatrixPosition(this.light.matrixWorld),Ld.setFromMatrixPosition(this.light.target.matrixWorld),tA.subVectors(Ld,Rd),this.lightPlane.lookAt(Ld),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ld),this.targetLine.scale.z=tA.length()}},b.DiscreteInterpolant=Xa,b.DodecahedronBufferGeometry=Sc,b.DodecahedronGeometry=Sc,b.DoubleSide=2,b.DstAlphaFactor=206,b.DstColorFactor=208,b.DynamicBufferAttribute=function(h,n){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Gr(h,n).setUsage(Sh)},b.DynamicCopyUsage=35050,b.DynamicDrawUsage=Sh,b.DynamicReadUsage=35049,b.EdgesGeometry=Yp,b.EdgesHelper=function(h,n){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new qo(new Yp(h.geometry),new To({color:void 0!==n?n:16777215}))},b.EllipseCurve=cd,b.EqualDepth=4,b.EqualStencilFunc=514,b.EquirectangularReflectionMapping=303,b.EquirectangularRefractionMapping=304,b.Euler=Bo,b.EventDispatcher=el,b.ExtrudeBufferGeometry=pl,b.ExtrudeGeometry=pl,b.FaceColors=1,b.FileLoader=tc,b.FlatShading=1,b.Float16BufferAttribute=ls,b.Float32Attribute=function(h,n){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Mi(h,n)},b.Float32BufferAttribute=Mi,b.Float64Attribute=function(h,n){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ov(h,n)},b.Float64BufferAttribute=ov,b.FloatType=Xi,b.Fog=Mo,b.FogExp2=al,b.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},b.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},b.FramebufferTexture=ha,b.FrontSide=0,b.Frustum=Nl,b.GLBufferAttribute=Qx,b.GLSL1="100",b.GLSL3=$a,b.GreaterDepth=6,b.GreaterEqualDepth=5,b.GreaterEqualStencilFunc=518,b.GreaterStencilFunc=516,b.GridHelper=eA,b.Group=wc,b.HalfFloatType=Oi,b.HemisphereLight=Cf,b.HemisphereLightHelper=class extends Er{constructor(n,r,l){super(),this.light=n,this.light.updateMatrixWorld(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=l;const c=new Va(r);c.rotateY(.5*Math.PI),this.material=new ta({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const f=c.getAttribute("position"),m=new Float32Array(3*f.count);c.setAttribute("color",new Gr(m,3)),this.add(new Ys(c,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const r=n.geometry.getAttribute("color");Cm.copy(this.light.color),Jx.copy(this.light.groundColor);for(let l=0,c=r.count;l<c;l++){const f=l<c/2?Cm:Jx;r.setXYZ(l,f.r,f.g,f.b)}r.needsUpdate=!0}n.lookAt(Pg.setFromMatrixPosition(this.light.matrixWorld).negate())}},b.HemisphereLightProbe=Eg,b.IcosahedronBufferGeometry=ml,b.IcosahedronGeometry=ml,b.ImageBitmapLoader=Td,b.ImageLoader=wd,b.ImageUtils=tl,b.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},b.IncrementStencilOp=7682,b.IncrementWrapStencilOp=34055,b.InstancedBufferAttribute=hl,b.InstancedBufferGeometry=gm,b.InstancedInterleavedBuffer=Cg,b.InstancedMesh=af,b.Int16Attribute=function(h,n){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new so(h,n)},b.Int16BufferAttribute=so,b.Int32Attribute=function(h,n){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new oo(h,n)},b.Int32BufferAttribute=oo,b.Int8Attribute=function(h,n){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Gd(h,n)},b.Int8BufferAttribute=Gd,b.IntType=1013,b.InterleavedBuffer=Gl,b.InterleavedBufferAttribute=xa,b.Interpolant=$l,b.InterpolateDiscrete=Gt,b.InterpolateLinear=An,b.InterpolateSmooth=2302,b.InvertStencilOp=5386,b.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},b.KeepStencilOp=7680,b.KeyframeTrack=Go,b.LOD=kp,b.LatheBufferGeometry=ql,b.LatheGeometry=ql,b.Layers=kd,b.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},b.LessDepth=2,b.LessEqualDepth=3,b.LessEqualStencilFunc=515,b.LessStencilFunc=513,b.Light=wa,b.LightProbe=_d,b.Line=ia,b.Line3=Mm,b.LineBasicMaterial=To,b.LineCurve=ba,b.LineCurve3=fd,b.LineDashedMaterial=am,b.LineLoop=id,b.LinePieces=1,b.LineSegments=qo,b.LineStrip=0,b.LinearEncoding=ts,b.LinearFilter=vt,b.LinearInterpolant=cm,b.LinearMipMapLinearFilter=1008,b.LinearMipMapNearestFilter=1007,b.LinearMipmapLinearFilter=Fn,b.LinearMipmapNearestFilter=1007,b.LinearToneMapping=1,b.Loader=Zs,b.LoaderUtils=Md,b.LoadingManager=um,b.LoopOnce=2200,b.LoopPingPong=2202,b.LoopRepeat=2201,b.LuminanceAlphaFormat=1025,b.LuminanceFormat=1024,b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},b.Material=js,b.MaterialLoader=Uf,b.Math=iv,b.MathUtils=iv,b.Matrix3=Hr,b.Matrix4=ri,b.MaxEquation=104,b.Mesh=Ys,b.MeshBasicMaterial=ta,b.MeshDepthMaterial=ef,b.MeshDistanceMaterial=Yu,b.MeshFaceMaterial=function(h){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),h},b.MeshLambertMaterial=Mf,b.MeshMatcapMaterial=Tf,b.MeshNormalMaterial=_f,b.MeshPhongMaterial=Ef,b.MeshPhysicalMaterial=bf,b.MeshStandardMaterial=Ad,b.MeshToonMaterial=wf,b.MinEquation=103,b.MirroredRepeatWrapping=rn,b.MixOperation=1,b.MultiMaterial=function(h=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),h.isMultiMaterial=!0,h.materials=h,h.clone=function(){return h.slice()},h},b.MultiplyBlending=4,b.MultiplyOperation=0,b.NearestFilter=On,b.NearestMipMapLinearFilter=1005,b.NearestMipMapNearestFilter=1004,b.NearestMipmapLinearFilter=1005,b.NearestMipmapNearestFilter=1004,b.NeverDepth=0,b.NeverStencilFunc=512,b.NoBlending=0,b.NoColors=0,b.NoToneMapping=0,b.NormalAnimationBlendMode=2500,b.NormalBlending=1,b.NotEqualDepth=7,b.NotEqualStencilFunc=517,b.NumberKeyframeTrack=bd,b.Object3D=Er,b.ObjectLoader=class extends Zs{constructor(n){super(n)}load(n,r,l,c){const f=this,m=""===this.path?Md.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||m;const g=new tc(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(n,function(C){let L=null;try{L=JSON.parse(C)}catch(z){return void 0!==c&&c(z),void console.error("THREE:ObjectLoader: Can't parse "+n+".",z.message)}const G=L.metadata;void 0!==G&&void 0!==G.type&&"geometry"!==G.type.toLowerCase()?f.parse(L,r):console.error("THREE.ObjectLoader: Can't load "+n)},l,c)}loadAsync(n,r){var l=this;return Ko(function*(){const c=l,f=""===l.path?Md.extractUrlBase(n):l.path;l.resourcePath=l.resourcePath||f;const m=new tc(l.manager);m.setPath(l.path),m.setRequestHeader(l.requestHeader),m.setWithCredentials(l.withCredentials);const g=yield m.loadAsync(n,r),C=JSON.parse(g),L=C.metadata;if(void 0===L||void 0===L.type||"geometry"===L.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+n);return yield c.parseAsync(C)})()}parse(n,r){const l=this.parseAnimations(n.animations),c=this.parseShapes(n.shapes),f=this.parseGeometries(n.geometries,c),m=this.parseImages(n.images,function(){void 0!==r&&r(L)}),g=this.parseTextures(n.textures,m),C=this.parseMaterials(n.materials,g),L=this.parseObject(n.object,f,C,g,l),G=this.parseSkeletons(n.skeletons,L);if(this.bindSkeletons(L,G),void 0!==r){let z=!1;for(const X in m)if(m[X]instanceof HTMLImageElement){z=!0;break}!1===z&&r(L)}return L}parseAsync(n){var r=this;return Ko(function*(){const l=r.parseAnimations(n.animations),c=r.parseShapes(n.shapes),f=r.parseGeometries(n.geometries,c),m=yield r.parseImagesAsync(n.images),g=r.parseTextures(n.textures,m),C=r.parseMaterials(n.materials,g),L=r.parseObject(n.object,f,C,g,l),G=r.parseSkeletons(n.skeletons,L);return r.bindSkeletons(L,G),L})()}parseShapes(n){const r={};if(void 0!==n)for(let l=0,c=n.length;l<c;l++){const f=(new fl).fromJSON(n[l]);r[f.uuid]=f}return r}parseSkeletons(n,r){const l={},c={};if(r.traverse(function(f){f.isBone&&(c[f.uuid]=f)}),void 0!==n)for(let f=0,m=n.length;f<m;f++){const g=(new ed).fromJSON(n[f],c);l[g.uuid]=g}return l}parseGeometries(n,r){const l={};if(void 0!==n){const f=new Ox;for(let m=0,g=n.length;m<g;m++){let C;const L=n[m];switch(L.type){case"BufferGeometry":case"InstancedBufferGeometry":C=f.parse(L);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?C=(new THREE.LegacyJSONLoader).parse(L,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:L.type in om?C=om[L.type].fromJSON(L,r):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${L.type}"`)}C.uuid=L.uuid,void 0!==L.name&&(C.name=L.name),!0===C.isBufferGeometry&&void 0!==L.userData&&(C.userData=L.userData),l[L.uuid]=C}}return l}parseMaterials(n,r){const l={},c={};if(void 0!==n){const f=new Uf;f.setTextures(r);for(let m=0,g=n.length;m<g;m++){const C=n[m];if("MultiMaterial"===C.type){const L=[];for(let G=0;G<C.materials.length;G++){const z=C.materials[G];void 0===l[z.uuid]&&(l[z.uuid]=f.parse(z)),L.push(l[z.uuid])}c[C.uuid]=L}else void 0===l[C.uuid]&&(l[C.uuid]=f.parse(C)),c[C.uuid]=l[C.uuid]}}return c}parseAnimations(n){const r={};if(void 0!==n)for(let l=0;l<n.length;l++){const f=Ed.parse(n[l]);r[f.uuid]=f}return r}parseImages(n,r){const l=this,c={};let f;function g(C){if("string"==typeof C){const L=C;return function(C){return l.manager.itemStart(C),f.load(C,function(){l.manager.itemEnd(C)},void 0,function(){l.manager.itemError(C),l.manager.itemEnd(C)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:l.resourcePath+L)}return C.data?{data:Ma(C.type,C.data),width:C.width,height:C.height}:null}if(void 0!==n&&n.length>0){const C=new um(r);f=new wd(C),f.setCrossOrigin(this.crossOrigin);for(let L=0,G=n.length;L<G;L++){const z=n[L],X=z.url;if(Array.isArray(X)){c[z.uuid]=[];for(let Q=0,re=X.length;Q<re;Q++){const Te=g(X[Q]);null!==Te&&(Te instanceof HTMLImageElement?c[z.uuid].push(Te):c[z.uuid].push(new Xl(Te.data,Te.width,Te.height)))}}else{const Q=g(z.url);null!==Q&&(c[z.uuid]=Q)}}}return c}parseImagesAsync(n){var r=this;return Ko(function*(){const l=r,c={};let f;function m(C){return g.apply(this,arguments)}function g(){return(g=Ko(function*(C){if("string"==typeof C){const L=C,G=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:l.resourcePath+L;return yield f.loadAsync(G)}return C.data?{data:Ma(C.type,C.data),width:C.width,height:C.height}:null})).apply(this,arguments)}if(void 0!==n&&n.length>0){f=new wd(r.manager),f.setCrossOrigin(r.crossOrigin);for(let C=0,L=n.length;C<L;C++){const G=n[C],z=G.url;if(Array.isArray(z)){c[G.uuid]=[];for(let X=0,Q=z.length;X<Q;X++){const re=z[X],ue=yield m(re);null!==ue&&(ue instanceof HTMLImageElement?c[G.uuid].push(ue):c[G.uuid].push(new Xl(ue.data,ue.width,ue.height)))}}else{const X=yield m(G.url);null!==X&&(c[G.uuid]=X)}}}return c})()}parseTextures(n,r){function l(f,m){return"number"==typeof f?f:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",f),m[f])}const c={};if(void 0!==n)for(let f=0,m=n.length;f<m;f++){const g=n[f];let C;void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid),void 0===r[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);const L=r[g.image];Array.isArray(L)?(C=new Vu(L),6===L.length&&(C.needsUpdate=!0)):(C=L&&L.data?new Xl(L.data,L.width,L.height):new Rn(L),L&&(C.needsUpdate=!0)),C.uuid=g.uuid,void 0!==g.name&&(C.name=g.name),void 0!==g.mapping&&(C.mapping=l(g.mapping,xg)),void 0!==g.offset&&C.offset.fromArray(g.offset),void 0!==g.repeat&&C.repeat.fromArray(g.repeat),void 0!==g.center&&C.center.fromArray(g.center),void 0!==g.rotation&&(C.rotation=g.rotation),void 0!==g.wrap&&(C.wrapS=l(g.wrap[0],vm),C.wrapT=l(g.wrap[1],vm)),void 0!==g.format&&(C.format=g.format),void 0!==g.type&&(C.type=g.type),void 0!==g.encoding&&(C.encoding=g.encoding),void 0!==g.minFilter&&(C.minFilter=l(g.minFilter,Ag)),void 0!==g.magFilter&&(C.magFilter=l(g.magFilter,Ag)),void 0!==g.anisotropy&&(C.anisotropy=g.anisotropy),void 0!==g.flipY&&(C.flipY=g.flipY),void 0!==g.premultiplyAlpha&&(C.premultiplyAlpha=g.premultiplyAlpha),void 0!==g.unpackAlignment&&(C.unpackAlignment=g.unpackAlignment),void 0!==g.userData&&(C.userData=g.userData),c[g.uuid]=C}return c}parseObject(n,r,l,c,f){let m,G,z;function g(X){return void 0===r[X]&&console.warn("THREE.ObjectLoader: Undefined geometry",X),r[X]}function C(X){if(void 0!==X){if(Array.isArray(X)){const Q=[];for(let re=0,ue=X.length;re<ue;re++){const Te=X[re];void 0===l[Te]&&console.warn("THREE.ObjectLoader: Undefined material",Te),Q.push(l[Te])}return Q}return void 0===l[X]&&console.warn("THREE.ObjectLoader: Undefined material",X),l[X]}}function L(X){return void 0===c[X]&&console.warn("THREE.ObjectLoader: Undefined texture",X),c[X]}switch(n.type){case"Scene":m=new ll,void 0!==n.background&&(m.background=Number.isInteger(n.background)?new zn(n.background):L(n.background)),void 0!==n.environment&&(m.environment=L(n.environment)),void 0!==n.fog&&("Fog"===n.fog.type?m.fog=new Mo(n.fog.color,n.fog.near,n.fog.far):"FogExp2"===n.fog.type&&(m.fog=new al(n.fog.color,n.fog.density)));break;case"PerspectiveCamera":m=new Ss(n.fov,n.aspect,n.near,n.far),void 0!==n.focus&&(m.focus=n.focus),void 0!==n.zoom&&(m.zoom=n.zoom),void 0!==n.filmGauge&&(m.filmGauge=n.filmGauge),void 0!==n.filmOffset&&(m.filmOffset=n.filmOffset),void 0!==n.view&&(m.view=Object.assign({},n.view));break;case"OrthographicCamera":m=new wr(n.left,n.right,n.top,n.bottom,n.near,n.far),void 0!==n.zoom&&(m.zoom=n.zoom),void 0!==n.view&&(m.view=Object.assign({},n.view));break;case"AmbientLight":m=new Ff(n.color,n.intensity);break;case"DirectionalLight":m=new Bf(n.color,n.intensity);break;case"PointLight":m=new If(n.color,n.intensity,n.distance,n.decay);break;case"RectAreaLight":m=new Of(n.color,n.intensity,n.width,n.height);break;case"SpotLight":m=new Df(n.color,n.intensity,n.distance,n.angle,n.penumbra,n.decay);break;case"HemisphereLight":m=new Cf(n.color,n.groundColor,n.intensity);break;case"LightProbe":m=(new _d).fromJSON(n);break;case"SkinnedMesh":G=g(n.geometry),z=C(n.material),m=new $h(G,z),void 0!==n.bindMode&&(m.bindMode=n.bindMode),void 0!==n.bindMatrix&&m.bindMatrix.fromArray(n.bindMatrix),void 0!==n.skeleton&&(m.skeleton=n.skeleton);break;case"Mesh":G=g(n.geometry),z=C(n.material),m=new Ys(G,z);break;case"InstancedMesh":G=g(n.geometry),z=C(n.material);const Q=n.instanceMatrix,re=n.instanceColor;m=new af(G,z,n.count),m.instanceMatrix=new hl(new Float32Array(Q.array),16),void 0!==re&&(m.instanceColor=new hl(new Float32Array(re.array),re.itemSize));break;case"LOD":m=new kp;break;case"Line":m=new ia(g(n.geometry),C(n.material));break;case"LineLoop":m=new id(g(n.geometry),C(n.material));break;case"LineSegments":m=new qo(g(n.geometry),C(n.material));break;case"PointCloud":case"Points":m=new od(g(n.geometry),C(n.material));break;case"Sprite":m=new Kh(C(n.material));break;case"Group":m=new wc;break;case"Bone":m=new of;break;default:m=new Er}if(m.uuid=n.uuid,void 0!==n.name&&(m.name=n.name),void 0!==n.matrix?(m.matrix.fromArray(n.matrix),void 0!==n.matrixAutoUpdate&&(m.matrixAutoUpdate=n.matrixAutoUpdate),m.matrixAutoUpdate&&m.matrix.decompose(m.position,m.quaternion,m.scale)):(void 0!==n.position&&m.position.fromArray(n.position),void 0!==n.rotation&&m.rotation.fromArray(n.rotation),void 0!==n.quaternion&&m.quaternion.fromArray(n.quaternion),void 0!==n.scale&&m.scale.fromArray(n.scale)),void 0!==n.castShadow&&(m.castShadow=n.castShadow),void 0!==n.receiveShadow&&(m.receiveShadow=n.receiveShadow),n.shadow&&(void 0!==n.shadow.bias&&(m.shadow.bias=n.shadow.bias),void 0!==n.shadow.normalBias&&(m.shadow.normalBias=n.shadow.normalBias),void 0!==n.shadow.radius&&(m.shadow.radius=n.shadow.radius),void 0!==n.shadow.mapSize&&m.shadow.mapSize.fromArray(n.shadow.mapSize),void 0!==n.shadow.camera&&(m.shadow.camera=this.parseObject(n.shadow.camera))),void 0!==n.visible&&(m.visible=n.visible),void 0!==n.frustumCulled&&(m.frustumCulled=n.frustumCulled),void 0!==n.renderOrder&&(m.renderOrder=n.renderOrder),void 0!==n.userData&&(m.userData=n.userData),void 0!==n.layers&&(m.layers.mask=n.layers),void 0!==n.children){const X=n.children;for(let Q=0;Q<X.length;Q++)m.add(this.parseObject(X[Q],r,l,c,f))}if(void 0!==n.animations){const X=n.animations;for(let Q=0;Q<X.length;Q++)m.animations.push(f[X[Q]])}if("LOD"===n.type){void 0!==n.autoUpdate&&(m.autoUpdate=n.autoUpdate);const X=n.levels;for(let Q=0;Q<X.length;Q++){const re=X[Q],ue=m.getObjectByProperty("uuid",re.object);void 0!==ue&&m.addLevel(ue,re.distance)}}return m}bindSkeletons(n,r){0!==Object.keys(r).length&&n.traverse(function(l){if(!0===l.isSkinnedMesh&&void 0!==l.skeleton){const c=r[l.skeleton];void 0===c?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(c,l.bindMatrix)}})}setTexturePath(n){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(n)}},b.ObjectSpaceNormalMap=1,b.OctahedronBufferGeometry=Va,b.OctahedronGeometry=Va,b.OneFactor=201,b.OneMinusDstAlphaFactor=207,b.OneMinusDstColorFactor=209,b.OneMinusSrcAlphaFactor=205,b.OneMinusSrcColorFactor=203,b.OrthographicCamera=wr,b.PCFShadowMap=1,b.PCFSoftShadowMap=2,b.PMREMGenerator=Ec,b.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new ji},b.Particle=function(h){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Kh(h)},b.ParticleBasicMaterial=function(h){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new dl(h)},b.ParticleSystem=function(h,n){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new od(h,n)},b.ParticleSystemMaterial=function(h){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new dl(h)},b.Path=da,b.PerspectiveCamera=Ss,b.Plane=Yo,b.PlaneBufferGeometry=Jc,b.PlaneGeometry=Jc,b.PlaneHelper=class extends ia{constructor(n,r=1,l=16776960){const c=l,m=new ji;m.setAttribute("position",new Mi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),m.computeBoundingSphere(),super(m,new To({color:c,toneMapped:!1})),this.type="PlaneHelper",this.plane=n,this.size=r;const C=new ji;C.setAttribute("position",new Mi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),C.computeBoundingSphere(),this.add(new Ys(C,new ta({color:c,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(n){let r=-this.plane.constant;Math.abs(r)<1e-8&&(r=1e-8),this.scale.set(.5*this.size,.5*this.size,r),this.children[0].material.side=r<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(n)}},b.PointCloud=function(h,n){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new od(h,n)},b.PointCloudMaterial=function(h){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new dl(h)},b.PointLight=If,b.PointLightHelper=class extends Ys{constructor(n,r,l){super(new gl(r,4,2),new ta({wireframe:!0,fog:!1,toneMapped:!1})),this.light=n,this.light.updateMatrixWorld(),this.color=l,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},b.Points=od,b.PointsMaterial=dl,b.PolarGridHelper=class extends qo{constructor(n=10,r=16,l=8,c=64,f=4473924,m=8947848){f=new zn(f),m=new zn(m);const g=[],C=[];for(let z=0;z<=r;z++){const X=z/r*(2*Math.PI),Q=Math.sin(X)*n,re=Math.cos(X)*n;g.push(0,0,0),g.push(Q,0,re);const ue=1&z?f:m;C.push(ue.r,ue.g,ue.b),C.push(ue.r,ue.g,ue.b)}for(let z=0;z<=l;z++){const X=1&z?f:m,Q=n-n/l*z;for(let re=0;re<c;re++){let ue=re/c*(2*Math.PI),Te=Math.sin(ue)*Q,se=Math.cos(ue)*Q;g.push(Te,0,se),C.push(X.r,X.g,X.b),ue=(re+1)/c*(2*Math.PI),Te=Math.sin(ue)*Q,se=Math.cos(ue)*Q,g.push(Te,0,se),C.push(X.r,X.g,X.b)}}const L=new ji;L.setAttribute("position",new Mi(g,3)),L.setAttribute("color",new Mi(C,3)),super(L,new To({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},b.PolyhedronBufferGeometry=Aa,b.PolyhedronGeometry=Aa,b.PositionalAudio=class extends nc{constructor(n){super(n),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(n){return this.panner.refDistance=n,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(n){return this.panner.rolloffFactor=n,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(n){return this.panner.distanceModel=n,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(n){return this.panner.maxDistance=n,this}setDirectionalCone(n,r,l){return this.panner.coneInnerAngle=n,this.panner.coneOuterAngle=r,this.panner.coneOuterGain=l,this}updateMatrixWorld(n){if(super.updateMatrixWorld(n),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Fc,Mg,vu),fh.set(0,0,1).applyQuaternion(Mg);const r=this.panner;if(r.positionX){const l=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(Fc.x,l),r.positionY.linearRampToValueAtTime(Fc.y,l),r.positionZ.linearRampToValueAtTime(Fc.z,l),r.orientationX.linearRampToValueAtTime(fh.x,l),r.orientationY.linearRampToValueAtTime(fh.y,l),r.orientationZ.linearRampToValueAtTime(fh.z,l)}else r.setPosition(Fc.x,Fc.y,Fc.z),r.setOrientation(fh.x,fh.y,fh.z)}},b.PropertyBinding=Ls,b.PropertyMixer=Nf,b.QuadraticBezierCurve=cu,b.QuadraticBezierCurve3=uu,b.Quaternion=as,b.QuaternionKeyframeTrack=ja,b.QuaternionLinearInterpolant=ah,b.REVISION=D,b.RGBADepthPacking=3201,b.RGBAFormat=bt,b.RGBAIntegerFormat=1033,b.RGBA_ASTC_10x10_Format=37819,b.RGBA_ASTC_10x5_Format=K,b.RGBA_ASTC_10x6_Format=37817,b.RGBA_ASTC_10x8_Format=37818,b.RGBA_ASTC_12x10_Format=37820,b.RGBA_ASTC_12x12_Format=37821,b.RGBA_ASTC_4x4_Format=37808,b.RGBA_ASTC_5x4_Format=37809,b.RGBA_ASTC_5x5_Format=37810,b.RGBA_ASTC_6x5_Format=37811,b.RGBA_ASTC_6x6_Format=37812,b.RGBA_ASTC_8x5_Format=37813,b.RGBA_ASTC_8x6_Format=37814,b.RGBA_ASTC_8x8_Format=37815,b.RGBA_BPTC_Format=36492,b.RGBA_ETC2_EAC_Format=37496,b.RGBA_PVRTC_2BPPV1_Format=35843,b.RGBA_PVRTC_4BPPV1_Format=35842,b.RGBA_S3TC_DXT1_Format=mn,b.RGBA_S3TC_DXT3_Format=Qt,b.RGBA_S3TC_DXT5_Format=Rt,b.RGB_ETC1_Format=36196,b.RGB_ETC2_Format=37492,b.RGB_PVRTC_2BPPV1_Format=35841,b.RGB_PVRTC_4BPPV1_Format=35840,b.RGB_S3TC_DXT1_Format=Ut,b.RGFormat=1030,b.RGIntegerFormat=1031,b.RawShaderMaterial=Xn,b.Ray=$o,b.Raycaster=class{constructor(n,r,l=0,c=1/0){this.ray=new $o(n,r),this.near=l,this.far=c,this.camera=null,this.layers=new kd,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,r){this.ray.set(n,r)}setFromCamera(n,r){r&&r.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(r).sub(this.ray.origin).normalize(),this.camera=r):r&&r.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(r.near+r.far)/(r.near-r.far)).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld),this.camera=r):console.error("THREE.Raycaster: Unsupported camera type: "+r.type)}intersectObject(n,r=!0,l=[]){return Lg(n,this,l,r),l.sort(Hf),l}intersectObjects(n,r=!0,l=[]){for(let c=0,f=n.length;c<f;c++)Lg(n[c],this,l,r);return l.sort(Hf),l}},b.RectAreaLight=Of,b.RedFormat=1028,b.RedIntegerFormat=1029,b.ReinhardToneMapping=2,b.RepeatWrapping=Tn,b.ReplaceStencilOp=7681,b.ReverseSubtractEquation=102,b.RingBufferGeometry=sh,b.RingGeometry=sh,b.Scene=ll,b.SceneUtils=Ab,b.ShaderChunk=Ur,b.ShaderLib=rl,b.ShaderMaterial=Ul,b.ShadowMaterial=xd,b.Shape=fl,b.ShapeBufferGeometry=Wa,b.ShapeGeometry=Wa,b.ShapePath=class{constructor(){this.type="ShapePath",this.color=new zn,this.subPaths=[],this.currentPath=null}moveTo(n,r){return this.currentPath=new da,this.subPaths.push(this.currentPath),this.currentPath.moveTo(n,r),this}lineTo(n,r){return this.currentPath.lineTo(n,r),this}quadraticCurveTo(n,r,l,c){return this.currentPath.quadraticCurveTo(n,r,l,c),this}bezierCurveTo(n,r,l,c,f,m){return this.currentPath.bezierCurveTo(n,r,l,c,f,m),this}splineThru(n){return this.currentPath.splineThru(n),this}toShapes(n,r){function l(J){const Be=[];for(let be=0,Ve=J.length;be<Ve;be++){const Ze=J[be],dt=new fl;dt.curves=Ze.curves,Be.push(dt)}return Be}function c(J,Be){const be=Be.length;let Ve=!1;for(let Ze=be-1,dt=0;dt<be;Ze=dt++){let yt=Be[Ze],It=Be[dt],Ht=It.x-yt.x,_e=It.y-yt.y;if(Math.abs(_e)>Number.EPSILON){if(_e<0&&(yt=Be[dt],Ht=-Ht,It=Be[Ze],_e=-_e),J.y<yt.y||J.y>It.y)continue;if(J.y===yt.y){if(J.x===yt.x)return!0}else{const Ke=_e*(J.x-yt.x)-Ht*(J.y-yt.y);if(0===Ke)return!0;if(Ke<0)continue;Ve=!Ve}}else{if(J.y!==yt.y)continue;if(It.x<=J.x&&J.x<=yt.x||yt.x<=J.x&&J.x<=It.x)return!0}}return Ve}const f=za.isClockWise,m=this.subPaths;if(0===m.length)return[];if(!0===r)return l(m);let g,C,L;const G=[];if(1===m.length)return C=m[0],L=new fl,L.curves=C.curves,G.push(L),G;let z=!f(m[0].getPoints());z=n?!z:z;const X=[],Q=[];let Te,se,re=[],ue=0;Q[ue]=void 0,re[ue]=[];for(let J=0,Be=m.length;J<Be;J++)C=m[J],Te=C.getPoints(),g=f(Te),g=n?!g:g,g?(!z&&Q[ue]&&ue++,Q[ue]={s:new fl,p:Te},Q[ue].s.curves=C.curves,z&&ue++,re[ue]=[]):re[ue].push({h:C,p:Te[0]});if(!Q[0])return l(m);if(Q.length>1){let J=!1;const Be=[];for(let be=0,Ve=Q.length;be<Ve;be++)X[be]=[];for(let be=0,Ve=Q.length;be<Ve;be++){const Ze=re[be];for(let dt=0;dt<Ze.length;dt++){const yt=Ze[dt];let It=!0;for(let Ht=0;Ht<Q.length;Ht++)c(yt.p,Q[Ht].p)&&(be!==Ht&&Be.push({froms:be,tos:Ht,hole:dt}),It?(It=!1,X[Ht].push(yt)):J=!0);It&&X[be].push(yt)}}Be.length>0&&(J||(re=X))}for(let J=0,Be=Q.length;J<Be;J++){L=Q[J].s,G.push(L),se=re[J];for(let be=0,Ve=se.length;be<Ve;be++)L.holes.push(se[be].h)}return G}},b.ShapeUtils=za,b.ShortType=1011,b.Skeleton=ed,b.SkeletonHelper=Sm,b.SkinnedMesh=$h,b.SmoothShading=2,b.Sphere=Ca,b.SphereBufferGeometry=gl,b.SphereGeometry=gl,b.Spherical=class{constructor(n=1,r=0,l=0){return this.radius=n,this.phi=r,this.theta=l,this}set(n,r,l){return this.radius=n,this.phi=r,this.theta=l,this}copy(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this}makeSafe(){const n=1e-6;return this.phi=Math.max(n,Math.min(Math.PI-n,this.phi)),this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,r,l){return this.radius=Math.sqrt(n*n+r*r+l*l),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,l),this.phi=Math.acos(Po(r/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},b.SphericalHarmonics3=uh,b.SplineCurve=eh,b.SpotLight=Df,b.SpotLightHelper=class extends Er{constructor(n,r){super(),this.light=n,this.light.updateMatrixWorld(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const l=new ji,c=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let m=0,g=1,C=32;m<C;m++,g++){const L=m/C*Math.PI*2,G=g/C*Math.PI*2;c.push(Math.cos(L),Math.sin(L),1,Math.cos(G),Math.sin(G),1)}l.setAttribute("position",new Mi(c,3));const f=new To({fog:!1,toneMapped:!1});this.cone=new qo(l,f),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),Zx.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Zx),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},b.Sprite=Kh,b.SpriteMaterial=zl,b.SrcAlphaFactor=204,b.SrcAlphaSaturateFactor=210,b.SrcColorFactor=202,b.StaticCopyUsage=35046,b.StaticDrawUsage=Th,b.StaticReadUsage=35045,b.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ss,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ss,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(n){const r=this._cache;if(r.focus!==n.focus||r.fov!==n.fov||r.aspect!==n.aspect*this.aspect||r.near!==n.near||r.far!==n.far||r.zoom!==n.zoom||r.eyeSep!==this.eyeSep){r.focus=n.focus,r.fov=n.fov,r.aspect=n.aspect*this.aspect,r.near=n.near,r.far=n.far,r.zoom=n.zoom,r.eyeSep=this.eyeSep,hh.copy(n.projectionMatrix);const c=r.eyeSep/2,f=c*r.near/r.focus,m=r.near*Math.tan(bo*r.fov*.5)/r.zoom;let g,C;Pc.elements[12]=-c,Am.elements[12]=c,g=-m*r.aspect+f,C=m*r.aspect+f,hh.elements[0]=2*r.near/(C-g),hh.elements[8]=(C+g)/(C-g),this.cameraL.projectionMatrix.copy(hh),g=-m*r.aspect-f,C=m*r.aspect-f,hh.elements[0]=2*r.near/(C-g),hh.elements[8]=(C+g)/(C-g),this.cameraR.projectionMatrix.copy(hh)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(Pc),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(Am)}},b.StreamCopyUsage=35042,b.StreamDrawUsage=35040,b.StreamReadUsage=35041,b.StringKeyframeTrack=vl,b.SubtractEquation=101,b.SubtractiveBlending=3,b.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b.TangentSpaceNormalMap=0,b.TetrahedronBufferGeometry=Kl,b.TetrahedronGeometry=Kl,b.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new ji},b.Texture=Rn,b.TextureLoader=Ya,b.TorusBufferGeometry=Jl,b.TorusGeometry=Jl,b.TorusKnotBufferGeometry=fu,b.TorusKnotGeometry=fu,b.Triangle=Xs,b.TriangleFanDrawMode=2,b.TriangleStripDrawMode=1,b.TrianglesDrawMode=0,b.TubeBufferGeometry=pu,b.TubeGeometry=pu,b.UVMapping=H,b.Uint16Attribute=function(h,n){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Pa(h,n)},b.Uint16BufferAttribute=Pa,b.Uint32Attribute=function(h,n){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new qc(h,n)},b.Uint32BufferAttribute=qc,b.Uint8Attribute=function(h,n){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ro(h,n)},b.Uint8BufferAttribute=ro,b.Uint8ClampedAttribute=function(h,n){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Qm(h,n)},b.Uint8ClampedBufferAttribute=Qm,b.Uniform=kf,b.UniformsLib=Jn,b.UniformsUtils=Xd,b.UnsignedByteType=Sn,b.UnsignedInt248Type=Un,b.UnsignedIntType=ur,b.UnsignedShort4444Type=1017,b.UnsignedShort5551Type=1018,b.UnsignedShortType=Zi,b.VSMShadowMap=3,b.Vector2=st,b.Vector3=Oe,b.Vector4=Or,b.VectorKeyframeTrack=Lc,b.Vertex=function(h,n,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Oe(h,n,r)},b.VertexColors=2,b.VideoTexture=pg,b.WebGL1Renderer=nu,b.WebGLCubeRenderTarget=Yd,b.WebGLMultipleRenderTargets=Od,b.WebGLMultisampleRenderTarget=Ud,b.WebGLRenderTarget=Ro,b.WebGLRenderTargetCube=function(h,n,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Yd(h,r)},b.WebGLRenderer=fs,b.WebGLUtils=ug,b.WireframeGeometry=Af,b.WireframeHelper=function(h,n){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new qo(new Af(h.geometry),new To({color:void 0!==n?n:16777215}))},b.WrapAroundEnding=rr,b.XHRLoader=function(h){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new tc(h)},b.ZeroCurvatureEnding=yi,b.ZeroFactor=200,b.ZeroSlopeEnding=Li,b.ZeroStencilOp=0,b._SRGBAFormat=1035,b.sRGBEncoding=br,Object.defineProperty(b,"__esModule",{value:!0})}("object"==typeof Ue&&void 0!==ae?Ue:(b="undefined"!=typeof globalThis?globalThis:b||self).THREE={})},{}],58:[function(k,ae,Ue){!function(){function D(B,I){switch(I){case THREE.sRGBEncoding:B.convertSRGBToLinear();break;case THREE.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return B}THREE.LightProbeGenerator=class{static fromCubeTexture(I){let w=0;const T=new THREE.Vector3,x=new THREE.Vector3,S=new THREE.Color,y=[0,0,0,0,0,0,0,0,0],M=new THREE.SphericalHarmonics3,E=M.coefficients;for(let R=0;R<6;R++){const F=I.image[R],O=F.width,V=F.height,Y=document.createElement("canvas");Y.width=O,Y.height=V;const ee=Y.getContext("2d");ee.drawImage(F,0,0,O,V);const oe=ee.getImageData(0,0,O,V),Ee=oe.data,ve=oe.width,Ce=2/ve;for(let He=0,we=Ee.length;He<we;He+=4){S.setRGB(Ee[He]/255,Ee[He+1]/255,Ee[He+2]/255),D(S,I.encoding);const ce=He/4,Me=(ce%ve+.5)*Ce-1,fe=1-(Math.floor(ce/ve)+.5)*Ce;switch(R){case 0:T.set(-1,fe,-Me);break;case 1:T.set(1,fe,Me);break;case 2:T.set(-Me,1,-fe);break;case 3:T.set(-Me,-1,fe);break;case 4:T.set(-Me,fe,1);break;case 5:T.set(Me,fe,-1)}const je=T.lengthSq(),it=4/(Math.sqrt(je)*je);w+=it,x.copy(T).normalize(),THREE.SphericalHarmonics3.getBasisAt(x,y);for(let ft=0;ft<9;ft++)E[ft].x+=y[ft]*S.r*it,E[ft].y+=y[ft]*S.g*it,E[ft].z+=y[ft]*S.b*it}}const _=4*Math.PI/w;for(let R=0;R<9;R++)E[R].x*=_,E[R].y*=_,E[R].z*=_;return new THREE.LightProbe(M)}static fromCubeRenderTarget(I,w){let T=0;const x=new THREE.Vector3,S=new THREE.Vector3,y=new THREE.Color,M=[0,0,0,0,0,0,0,0,0],E=new THREE.SphericalHarmonics3,_=E.coefficients;for(let F=0;F<6;F++){const O=w.width,V=new Uint8Array(O*O*4);I.readRenderTargetPixels(w,0,0,O,O,V,F);const Y=2/O;for(let ee=0,oe=V.length;ee<oe;ee+=4){y.setRGB(V[ee]/255,V[ee+1]/255,V[ee+2]/255),D(y,w.texture.encoding);const Ee=ee/4,ve=(Ee%O+.5)*Y-1,Ce=1-(Math.floor(Ee/O)+.5)*Y;switch(F){case 0:x.set(1,Ce,-ve);break;case 1:x.set(-1,Ce,ve);break;case 2:x.set(ve,1,-Ce);break;case 3:x.set(ve,-1,Ce);break;case 4:x.set(ve,Ce,1);break;case 5:x.set(-ve,Ce,-1)}const He=x.lengthSq(),we=4/(Math.sqrt(He)*He);T+=we,S.copy(x).normalize(),THREE.SphericalHarmonics3.getBasisAt(S,M);for(let ce=0;ce<9;ce++)_[ce].x+=M[ce]*y.r*we,_[ce].y+=M[ce]*y.g*we,_[ce].z+=M[ce]*y.b*we}}const R=4*Math.PI/T;for(let F=0;F<9;F++)_[F].x*=R,_[F].y*=R,_[F].z*=R;return new THREE.LightProbe(E)}}}()},{}],59:[function(k,ae,Ue){!function(){const b=new WeakMap;class D extends THREE.Loader{constructor(w){super(w),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(w){return this.decoderPath=w,this}setDecoderConfig(w){return this.decoderConfig=w,this}setWorkerLimit(w){return this.workerLimit=w,this}load(w,T,x,S){const y=new THREE.FileLoader(this.manager);y.setPath(this.path),y.setResponseType("arraybuffer"),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials),y.load(w,M=>{this.decodeGeometry(M,{attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1}).then(T).catch(S)},x,S)}decodeDracoFile(w,T,x,S){this.decodeGeometry(w,{attributeIDs:x||this.defaultAttributeIDs,attributeTypes:S||this.defaultAttributeTypes,useUniqueIDs:!!x}).then(T)}decodeGeometry(w,T){for(const _ in T.attributeTypes){const R=T.attributeTypes[_];void 0!==R.BYTES_PER_ELEMENT&&(T.attributeTypes[_]=R.name)}const x=JSON.stringify(T);if(b.has(w)){const _=b.get(w);if(_.key===x)return _.promise;if(0===w.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let S;const y=this.workerNextTaskID++,E=this._getWorker(y,w.byteLength).then(_=>(S=_,new Promise((R,F)=>{S._callbacks[y]={resolve:R,reject:F},S.postMessage({type:"decode",id:y,taskConfig:T,buffer:w},[w])}))).then(_=>this._createGeometry(_.geometry));return E.catch(()=>!0).then(()=>{S&&y&&this._releaseTask(S,y)}),b.set(w,{key:x,promise:E}),E}_createGeometry(w){const T=new THREE.BufferGeometry;w.index&&T.setIndex(new THREE.BufferAttribute(w.index.array,1));for(let x=0;x<w.attributes.length;x++){const S=w.attributes[x];T.setAttribute(S.name,new THREE.BufferAttribute(S.array,S.itemSize))}return T}_loadLibrary(w,T){const x=new THREE.FileLoader(this.manager);return x.setPath(this.decoderPath),x.setResponseType(T),x.setWithCredentials(this.withCredentials),new Promise((S,y)=>{x.load(w,S,void 0,y)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const w="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,T=[];return w?T.push(this._loadLibrary("draco_decoder.js","text")):(T.push(this._loadLibrary("draco_wasm_wrapper.js","text")),T.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(T).then(x=>{const S=x[0];w||(this.decoderConfig.wasmBinary=x[1]);const y=B.toString(),M=["/* draco decoder */",S,"","/* worker */",y.substring(y.indexOf("{")+1,y.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([M]))}),this.decoderPending}_getWorker(w,T){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const S=new Worker(this.workerSourceURL);S._callbacks={},S._taskCosts={},S._taskLoad=0,S.postMessage({type:"init",decoderConfig:this.decoderConfig}),S.onmessage=function(y){const M=y.data;switch(M.type){case"decode":S._callbacks[M.id].resolve(M);break;case"error":S._callbacks[M.id].reject(M);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+M.type+'"')}},this.workerPool.push(S)}else this.workerPool.sort(function(S,y){return S._taskLoad>y._taskLoad?-1:1});const x=this.workerPool[this.workerPool.length-1];return x._taskCosts[w]=T,x._taskLoad+=T,x})}_releaseTask(w,T){w._taskLoad-=w._taskCosts[T],delete w._callbacks[T],delete w._taskCosts[T]}debug(){console.log("Task load: ",this.workerPool.map(w=>w._taskLoad))}dispose(){for(let w=0;w<this.workerPool.length;++w)this.workerPool[w].terminate();return this.workerPool.length=0,this}}function B(){let I,w;function T(M,E,_,R){const F=R.attributeIDs,O=R.attributeTypes;let V,Y;const ee=E.GetEncodedGeometryType(_);if(ee===M.TRIANGULAR_MESH)V=new M.Mesh,Y=E.DecodeBufferToMesh(_,V);else{if(ee!==M.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");V=new M.PointCloud,Y=E.DecodeBufferToPointCloud(_,V)}if(!Y.ok()||0===V.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+Y.error_msg());const oe={index:null,attributes:[]};for(const Ee in F){const ve=self[O[Ee]];let Ce,He;if(R.useUniqueIDs)He=F[Ee],Ce=E.GetAttributeByUniqueId(V,He);else{if(He=E.GetAttributeId(V,M[F[Ee]]),-1===He)continue;Ce=E.GetAttribute(V,He)}oe.attributes.push(S(M,E,V,Ee,ve,Ce))}return ee===M.TRIANGULAR_MESH&&(oe.index=function(M,E,_){const F=3*_.num_faces(),O=4*F,V=M._malloc(O);E.GetTrianglesUInt32Array(_,O,V);const Y=new Uint32Array(M.HEAPF32.buffer,V,F).slice();return M._free(V),{array:Y,itemSize:1}}(M,E,V)),M.destroy(V),oe}function S(M,E,_,R,F,O){const V=O.num_components(),ee=_.num_points()*V,oe=ee*F.BYTES_PER_ELEMENT,Ee=function(M,E){switch(E){case Float32Array:return M.DT_FLOAT32;case Int8Array:return M.DT_INT8;case Int16Array:return M.DT_INT16;case Int32Array:return M.DT_INT32;case Uint8Array:return M.DT_UINT8;case Uint16Array:return M.DT_UINT16;case Uint32Array:return M.DT_UINT32}}(M,F),ve=M._malloc(oe);E.GetAttributeDataArrayForAllPoints(_,O,Ee,oe,ve);const Ce=new F(M.HEAPF32.buffer,ve,ee).slice();return M._free(ve),{name:R,array:Ce,itemSize:V}}onmessage=function(M){const E=M.data;switch(E.type){case"init":I=E.decoderConfig,w=new Promise(function(F){I.onModuleLoaded=function(O){F({draco:O})},DracoDecoderModule(I)});break;case"decode":const _=E.buffer,R=E.taskConfig;w.then(F=>{const O=F.draco,V=new O.Decoder,Y=new O.DecoderBuffer;Y.Init(new Int8Array(_),_.byteLength);try{const ee=T(O,V,Y,R),oe=ee.attributes.map(Ee=>Ee.array.buffer);ee.index&&oe.push(ee.index.array.buffer),self.postMessage({type:"decode",id:E.id,geometry:ee},oe)}catch(ee){console.error(ee),self.postMessage({type:"error",id:E.id,error:ee.message})}finally{O.destroy(Y),O.destroy(V)}})}}}THREE.DRACOLoader=D}()},{}],60:[function(k,ae,Ue){!function(){class b extends THREE.Loader{constructor(le){super(le),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(he){return new T(he)}),this.register(function(he){return new _(he)}),this.register(function(he){return new R(he)}),this.register(function(he){return new x(he)}),this.register(function(he){return new S(he)}),this.register(function(he){return new y(he)}),this.register(function(he){return new M(he)}),this.register(function(he){return new E(he)}),this.register(function(he){return new I(he)}),this.register(function(he){return new F(he)})}load(le,he,Se,me){const Re=this;let ie;ie=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(le),this.manager.itemStart(le);const W=function(de){me?me(de):console.error(de),Re.manager.itemError(le),Re.manager.itemEnd(le)},H=new THREE.FileLoader(this.manager);H.setPath(this.path),H.setResponseType("arraybuffer"),H.setRequestHeader(this.requestHeader),H.setWithCredentials(this.withCredentials),H.load(le,function(de){try{Re.parse(de,ie,function(Pe){he(Pe),Re.manager.itemEnd(le)},W)}catch(Pe){W(Pe)}},Se,W)}setDRACOLoader(le){return this.dracoLoader=le,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(le){return this.ktx2Loader=le,this}setMeshoptDecoder(le){return this.meshoptDecoder=le,this}register(le){return-1===this.pluginCallbacks.indexOf(le)&&this.pluginCallbacks.push(le),this}unregister(le){return-1!==this.pluginCallbacks.indexOf(le)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(le),1),this}parse(le,he,Se,me){let Re;const ie={},W={};if("string"==typeof le)Re=le;else if(THREE.LoaderUtils.decodeText(new Uint8Array(le,0,4))===O){try{ie[B.KHR_BINARY_GLTF]=new ee(le)}catch(Ye){return void(me&&me(Ye))}Re=ie[B.KHR_BINARY_GLTF].content}else Re=THREE.LoaderUtils.decodeText(new Uint8Array(le));const H=JSON.parse(Re);if(void 0===H.asset||H.asset.version[0]<2)return void(me&&me(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const de=new bs(H,{path:he||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});de.fileLoader.setRequestHeader(this.requestHeader);for(let Pe=0;Pe<this.pluginCallbacks.length;Pe++){const Ye=this.pluginCallbacks[Pe](de);W[Ye.name]=Ye,ie[Ye.name]=!0}if(H.extensionsUsed)for(let Pe=0;Pe<H.extensionsUsed.length;++Pe){const Ye=H.extensionsUsed[Pe],rt=H.extensionsRequired||[];switch(Ye){case B.KHR_MATERIALS_UNLIT:ie[Ye]=new w;break;case B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:ie[Ye]=new Ce;break;case B.KHR_DRACO_MESH_COMPRESSION:ie[Ye]=new oe(H,this.dracoLoader);break;case B.KHR_TEXTURE_TRANSFORM:ie[Ye]=new Ee;break;case B.KHR_MESH_QUANTIZATION:ie[Ye]=new He;break;default:rt.indexOf(Ye)>=0&&void 0===W[Ye]&&console.warn('THREE.GLTFLoader: Unknown extension "'+Ye+'".')}}de.setExtensions(ie),de.setPlugins(W),de.parse(Se,me)}parseAsync(le,he){const Se=this;return new Promise(function(me,Re){Se.parse(le,he,me,Re)})}}function D(){let cn={};return{get:function(le){return cn[le]},add:function(le,he){cn[le]=he},remove:function(le){delete cn[le]},removeAll:function(){cn={}}}}const B={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class I{constructor(le){this.parser=le,this.name=B.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const le=this.parser,he=this.parser.json.nodes||[];for(let Se=0,me=he.length;Se<me;Se++){const Re=he[Se];Re.extensions&&Re.extensions[this.name]&&void 0!==Re.extensions[this.name].light&&le._addNodeRef(this.cache,Re.extensions[this.name].light)}}_loadLight(le){const he=this.parser,Se="light:"+le;let me=he.cache.get(Se);if(me)return me;const Re=he.json,H=((Re.extensions&&Re.extensions[this.name]||{}).lights||[])[le];let de;const Pe=new THREE.Color(16777215);void 0!==H.color&&Pe.fromArray(H.color);const Ye=void 0!==H.range?H.range:0;switch(H.type){case"directional":de=new THREE.DirectionalLight(Pe),de.target.position.set(0,0,-1),de.add(de.target);break;case"point":de=new THREE.PointLight(Pe),de.distance=Ye;break;case"spot":de=new THREE.SpotLight(Pe),de.distance=Ye,H.spot=H.spot||{},H.spot.innerConeAngle=void 0!==H.spot.innerConeAngle?H.spot.innerConeAngle:0,H.spot.outerConeAngle=void 0!==H.spot.outerConeAngle?H.spot.outerConeAngle:Math.PI/4,de.angle=H.spot.outerConeAngle,de.penumbra=1-H.spot.innerConeAngle/H.spot.outerConeAngle,de.target.position.set(0,0,-1),de.add(de.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+H.type)}return de.position.set(0,0,0),de.decay=2,void 0!==H.intensity&&(de.intensity=H.intensity),de.name=he.createUniqueName(H.name||"light_"+le),me=Promise.resolve(de),he.cache.add(Se,me),me}createNodeAttachment(le){const he=this,Se=this.parser,Re=Se.json.nodes[le],W=(Re.extensions&&Re.extensions[this.name]||{}).light;return void 0===W?null:this._loadLight(W).then(function(H){return Se._getNodeRef(he.cache,W,H)})}}class w{constructor(){this.name=B.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(le,he,Se){const me=[];le.color=new THREE.Color(1,1,1),le.opacity=1;const Re=he.pbrMetallicRoughness;if(Re){if(Array.isArray(Re.baseColorFactor)){const ie=Re.baseColorFactor;le.color.fromArray(ie),le.opacity=ie[3]}void 0!==Re.baseColorTexture&&me.push(Se.assignTexture(le,"map",Re.baseColorTexture))}return Promise.all(me)}}class T{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_CLEARCOAT}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const Se=this.parser,me=Se.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=[],ie=me.extensions[this.name];if(void 0!==ie.clearcoatFactor&&(he.clearcoat=ie.clearcoatFactor),void 0!==ie.clearcoatTexture&&Re.push(Se.assignTexture(he,"clearcoatMap",ie.clearcoatTexture)),void 0!==ie.clearcoatRoughnessFactor&&(he.clearcoatRoughness=ie.clearcoatRoughnessFactor),void 0!==ie.clearcoatRoughnessTexture&&Re.push(Se.assignTexture(he,"clearcoatRoughnessMap",ie.clearcoatRoughnessTexture)),void 0!==ie.clearcoatNormalTexture&&(Re.push(Se.assignTexture(he,"clearcoatNormalMap",ie.clearcoatNormalTexture)),void 0!==ie.clearcoatNormalTexture.scale)){const W=ie.clearcoatNormalTexture.scale;he.clearcoatNormalScale=new THREE.Vector2(W,W)}return Promise.all(Re)}}class x{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_SHEEN}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const Se=this.parser,me=Se.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=[];he.sheenColor=new THREE.Color(0,0,0),he.sheenRoughness=0,he.sheen=1;const ie=me.extensions[this.name];return void 0!==ie.sheenColorFactor&&he.sheenColor.fromArray(ie.sheenColorFactor),void 0!==ie.sheenRoughnessFactor&&(he.sheenRoughness=ie.sheenRoughnessFactor),void 0!==ie.sheenColorTexture&&Re.push(Se.assignTexture(he,"sheenColorMap",ie.sheenColorTexture)),void 0!==ie.sheenRoughnessTexture&&Re.push(Se.assignTexture(he,"sheenRoughnessMap",ie.sheenRoughnessTexture)),Promise.all(Re)}}class S{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_TRANSMISSION}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const Se=this.parser,me=Se.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=[],ie=me.extensions[this.name];return void 0!==ie.transmissionFactor&&(he.transmission=ie.transmissionFactor),void 0!==ie.transmissionTexture&&Re.push(Se.assignTexture(he,"transmissionMap",ie.transmissionTexture)),Promise.all(Re)}}class y{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_VOLUME}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const Se=this.parser,me=Se.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=[],ie=me.extensions[this.name];he.thickness=void 0!==ie.thicknessFactor?ie.thicknessFactor:0,void 0!==ie.thicknessTexture&&Re.push(Se.assignTexture(he,"thicknessMap",ie.thicknessTexture)),he.attenuationDistance=ie.attenuationDistance||0;const W=ie.attenuationColor||[1,1,1];return he.attenuationColor=new THREE.Color(W[0],W[1],W[2]),Promise.all(Re)}}class M{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_IOR}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const me=this.parser.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=me.extensions[this.name];return he.ior=void 0!==Re.ior?Re.ior:1.5,Promise.resolve()}}class E{constructor(le){this.parser=le,this.name=B.KHR_MATERIALS_SPECULAR}getMaterialType(le){const Se=this.parser.json.materials[le];return Se.extensions&&Se.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(le,he){const Se=this.parser,me=Se.json.materials[le];if(!me.extensions||!me.extensions[this.name])return Promise.resolve();const Re=[],ie=me.extensions[this.name];he.specularIntensity=void 0!==ie.specularFactor?ie.specularFactor:1,void 0!==ie.specularTexture&&Re.push(Se.assignTexture(he,"specularIntensityMap",ie.specularTexture));const W=ie.specularColorFactor||[1,1,1];return he.specularColor=new THREE.Color(W[0],W[1],W[2]),void 0!==ie.specularColorTexture&&Re.push(Se.assignTexture(he,"specularColorMap",ie.specularColorTexture).then(function(H){H.encoding=THREE.sRGBEncoding})),Promise.all(Re)}}class _{constructor(le){this.parser=le,this.name=B.KHR_TEXTURE_BASISU}loadTexture(le){const he=this.parser,Se=he.json,me=Se.textures[le];if(!me.extensions||!me.extensions[this.name])return null;const ie=Se.images[me.extensions[this.name].source],W=he.options.ktx2Loader;if(!W){if(Se.extensionsRequired&&Se.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return he.loadTextureImage(le,ie,W)}}class R{constructor(le){this.parser=le,this.name=B.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(le){const he=this.name,Se=this.parser,me=Se.json,Re=me.textures[le];if(!Re.extensions||!Re.extensions[he])return null;const W=me.images[Re.extensions[he].source];let H=Se.textureLoader;if(W.uri){const de=Se.options.manager.getHandler(W.uri);null!==de&&(H=de)}return this.detectSupport().then(function(de){if(de)return Se.loadTextureImage(le,W,H);if(me.extensionsRequired&&me.extensionsRequired.indexOf(he)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Se.loadTexture(le)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(le){const he=new Image;he.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",he.onload=he.onerror=function(){le(1===he.height)}})),this.isSupported}}class F{constructor(le){this.name=B.EXT_MESHOPT_COMPRESSION,this.parser=le}loadBufferView(le){const he=this.parser.json,Se=he.bufferViews[le];if(Se.extensions&&Se.extensions[this.name]){const me=Se.extensions[this.name],Re=this.parser.getDependency("buffer",me.buffer),ie=this.parser.options.meshoptDecoder;if(!ie||!ie.supported){if(he.extensionsRequired&&he.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([Re,ie.ready]).then(function(W){const H=me.byteOffset||0,de=me.byteLength||0,Pe=me.count,Ye=me.byteStride,rt=new ArrayBuffer(Pe*Ye),Dt=new Uint8Array(W[0],H,de);return ie.decodeGltfBuffer(new Uint8Array(rt),Pe,Ye,Dt,me.mode,me.filter),rt})}return null}}const O="glTF",Y_JSON=1313821514,Y_BIN=5130562;class ee{constructor(le){this.name=B.KHR_BINARY_GLTF,this.content=null,this.body=null;const he=new DataView(le,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(le.slice(0,4))),version:he.getUint32(4,!0),length:he.getUint32(8,!0)},this.header.magic!==O)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Se=this.header.length-12,me=new DataView(le,12);let Re=0;for(;Re<Se;){const ie=me.getUint32(Re,!0);Re+=4;const W=me.getUint32(Re,!0);if(Re+=4,W===Y_JSON){const H=new Uint8Array(le,12+Re,ie);this.content=THREE.LoaderUtils.decodeText(H)}else if(W===Y_BIN){const H=12+Re;this.body=le.slice(H,H+ie)}Re+=ie}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class oe{constructor(le,he){if(!he)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=B.KHR_DRACO_MESH_COMPRESSION,this.json=le,this.dracoLoader=he,this.dracoLoader.preload()}decodePrimitive(le,he){const Se=this.json,me=this.dracoLoader,Re=le.extensions[this.name].bufferView,ie=le.extensions[this.name].attributes,W={},H={},de={};for(const Pe in ie){const Ye=_t[Pe]||Pe.toLowerCase();W[Ye]=ie[Pe]}for(const Pe in le.attributes){const Ye=_t[Pe]||Pe.toLowerCase();if(void 0!==ie[Pe]){const rt=Se.accessors[le.attributes[Pe]];de[Ye]=je[rt.componentType],H[Ye]=!0===rt.normalized}}return he.getDependency("bufferView",Re).then(function(Pe){return new Promise(function(Ye){me.decodeDracoFile(Pe,function(rt){for(const Dt in rt.attributes){const un=rt.attributes[Dt],Tn=H[Dt];void 0!==Tn&&(un.normalized=Tn)}Ye(rt)},W,de)})})}}class Ee{constructor(){this.name=B.KHR_TEXTURE_TRANSFORM}extendTexture(le,he){return void 0!==he.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===he.offset&&void 0===he.rotation&&void 0===he.scale||(le=le.clone(),void 0!==he.offset&&le.offset.fromArray(he.offset),void 0!==he.rotation&&(le.rotation=he.rotation),void 0!==he.scale&&le.repeat.fromArray(he.scale),le.needsUpdate=!0),le}}class ve extends THREE.MeshStandardMaterial{constructor(le){super(),this.isGLTFSpecularGlossinessMaterial=!0;const he=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),Se=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),me=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),Re=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),ie=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),W={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=W,this.onBeforeCompile=function(H){for(const de in W)H.uniforms[de]=W[de];H.fragmentShader=H.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",he).replace("#include <metalnessmap_pars_fragment>",Se).replace("#include <roughnessmap_fragment>",me).replace("#include <metalnessmap_fragment>",Re).replace("#include <lights_physical_fragment>",ie)},Object.defineProperties(this,{specular:{get:function(){return W.specular.value},set:function(H){W.specular.value=H}},specularMap:{get:function(){return W.specularMap.value},set:function(H){W.specularMap.value=H,H?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return W.glossiness.value},set:function(H){W.glossiness.value=H}},glossinessMap:{get:function(){return W.glossinessMap.value},set:function(H){W.glossinessMap.value=H,H?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(le)}copy(le){return super.copy(le),this.specularMap=le.specularMap,this.specular.copy(le.specular),this.glossinessMap=le.glossinessMap,this.glossiness=le.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ce{constructor(){this.name=B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return ve}extendParams(le,he,Se){const me=he.extensions[this.name];le.color=new THREE.Color(1,1,1),le.opacity=1;const Re=[];if(Array.isArray(me.diffuseFactor)){const ie=me.diffuseFactor;le.color.fromArray(ie),le.opacity=ie[3]}if(void 0!==me.diffuseTexture&&Re.push(Se.assignTexture(le,"map",me.diffuseTexture)),le.emissive=new THREE.Color(0,0,0),le.glossiness=void 0!==me.glossinessFactor?me.glossinessFactor:1,le.specular=new THREE.Color(1,1,1),Array.isArray(me.specularFactor)&&le.specular.fromArray(me.specularFactor),void 0!==me.specularGlossinessTexture){const ie=me.specularGlossinessTexture;Re.push(Se.assignTexture(le,"glossinessMap",ie)),Re.push(Se.assignTexture(le,"specularMap",ie))}return Promise.all(Re)}createMaterial(le){const he=new ve(le);return he.fog=!0,he.color=le.color,he.map=void 0===le.map?null:le.map,he.lightMap=null,he.lightMapIntensity=1,he.aoMap=void 0===le.aoMap?null:le.aoMap,he.aoMapIntensity=1,he.emissive=le.emissive,he.emissiveIntensity=1,he.emissiveMap=void 0===le.emissiveMap?null:le.emissiveMap,he.bumpMap=void 0===le.bumpMap?null:le.bumpMap,he.bumpScale=1,he.normalMap=void 0===le.normalMap?null:le.normalMap,he.normalMapType=THREE.TangentSpaceNormalMap,le.normalScale&&(he.normalScale=le.normalScale),he.displacementMap=null,he.displacementScale=1,he.displacementBias=0,he.specularMap=void 0===le.specularMap?null:le.specularMap,he.specular=le.specular,he.glossinessMap=void 0===le.glossinessMap?null:le.glossinessMap,he.glossiness=le.glossiness,he.alphaMap=null,he.envMap=void 0===le.envMap?null:le.envMap,he.envMapIntensity=1,he.refractionRatio=.98,he}}class He{constructor(){this.name=B.KHR_MESH_QUANTIZATION}}class we extends THREE.Interpolant{constructor(le,he,Se,me){super(le,he,Se,me)}copySampleValue_(le){const he=this.resultBuffer,Se=this.sampleValues,me=this.valueSize,Re=le*me*3+me;for(let ie=0;ie!==me;ie++)he[ie]=Se[Re+ie];return he}}we.prototype.beforeStart_=we.prototype.copySampleValue_,we.prototype.afterEnd_=we.prototype.copySampleValue_,we.prototype.interpolate_=function(cn,le,he,Se){const me=this.resultBuffer,Re=this.sampleValues,ie=this.valueSize,W=2*ie,H=3*ie,de=Se-le,Pe=(he-le)/de,Ye=Pe*Pe,rt=Ye*Pe,Dt=cn*H,un=Dt-H,Tn=-2*rt+3*Ye,dn=rt-Ye,rn=1-Tn,On=dn-Ye+Pe;for(let Nn=0;Nn!==ie;Nn++)me[Nn]=rn*Re[un+Nn+ie]+On*(Re[un+Nn+W]*de)+Tn*Re[Dt+Nn+ie]+dn*(Re[Dt+Nn]*de);return me};const ce=new THREE.Quaternion;class Me extends we{interpolate_(le,he,Se,me){const Re=super.interpolate_(le,he,Se,me);return ce.fromArray(Re).normalize().toArray(Re),Re}}const fe_POINTS=0,fe_LINES=1,fe_LINE_LOOP=2,fe_LINE_STRIP=3,fe_TRIANGLES=4,fe_TRIANGLE_STRIP=5,fe_TRIANGLE_FAN=6,je={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},it={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},ft={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},ht={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_t={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_n={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},kn_OPAQUE="OPAQUE",kn_MASK="MASK",kn_BLEND="BLEND";function vi(cn,le,he){for(const Se in he.extensions)void 0===cn[Se]&&(le.userData.gltfExtensions=le.userData.gltfExtensions||{},le.userData.gltfExtensions[Se]=he.extensions[Se])}function bn(cn,le){void 0!==le.extras&&("object"==typeof le.extras?Object.assign(cn.userData,le.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+le.extras))}function _r(cn,le){if(cn.updateMorphTargets(),void 0!==le.weights)for(let he=0,Se=le.weights.length;he<Se;he++)cn.morphTargetInfluences[he]=le.weights[he];if(le.extras&&Array.isArray(le.extras.targetNames)){const he=le.extras.targetNames;if(cn.morphTargetInfluences.length===he.length){cn.morphTargetDictionary={};for(let Se=0,me=he.length;Se<me;Se++)cn.morphTargetDictionary[he[Se]]=Se}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zr(cn){const le=cn.extensions&&cn.extensions[B.KHR_DRACO_MESH_COMPRESSION];let he;return he=le?"draco:"+le.bufferView+":"+le.indices+":"+Lr(le.attributes):cn.indices+":"+Lr(cn.attributes)+":"+cn.mode,he}function Lr(cn){let le="";const he=Object.keys(cn).sort();for(let Se=0,me=he.length;Se<me;Se++)le+=he[Se]+":"+cn[he[Se]]+";";return le}function kr(cn){switch(cn){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class bs{constructor(le={},he={}){this.json=le,this.extensions={},this.plugins={},this.options=he,this.cache=new D,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?new THREE.ImageBitmapLoader(this.options.manager):new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(le){this.extensions=le}setPlugins(le){this.plugins=le}parse(le,he){const Se=this,me=this.json,Re=this.extensions;this.cache.removeAll(),this._invokeAll(function(ie){return ie._markDefs&&ie._markDefs()}),Promise.all(this._invokeAll(function(ie){return ie.beforeRoot&&ie.beforeRoot()})).then(function(){return Promise.all([Se.getDependencies("scene"),Se.getDependencies("animation"),Se.getDependencies("camera")])}).then(function(ie){const W={scene:ie[0][me.scene||0],scenes:ie[0],animations:ie[1],cameras:ie[2],asset:me.asset,parser:Se,userData:{}};vi(Re,W,me),bn(W,me),Promise.all(Se._invokeAll(function(H){return H.afterRoot&&H.afterRoot(W)})).then(function(){le(W)})}).catch(he)}_markDefs(){const le=this.json.nodes||[],he=this.json.skins||[],Se=this.json.meshes||[];for(let me=0,Re=he.length;me<Re;me++){const ie=he[me].joints;for(let W=0,H=ie.length;W<H;W++)le[ie[W]].isBone=!0}for(let me=0,Re=le.length;me<Re;me++){const ie=le[me];void 0!==ie.mesh&&(this._addNodeRef(this.meshCache,ie.mesh),void 0!==ie.skin&&(Se[ie.mesh].isSkinnedMesh=!0)),void 0!==ie.camera&&this._addNodeRef(this.cameraCache,ie.camera)}}_addNodeRef(le,he){void 0!==he&&(void 0===le.refs[he]&&(le.refs[he]=le.uses[he]=0),le.refs[he]++)}_getNodeRef(le,he,Se){if(le.refs[he]<=1)return Se;const me=Se.clone(),Re=(ie,W)=>{const H=this.associations.get(ie);null!=H&&this.associations.set(W,H);for(const[de,Pe]of ie.children.entries())Re(Pe,W.children[de])};return Re(Se,me),me.name+="_instance_"+le.uses[he]++,me}_invokeOne(le){const he=Object.values(this.plugins);he.push(this);for(let Se=0;Se<he.length;Se++){const me=le(he[Se]);if(me)return me}return null}_invokeAll(le){const he=Object.values(this.plugins);he.unshift(this);const Se=[];for(let me=0;me<he.length;me++){const Re=le(he[me]);Re&&Se.push(Re)}return Se}getDependency(le,he){const Se=le+":"+he;let me=this.cache.get(Se);if(!me){switch(le){case"scene":me=this.loadScene(he);break;case"node":me=this.loadNode(he);break;case"mesh":me=this._invokeOne(function(Re){return Re.loadMesh&&Re.loadMesh(he)});break;case"accessor":me=this.loadAccessor(he);break;case"bufferView":me=this._invokeOne(function(Re){return Re.loadBufferView&&Re.loadBufferView(he)});break;case"buffer":me=this.loadBuffer(he);break;case"material":me=this._invokeOne(function(Re){return Re.loadMaterial&&Re.loadMaterial(he)});break;case"texture":me=this._invokeOne(function(Re){return Re.loadTexture&&Re.loadTexture(he)});break;case"skin":me=this.loadSkin(he);break;case"animation":me=this.loadAnimation(he);break;case"camera":me=this.loadCamera(he);break;default:throw new Error("Unknown type: "+le)}this.cache.add(Se,me)}return me}getDependencies(le){let he=this.cache.get(le);if(!he){const Se=this;he=Promise.all((this.json[le+("mesh"===le?"es":"s")]||[]).map(function(Re,ie){return Se.getDependency(le,ie)})),this.cache.add(le,he)}return he}loadBuffer(le){const he=this.json.buffers[le],Se=this.fileLoader;if(he.type&&"arraybuffer"!==he.type)throw new Error("THREE.GLTFLoader: "+he.type+" buffer type is not supported.");if(void 0===he.uri&&0===le)return Promise.resolve(this.extensions[B.KHR_BINARY_GLTF].body);const me=this.options;return new Promise(function(Re,ie){Se.load(THREE.LoaderUtils.resolveURL(he.uri,me.path),Re,void 0,function(){ie(new Error('THREE.GLTFLoader: Failed to load buffer "'+he.uri+'".'))})})}loadBufferView(le){const he=this.json.bufferViews[le];return this.getDependency("buffer",he.buffer).then(function(Se){const Re=he.byteOffset||0;return Se.slice(Re,Re+(he.byteLength||0))})}loadAccessor(le){const he=this,Se=this.json,me=this.json.accessors[le];if(void 0===me.bufferView&&void 0===me.sparse)return Promise.resolve(null);const Re=[];return Re.push(void 0!==me.bufferView?this.getDependency("bufferView",me.bufferView):null),void 0!==me.sparse&&(Re.push(this.getDependency("bufferView",me.sparse.indices.bufferView)),Re.push(this.getDependency("bufferView",me.sparse.values.bufferView))),Promise.all(Re).then(function(ie){const W=ie[0],H=ht[me.type],de=je[me.componentType],Pe=de.BYTES_PER_ELEMENT,rt=me.byteOffset||0,Dt=void 0!==me.bufferView?Se.bufferViews[me.bufferView].byteStride:void 0,un=!0===me.normalized;let Tn,dn;if(Dt&&Dt!==Pe*H){const rn=Math.floor(rt/Dt),On="InterleavedBuffer:"+me.bufferView+":"+me.componentType+":"+rn+":"+me.count;let Nn=he.cache.get(On);Nn||(Tn=new de(W,rn*Dt,me.count*Dt/Pe),Nn=new THREE.InterleavedBuffer(Tn,Dt/Pe),he.cache.add(On,Nn)),dn=new THREE.InterleavedBufferAttribute(Nn,H,rt%Dt/Pe,un)}else Tn=null===W?new de(me.count*H):new de(W,rt,me.count*H),dn=new THREE.BufferAttribute(Tn,H,un);if(void 0!==me.sparse){const Pn=me.sparse.values.byteOffset||0,Ar=new(0,je[me.sparse.indices.componentType])(ie[1],me.sparse.indices.byteOffset||0,me.sparse.count*ht.SCALAR),di=new de(ie[2],Pn,me.sparse.count*H);null!==W&&(dn=new THREE.BufferAttribute(dn.array.slice(),dn.itemSize,dn.normalized));for(let vt=0,Nt=Ar.length;vt<Nt;vt++){const Lt=Ar[vt];if(dn.setX(Lt,di[vt*H]),H>=2&&dn.setY(Lt,di[vt*H+1]),H>=3&&dn.setZ(Lt,di[vt*H+2]),H>=4&&dn.setW(Lt,di[vt*H+3]),H>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return dn})}loadTexture(le){const he=this.json,Re=he.images[he.textures[le].source];let ie=this.textureLoader;if(Re.uri){const W=this.options.manager.getHandler(Re.uri);null!==W&&(ie=W)}return this.loadTextureImage(le,Re,ie)}loadTextureImage(le,he,Se){const me=this,Re=this.json,ie=this.options,W=Re.textures[le],H=(he.uri||he.bufferView)+":"+W.sampler;if(this.textureCache[H])return this.textureCache[H];const de=self.URL||self.webkitURL;let Pe=he.uri||"",Ye=!1;if(void 0!==he.bufferView)Pe=me.getDependency("bufferView",he.bufferView).then(function(Dt){Ye=!0;const un=new Blob([Dt],{type:he.mimeType});return Pe=de.createObjectURL(un),Pe});else if(void 0===he.uri)throw new Error("THREE.GLTFLoader: Image "+le+" is missing URI and bufferView");const rt=Promise.resolve(Pe).then(function(Dt){return new Promise(function(un,Tn){let dn=un;!0===Se.isImageBitmapLoader&&(dn=function(rn){const On=new THREE.Texture(rn);On.needsUpdate=!0,un(On)}),Se.load(THREE.LoaderUtils.resolveURL(Dt,ie.path),dn,void 0,Tn)})}).then(function(Dt){!0===Ye&&de.revokeObjectURL(Pe),Dt.flipY=!1,W.name&&(Dt.name=W.name);const Tn=(Re.samplers||{})[W.sampler]||{};return Dt.magFilter=it[Tn.magFilter]||THREE.LinearFilter,Dt.minFilter=it[Tn.minFilter]||THREE.LinearMipmapLinearFilter,Dt.wrapS=ft[Tn.wrapS]||THREE.RepeatWrapping,Dt.wrapT=ft[Tn.wrapT]||THREE.RepeatWrapping,me.associations.set(Dt,{textures:le}),Dt}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",Pe),null});return this.textureCache[H]=rt,rt}assignTexture(le,he,Se){const me=this;return this.getDependency("texture",Se.index).then(function(Re){if(void 0!==Se.texCoord&&0!=Se.texCoord&&!("aoMap"===he&&1==Se.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+Se.texCoord+" for texture "+he+" not yet supported."),me.extensions[B.KHR_TEXTURE_TRANSFORM]){const ie=void 0!==Se.extensions?Se.extensions[B.KHR_TEXTURE_TRANSFORM]:void 0;if(ie){const W=me.associations.get(Re);Re=me.extensions[B.KHR_TEXTURE_TRANSFORM].extendTexture(Re,ie),me.associations.set(Re,W)}}return le[he]=Re,Re})}assignFinalMaterial(le){const he=le.geometry;let Se=le.material;const me=void 0===he.attributes.tangent,Re=void 0!==he.attributes.color,ie=void 0===he.attributes.normal;if(le.isPoints){const W="PointsMaterial:"+Se.uuid;let H=this.cache.get(W);H||(H=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(H,Se),H.color.copy(Se.color),H.map=Se.map,H.sizeAttenuation=!1,this.cache.add(W,H)),Se=H}else if(le.isLine){const W="LineBasicMaterial:"+Se.uuid;let H=this.cache.get(W);H||(H=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(H,Se),H.color.copy(Se.color),this.cache.add(W,H)),Se=H}if(me||Re||ie){let W="ClonedMaterial:"+Se.uuid+":";Se.isGLTFSpecularGlossinessMaterial&&(W+="specular-glossiness:"),me&&(W+="derivative-tangents:"),Re&&(W+="vertex-colors:"),ie&&(W+="flat-shading:");let H=this.cache.get(W);H||(H=Se.clone(),Re&&(H.vertexColors=!0),ie&&(H.flatShading=!0),me&&(H.normalScale&&(H.normalScale.y*=-1),H.clearcoatNormalScale&&(H.clearcoatNormalScale.y*=-1)),this.cache.add(W,H),this.associations.set(H,this.associations.get(Se))),Se=H}Se.aoMap&&void 0===he.attributes.uv2&&void 0!==he.attributes.uv&&he.setAttribute("uv2",he.attributes.uv),le.material=Se}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(le){const he=this,me=this.extensions,Re=this.json.materials[le];let ie;const W={},H=Re.extensions||{},de=[];if(H[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const Ye=me[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];ie=Ye.getMaterialType(),de.push(Ye.extendParams(W,Re,he))}else if(H[B.KHR_MATERIALS_UNLIT]){const Ye=me[B.KHR_MATERIALS_UNLIT];ie=Ye.getMaterialType(),de.push(Ye.extendParams(W,Re,he))}else{const Ye=Re.pbrMetallicRoughness||{};if(W.color=new THREE.Color(1,1,1),W.opacity=1,Array.isArray(Ye.baseColorFactor)){const rt=Ye.baseColorFactor;W.color.fromArray(rt),W.opacity=rt[3]}void 0!==Ye.baseColorTexture&&de.push(he.assignTexture(W,"map",Ye.baseColorTexture)),W.metalness=void 0!==Ye.metallicFactor?Ye.metallicFactor:1,W.roughness=void 0!==Ye.roughnessFactor?Ye.roughnessFactor:1,void 0!==Ye.metallicRoughnessTexture&&(de.push(he.assignTexture(W,"metalnessMap",Ye.metallicRoughnessTexture)),de.push(he.assignTexture(W,"roughnessMap",Ye.metallicRoughnessTexture))),ie=this._invokeOne(function(rt){return rt.getMaterialType&&rt.getMaterialType(le)}),de.push(Promise.all(this._invokeAll(function(rt){return rt.extendMaterialParams&&rt.extendMaterialParams(le,W)})))}!0===Re.doubleSided&&(W.side=THREE.DoubleSide);const Pe=Re.alphaMode||kn_OPAQUE;if(Pe===kn_BLEND?(W.transparent=!0,W.depthWrite=!1):(W.transparent=!1,W.alphaWrite=!1,Pe===kn_MASK&&(W.alphaTest=void 0!==Re.alphaCutoff?Re.alphaCutoff:.5)),void 0!==Re.normalTexture&&ie!==THREE.MeshBasicMaterial&&(de.push(he.assignTexture(W,"normalMap",Re.normalTexture)),W.normalScale=new THREE.Vector2(1,1),void 0!==Re.normalTexture.scale)){const Ye=Re.normalTexture.scale;W.normalScale.set(Ye,Ye)}return void 0!==Re.occlusionTexture&&ie!==THREE.MeshBasicMaterial&&(de.push(he.assignTexture(W,"aoMap",Re.occlusionTexture)),void 0!==Re.occlusionTexture.strength&&(W.aoMapIntensity=Re.occlusionTexture.strength)),void 0!==Re.emissiveFactor&&ie!==THREE.MeshBasicMaterial&&(W.emissive=(new THREE.Color).fromArray(Re.emissiveFactor)),void 0!==Re.emissiveTexture&&ie!==THREE.MeshBasicMaterial&&de.push(he.assignTexture(W,"emissiveMap",Re.emissiveTexture)),Promise.all(de).then(function(){let Ye;return Ye=ie===ve?me[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(W):new ie(W),Re.name&&(Ye.name=Re.name),Ye.map&&(Ye.map.encoding=THREE.sRGBEncoding),Ye.emissiveMap&&(Ye.emissiveMap.encoding=THREE.sRGBEncoding),bn(Ye,Re),he.associations.set(Ye,{materials:le}),Re.extensions&&vi(me,Ye,Re),Ye})}createUniqueName(le){const he=THREE.PropertyBinding.sanitizeNodeName(le||"");let Se=he;for(let me=1;this.nodeNamesUsed[Se];++me)Se=he+"_"+me;return this.nodeNamesUsed[Se]=!0,Se}loadGeometries(le){const he=this,Se=this.extensions,me=this.primitiveCache;function Re(W){return Se[B.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(W,he).then(function(H){return Kr(H,W,he)})}const ie=[];for(let W=0,H=le.length;W<H;W++){const de=le[W],Pe=Zr(de),Ye=me[Pe];if(Ye)ie.push(Ye.promise);else{let rt;rt=de.extensions&&de.extensions[B.KHR_DRACO_MESH_COMPRESSION]?Re(de):Kr(new THREE.BufferGeometry,de,he),me[Pe]={primitive:de,promise:rt},ie.push(rt)}}return Promise.all(ie)}loadMesh(le){const he=this,me=this.extensions,Re=this.json.meshes[le],ie=Re.primitives,W=[];for(let H=0,de=ie.length;H<de;H++){const Pe=void 0===ie[H].material?(void 0===(cn=this.cache).DefaultMaterial&&(cn.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),cn.DefaultMaterial):this.getDependency("material",ie[H].material);W.push(Pe)}var cn;return W.push(he.loadGeometries(ie)),Promise.all(W).then(function(H){const de=H.slice(0,H.length-1),Pe=H[H.length-1],Ye=[];for(let Dt=0,un=Pe.length;Dt<un;Dt++){const Tn=Pe[Dt],dn=ie[Dt];let rn;const On=de[Dt];if(dn.mode===fe_TRIANGLES||dn.mode===fe_TRIANGLE_STRIP||dn.mode===fe_TRIANGLE_FAN||void 0===dn.mode)rn=!0===Re.isSkinnedMesh?new THREE.SkinnedMesh(Tn,On):new THREE.Mesh(Tn,On),!0===rn.isSkinnedMesh&&!rn.geometry.attributes.skinWeight.normalized&&rn.normalizeSkinWeights(),dn.mode===fe_TRIANGLE_STRIP?rn.geometry=Es(rn.geometry,THREE.TriangleStripDrawMode):dn.mode===fe_TRIANGLE_FAN&&(rn.geometry=Es(rn.geometry,THREE.TriangleFanDrawMode));else if(dn.mode===fe_LINES)rn=new THREE.LineSegments(Tn,On);else if(dn.mode===fe_LINE_STRIP)rn=new THREE.Line(Tn,On);else if(dn.mode===fe_LINE_LOOP)rn=new THREE.LineLoop(Tn,On);else{if(dn.mode!==fe_POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+dn.mode);rn=new THREE.Points(Tn,On)}Object.keys(rn.geometry.morphAttributes).length>0&&_r(rn,Re),rn.name=he.createUniqueName(Re.name||"mesh_"+le),bn(rn,Re),dn.extensions&&vi(me,rn,dn),he.assignFinalMaterial(rn),Ye.push(rn)}for(let Dt=0,un=Ye.length;Dt<un;Dt++)he.associations.set(Ye[Dt],{meshes:le,primitives:Dt});if(1===Ye.length)return Ye[0];const rt=new THREE.Group;he.associations.set(rt,{meshes:le});for(let Dt=0,un=Ye.length;Dt<un;Dt++)rt.add(Ye[Dt]);return rt})}loadCamera(le){let he;const Se=this.json.cameras[le],me=Se[Se.type];if(me)return"perspective"===Se.type?he=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(me.yfov),me.aspectRatio||1,me.znear||1,me.zfar||2e6):"orthographic"===Se.type&&(he=new THREE.OrthographicCamera(-me.xmag,me.xmag,me.ymag,-me.ymag,me.znear,me.zfar)),Se.name&&(he.name=this.createUniqueName(Se.name)),bn(he,Se),Promise.resolve(he);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(le){const he=this.json.skins[le],Se={joints:he.joints};return void 0===he.inverseBindMatrices?Promise.resolve(Se):this.getDependency("accessor",he.inverseBindMatrices).then(function(me){return Se.inverseBindMatrices=me,Se})}loadAnimation(le){const Se=this.json.animations[le],me=[],Re=[],ie=[],W=[],H=[];for(let de=0,Pe=Se.channels.length;de<Pe;de++){const Ye=Se.channels[de],rt=Se.samplers[Ye.sampler],Dt=Ye.target,Tn=void 0!==Se.parameters?Se.parameters[rt.input]:rt.input,dn=void 0!==Se.parameters?Se.parameters[rt.output]:rt.output;me.push(this.getDependency("node",void 0!==Dt.node?Dt.node:Dt.id)),Re.push(this.getDependency("accessor",Tn)),ie.push(this.getDependency("accessor",dn)),W.push(rt),H.push(Dt)}return Promise.all([Promise.all(me),Promise.all(Re),Promise.all(ie),Promise.all(W),Promise.all(H)]).then(function(de){const Pe=de[0],Ye=de[1],rt=de[2],Dt=de[3],un=de[4],Tn=[];for(let rn=0,On=Pe.length;rn<On;rn++){const Nn=Pe[rn],Pn=Ye[rn],Ar=rt[rn],di=Dt[rn],vt=un[rn];if(void 0===Nn)continue;let Nt;switch(Nn.updateMatrix(),Nn.matrixAutoUpdate=!0,Bt[vt.path]){case Bt.weights:Nt=THREE.NumberKeyframeTrack;break;case Bt.rotation:Nt=THREE.QuaternionKeyframeTrack;break;case Bt.position:case Bt.scale:default:Nt=THREE.VectorKeyframeTrack}const Lt=Nn.name?Nn.name:Nn.uuid,Fn=void 0!==di.interpolation?_n[di.interpolation]:THREE.InterpolateLinear,sn=[];Bt[vt.path]===Bt.weights?Nn.traverse(function(En){En.morphTargetInfluences&&sn.push(En.name?En.name:En.uuid)}):sn.push(Lt);let Sn=Ar.array;if(Ar.normalized){const En=kr(Sn.constructor),Ei=new Float32Array(Sn.length);for(let Zi=0,wi=Sn.length;Zi<wi;Zi++)Ei[Zi]=Sn[Zi]*En;Sn=Ei}for(let En=0,Ei=sn.length;En<Ei;En++){const Zi=new Nt(sn[En]+"."+Bt[vt.path],Pn.array,Sn,Fn);"CUBICSPLINE"===di.interpolation&&(Zi.createInterpolant=function(ur){return new(this instanceof THREE.QuaternionKeyframeTrack?Me:we)(this.times,this.values,this.getValueSize()/3,ur)},Zi.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),Tn.push(Zi)}}return new THREE.AnimationClip(Se.name?Se.name:"animation_"+le,void 0,Tn)})}createNodeMesh(le){const Se=this,me=this.json.nodes[le];return void 0===me.mesh?null:Se.getDependency("mesh",me.mesh).then(function(Re){const ie=Se._getNodeRef(Se.meshCache,me.mesh,Re);return void 0!==me.weights&&ie.traverse(function(W){if(W.isMesh)for(let H=0,de=me.weights.length;H<de;H++)W.morphTargetInfluences[H]=me.weights[H]}),ie})}loadNode(le){const Se=this.extensions,me=this,Re=this.json.nodes[le],ie=Re.name?me.createUniqueName(Re.name):"";return function(){const W=[],H=me._invokeOne(function(de){return de.createNodeMesh&&de.createNodeMesh(le)});return H&&W.push(H),void 0!==Re.camera&&W.push(me.getDependency("camera",Re.camera).then(function(de){return me._getNodeRef(me.cameraCache,Re.camera,de)})),me._invokeAll(function(de){return de.createNodeAttachment&&de.createNodeAttachment(le)}).forEach(function(de){W.push(de)}),Promise.all(W)}().then(function(W){let H;if(H=!0===Re.isBone?new THREE.Bone:W.length>1?new THREE.Group:1===W.length?W[0]:new THREE.Object3D,H!==W[0])for(let de=0,Pe=W.length;de<Pe;de++)H.add(W[de]);if(Re.name&&(H.userData.name=Re.name,H.name=ie),bn(H,Re),Re.extensions&&vi(Se,H,Re),void 0!==Re.matrix){const de=new THREE.Matrix4;de.fromArray(Re.matrix),H.applyMatrix4(de)}else void 0!==Re.translation&&H.position.fromArray(Re.translation),void 0!==Re.rotation&&H.quaternion.fromArray(Re.rotation),void 0!==Re.scale&&H.scale.fromArray(Re.scale);return me.associations.has(H)||me.associations.set(H,{}),me.associations.get(H).nodes=le,H})}loadScene(le){const he=this.json,Se=this.extensions,me=this.json.scenes[le],Re=this,ie=new THREE.Group;me.name&&(ie.name=Re.createUniqueName(me.name)),bn(ie,me),me.extensions&&vi(Se,ie,me);const W=me.nodes||[],H=[];for(let de=0,Pe=W.length;de<Pe;de++)H.push(qr(W[de],ie,he,Re));return Promise.all(H).then(function(){return Re.associations=(Pe=>{const Ye=new Map;for(const[rt,Dt]of Re.associations)(rt instanceof THREE.Material||rt instanceof THREE.Texture)&&Ye.set(rt,Dt);return Pe.traverse(rt=>{const Dt=Re.associations.get(rt);null!=Dt&&Ye.set(rt,Dt)}),Ye})(ie),ie})}}function qr(cn,le,he,Se){const me=he.nodes[cn];return Se.getDependency("node",cn).then(function(Re){if(void 0===me.skin)return Re;let ie;return Se.getDependency("skin",me.skin).then(function(W){ie=W;const H=[];for(let de=0,Pe=ie.joints.length;de<Pe;de++)H.push(Se.getDependency("node",ie.joints[de]));return Promise.all(H)}).then(function(W){return Re.traverse(function(H){if(!H.isMesh)return;const de=[],Pe=[];for(let Ye=0,rt=W.length;Ye<rt;Ye++){const Dt=W[Ye];if(Dt){de.push(Dt);const un=new THREE.Matrix4;void 0!==ie.inverseBindMatrices&&un.fromArray(ie.inverseBindMatrices.array,16*Ye),Pe.push(un)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ie.joints[Ye])}H.bind(new THREE.Skeleton(de,Pe),H.matrixWorld)}),Re})}).then(function(Re){le.add(Re);const ie=[];if(me.children){const W=me.children;for(let H=0,de=W.length;H<de;H++)ie.push(qr(W[H],Re,he,Se))}return Promise.all(ie)})}function Kr(cn,le,he){const Se=le.attributes,me=[];function Re(ie,W){return he.getDependency("accessor",ie).then(function(H){cn.setAttribute(W,H)})}for(const ie in Se){const W=_t[ie]||ie.toLowerCase();W in cn.attributes||me.push(Re(Se[ie],W))}if(void 0!==le.indices&&!cn.index){const ie=he.getDependency("accessor",le.indices).then(function(W){cn.setIndex(W)});me.push(ie)}return bn(cn,le),function(cn,le,he){const Se=le.attributes,me=new THREE.Box3;if(void 0===Se.POSITION)return;{const W=he.json.accessors[Se.POSITION],H=W.min,de=W.max;if(void 0===H||void 0===de)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(me.set(new THREE.Vector3(H[0],H[1],H[2]),new THREE.Vector3(de[0],de[1],de[2])),W.normalized){const Pe=kr(je[W.componentType]);me.min.multiplyScalar(Pe),me.max.multiplyScalar(Pe)}}const Re=le.targets;if(void 0!==Re){const W=new THREE.Vector3,H=new THREE.Vector3;for(let de=0,Pe=Re.length;de<Pe;de++){const Ye=Re[de];if(void 0!==Ye.POSITION){const rt=he.json.accessors[Ye.POSITION],Dt=rt.min,un=rt.max;if(void 0!==Dt&&void 0!==un){if(H.setX(Math.max(Math.abs(Dt[0]),Math.abs(un[0]))),H.setY(Math.max(Math.abs(Dt[1]),Math.abs(un[1]))),H.setZ(Math.max(Math.abs(Dt[2]),Math.abs(un[2]))),rt.normalized){const Tn=kr(je[rt.componentType]);H.multiplyScalar(Tn)}W.max(H)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}me.expandByVector(W)}cn.boundingBox=me;const ie=new THREE.Sphere;me.getCenter(ie.center),ie.radius=me.min.distanceTo(me.max)/2,cn.boundingSphere=ie}(cn,le,he),Promise.all(me).then(function(){return void 0!==le.targets?function(cn,le,he){let Se=!1,me=!1;for(let W=0,H=le.length;W<H;W++){const de=le[W];if(void 0!==de.POSITION&&(Se=!0),void 0!==de.NORMAL&&(me=!0),Se&&me)break}if(!Se&&!me)return Promise.resolve(cn);const Re=[],ie=[];for(let W=0,H=le.length;W<H;W++){const de=le[W];if(Se){const Pe=void 0!==de.POSITION?he.getDependency("accessor",de.POSITION):cn.attributes.position;Re.push(Pe)}if(me){const Pe=void 0!==de.NORMAL?he.getDependency("accessor",de.NORMAL):cn.attributes.normal;ie.push(Pe)}}return Promise.all([Promise.all(Re),Promise.all(ie)]).then(function(W){const de=W[1];return Se&&(cn.morphAttributes.position=W[0]),me&&(cn.morphAttributes.normal=de),cn.morphTargetsRelative=!0,cn})}(cn,le.targets,he):cn})}function Es(cn,le){let he=cn.getIndex();if(null===he){const ie=[],W=cn.getAttribute("position");if(void 0===W)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),cn;for(let H=0;H<W.count;H++)ie.push(H);cn.setIndex(ie),he=cn.getIndex()}const Se=he.count-2,me=[];if(le===THREE.TriangleFanDrawMode)for(let ie=1;ie<=Se;ie++)me.push(he.getX(0)),me.push(he.getX(ie)),me.push(he.getX(ie+1));else for(let ie=0;ie<Se;ie++)ie%2==0?(me.push(he.getX(ie)),me.push(he.getX(ie+1)),me.push(he.getX(ie+2))):(me.push(he.getX(ie+2)),me.push(he.getX(ie+1)),me.push(he.getX(ie)));me.length/3!==Se&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const Re=cn.clone();return Re.setIndex(me),Re}THREE.GLTFLoader=b}()},{}],61:[function(k,ae,Ue){!function(){class b extends THREE.Loader{constructor(I){super(I)}load(I,w,T,x){const S=this,y=""===this.path?THREE.LoaderUtils.extractUrlBase(I):this.path,M=new THREE.FileLoader(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(I,function(E){try{w(S.parse(E,y))}catch(_){x?x(_):console.error(_),S.manager.itemError(I)}},T,x)}setMaterialOptions(I){return this.materialOptions=I,this}parse(I,w){const T=I.split("\n");let x={};const S=/\s+/,y={};for(let E=0;E<T.length;E++){let _=T[E];if(_=_.trim(),0===_.length||"#"===_.charAt(0))continue;const R=_.indexOf(" ");let F=R>=0?_.substring(0,R):_;F=F.toLowerCase();let O=R>=0?_.substring(R+1):"";if(O=O.trim(),"newmtl"===F)x={name:O},y[O]=x;else if("ka"===F||"kd"===F||"ks"===F||"ke"===F){const V=O.split(S,3);x[F]=[parseFloat(V[0]),parseFloat(V[1]),parseFloat(V[2])]}else x[F]=O}const M=new D(this.resourcePath||w,this.materialOptions);return M.setCrossOrigin(this.crossOrigin),M.setManager(this.manager),M.setMaterials(y),M}}class D{constructor(I="",w={}){this.baseUrl=I,this.options=w,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:THREE.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:THREE.RepeatWrapping}setCrossOrigin(I){return this.crossOrigin=I,this}setManager(I){this.manager=I}setMaterials(I){this.materialsInfo=this.convert(I),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(I){if(!this.options)return I;const w={};for(const T in I){const x=I[T],S={};w[T]=S;for(const y in x){let M=!0,E=x[y];const _=y.toLowerCase();switch(_){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(E=[E[0]/255,E[1]/255,E[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===E[0]&&0===E[1]&&0===E[2]&&(M=!1)}M&&(S[_]=E)}}return w}preload(){for(const I in this.materialsInfo)this.create(I)}getIndex(I){return this.nameLookup[I]}getAsArray(){let I=0;for(const w in this.materialsInfo)this.materialsArray[I]=this.create(w),this.nameLookup[w]=I,I++;return this.materialsArray}create(I){return void 0===this.materials[I]&&this.createMaterial_(I),this.materials[I]}createMaterial_(I){const w=this,T=this.materialsInfo[I],x={name:I,side:this.side};function y(M,E){if(x[M])return;const _=w.getTextureParams(E,x),R=w.loadTexture(function(M,E){return"string"!=typeof E||""===E?"":/^https?:\/\//i.test(E)?E:M+E}(w.baseUrl,_.url));R.repeat.copy(_.scale),R.offset.copy(_.offset),R.wrapS=w.wrap,R.wrapT=w.wrap,("map"===M||"emissiveMap"===M)&&(R.encoding=THREE.sRGBEncoding),x[M]=R}for(const M in T){const E=T[M];let _;if(""!==E)switch(M.toLowerCase()){case"kd":x.color=(new THREE.Color).fromArray(E).convertSRGBToLinear();break;case"ks":x.specular=(new THREE.Color).fromArray(E).convertSRGBToLinear();break;case"ke":x.emissive=(new THREE.Color).fromArray(E).convertSRGBToLinear();break;case"map_kd":y("map",E);break;case"map_ks":y("specularMap",E);break;case"map_ke":y("emissiveMap",E);break;case"norm":y("normalMap",E);break;case"map_bump":case"bump":y("bumpMap",E);break;case"map_d":y("alphaMap",E),x.transparent=!0;break;case"ns":x.shininess=parseFloat(E);break;case"d":_=parseFloat(E),_<1&&(x.opacity=_,x.transparent=!0);break;case"tr":_=parseFloat(E),this.options&&this.options.invertTrProperty&&(_=1-_),_>0&&(x.opacity=1-_,x.transparent=!0)}}return this.materials[I]=new THREE.MeshPhongMaterial(x),this.materials[I]}getTextureParams(I,w){const T={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},x=I.split(/\s+/);let S;return S=x.indexOf("-bm"),S>=0&&(w.bumpScale=parseFloat(x[S+1]),x.splice(S,2)),S=x.indexOf("-s"),S>=0&&(T.scale.set(parseFloat(x[S+1]),parseFloat(x[S+2])),x.splice(S,4)),S=x.indexOf("-o"),S>=0&&(T.offset.set(parseFloat(x[S+1]),parseFloat(x[S+2])),x.splice(S,4)),T.url=x.join(" ").trim(),T}loadTexture(I,w,T,x,S){const y=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;let M=y.getHandler(I);null===M&&(M=new THREE.TextureLoader(y)),M.setCrossOrigin&&M.setCrossOrigin(this.crossOrigin);const E=M.load(I,T,x,S);return void 0!==w&&(E.mapping=w),E}}THREE.MTLLoader=b}()},{}],62:[function(k,ae,Ue){!function(){const b=/^[og]\s*(.+)?/,D=/^mtllib /,B=/^usemtl /,I=/^usemap /,w=new THREE.Vector3,T=new THREE.Vector3,x=new THREE.Vector3,S=new THREE.Vector3,y=new THREE.Vector3;function M(){const _={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(R,F){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=R,void(this.object.fromDeclaration=!1!==F);const O=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:R||"",fromDeclaration:!1!==F,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(V,Y){const ee=this._finalize(!1);ee&&(ee.inherited||ee.groupCount<=0)&&this.materials.splice(ee.index,1);const oe={index:this.materials.length,name:V||"",mtllib:Array.isArray(Y)&&Y.length>0?Y[Y.length-1]:"",smooth:void 0!==ee?ee.smooth:this.smooth,groupStart:void 0!==ee?ee.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(Ee){const ve={index:"number"==typeof Ee?Ee:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return ve.clone=this.clone.bind(ve),ve}};return this.materials.push(oe),oe},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(V){const Y=this.currentMaterial();if(Y&&-1===Y.groupEnd&&(Y.groupEnd=this.geometry.vertices.length/3,Y.groupCount=Y.groupEnd-Y.groupStart,Y.inherited=!1),V&&this.materials.length>1)for(let ee=this.materials.length-1;ee>=0;ee--)this.materials[ee].groupCount<=0&&this.materials.splice(ee,1);return V&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),Y}},O&&O.name&&"function"==typeof O.clone){const V=O.clone(0);V.inherited=!0,this.object.materials.push(V)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(R,F){const O=parseInt(R,10);return 3*(O>=0?O-1:O+F/3)},parseNormalIndex:function(R,F){const O=parseInt(R,10);return 3*(O>=0?O-1:O+F/3)},parseUVIndex:function(R,F){const O=parseInt(R,10);return 2*(O>=0?O-1:O+F/2)},addVertex:function(R,F,O){const V=this.vertices,Y=this.object.geometry.vertices;Y.push(V[R+0],V[R+1],V[R+2]),Y.push(V[F+0],V[F+1],V[F+2]),Y.push(V[O+0],V[O+1],V[O+2])},addVertexPoint:function(R){const F=this.vertices;this.object.geometry.vertices.push(F[R+0],F[R+1],F[R+2])},addVertexLine:function(R){const F=this.vertices;this.object.geometry.vertices.push(F[R+0],F[R+1],F[R+2])},addNormal:function(R,F,O){const V=this.normals,Y=this.object.geometry.normals;Y.push(V[R+0],V[R+1],V[R+2]),Y.push(V[F+0],V[F+1],V[F+2]),Y.push(V[O+0],V[O+1],V[O+2])},addFaceNormal:function(R,F,O){const V=this.vertices,Y=this.object.geometry.normals;w.fromArray(V,R),T.fromArray(V,F),x.fromArray(V,O),y.subVectors(x,T),S.subVectors(w,T),y.cross(S),y.normalize(),Y.push(y.x,y.y,y.z),Y.push(y.x,y.y,y.z),Y.push(y.x,y.y,y.z)},addColor:function(R,F,O){const V=this.colors,Y=this.object.geometry.colors;void 0!==V[R]&&Y.push(V[R+0],V[R+1],V[R+2]),void 0!==V[F]&&Y.push(V[F+0],V[F+1],V[F+2]),void 0!==V[O]&&Y.push(V[O+0],V[O+1],V[O+2])},addUV:function(R,F,O){const V=this.uvs,Y=this.object.geometry.uvs;Y.push(V[R+0],V[R+1]),Y.push(V[F+0],V[F+1]),Y.push(V[O+0],V[O+1])},addDefaultUV:function(){const R=this.object.geometry.uvs;R.push(0,0),R.push(0,0),R.push(0,0)},addUVLine:function(R){const F=this.uvs;this.object.geometry.uvs.push(F[R+0],F[R+1])},addFace:function(R,F,O,V,Y,ee,oe,Ee,ve){const Ce=this.vertices.length;let He=this.parseVertexIndex(R,Ce),we=this.parseVertexIndex(F,Ce),ce=this.parseVertexIndex(O,Ce);if(this.addVertex(He,we,ce),this.addColor(He,we,ce),void 0!==oe&&""!==oe){const Me=this.normals.length;He=this.parseNormalIndex(oe,Me),we=this.parseNormalIndex(Ee,Me),ce=this.parseNormalIndex(ve,Me),this.addNormal(He,we,ce)}else this.addFaceNormal(He,we,ce);if(void 0!==V&&""!==V){const Me=this.uvs.length;He=this.parseUVIndex(V,Me),we=this.parseUVIndex(Y,Me),ce=this.parseUVIndex(ee,Me),this.addUV(He,we,ce),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(R){this.object.geometry.type="Points";const F=this.vertices.length;for(let O=0,V=R.length;O<V;O++){const Y=this.parseVertexIndex(R[O],F);this.addVertexPoint(Y),this.addColor(Y)}},addLineGeometry:function(R,F){this.object.geometry.type="Line";const O=this.vertices.length,V=this.uvs.length;for(let Y=0,ee=R.length;Y<ee;Y++)this.addVertexLine(this.parseVertexIndex(R[Y],O));for(let Y=0,ee=F.length;Y<ee;Y++)this.addUVLine(this.parseUVIndex(F[Y],V))}};return _.startObject("",!1),_}class E extends THREE.Loader{constructor(R){super(R),this.materials=null}load(R,F,O,V){const Y=this,ee=new THREE.FileLoader(this.manager);ee.setPath(this.path),ee.setRequestHeader(this.requestHeader),ee.setWithCredentials(this.withCredentials),ee.load(R,function(oe){try{F(Y.parse(oe))}catch(Ee){V?V(Ee):console.error(Ee),Y.manager.itemError(R)}},O,V)}setMaterials(R){return this.materials=R,this}parse(R){const F=new M;-1!==R.indexOf("\r\n")&&(R=R.replace(/\r\n/g,"\n")),-1!==R.indexOf("\\\n")&&(R=R.replace(/\\\n/g,""));const O=R.split("\n");let V="",Y="",ee=0,oe=[];const Ee="function"==typeof"".trimLeft;for(let He=0,we=O.length;He<we;He++)if(V=O[He],V=Ee?V.trimLeft():V.trim(),ee=V.length,0!==ee&&(Y=V.charAt(0),"#"!==Y))if("v"===Y){const ce=V.split(/\s+/);switch(ce[0]){case"v":F.vertices.push(parseFloat(ce[1]),parseFloat(ce[2]),parseFloat(ce[3])),ce.length>=7?F.colors.push(parseFloat(ce[4]),parseFloat(ce[5]),parseFloat(ce[6])):F.colors.push(void 0,void 0,void 0);break;case"vn":F.normals.push(parseFloat(ce[1]),parseFloat(ce[2]),parseFloat(ce[3]));break;case"vt":F.uvs.push(parseFloat(ce[1]),parseFloat(ce[2]))}}else if("f"===Y){const Me=V.substr(1).trim().split(/\s+/),fe=[];for(let it=0,ft=Me.length;it<ft;it++){const ht=Me[it];if(ht.length>0){const _t=ht.split("/");fe.push(_t)}}const je=fe[0];for(let it=1,ft=fe.length-1;it<ft;it++){const ht=fe[it],_t=fe[it+1];F.addFace(je[0],ht[0],_t[0],je[1],ht[1],_t[1],je[2],ht[2],_t[2])}}else if("l"===Y){const ce=V.substring(1).trim().split(" ");let Me=[];const fe=[];if(-1===V.indexOf("/"))Me=ce;else for(let je=0,it=ce.length;je<it;je++){const ft=ce[je].split("/");""!==ft[0]&&Me.push(ft[0]),""!==ft[1]&&fe.push(ft[1])}F.addLineGeometry(Me,fe)}else if("p"===Y){const Me=V.substr(1).trim().split(" ");F.addPointGeometry(Me)}else if(null!==(oe=b.exec(V))){const ce=(" "+oe[0].substr(1).trim()).substr(1);F.startObject(ce)}else if(B.test(V))F.object.startMaterial(V.substring(7).trim(),F.materialLibraries);else if(D.test(V))F.materialLibraries.push(V.substring(7).trim());else if(I.test(V))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===Y){if(oe=V.split(" "),oe.length>1){const Me=oe[1].trim().toLowerCase();F.object.smooth="0"!==Me&&"off"!==Me}else F.object.smooth=!0;const ce=F.object.currentMaterial();ce&&(ce.smooth=F.object.smooth)}else{if("\0"===V)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+V+'"')}F.finalize();const ve=new THREE.Group;if(ve.materialLibraries=[].concat(F.materialLibraries),1==!(1===F.objects.length&&0===F.objects[0].geometry.vertices.length))for(let He=0,we=F.objects.length;He<we;He++){const ce=F.objects[He],Me=ce.geometry,fe=ce.materials,je="Line"===Me.type,it="Points"===Me.type;let ft=!1;if(0===Me.vertices.length)continue;const ht=new THREE.BufferGeometry;ht.setAttribute("position",new THREE.Float32BufferAttribute(Me.vertices,3)),Me.normals.length>0&&ht.setAttribute("normal",new THREE.Float32BufferAttribute(Me.normals,3)),Me.colors.length>0&&(ft=!0,ht.setAttribute("color",new THREE.Float32BufferAttribute(Me.colors,3))),!0===Me.hasUVIndices&&ht.setAttribute("uv",new THREE.Float32BufferAttribute(Me.uvs,2));const _t=[];for(let _n=0,kn=fe.length;_n<kn;_n++){const Dn=fe[_n],vi=Dn.name+"_"+Dn.smooth+"_"+ft;let bn=F.materials[vi];if(null!==this.materials)if(bn=this.materials.create(Dn.name),!je||!bn||bn instanceof THREE.LineBasicMaterial){if(it&&bn&&!(bn instanceof THREE.PointsMaterial)){const qn=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(qn,bn),qn.color.copy(bn.color),qn.map=bn.map,bn=qn}}else{const qn=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(qn,bn),qn.color.copy(bn.color),bn=qn}void 0===bn&&(bn=je?new THREE.LineBasicMaterial:it?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial,bn.name=Dn.name,bn.flatShading=!Dn.smooth,bn.vertexColors=ft,F.materials[vi]=bn),_t.push(bn)}let Bt;if(_t.length>1){for(let _n=0,kn=fe.length;_n<kn;_n++){const Dn=fe[_n];ht.addGroup(Dn.groupStart,Dn.groupCount,_n)}Bt=je?new THREE.LineSegments(ht,_t):it?new THREE.Points(ht,_t):new THREE.Mesh(ht,_t)}else Bt=je?new THREE.LineSegments(ht,_t[0]):it?new THREE.Points(ht,_t[0]):new THREE.Mesh(ht,_t[0]);Bt.name=ce.name,ve.add(Bt)}else if(F.vertices.length>0){const He=new THREE.PointsMaterial({size:1,sizeAttenuation:!1}),we=new THREE.BufferGeometry;we.setAttribute("position",new THREE.Float32BufferAttribute(F.vertices,3)),F.colors.length>0&&void 0!==F.colors[0]&&(we.setAttribute("color",new THREE.Float32BufferAttribute(F.colors,3)),He.vertexColors=!0);const ce=new THREE.Points(we,He);ve.add(ce)}return ve}}THREE.OBJLoader=E}()},{}],63:[function(k,ae,Ue){!function(){function B(y){let M,E,_,R=0;for(let V=0;V<y.length;++V){const Y=y[V];if(Y.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===M&&(M=Y.array.constructor),M!==Y.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===E&&(E=Y.itemSize),E!==Y.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===_&&(_=Y.normalized),_!==Y.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes."),null;R+=Y.array.length}const F=new M(R);let O=0;for(let V=0;V<y.length;++V)F.set(y[V].array,O),O+=y[V].array.length;return new THREE.BufferAttribute(F,E,_)}THREE.BufferGeometryUtils={},THREE.BufferGeometryUtils.computeMorphedAttributes=function(y){if(!0!==y.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type THREE.BufferGeometry."),null;const M=new THREE.Vector3,E=new THREE.Vector3,_=new THREE.Vector3,R=new THREE.Vector3,F=new THREE.Vector3,O=new THREE.Vector3,V=new THREE.Vector3,Y=new THREE.Vector3,ee=new THREE.Vector3;function oe(qr,cr,Kr,Es,cn,le,he,Se,me){M.fromBufferAttribute(Kr,le),E.fromBufferAttribute(Kr,he),_.fromBufferAttribute(Kr,Se);const Re=qr.morphTargetInfluences;if(cr.morphTargets&&Es&&Re){V.set(0,0,0),Y.set(0,0,0),ee.set(0,0,0);for(let ie=0,W=Es.length;ie<W;ie++){const H=Re[ie],de=Es[ie];0!==H&&(R.fromBufferAttribute(de,le),F.fromBufferAttribute(de,he),O.fromBufferAttribute(de,Se),cn?(V.addScaledVector(R,H),Y.addScaledVector(F,H),ee.addScaledVector(O,H)):(V.addScaledVector(R.sub(M),H),Y.addScaledVector(F.sub(E),H),ee.addScaledVector(O.sub(_),H)))}M.add(V),E.add(Y),_.add(ee)}qr.isSkinnedMesh&&(qr.boneTransform(le,M),qr.boneTransform(he,E),qr.boneTransform(Se,_)),me[3*le+0]=M.x,me[3*le+1]=M.y,me[3*le+2]=M.z,me[3*he+0]=E.x,me[3*he+1]=E.y,me[3*he+2]=E.z,me[3*Se+0]=_.x,me[3*Se+1]=_.y,me[3*Se+2]=_.z}const Ee=y.geometry,ve=y.material;let Ce,He,we;const ce=Ee.index,Me=Ee.attributes.position,fe=Ee.morphAttributes.position,je=Ee.morphTargetsRelative,it=Ee.attributes.normal,ft=Ee.morphAttributes.position,ht=Ee.groups,_t=Ee.drawRange;let Bt,_n,kn,Dn,vi,bn,qn,_r;const Zr=new Float32Array(Me.count*Me.itemSize),Lr=new Float32Array(it.count*it.itemSize);if(null!==ce)if(Array.isArray(ve))for(Bt=0,kn=ht.length;Bt<kn;Bt++)for(vi=ht[Bt],bn=ve[vi.materialIndex],qn=Math.max(vi.start,_t.start),_r=Math.min(vi.start+vi.count,_t.start+_t.count),_n=qn,Dn=_r;_n<Dn;_n+=3)Ce=ce.getX(_n),He=ce.getX(_n+1),we=ce.getX(_n+2),oe(y,bn,Me,fe,je,Ce,He,we,Zr),oe(y,bn,it,ft,je,Ce,He,we,Lr);else for(qn=Math.max(0,_t.start),_r=Math.min(ce.count,_t.start+_t.count),Bt=qn,kn=_r;Bt<kn;Bt+=3)Ce=ce.getX(Bt),He=ce.getX(Bt+1),we=ce.getX(Bt+2),oe(y,ve,Me,fe,je,Ce,He,we,Zr),oe(y,ve,it,ft,je,Ce,He,we,Lr);else if(void 0!==Me)if(Array.isArray(ve))for(Bt=0,kn=ht.length;Bt<kn;Bt++)for(vi=ht[Bt],bn=ve[vi.materialIndex],qn=Math.max(vi.start,_t.start),_r=Math.min(vi.start+vi.count,_t.start+_t.count),_n=qn,Dn=_r;_n<Dn;_n+=3)Ce=_n,He=_n+1,we=_n+2,oe(y,bn,Me,fe,je,Ce,He,we,Zr),oe(y,bn,it,ft,je,Ce,He,we,Lr);else for(qn=Math.max(0,_t.start),_r=Math.min(Me.count,_t.start+_t.count),Bt=qn,kn=_r;Bt<kn;Bt+=3)Ce=Bt,He=Bt+1,we=Bt+2,oe(y,ve,Me,fe,je,Ce,He,we,Zr),oe(y,ve,it,ft,je,Ce,He,we,Lr);return{positionAttribute:Me,normalAttribute:it,morphedPositionAttribute:new THREE.Float32BufferAttribute(Zr,3),morphedNormalAttribute:new THREE.Float32BufferAttribute(Lr,3)}},THREE.BufferGeometryUtils.computeTangents=function(y){y.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use THREE.BufferGeometry.computeTangents() instead.")},THREE.BufferGeometryUtils.estimateBytesUsed=function(y){let M=0;for(const _ in y.attributes){const R=y.getAttribute(_);M+=R.count*R.itemSize*R.array.BYTES_PER_ELEMENT}const E=y.getIndex();return M+=E?E.count*E.itemSize*E.array.BYTES_PER_ELEMENT:0,M},THREE.BufferGeometryUtils.interleaveAttributes=function(y){let M,E=0,_=0;for(let ee=0,oe=y.length;ee<oe;++ee){const Ee=y[ee];if(void 0===M&&(M=Ee.array.constructor),M!==Ee.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;E+=Ee.array.length,_+=Ee.itemSize}const R=new THREE.InterleavedBuffer(new M(E),_);let F=0;const O=[],V=["getX","getY","getZ","getW"],Y=["setX","setY","setZ","setW"];for(let ee=0,oe=y.length;ee<oe;ee++){const Ee=y[ee],ve=Ee.itemSize,Ce=Ee.count,He=new THREE.InterleavedBufferAttribute(R,ve,F,Ee.normalized);O.push(He),F+=ve;for(let we=0;we<Ce;we++)for(let ce=0;ce<ve;ce++)He[Y[ce]](we,Ee[V[ce]](we))}return O},THREE.BufferGeometryUtils.mergeBufferAttributes=B,THREE.BufferGeometryUtils.mergeBufferGeometries=function(y,M=!1){const E=null!==y[0].index,_=new Set(Object.keys(y[0].attributes)),R=new Set(Object.keys(y[0].morphAttributes)),F={},O={},V=y[0].morphTargetsRelative,Y=new THREE.BufferGeometry;let ee=0;for(let oe=0;oe<y.length;++oe){const Ee=y[oe];let ve=0;if(E!==(null!==Ee.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const Ce in Ee.attributes){if(!_.has(Ce))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+'. All geometries must have compatible attributes; make sure "'+Ce+'" attribute exists among all geometries, or in none of them.'),null;void 0===F[Ce]&&(F[Ce]=[]),F[Ce].push(Ee.attributes[Ce]),ve++}if(ve!==_.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+". Make sure all geometries have the same number of attributes."),null;if(V!==Ee.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const Ce in Ee.morphAttributes){if(!R.has(Ce))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===O[Ce]&&(O[Ce]=[]),O[Ce].push(Ee.morphAttributes[Ce])}if(Y.userData.mergedUserData=Y.userData.mergedUserData||[],Y.userData.mergedUserData.push(Ee.userData),M){let Ce;if(E)Ce=Ee.index.count;else{if(void 0===Ee.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+oe+". The geometry must have either an index or a position attribute"),null;Ce=Ee.attributes.position.count}Y.addGroup(ee,Ce,oe),ee+=Ce}}if(E){let oe=0;const Ee=[];for(let ve=0;ve<y.length;++ve){const Ce=y[ve].index;for(let He=0;He<Ce.count;++He)Ee.push(Ce.getX(He)+oe);oe+=y[ve].attributes.position.count}Y.setIndex(Ee)}for(const oe in F){const Ee=B(F[oe]);if(!Ee)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+oe+" attribute."),null;Y.setAttribute(oe,Ee)}for(const oe in O){const Ee=O[oe][0].length;if(0===Ee)break;Y.morphAttributes=Y.morphAttributes||{},Y.morphAttributes[oe]=[];for(let ve=0;ve<Ee;++ve){const Ce=[];for(let we=0;we<O[oe].length;++we)Ce.push(O[oe][we][ve]);const He=B(Ce);if(!He)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+oe+" morphAttribute."),null;Y.morphAttributes[oe].push(He)}}return Y},THREE.BufferGeometryUtils.mergeVertices=function(y,M=1e-4){M=Math.max(M,Number.EPSILON);const E={},_=y.getIndex(),R=y.getAttribute("position"),F=_?_.count:R.count;let O=0;const V=Object.keys(y.attributes),Y={},ee={},oe=[],Ee=["getX","getY","getZ","getW"];for(let we=0,ce=V.length;we<ce;we++){const Me=V[we];Y[Me]=[];const fe=y.morphAttributes[Me];fe&&(ee[Me]=new Array(fe.length).fill().map(()=>[]))}const ve=Math.log10(1/M),Ce=Math.pow(10,ve);for(let we=0;we<F;we++){const ce=_?_.getX(we):we;let Me="";for(let fe=0,je=V.length;fe<je;fe++){const ft=y.getAttribute(V[fe]),ht=ft.itemSize;for(let _t=0;_t<ht;_t++)Me+=~~(ft[Ee[_t]](ce)*Ce)+","}if(Me in E)oe.push(E[Me]);else{for(let fe=0,je=V.length;fe<je;fe++){const it=V[fe],ft=y.getAttribute(it),ht=y.morphAttributes[it],_t=ft.itemSize,Bt=Y[it],_n=ee[it];for(let kn=0;kn<_t;kn++){const Dn=Ee[kn];if(Bt.push(ft[Dn](ce)),ht)for(let vi=0,bn=ht.length;vi<bn;vi++)_n[vi].push(ht[vi][Dn](ce))}}E[Me]=O,oe.push(O),O++}}const He=y.clone();for(let we=0,ce=V.length;we<ce;we++){const Me=V[we],fe=y.getAttribute(Me),je=new fe.array.constructor(Y[Me]),it=new THREE.BufferAttribute(je,fe.itemSize,fe.normalized);if(He.setAttribute(Me,it),Me in ee)for(let ft=0;ft<ee[Me].length;ft++){const ht=y.morphAttributes[Me][ft],_t=new ht.array.constructor(ee[Me][ft]),Bt=new THREE.BufferAttribute(_t,ht.itemSize,ht.normalized);He.morphAttributes[Me][ft]=Bt}}return He.setIndex(oe),He},THREE.BufferGeometryUtils.toTrianglesDrawMode=function(y,M){if(M===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),y;if(M===THREE.TriangleFanDrawMode||M===THREE.TriangleStripDrawMode){let E=y.getIndex();if(null===E){const O=[],V=y.getAttribute("position");if(void 0===V)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),y;for(let Y=0;Y<V.count;Y++)O.push(Y);y.setIndex(O),E=y.getIndex()}const _=E.count-2,R=[];if(M===THREE.TriangleFanDrawMode)for(let O=1;O<=_;O++)R.push(E.getX(0)),R.push(E.getX(O)),R.push(E.getX(O+1));else for(let O=0;O<_;O++)O%2==0?(R.push(E.getX(O)),R.push(E.getX(O+1)),R.push(E.getX(O+2))):(R.push(E.getX(O+2)),R.push(E.getX(O+1)),R.push(E.getX(O)));R.length/3!==_&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const F=y.clone();return F.setIndex(R),F.clearGroups(),F}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",M),y}}()},{}],64:[function(k,ae,Ue){var b=k("layout-bmfont-text"),B=(k("inherits"),k("quad-indices")),I=k("three-buffer-vertex-data"),w=k("object-assign"),T=k("./lib/vertices"),x=k("./lib/utils");ae.exports=function(M){return new S(M)};class S extends THREE.BufferGeometry{constructor(M){super(),"string"==typeof M&&(M={text:M}),this._opt=w({},M),M&&this.update(M)}update(M){if("string"==typeof M&&(M={text:M}),!(M=w({},this._opt,M)).font)throw new TypeError("must specify a { font } in options");this.layout=b(M);var E=!1!==M.flipY,_=M.font,R=_.common.scaleW,F=_.common.scaleH,O=this.layout.glyphs.filter(function(Ee){var ve=Ee.data;return ve.width*ve.height>0});this.visibleGlyphs=O;var V=T.positions(O),Y=T.uvs(O,R,F,E),ee=B({clockwise:!0,type:"uint16",count:O.length});if(I.index(this,ee,1,"uint16"),I.attr(this,"position",V,2),I.attr(this,"uv",Y,2),!M.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(M.multipage){var oe=T.pages(O);I.attr(this,"page",oe,1)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var M=this.attributes.position.array;if(!M||!this.attributes.position.itemSize||M.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);x.computeSphere(M,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var M=this.boundingBox,E=this.attributes.position.array;!E||!this.attributes.position.itemSize||E.length<2?M.makeEmpty():x.computeBox(E,M)}}},{"./lib/utils":65,"./lib/vertices":66,inherits:30,"layout-bmfont-text":36,"object-assign":39,"quad-indices":51,"three-buffer-vertex-data":67}],65:[function(k,ae,Ue){var D={min:[0,0],max:[0,0]};function B(I){var w=I.length/2;D.min[0]=I[0],D.min[1]=I[1],D.max[0]=I[0],D.max[1]=I[1];for(var T=0;T<w;T++){var x=I[2*T+0],S=I[2*T+1];D.min[0]=Math.min(x,D.min[0]),D.min[1]=Math.min(S,D.min[1]),D.max[0]=Math.max(x,D.max[0]),D.max[1]=Math.max(S,D.max[1])}}ae.exports.computeBox=function(I,w){B(I),w.min.set(D.min[0],D.min[1],0),w.max.set(D.max[0],D.max[1],0)},ae.exports.computeSphere=function(I,w){B(I);var T=D.min[0],x=D.min[1],M=D.max[0]-T,E=D.max[1]-x,_=Math.sqrt(M*M+E*E);w.center.set(T+M/2,x+E/2,0),w.radius=_/2}},{}],66:[function(k,ae,Ue){ae.exports.pages=function(D){var B=new Float32Array(4*D.length*1),I=0;return D.forEach(function(w){var T=w.data.page||0;B[I++]=T,B[I++]=T,B[I++]=T,B[I++]=T}),B},ae.exports.uvs=function(D,B,I,w){var T=new Float32Array(4*D.length*2),x=0;return D.forEach(function(S){var y=S.data,E=y.y+y.height,_=y.x/B,R=y.y/I,F=(y.x+y.width)/B,O=E/I;w&&(R=(I-y.y)/I,O=(I-E)/I),T[x++]=_,T[x++]=R,T[x++]=_,T[x++]=O,T[x++]=F,T[x++]=O,T[x++]=F,T[x++]=R}),T},ae.exports.positions=function(D){var B=new Float32Array(4*D.length*2),I=0;return D.forEach(function(w){var T=w.data,x=w.position[0]+T.xoffset,S=w.position[1]+T.yoffset,y=T.width,M=T.height;B[I++]=x,B[I++]=S,B[I++]=x,B[I++]=S+M,B[I++]=x+y,B[I++]=S+M,B[I++]=x+y,B[I++]=S}),B}},{}],67:[function(k,ae,Ue){var b=k("flatten-vertex-data");function w(x,S,y,M){return S=b(S=S||[],M),(x=new THREE.BufferAttribute(S,y)).itemSize=y,x.needsUpdate=!0,x}ae.exports.attr=function(x,S,y,M,E){if("number"!=typeof M&&(M=3),"string"!=typeof E&&(E="float32"),Array.isArray(y)&&Array.isArray(y[0])&&y[0].length!==M)throw new Error("Nested vertex array has unexpected size; expected "+M+" but found "+y[0].length);var R=w(x.getAttribute(S),y,M,E);x.setAttribute(S,R)},ae.exports.index=function(x,S,y,M){"number"!=typeof y&&(y=1),"string"!=typeof M&&(M="uint16");var E=!x.index&&"function"!=typeof x.setIndex,R=w(E?x.getAttribute("index"):x.index,S,y,M);R&&(E?x.addAttribute("index",R):x.index=R)}},{"flatten-vertex-data":23}],68:[function(k,ae,Ue){(function(b,D){var B=k("process/browser.js").nextTick,I=Function.prototype.apply,w=Array.prototype.slice,T={},x=0;function S(y,M){this._id=y,this._clearFn=M}Ue.setTimeout=function(){return new S(I.call(setTimeout,window,arguments),clearTimeout)},Ue.setInterval=function(){return new S(I.call(setInterval,window,arguments),clearInterval)},Ue.clearTimeout=Ue.clearInterval=function(y){y.close()},S.prototype.unref=S.prototype.ref=function(){},S.prototype.close=function(){this._clearFn.call(window,this._id)},Ue.enroll=function(y,M){clearTimeout(y._idleTimeoutId),y._idleTimeout=M},Ue.unenroll=function(y){clearTimeout(y._idleTimeoutId),y._idleTimeout=-1},Ue._unrefActive=Ue.active=function(y){clearTimeout(y._idleTimeoutId);var M=y._idleTimeout;M>=0&&(y._idleTimeoutId=setTimeout(function(){y._onTimeout&&y._onTimeout()},M))},Ue.setImmediate="function"==typeof b?b:function(y){var M=x++,E=!(arguments.length<2)&&w.call(arguments,1);return T[M]=!0,B(function(){T[M]&&(E?y.apply(null,E):y.call(null),Ue.clearImmediate(M))}),M},Ue.clearImmediate="function"==typeof D?D:function(y){delete T[y]}}).call(this,k("timers").setImmediate,k("timers").clearImmediate)},{"process/browser.js":49,timers:68}],69:[function(k,ae,Ue){(function(b){var B;B=function(){"use strict";var D="undefined"!=typeof window?window:void 0!==b?b:"undefined"!=typeof self?self:{};var Y,w=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},T=function(Y,ee){for(var oe=0,Ee=Y.length;oe<Ee;oe++)ee[oe]=Y[oe]},x=function(Y,ee){for(var oe in ee)ee.hasOwnProperty(oe)&&(Y[oe]=ee[oe]);return Y},y=function(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}((function(V,Y){V.exports=function(){var K,oe=function(){function K(ne,pe){for(var xe=0;xe<pe.length;xe++){var Ge=pe[xe];Ge.enumerable=Ge.enumerable||!1,Ge.configurable=!0,"value"in Ge&&(Ge.writable=!0),Object.defineProperty(ne,Ge.key,Ge)}}return function(ne,pe,xe){return pe&&K(ne.prototype,pe),xe&&K(ne,xe),ne}}(),Ee=function(ne,pe){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return function(ne,pe){var xe=[],Ge=!0,ut=!1,Pt=void 0;try{for(var $t,on=ne[Symbol.iterator]();!(Ge=($t=on.next()).done)&&(xe.push($t.value),!pe||xe.length!==pe);Ge=!0);}catch(xt){ut=!0,Pt=xt}finally{try{!Ge&&on.return&&on.return()}finally{if(ut)throw Pt}}return xe}(ne,pe);throw new TypeError("Invalid attempt to destructure non-iterable instance")},we=function(ne,pe,xe){return ne+(pe-ne)*xe},ce=(K=/iPad|iPhone|iPod/.test(navigator.platform),function(){return K}),Me=function(){var K=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return K}}(),fe=function(){var K=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return K}}(),je=function(){var K=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return K}}(),it=function(){var K=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),ne=K?parseInt(K[1],10):null;return function(){return ne}}(),ft=function(){var K;return K=ce()&&fe()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return K}}(),ht=function(){var K=!1;if(65===it()){var ne=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(ne){var pe=ne[1].split("."),xe=Ee(pe,4),on=xe[3];K=3325===parseInt(xe[2],10)&&parseInt(on,10)<148}}return function(){return K}}(),_t=function(){var K=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return K}}(),Bt=function(){var ne=90==window.orientation||-90==window.orientation;return _t()?!ne:ne},kn=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},Dn=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},bn=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},_r=function(ne,pe,xe,Ge){var ut=ne.createShader(ne.VERTEX_SHADER);ne.shaderSource(ut,pe),ne.compileShader(ut);var Pt=ne.createShader(ne.FRAGMENT_SHADER);ne.shaderSource(Pt,xe),ne.compileShader(Pt);var on=ne.createProgram();for(var $t in ne.attachShader(on,ut),ne.attachShader(on,Pt),Ge)ne.bindAttribLocation(on,Ge[$t],$t);return ne.linkProgram(on),ne.deleteShader(ut),ne.deleteShader(Pt),on},Zr=function(ne,pe){for(var xe={},Ge=ne.getProgramParameter(pe,ne.ACTIVE_UNIFORMS),ut="",Pt=0;Pt<Ge;Pt++)xe[ut=ne.getActiveUniform(pe,Pt).name.replace("[0]","")]=ne.getUniformLocation(pe,ut);return xe},kr=function(){var pe,ne=!1;return pe=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(pe)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(pe.substr(0,4)))&&(ne=!0),ne},bs=function(ne,pe){for(var xe in pe)pe.hasOwnProperty(xe)&&(ne[xe]=pe[xe]);return ne},qr=function(ne){if(ce()){var pe=ne.style.width,xe=ne.style.height;ne.style.width=parseInt(pe)+1+"px",ne.style.height=parseInt(xe)+"px",setTimeout(function(){ne.style.width=pe,ne.style.height=xe},100)}window.canvas=ne},cr=function(){var K=Math.PI/180,ne=.25*Math.PI,Pt=new Float32Array([0,0,0,1]),on=new Float32Array([0,0,0]);function $t(xt,Gt,An,li,yi,Li){(function(xt,Gt,An,li){var yi=Math.tan(Gt?Gt.upDegrees*K:ne),Li=Math.tan(Gt?Gt.downDegrees*K:ne),rr=Math.tan(Gt?Gt.leftDegrees*K:ne),Ui=Math.tan(Gt?Gt.rightDegrees*K:ne),Kn=2/(rr+Ui),$r=2/(yi+Li);xt[0]=Kn,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=$r,xt[6]=0,xt[7]=0,xt[8]=-(rr-Ui)*Kn*.5,xt[9]=(yi-Li)*$r*.5,xt[10]=li/(An-li),xt[11]=-1,xt[12]=0,xt[13]=0,xt[14]=li*An/(An-li),xt[15]=0})(xt,li||null,Li.depthNear,Li.depthFar),function(xt,Gt,An){var li=Gt[0],yi=Gt[1],Li=Gt[2],rr=Gt[3],Ui=li+li,Kn=yi+yi,$r=Li+Li,Hs=li*Ui,Bs=li*Kn,ts=li*$r,br=yi*Kn,Gs=yi*$r,$s=Li*$r,fo=rr*Ui,Co=rr*Kn,El=rr*$r;xt[0]=1-(br+$s),xt[1]=Bs+El,xt[2]=ts-Co,xt[3]=0,xt[4]=Bs-El,xt[5]=1-(Hs+$s),xt[6]=Gs+fo,xt[7]=0,xt[8]=ts+Co,xt[9]=Gs-fo,xt[10]=1-(Hs+br),xt[11]=0,xt[12]=An[0],xt[13]=An[1],xt[14]=An[2],xt[15]=1}(Gt,An.orientation||Pt,An.position||on),yi&&function(xt,Gt,An){var rr,Ui,Kn,$r,Hs,Bs,ts,br,Gs,$s,fo,Co,li=An[0],yi=An[1],Li=An[2];Gt===xt?(xt[12]=Gt[0]*li+Gt[4]*yi+Gt[8]*Li+Gt[12],xt[13]=Gt[1]*li+Gt[5]*yi+Gt[9]*Li+Gt[13],xt[14]=Gt[2]*li+Gt[6]*yi+Gt[10]*Li+Gt[14],xt[15]=Gt[3]*li+Gt[7]*yi+Gt[11]*Li+Gt[15]):(Ui=Gt[1],Kn=Gt[2],$r=Gt[3],Hs=Gt[4],Bs=Gt[5],ts=Gt[6],br=Gt[7],Gs=Gt[8],$s=Gt[9],fo=Gt[10],Co=Gt[11],xt[0]=rr=Gt[0],xt[1]=Ui,xt[2]=Kn,xt[3]=$r,xt[4]=Hs,xt[5]=Bs,xt[6]=ts,xt[7]=br,xt[8]=Gs,xt[9]=$s,xt[10]=fo,xt[11]=Co,xt[12]=rr*li+Hs*yi+Gs*Li+Gt[12],xt[13]=Ui*li+Bs*yi+$s*Li+Gt[13],xt[14]=Kn*li+ts*yi+fo*Li+Gt[14],xt[15]=$r*li+br*yi+Co*Li+Gt[15])}(Gt,Gt,yi),function(xt,Gt){var An=Gt[0],li=Gt[1],yi=Gt[2],Li=Gt[3],rr=Gt[4],Ui=Gt[5],Kn=Gt[6],$r=Gt[7],Hs=Gt[8],Bs=Gt[9],ts=Gt[10],br=Gt[11],Gs=Gt[12],$s=Gt[13],fo=Gt[14],Co=Gt[15],El=An*Ui-li*rr,wl=An*Kn-yi*rr,bu=An*$r-Li*rr,Eu=li*Kn-yi*Ui,wu=li*$r-Li*Ui,_u=yi*$r-Li*Kn,Mu=Hs*$s-Bs*Gs,Tu=Hs*fo-ts*Gs,Su=Hs*Co-br*Gs,Cu=Bs*fo-ts*$s,Ru=Bs*Co-br*$s,Lu=ts*Co-br*fo,po=El*Lu-wl*Ru+bu*Cu+Eu*Su-wu*Tu+_u*Mu;po&&(xt[0]=(Ui*Lu-Kn*Ru+$r*Cu)*(po=1/po),xt[1]=(yi*Ru-li*Lu-Li*Cu)*po,xt[2]=($s*_u-fo*wu+Co*Eu)*po,xt[3]=(ts*wu-Bs*_u-br*Eu)*po,xt[4]=(Kn*Su-rr*Lu-$r*Tu)*po,xt[5]=(An*Lu-yi*Su+Li*Tu)*po,xt[6]=(fo*bu-Gs*_u-Co*wl)*po,xt[7]=(Hs*_u-ts*bu+br*wl)*po,xt[8]=(rr*Ru-Ui*Su+$r*Mu)*po,xt[9]=(li*Su-An*Ru-Li*Mu)*po,xt[10]=(Gs*wu-$s*bu+Co*El)*po,xt[11]=(Bs*bu-Hs*wu-br*El)*po,xt[12]=(Ui*Tu-rr*Cu-Kn*Mu)*po,xt[13]=(An*Cu-li*Tu+yi*Mu)*po,xt[14]=($s*wl-Gs*Eu-fo*El)*po,xt[15]=(Hs*Eu-Bs*wl+ts*El)*po)}(Gt,Gt)}return function(xt,Gt,An){return!(!xt||!Gt||(xt.pose=Gt,xt.timestamp=Gt.timestamp,$t(xt.leftProjectionMatrix,xt.leftViewMatrix,Gt,An._getFieldOfView("left"),An._getEyeOffset("left"),An),$t(xt.rightProjectionMatrix,xt.rightViewMatrix,Gt,An._getFieldOfView("right"),An._getEyeOffset("right"),An),0))}}(),Es=function(ne){var xe=ne.indexOf("://"),Ge=ne.indexOf("/",-1!==xe?xe+3:0);return-1===Ge&&(Ge=ne.length),ne.substring(0,Ge)},le=function(){var K={};return function(ne,pe){void 0===K[ne]&&(console.warn("webvr-polyfill: "+pe),K[ne]=!0)}}(),he=function(ne,pe){le(ne,ne+" has been deprecated. This may not work on native WebVR displays. "+(pe?"Please use "+pe+" instead.":""))},me=function(K,ne,pe){if(ne){for(var xe=[],Ge=null,ut=0;ut<ne.length;++ut)switch(Pt=ne[ut]){case K.TEXTURE_BINDING_2D:case K.TEXTURE_BINDING_CUBE_MAP:if((on=ne[++ut])<K.TEXTURE0||on>K.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),xe.push(null,null);break}Ge||(Ge=K.getParameter(K.ACTIVE_TEXTURE)),K.activeTexture(on),xe.push(K.getParameter(Pt),null);break;case K.ACTIVE_TEXTURE:Ge=K.getParameter(K.ACTIVE_TEXTURE),xe.push(null);break;default:xe.push(K.getParameter(Pt))}for(pe(K),ut=0;ut<ne.length;++ut){var Pt,$t=xe[ut];switch(Pt=ne[ut]){case K.ACTIVE_TEXTURE:break;case K.ARRAY_BUFFER_BINDING:K.bindBuffer(K.ARRAY_BUFFER,$t);break;case K.COLOR_CLEAR_VALUE:K.clearColor($t[0],$t[1],$t[2],$t[3]);break;case K.COLOR_WRITEMASK:K.colorMask($t[0],$t[1],$t[2],$t[3]);break;case K.CURRENT_PROGRAM:K.useProgram($t);break;case K.ELEMENT_ARRAY_BUFFER_BINDING:K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,$t);break;case K.FRAMEBUFFER_BINDING:K.bindFramebuffer(K.FRAMEBUFFER,$t);break;case K.RENDERBUFFER_BINDING:K.bindRenderbuffer(K.RENDERBUFFER,$t);break;case K.TEXTURE_BINDING_2D:if((on=ne[++ut])<K.TEXTURE0||on>K.TEXTURE31)break;K.activeTexture(on),K.bindTexture(K.TEXTURE_2D,$t);break;case K.TEXTURE_BINDING_CUBE_MAP:var on;if((on=ne[++ut])<K.TEXTURE0||on>K.TEXTURE31)break;K.activeTexture(on),K.bindTexture(K.TEXTURE_CUBE_MAP,$t);break;case K.VIEWPORT:K.viewport($t[0],$t[1],$t[2],$t[3]);break;case K.BLEND:case K.CULL_FACE:case K.DEPTH_TEST:case K.SCISSOR_TEST:case K.STENCIL_TEST:$t?K.enable(Pt):K.disable(Pt);break;default:console.log("No GL restore behavior for 0x"+Pt.toString(16))}Ge&&K.activeTexture(Ge)}}else pe(K)},Re=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),ie=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function W(K,ne,pe,xe){this.gl=K,this.cardboardUI=ne,this.bufferScale=pe,this.dirtySubmitFrameBindings=xe,this.ctxAttribs=K.getContextAttributes(),this.instanceExt=K.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=K.drawingBufferWidth,this.bufferHeight=K.drawingBufferHeight,this.realBindFramebuffer=K.bindFramebuffer,this.realEnable=K.enable,this.realDisable=K.disable,this.realColorMask=K.colorMask,this.realClearColor=K.clearColor,this.realViewport=K.viewport,ce()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(K.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(K.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=_r(K,Re,ie,this.attribs),this.uniforms=Zr(K,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=K.createBuffer(),this.indexBuffer=K.createBuffer(),this.indexCount=0,this.renderTarget=K.createTexture(),this.framebuffer=K.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=K.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=K.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=K.createRenderbuffer()),this.patch(),this.onResize()}W.prototype.destroy=function(){var K=this.gl;this.unpatch(),K.deleteProgram(this.program),K.deleteBuffer(this.vertexBuffer),K.deleteBuffer(this.indexBuffer),K.deleteTexture(this.renderTarget),K.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&K.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&K.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&K.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},W.prototype.onResize=function(){var K=this.gl,ne=this;me(K,[K.RENDERBUFFER_BINDING,K.TEXTURE_BINDING_2D,K.TEXTURE0],function(xe){ne.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,null),ne.scissorTest&&ne.realDisable.call(xe,xe.SCISSOR_TEST),ne.realColorMask.call(xe,!0,!0,!0,!0),ne.realViewport.call(xe,0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),ne.realClearColor.call(xe,0,0,0,1),xe.clear(xe.COLOR_BUFFER_BIT),ne.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,ne.framebuffer),xe.bindTexture(xe.TEXTURE_2D,ne.renderTarget),xe.texImage2D(xe.TEXTURE_2D,0,ne.ctxAttribs.alpha?xe.RGBA:xe.RGB,ne.bufferWidth,ne.bufferHeight,0,ne.ctxAttribs.alpha?xe.RGBA:xe.RGB,xe.UNSIGNED_BYTE,null),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_2D,ne.renderTarget,0),ne.ctxAttribs.depth&&ne.ctxAttribs.stencil?(xe.bindRenderbuffer(xe.RENDERBUFFER,ne.depthStencilBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.DEPTH_STENCIL,ne.bufferWidth,ne.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.DEPTH_STENCIL_ATTACHMENT,xe.RENDERBUFFER,ne.depthStencilBuffer)):ne.ctxAttribs.depth?(xe.bindRenderbuffer(xe.RENDERBUFFER,ne.depthBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.DEPTH_COMPONENT16,ne.bufferWidth,ne.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.DEPTH_ATTACHMENT,xe.RENDERBUFFER,ne.depthBuffer)):ne.ctxAttribs.stencil&&(xe.bindRenderbuffer(xe.RENDERBUFFER,ne.stencilBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.STENCIL_INDEX8,ne.bufferWidth,ne.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.STENCIL_ATTACHMENT,xe.RENDERBUFFER,ne.stencilBuffer)),!xe.checkFramebufferStatus(xe.FRAMEBUFFER)===xe.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),ne.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,ne.lastBoundFramebuffer),ne.scissorTest&&ne.realEnable.call(xe,xe.SCISSOR_TEST),ne.realColorMask.apply(xe,ne.colorMask),ne.realViewport.apply(xe,ne.viewport),ne.realClearColor.apply(xe,ne.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},W.prototype.patch=function(){if(!this.isPatched){var K=this,ne=this.gl.canvas,pe=this.gl;ce()||(ne.width=kn()*this.bufferScale,ne.height=Dn()*this.bufferScale,Object.defineProperty(ne,"width",{configurable:!0,enumerable:!0,get:function(){return K.bufferWidth},set:function(Ge){K.bufferWidth=Ge,K.realCanvasWidth.set.call(ne,Ge),K.onResize()}}),Object.defineProperty(ne,"height",{configurable:!0,enumerable:!0,get:function(){return K.bufferHeight},set:function(Ge){K.bufferHeight=Ge,K.realCanvasHeight.set.call(ne,Ge),K.onResize()}})),this.lastBoundFramebuffer=pe.getParameter(pe.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(pe.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(xe,Ge){K.lastBoundFramebuffer=Ge||K.framebuffer,K.realBindFramebuffer.call(pe,xe,K.lastBoundFramebuffer)},this.cullFace=pe.getParameter(pe.CULL_FACE),this.depthTest=pe.getParameter(pe.DEPTH_TEST),this.blend=pe.getParameter(pe.BLEND),this.scissorTest=pe.getParameter(pe.SCISSOR_TEST),this.stencilTest=pe.getParameter(pe.STENCIL_TEST),pe.enable=function(xe){switch(xe){case pe.CULL_FACE:K.cullFace=!0;break;case pe.DEPTH_TEST:K.depthTest=!0;break;case pe.BLEND:K.blend=!0;break;case pe.SCISSOR_TEST:K.scissorTest=!0;break;case pe.STENCIL_TEST:K.stencilTest=!0}K.realEnable.call(pe,xe)},pe.disable=function(xe){switch(xe){case pe.CULL_FACE:K.cullFace=!1;break;case pe.DEPTH_TEST:K.depthTest=!1;break;case pe.BLEND:K.blend=!1;break;case pe.SCISSOR_TEST:K.scissorTest=!1;break;case pe.STENCIL_TEST:K.stencilTest=!1}K.realDisable.call(pe,xe)},this.colorMask=pe.getParameter(pe.COLOR_WRITEMASK),pe.colorMask=function(xe,Ge,ut,Pt){K.colorMask[0]=xe,K.colorMask[1]=Ge,K.colorMask[2]=ut,K.colorMask[3]=Pt,K.realColorMask.call(pe,xe,Ge,ut,Pt)},this.clearColor=pe.getParameter(pe.COLOR_CLEAR_VALUE),pe.clearColor=function(xe,Ge,ut,Pt){K.clearColor[0]=xe,K.clearColor[1]=Ge,K.clearColor[2]=ut,K.clearColor[3]=Pt,K.realClearColor.call(pe,xe,Ge,ut,Pt)},this.viewport=pe.getParameter(pe.VIEWPORT),pe.viewport=function(xe,Ge,ut,Pt){K.viewport[0]=xe,K.viewport[1]=Ge,K.viewport[2]=ut,K.viewport[3]=Pt,K.realViewport.call(pe,xe,Ge,ut,Pt)},this.isPatched=!0,qr(ne)}},W.prototype.unpatch=function(){if(this.isPatched){var K=this.gl,ne=this.gl.canvas;ce()||(Object.defineProperty(ne,"width",this.realCanvasWidth),Object.defineProperty(ne,"height",this.realCanvasHeight)),ne.width=this.bufferWidth,ne.height=this.bufferHeight,K.bindFramebuffer=this.realBindFramebuffer,K.enable=this.realEnable,K.disable=this.realDisable,K.colorMask=this.realColorMask,K.clearColor=this.realClearColor,K.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&K.bindFramebuffer(K.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){qr(ne)},1)}},W.prototype.setTextureBounds=function(K,ne){K||(K=[0,0,.5,1]),ne||(ne=[.5,0,.5,1]),this.viewportOffsetScale[0]=K[0],this.viewportOffsetScale[1]=K[1],this.viewportOffsetScale[2]=K[2],this.viewportOffsetScale[3]=K[3],this.viewportOffsetScale[4]=ne[0],this.viewportOffsetScale[5]=ne[1],this.viewportOffsetScale[6]=ne[2],this.viewportOffsetScale[7]=ne[3]},W.prototype.submitFrame=function(){var K=this.gl,ne=this,pe=[];if(this.dirtySubmitFrameBindings||pe.push(K.CURRENT_PROGRAM,K.ARRAY_BUFFER_BINDING,K.ELEMENT_ARRAY_BUFFER_BINDING,K.TEXTURE_BINDING_2D,K.TEXTURE0),me(K,pe,function(Ge){ne.realBindFramebuffer.call(Ge,Ge.FRAMEBUFFER,null);var ut=0,Pt=0;ne.instanceExt&&(ut=Ge.getVertexAttrib(ne.attribs.position,ne.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),Pt=Ge.getVertexAttrib(ne.attribs.texCoord,ne.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),ne.cullFace&&ne.realDisable.call(Ge,Ge.CULL_FACE),ne.depthTest&&ne.realDisable.call(Ge,Ge.DEPTH_TEST),ne.blend&&ne.realDisable.call(Ge,Ge.BLEND),ne.scissorTest&&ne.realDisable.call(Ge,Ge.SCISSOR_TEST),ne.stencilTest&&ne.realDisable.call(Ge,Ge.STENCIL_TEST),ne.realColorMask.call(Ge,!0,!0,!0,!0),ne.realViewport.call(Ge,0,0,Ge.drawingBufferWidth,Ge.drawingBufferHeight),(ne.ctxAttribs.alpha||ce())&&(ne.realClearColor.call(Ge,0,0,0,1),Ge.clear(Ge.COLOR_BUFFER_BIT)),Ge.useProgram(ne.program),Ge.bindBuffer(Ge.ELEMENT_ARRAY_BUFFER,ne.indexBuffer),Ge.bindBuffer(Ge.ARRAY_BUFFER,ne.vertexBuffer),Ge.enableVertexAttribArray(ne.attribs.position),Ge.enableVertexAttribArray(ne.attribs.texCoord),Ge.vertexAttribPointer(ne.attribs.position,2,Ge.FLOAT,!1,20,0),Ge.vertexAttribPointer(ne.attribs.texCoord,3,Ge.FLOAT,!1,20,8),ne.instanceExt&&(0!=ut&&ne.instanceExt.vertexAttribDivisorANGLE(ne.attribs.position,0),0!=Pt&&ne.instanceExt.vertexAttribDivisorANGLE(ne.attribs.texCoord,0)),Ge.activeTexture(Ge.TEXTURE0),Ge.uniform1i(ne.uniforms.diffuse,0),Ge.bindTexture(Ge.TEXTURE_2D,ne.renderTarget),Ge.uniform4fv(ne.uniforms.viewportOffsetScale,ne.viewportOffsetScale),Ge.drawElements(Ge.TRIANGLES,ne.indexCount,Ge.UNSIGNED_SHORT,0),ne.cardboardUI&&ne.cardboardUI.renderNoState(),ne.realBindFramebuffer.call(ne.gl,Ge.FRAMEBUFFER,ne.framebuffer),ne.ctxAttribs.preserveDrawingBuffer||(ne.realClearColor.call(Ge,0,0,0,0),Ge.clear(Ge.COLOR_BUFFER_BIT)),ne.dirtySubmitFrameBindings||ne.realBindFramebuffer.call(Ge,Ge.FRAMEBUFFER,ne.lastBoundFramebuffer),ne.cullFace&&ne.realEnable.call(Ge,Ge.CULL_FACE),ne.depthTest&&ne.realEnable.call(Ge,Ge.DEPTH_TEST),ne.blend&&ne.realEnable.call(Ge,Ge.BLEND),ne.scissorTest&&ne.realEnable.call(Ge,Ge.SCISSOR_TEST),ne.stencilTest&&ne.realEnable.call(Ge,Ge.STENCIL_TEST),ne.realColorMask.apply(Ge,ne.colorMask),ne.realViewport.apply(Ge,ne.viewport),(ne.ctxAttribs.alpha||!ne.ctxAttribs.preserveDrawingBuffer)&&ne.realClearColor.apply(Ge,ne.clearColor),ne.instanceExt&&(0!=ut&&ne.instanceExt.vertexAttribDivisorANGLE(ne.attribs.position,ut),0!=Pt&&ne.instanceExt.vertexAttribDivisorANGLE(ne.attribs.texCoord,Pt))}),ce()){var xe=K.canvas;(xe.width!=ne.bufferWidth||xe.height!=ne.bufferHeight)&&(ne.bufferWidth=xe.width,ne.bufferHeight=xe.height,ne.onResize())}},W.prototype.updateDeviceInfo=function(K){var ne=this.gl,pe=this;me(ne,[ne.ARRAY_BUFFER_BINDING,ne.ELEMENT_ARRAY_BUFFER_BINDING],function(Ge){var ut=pe.computeMeshVertices_(pe.meshWidth,pe.meshHeight,K);if(Ge.bindBuffer(Ge.ARRAY_BUFFER,pe.vertexBuffer),Ge.bufferData(Ge.ARRAY_BUFFER,ut,Ge.STATIC_DRAW),!pe.indexCount){var Pt=pe.computeMeshIndices_(pe.meshWidth,pe.meshHeight);Ge.bindBuffer(Ge.ELEMENT_ARRAY_BUFFER,pe.indexBuffer),Ge.bufferData(Ge.ELEMENT_ARRAY_BUFFER,Pt,Ge.STATIC_DRAW),pe.indexCount=Pt.length}})},W.prototype.computeMeshVertices_=function(K,ne,pe){for(var xe=new Float32Array(2*K*ne*5),Ge=pe.getLeftEyeVisibleTanAngles(),ut=pe.getLeftEyeNoLensTanAngles(),Pt=pe.getLeftEyeVisibleScreenRect(ut),on=0,$t=0;$t<2;$t++){for(var xt=0;xt<ne;xt++)for(var Gt=0;Gt<K;Gt++,on++){var An=Gt/(K-1),li=xt/(ne-1),yi=An,Li=li,rr=we(Ge[0],Ge[2],An),Ui=we(Ge[3],Ge[1],li),Kn=Math.sqrt(rr*rr+Ui*Ui),$r=pe.distortion.distortInverse(Kn);li=2*(Pt.y+(li=(Ui*$r/Kn-ut[3])/(ut[1]-ut[3]))*Pt.height-.5),xe[5*on+0]=An=2*(Pt.x+(An=(rr*$r/Kn-ut[0])/(ut[2]-ut[0]))*Pt.width-.5),xe[5*on+1]=li,xe[5*on+2]=yi,xe[5*on+3]=Li,xe[5*on+4]=$t}var ts=Ge[2]-Ge[0];Ge[0]=-(ts+Ge[0]),Ge[2]=ts-Ge[2],ut[0]=-((ts=ut[2]-ut[0])+ut[0]),ut[2]=ts-ut[2],Pt.x=1-(Pt.x+Pt.width)}return xe},W.prototype.computeMeshIndices_=function(K,ne){for(var pe=new Uint16Array(2*(K-1)*(ne-1)*6),xe=K/2,Ge=ne/2,ut=0,Pt=0,on=0;on<2;on++)for(var $t=0;$t<ne;$t++)for(var xt=0;xt<K;xt++,ut++)0==xt||0==$t||(xt<=xe==$t<=Ge?(pe[Pt++]=ut,pe[Pt++]=ut-K-1,pe[Pt++]=ut-K,pe[Pt++]=ut-K-1,pe[Pt++]=ut,pe[Pt++]=ut-1):(pe[Pt++]=ut-1,pe[Pt++]=ut-K,pe[Pt++]=ut,pe[Pt++]=ut-K,pe[Pt++]=ut-1,pe[Pt++]=ut-K-1));return pe},W.prototype.getOwnPropertyDescriptor_=function(K,ne){var pe=Object.getOwnPropertyDescriptor(K,ne);return(void 0===pe.get||void 0===pe.set)&&(pe.configurable=!0,pe.enumerable=!0,pe.get=function(){return this.getAttribute(ne)},pe.set=function(xe){this.setAttribute(ne,xe)}),pe};var H=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),de=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),Pe=Math.PI/180;function Pn(K){this.gl=K,this.attribs={position:0},this.program=_r(K,H,de,this.attribs),this.uniforms=Zr(K,this.program),this.vertexBuffer=K.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function Ar(K){this.coefficients=K}Pn.prototype.destroy=function(){var K=this.gl;this.listener&&K.canvas.removeEventListener("click",this.listener,!1),K.deleteProgram(this.program),K.deleteBuffer(this.vertexBuffer)},Pn.prototype.listen=function(K,ne){var pe=this.gl.canvas;this.listener=function(xe){var Ge=pe.clientWidth/2;xe.clientX>Ge-42&&xe.clientX<Ge+42&&xe.clientY>pe.clientHeight-42?K(xe):xe.clientX<42&&xe.clientY<42&&ne(xe)},pe.addEventListener("click",this.listener,!1)},Pn.prototype.onResize=function(){var K=this.gl,ne=this;me(K,[K.ARRAY_BUFFER_BINDING],function(xe){var Ge=[],ut=xe.drawingBufferWidth/2,Pt=Math.max(screen.width,screen.height)*window.devicePixelRatio,$t=xe.drawingBufferWidth/Pt*window.devicePixelRatio,xt=4*$t/2,Gt=42*$t,An=28*$t/2,li=14*$t;function yi($r,Hs){var Bs=(90-$r)*Pe,ts=Math.cos(Bs),br=Math.sin(Bs);Ge.push(.3125*ts*An+ut,.3125*br*An+An),Ge.push(Hs*ts*An+ut,Hs*br*An+An)}Ge.push(ut-xt,Gt),Ge.push(ut-xt,xe.drawingBufferHeight),Ge.push(ut+xt,Gt),Ge.push(ut+xt,xe.drawingBufferHeight),ne.gearOffset=Ge.length/2;for(var Li=0;Li<=6;Li++){var rr=60*Li;yi(rr,1),yi(rr+12,1),yi(rr+20,.75),yi(rr+40,.75),yi(rr+48,1)}function Ui($r,Hs){Ge.push(li+$r,xe.drawingBufferHeight-li-Hs)}ne.gearVertexCount=Ge.length/2-ne.gearOffset,ne.arrowOffset=Ge.length/2;var Kn=xt/Math.sin(45*Pe);Ui(0,An),Ui(An,0),Ui(An+Kn,Kn),Ui(Kn,An+Kn),Ui(Kn,An-Kn),Ui(0,An),Ui(An,2*An),Ui(An+Kn,2*An-Kn),Ui(Kn,An-Kn),Ui(0,An),Ui(Kn,An-xt),Ui(28*$t,An-xt),Ui(Kn,An+xt),Ui(28*$t,An+xt),ne.arrowVertexCount=Ge.length/2-ne.arrowOffset,xe.bindBuffer(xe.ARRAY_BUFFER,ne.vertexBuffer),xe.bufferData(xe.ARRAY_BUFFER,new Float32Array(Ge),xe.STATIC_DRAW)})},Pn.prototype.render=function(){var K=this.gl,ne=this;me(K,[K.CULL_FACE,K.DEPTH_TEST,K.BLEND,K.SCISSOR_TEST,K.STENCIL_TEST,K.COLOR_WRITEMASK,K.VIEWPORT,K.CURRENT_PROGRAM,K.ARRAY_BUFFER_BINDING],function(xe){xe.disable(xe.CULL_FACE),xe.disable(xe.DEPTH_TEST),xe.disable(xe.BLEND),xe.disable(xe.SCISSOR_TEST),xe.disable(xe.STENCIL_TEST),xe.colorMask(!0,!0,!0,!0),xe.viewport(0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),ne.renderNoState()})},Pn.prototype.renderNoState=function(){var ne,pe,xe,Ge,ut,Pt,on,$t,xt,Gt,K=this.gl;K.useProgram(this.program),K.bindBuffer(K.ARRAY_BUFFER,this.vertexBuffer),K.enableVertexAttribArray(this.attribs.position),K.vertexAttribPointer(this.attribs.position,2,K.FLOAT,!1,8,0),K.uniform4f(this.uniforms.color,1,1,1,1),xt=1/((Ge=0)-(ut=K.drawingBufferHeight)),Gt=1/((Pt=.1)-(on=1024)),(ne=this.projMat)[0]=-2*($t=1/((pe=0)-(xe=K.drawingBufferWidth))),ne[1]=0,ne[2]=0,ne[3]=0,ne[4]=0,ne[5]=-2*xt,ne[6]=0,ne[7]=0,ne[8]=0,ne[9]=0,ne[10]=2*Gt,ne[11]=0,ne[12]=(pe+xe)*$t,ne[13]=(ut+Ge)*xt,ne[14]=(on+Pt)*Gt,ne[15]=1,K.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),K.drawArrays(K.TRIANGLE_STRIP,0,4),K.drawArrays(K.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),K.drawArrays(K.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},Ar.prototype.distortInverse=function(K){for(var ne=0,pe=1,xe=K-this.distort(ne);Math.abs(pe-ne)>1e-4;){var Ge=K-this.distort(pe),ut=pe-Ge*((pe-ne)/(Ge-xe));ne=pe,pe=ut,xe=Ge}return pe},Ar.prototype.distort=function(K){for(var ne=K*K,pe=0,xe=0;xe<this.coefficients.length;xe++)pe=ne*(pe+this.coefficients[xe]);return(pe+1)*K};var di=Math.PI/180,vt=180/Math.PI,Nt=function(ne,pe,xe){this.x=ne||0,this.y=pe||0,this.z=xe||0};Nt.prototype={constructor:Nt,set:function(ne,pe,xe){return this.x=ne,this.y=pe,this.z=xe,this},copy:function(ne){return this.x=ne.x,this.y=ne.y,this.z=ne.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var ne=this.length();return 0!==ne?this.multiplyScalar(1/ne):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(ne){this.x*=ne,this.y*=ne,this.z*=ne},applyQuaternion:function(ne){var pe=this.x,xe=this.y,Ge=this.z,ut=ne.x,Pt=ne.y,on=ne.z,$t=ne.w,xt=$t*pe+Pt*Ge-on*xe,Gt=$t*xe+on*pe-ut*Ge,An=$t*Ge+ut*xe-Pt*pe,li=-ut*pe-Pt*xe-on*Ge;return this.x=xt*$t+li*-ut+Gt*-on-An*-Pt,this.y=Gt*$t+li*-Pt+An*-ut-xt*-on,this.z=An*$t+li*-on+xt*-Pt-Gt*-ut,this},dot:function(ne){return this.x*ne.x+this.y*ne.y+this.z*ne.z},crossVectors:function(ne,pe){var xe=ne.x,Ge=ne.y,ut=ne.z,Pt=pe.x,on=pe.y,$t=pe.z;return this.x=Ge*$t-ut*on,this.y=ut*Pt-xe*$t,this.z=xe*on-Ge*Pt,this}};var Lt=function(ne,pe,xe,Ge){this.x=ne||0,this.y=pe||0,this.z=xe||0,this.w=void 0!==Ge?Ge:1};function Fn(K){this.width=K.width||kn(),this.height=K.height||Dn(),this.widthMeters=K.widthMeters,this.heightMeters=K.heightMeters,this.bevelMeters=K.bevelMeters}Lt.prototype={constructor:Lt,set:function(ne,pe,xe,Ge){return this.x=ne,this.y=pe,this.z=xe,this.w=Ge,this},copy:function(ne){return this.x=ne.x,this.y=ne.y,this.z=ne.z,this.w=ne.w,this},setFromEulerXYZ:function(ne,pe,xe){var Ge=Math.cos(ne/2),ut=Math.cos(pe/2),Pt=Math.cos(xe/2),on=Math.sin(ne/2),$t=Math.sin(pe/2),xt=Math.sin(xe/2);return this.x=on*ut*Pt+Ge*$t*xt,this.y=Ge*$t*Pt-on*ut*xt,this.z=Ge*ut*xt+on*$t*Pt,this.w=Ge*ut*Pt-on*$t*xt,this},setFromEulerYXZ:function(ne,pe,xe){var Ge=Math.cos(ne/2),ut=Math.cos(pe/2),Pt=Math.cos(xe/2),on=Math.sin(ne/2),$t=Math.sin(pe/2),xt=Math.sin(xe/2);return this.x=on*ut*Pt+Ge*$t*xt,this.y=Ge*$t*Pt-on*ut*xt,this.z=Ge*ut*xt-on*$t*Pt,this.w=Ge*ut*Pt+on*$t*xt,this},setFromAxisAngle:function(ne,pe){var xe=pe/2,Ge=Math.sin(xe);return this.x=ne.x*Ge,this.y=ne.y*Ge,this.z=ne.z*Ge,this.w=Math.cos(xe),this},multiply:function(ne){return this.multiplyQuaternions(this,ne)},multiplyQuaternions:function(ne,pe){var xe=ne.x,Ge=ne.y,ut=ne.z,Pt=ne.w,on=pe.x,$t=pe.y,xt=pe.z,Gt=pe.w;return this.x=xe*Gt+Pt*on+Ge*xt-ut*$t,this.y=Ge*Gt+Pt*$t+ut*on-xe*xt,this.z=ut*Gt+Pt*xt+xe*$t-Ge*on,this.w=Pt*Gt-xe*on-Ge*$t-ut*xt,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var ne=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===ne?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=this.x*(ne=1/ne),this.y=this.y*ne,this.z=this.z*ne,this.w=this.w*ne),this},slerp:function(ne,pe){if(0===pe)return this;if(1===pe)return this.copy(ne);var xe=this.x,Ge=this.y,ut=this.z,Pt=this.w,on=Pt*ne.w+xe*ne.x+Ge*ne.y+ut*ne.z;if(on<0?(this.w=-ne.w,this.x=-ne.x,this.y=-ne.y,this.z=-ne.z,on=-on):this.copy(ne),on>=1)return this.w=Pt,this.x=xe,this.y=Ge,this.z=ut,this;var $t=Math.acos(on),xt=Math.sqrt(1-on*on);if(Math.abs(xt)<.001)return this.w=.5*(Pt+this.w),this.x=.5*(xe+this.x),this.y=.5*(Ge+this.y),this.z=.5*(ut+this.z),this;var Gt=Math.sin((1-pe)*$t)/xt,An=Math.sin(pe*$t)/xt;return this.w=Pt*Gt+this.w*An,this.x=xe*Gt+this.x*An,this.y=Ge*Gt+this.y*An,this.z=ut*Gt+this.z*An,this},setFromUnitVectors:function(){var K,ne;return function(xe,Ge){return void 0===K&&(K=new Nt),(ne=xe.dot(Ge)+1)<1e-6?(ne=0,Math.abs(xe.x)>Math.abs(xe.z)?K.set(-xe.y,xe.x,0):K.set(0,-xe.z,xe.y)):K.crossVectors(xe,Ge),this.x=K.x,this.y=K.y,this.z=K.z,this.w=ne,this.normalize(),this}}()};var sn=new Fn({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Sn=new Fn({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),En={CardboardV1:new Zi({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Zi({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Ei(K,ne){this.viewer=En.CardboardV2,this.updateDeviceParams(K),this.distortion=new Ar(this.viewer.distortionCoefficients);for(var pe=0;pe<ne.length;pe++){var xe=ne[pe];En[xe.id]=new Zi(xe)}}function Zi(K){this.id=K.id,this.label=K.label,this.fov=K.fov,this.interLensDistance=K.interLensDistance,this.baselineLensDistance=K.baselineLensDistance,this.screenLensDistance=K.screenLensDistance,this.distortionCoefficients=K.distortionCoefficients,this.inverseCoefficients=K.inverseCoefficients}Ei.prototype.updateDeviceParams=function(K){this.device=this.determineDevice_(K)||this.device},Ei.prototype.getDevice=function(){return this.device},Ei.prototype.setViewer=function(K){this.viewer=K,this.distortion=new Ar(this.viewer.distortionCoefficients)},Ei.prototype.determineDevice_=function(K){if(!K)return ce()?(console.warn("Using fallback iOS device measurements."),Sn):(console.warn("Using fallback Android device measurements."),sn);var xe=.0254/K.ydpi;return new Fn({widthMeters:.0254/K.xdpi*kn(),heightMeters:xe*Dn(),bevelMeters:.001*K.bevelMm})},Ei.prototype.getDistortedFieldOfViewLeftEye=function(){var K=this.viewer,ne=this.device,pe=this.distortion,xe=K.screenLensDistance,ut=K.interLensDistance/2,Pt=K.baselineLensDistance-ne.bevelMeters,on=ne.heightMeters-Pt,$t=vt*Math.atan(pe.distort((ne.widthMeters-K.interLensDistance)/2/xe)),xt=vt*Math.atan(pe.distort(ut/xe)),Gt=vt*Math.atan(pe.distort(Pt/xe)),An=vt*Math.atan(pe.distort(on/xe));return{leftDegrees:Math.min($t,K.fov),rightDegrees:Math.min(xt,K.fov),downDegrees:Math.min(Gt,K.fov),upDegrees:Math.min(An,K.fov)}},Ei.prototype.getLeftEyeVisibleTanAngles=function(){var K=this.viewer,ne=this.device,pe=this.distortion,xe=Math.tan(-di*K.fov),Ge=Math.tan(di*K.fov),ut=Math.tan(di*K.fov),Pt=Math.tan(-di*K.fov),on=ne.widthMeters/4,$t=ne.heightMeters/2,Gt=K.interLensDistance/2-on,An=-(K.baselineLensDistance-ne.bevelMeters-$t),li=K.screenLensDistance,yi=pe.distort((Gt-on)/li),Li=pe.distort((An+$t)/li),rr=pe.distort((Gt+on)/li),Ui=pe.distort((An-$t)/li),Kn=new Float32Array(4);return Kn[0]=Math.max(xe,yi),Kn[1]=Math.min(Ge,Li),Kn[2]=Math.min(ut,rr),Kn[3]=Math.max(Pt,Ui),Kn},Ei.prototype.getLeftEyeNoLensTanAngles=function(){var K=this.viewer,ne=this.device,pe=this.distortion,xe=new Float32Array(4),Ge=pe.distortInverse(Math.tan(-di*K.fov)),ut=pe.distortInverse(Math.tan(di*K.fov)),Pt=pe.distortInverse(Math.tan(di*K.fov)),on=pe.distortInverse(Math.tan(-di*K.fov)),$t=ne.widthMeters/4,xt=ne.heightMeters/2,An=K.interLensDistance/2-$t,li=-(K.baselineLensDistance-ne.bevelMeters-xt),yi=K.screenLensDistance,rr=(li+xt)/yi,Ui=(An+$t)/yi,Kn=(li-xt)/yi;return xe[0]=Math.max(Ge,(An-$t)/yi),xe[1]=Math.min(ut,rr),xe[2]=Math.min(Pt,Ui),xe[3]=Math.max(on,Kn),xe},Ei.prototype.getLeftEyeVisibleScreenRect=function(K){var ne=this.viewer,pe=this.device,xe=ne.screenLensDistance,Ge=(pe.widthMeters-ne.interLensDistance)/2,ut=ne.baselineLensDistance-pe.bevelMeters,Pt=(K[0]*xe+Ge)/pe.widthMeters,xt=(K[3]*xe+ut)/pe.heightMeters;return{x:Pt,y:xt,width:(K[2]*xe+Ge)/pe.widthMeters-Pt,height:(K[1]*xe+ut)/pe.heightMeters-xt}},Ei.prototype.getFieldOfViewLeftEye=function(K){return K?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Ei.prototype.getFieldOfViewRightEye=function(K){var ne=this.getFieldOfViewLeftEye(K);return{leftDegrees:ne.rightDegrees,rightDegrees:ne.leftDegrees,upDegrees:ne.upDegrees,downDegrees:ne.downDegrees}},Ei.prototype.getUndistortedFieldOfViewLeftEye=function(){var K=this.getUndistortedParams_();return{leftDegrees:vt*Math.atan(K.outerDist),rightDegrees:vt*Math.atan(K.innerDist),downDegrees:vt*Math.atan(K.bottomDist),upDegrees:vt*Math.atan(K.topDist)}},Ei.prototype.getUndistortedViewportLeftEye=function(){var K=this.getUndistortedParams_(),pe=this.device,xe=this.viewer.screenLensDistance,Pt=pe.width/(pe.widthMeters/xe),on=pe.height/(pe.heightMeters/xe),$t=Math.round((K.eyePosX-K.outerDist)*Pt),xt=Math.round((K.eyePosY-K.bottomDist)*on);return{x:$t,y:xt,width:Math.round((K.eyePosX+K.innerDist)*Pt)-$t,height:Math.round((K.eyePosY+K.topDist)*on)-xt}},Ei.prototype.getUndistortedParams_=function(){var K=this.viewer,ne=this.device,xe=K.screenLensDistance,Ge=K.interLensDistance/2/xe,Pt=ne.heightMeters/xe,on=ne.widthMeters/xe/2-Ge,$t=(K.baselineLensDistance-ne.bevelMeters)/xe,Gt=this.distortion.distortInverse(Math.tan(di*K.fov)),An=Math.min(on,Gt),li=Math.min(Ge,Gt),yi=Math.min($t,Gt);return{outerDist:An,innerDist:li,topDist:Math.min(Pt-$t,Gt),bottomDist:yi,eyePosX:on,eyePosY:$t}},Ei.Viewers=En;var Oi={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function qi(K,ne){if(this.dpdb=Oi,this.recalculateDeviceParams_(),K){this.onDeviceParamsUpdated=ne;var pe=new XMLHttpRequest,xe=this;pe.open("GET",K,!0),pe.addEventListener("load",function(){xe.loading=!1,pe.status>=200&&pe.status<=299?(xe.dpdb=JSON.parse(pe.response),xe.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),pe.send()}}function er(K){this.xdpi=K.xdpi,this.ydpi=K.ydpi,this.bevelMm=K.bevelMm}function Un(K,ne){this.set(K,ne)}function $e(K,ne){this.kFilter=K,this.isDebug=ne,this.currentAccelMeasurement=new Un,this.currentGyroMeasurement=new Un,this.previousGyroMeasurement=new Un,this.filterQ=ce()?new Lt(-1,0,0,1):new Lt(1,0,0,1),this.previousFilterQ=new Lt,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Lt,this.isOrientationInitialized=!1,this.estimatedGravity=new Nt,this.measuredGravity=new Nt,this.gyroIntegralQ=new Lt}function bt(K,ne){this.predictionTimeS=K,this.isDebug=ne,this.previousQ=new Lt,this.previousTimestampS=null,this.deltaQ=new Lt,this.outQ=new Lt}function fi(K,ne,pe,xe){this.yawOnly=pe,this.accelerometer=new Nt,this.gyroscope=new Nt,this.filter=new $e(K,xe),this.posePredictor=new bt(ne,xe),this.isFirefoxAndroid=je(),this.isIOS=ce();var Ge=it();this.isDeviceMotionInRadians=!this.isIOS&&Ge&&Ge<66,this.isWithoutDeviceMotion=ht()||ft(),this.filterToWorldQ=new Lt,ce()?this.filterToWorldQ.setFromAxisAngle(new Nt(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Nt(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Lt,this.worldToScreenQ=new Lt,this.originalPoseAdjustQ=new Lt,this.originalPoseAdjustQ.setFromAxisAngle(new Nt(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),Bt()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Lt,this.orientationOut_=new Float32Array(4),this.start()}qi.prototype.getDeviceParams=function(){return this.deviceParams},qi.prototype.recalculateDeviceParams_=function(){var K=this.calcDeviceParams_();K?(this.deviceParams=K,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},qi.prototype.calcDeviceParams_=function(){var K=this.dpdb;if(!K)return console.error("DPDB not available."),null;if(1!=K.format)return console.error("DPDB has unexpected format version."),null;if(!K.devices||!K.devices.length)return console.error("DPDB does not have a devices section."),null;var ne=navigator.userAgent||navigator.vendor||window.opera,pe=kn(),xe=Dn();if(!K.devices)return console.error("DPDB has no devices section."),null;for(var Ge=0;Ge<K.devices.length;Ge++){var ut=K.devices[Ge];if(ut.rules)if("ios"==ut.type||"android"==ut.type){if(ce()==("ios"==ut.type)){for(var Pt=!1,on=0;on<ut.rules.length;on++)if(this.ruleMatches_(ut.rules[on],ne,pe,xe)){Pt=!0;break}if(Pt)return new er({xdpi:ut.dpi[0]||ut.dpi,ydpi:ut.dpi[1]||ut.dpi,bevelMm:ut.bw})}}else console.warn("Device["+Ge+"] has invalid type.");else console.warn("Device["+Ge+"] has no rules section.")}return console.warn("No DPDB device match."),null},qi.prototype.ruleMatches_=function(K,ne,pe,xe){if(!K.ua&&!K.res||(K.ua&&"SM"===K.ua.substring(0,2)&&(K.ua=K.ua.substring(0,7)),K.ua&&ne.indexOf(K.ua)<0))return!1;if(K.res){if(!K.res[0]||!K.res[1])return!1;var Ge=K.res[0],ut=K.res[1];if(Math.min(pe,xe)!=Math.min(Ge,ut)||Math.max(pe,xe)!=Math.max(Ge,ut))return!1}return!0},Un.prototype.set=function(K,ne){this.sample=K,this.timestampS=ne},Un.prototype.copy=function(K){this.set(K.sample,K.timestampS)},$e.prototype.addAccelMeasurement=function(K,ne){this.currentAccelMeasurement.set(K,ne)},$e.prototype.addGyroMeasurement=function(K,ne){this.currentGyroMeasurement.set(K,ne),function(ne){return!(isNaN(ne)||ne<=.001||ne>1)}(ne-this.previousGyroMeasurement.timestampS)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},$e.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var ne=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);this.gyroIntegralQ.multiply(ne),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(ne);var pe=new Lt;pe.copy(this.filterQ),pe.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(pe),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var xe=new Lt;xe.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),xe.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",vt*function(ne){return ne.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(ne.w)}(xe),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var Ge=new Lt;Ge.copy(this.filterQ),Ge.multiply(xe),this.filterQ.slerp(Ge,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},$e.prototype.getOrientation=function(){return this.filterQ},$e.prototype.accelToQuaternion_=function(K){var ne=new Nt;ne.copy(K),ne.normalize();var pe=new Lt;return pe.setFromUnitVectors(new Nt(0,0,-1),ne),pe.inverse(),pe},$e.prototype.gyroToQuaternionDelta_=function(K,ne){var pe=new Lt,xe=new Nt;return xe.copy(K),xe.normalize(),pe.setFromAxisAngle(xe,K.length()*ne),pe},bt.prototype.getPrediction=function(K,ne,pe){if(!this.previousTimestampS)return this.previousQ.copy(K),this.previousTimestampS=pe,K;var xe=new Nt;xe.copy(ne),xe.normalize();var Ge=ne.length();return Ge<20*di?(this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(vt*Ge).toFixed(1)),this.outQ.copy(K),this.previousQ.copy(K),this.outQ):(this.deltaQ.setFromAxisAngle(xe,Ge*this.predictionTimeS),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(K),this.previousTimestampS=pe,this.outQ)},fi.prototype.getPosition=function(){return null},fi.prototype.getOrientation=function(){var K=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(Ge=(new Lt).setFromAxisAngle(new Nt(0,0,-1),0),ut=new Lt,-90===window.orientation?ut.setFromAxisAngle(new Nt(0,1,0),Math.PI/-2):ut.setFromAxisAngle(new Nt(0,1,0),Math.PI/2),Ge.multiply(ut)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var Ge=new Lt;return Ge.setFromAxisAngle(new Nt(1,0,0),-Math.PI/2),Ge}(),K=this._deviceOrientationQ,(pe=new Lt).copy(K),pe.multiply(this.deviceOrientationFilterToWorldQ),pe.multiply(this.resetQ),pe.multiply(this.worldToScreenQ),pe.multiplyQuaternions(this.deviceOrientationFixQ,pe),this.yawOnly&&(pe.x=0,pe.z=0,pe.normalize()),this.orientationOut_[0]=pe.x,this.orientationOut_[1]=pe.y,this.orientationOut_[2]=pe.z,this.orientationOut_[3]=pe.w,this.orientationOut_;var Ge,ut,pe,ne=this.filter.getOrientation();return K=this.posePredictor.getPrediction(ne,this.gyroscope,this.previousTimestampS),(pe=new Lt).copy(this.filterToWorldQ),pe.multiply(this.resetQ),pe.multiply(K),pe.multiply(this.worldToScreenQ),this.yawOnly&&(pe.x=0,pe.z=0,pe.normalize()),this.orientationOut_[0]=pe.x,this.orientationOut_[1]=pe.y,this.orientationOut_[2]=pe.z,this.orientationOut_[3]=pe.w,this.orientationOut_},fi.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),Bt()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},fi.prototype.onDeviceOrientation_=function(K){this._deviceOrientationQ=this._deviceOrientationQ||new Lt;var ne=K.alpha,pe=K.beta,xe=K.gamma;ne=(ne||0)*Math.PI/180,pe=(pe||0)*Math.PI/180,xe=(xe||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(pe,ne,-xe)},fi.prototype.onDeviceMotion_=function(K){this.updateDeviceMotion_(K)},fi.prototype.updateDeviceMotion_=function(K){var ne=K.accelerationIncludingGravity,pe=K.rotationRate,xe=K.timeStamp/1e3,Ge=xe-this.previousTimestampS;return Ge<0?(le("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=xe)):Ge<=.001||Ge>1?(le("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=xe)):(this.accelerometer.set(-ne.x,-ne.y,-ne.z),pe&&(_t()?this.gyroscope.set(-pe.beta,pe.alpha,pe.gamma):this.gyroscope.set(pe.alpha,pe.beta,pe.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,xe)),this.filter.addAccelMeasurement(this.accelerometer,xe),void(this.previousTimestampS=xe))},fi.prototype.onOrientationChange_=function(K){this.setScreenTransform_()},fi.prototype.onMessage_=function(K){var ne=K.data;ne&&ne.type&&"devicemotion"===ne.type.toLowerCase()&&this.updateDeviceMotion_(ne.deviceMotionEvent)},fi.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Nt(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Nt(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},fi.prototype.start=function(){var ne,pe,xe;this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),ce()&&(ne=window.self!==window.top,pe=Es(document.referrer),xe=Es(window.location.href),ne&&pe!==xe)&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},fi.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var os=new Nt(1,0,0),Ae=new Nt(0,0,1),Fe=new Lt;Fe.setFromAxisAngle(os,-Math.PI/2),Fe.multiply((new Lt).setFromAxisAngle(Ae,Math.PI/2));var ke=function(){function K(ne){(function(K,ne){if(!(K instanceof ne))throw new TypeError("Cannot call a class as a function")})(this,K),this.config=ne,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Lt,this._outQ=new Lt,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return oe(K,[{key:"init",value:function(){var pe=null;try{(pe=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(xe){this.errors.push(xe),"SecurityError"===xe.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===xe.name?this.useDeviceMotion():console.error(xe)}pe&&(this.api="sensor",this.sensor=pe,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new fi(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var pe=this.sensor.quaternion;this._sensorQ.set(pe[0],pe[1],pe[2],pe[3]);var xe=this._outQ;return xe.copy(Fe),xe.multiply(this._sensorQ),this.config.YAW_ONLY&&(xe.x=xe.z=0,xe.normalize()),this._out[0]=xe.x,this._out[1]=xe.y,this._out[2]=xe.z,this._out[3]=xe.w,this._out}},{key:"_onSensorError",value:function(pe){this.errors.push(pe.error),"NotAllowedError"===pe.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===pe.error.name?console.error("Sensor could not be read"):console.error(pe.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),K}();function at(){this.loadIcon_();var K=document.createElement("div");(ne=K.style).position="fixed",ne.top=0,ne.right=0,ne.bottom=0,ne.left=0,ne.backgroundColor="gray",ne.fontFamily="sans-serif",ne.zIndex=1e6;var pe=document.createElement("img");pe.src=this.icon,(ne=pe.style).marginLeft="25%",ne.marginTop="25%",ne.width="50%",K.appendChild(pe);var xe=document.createElement("div");(ne=xe.style).textAlign="center",ne.fontSize="16px",ne.lineHeight="24px",ne.margin="24px 25%",ne.width="50%",xe.innerHTML="Place your phone into your Cardboard viewer.",K.appendChild(xe);var Ge=document.createElement("div");(ne=Ge.style).backgroundColor="#CFD8DC",ne.position="fixed",ne.bottom=0,ne.width="100%",ne.height="48px",ne.padding="14px 24px",ne.boxSizing="border-box",ne.color="#656A6B",K.appendChild(Ge);var ut=document.createElement("div");ut.style.float="left",ut.innerHTML="No Cardboard viewer?";var ne,Pt=document.createElement("a");Pt.href="https://www.google.com/get/cardboard/get-cardboard/",Pt.innerHTML="get one",Pt.target="_blank",(ne=Pt.style).float="right",ne.fontWeight=600,ne.textTransform="uppercase",ne.borderLeft="1px solid gray",ne.paddingLeft="24px",ne.textDecoration="none",ne.color="#656A6B",Ge.appendChild(ut),Ge.appendChild(Pt),this.overlay=K,this.text=xe,this.hide()}at.prototype.show=function(K){K||this.overlay.parentElement?K&&(this.overlay.parentElement&&this.overlay.parentElement!=K&&this.overlay.parentElement.removeChild(this.overlay),K.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var pe=this.overlay.querySelector("img").style;Bt()?(pe.width="20%",pe.marginLeft="40%",pe.marginTop="3%"):(pe.width="50%",pe.marginLeft="25%",pe.marginTop="25%")},at.prototype.hide=function(){this.overlay.style.display="none"},at.prototype.showTemporarily=function(K,ne){this.show(ne),this.timer=setTimeout(this.hide.bind(this),K)},at.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},at.prototype.update=function(){this.disableShowTemporarily(),!Bt()&&kr()?this.show():this.hide()},at.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var Ut="WEBVR_CARDBOARD_VIEWER";function Qt(K){try{this.selectedKey=localStorage.getItem(Ut)}catch(ne){console.error("Failed to load viewer profile: %s",ne)}this.selectedKey||(this.selectedKey=K||"CardboardV1"),this.dialog=this.createDialog_(Ei.Viewers),this.root=null,this.onChangeCallbacks_=[]}Qt.prototype.show=function(K){this.root=K,K.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},Qt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Qt.prototype.getCurrentViewer=function(){return Ei.Viewers[this.selectedKey]},Qt.prototype.getSelectedKey_=function(){var K=this.dialog.querySelector("input[name=field]:checked");return K?K.id:null},Qt.prototype.onChange=function(K){this.onChangeCallbacks_.push(K)},Qt.prototype.fireOnChange_=function(K){for(var ne=0;ne<this.onChangeCallbacks_.length;ne++)this.onChangeCallbacks_[ne](K)},Qt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&Ei.Viewers[this.selectedKey]){this.fireOnChange_(Ei.Viewers[this.selectedKey]);try{localStorage.setItem(Ut,this.selectedKey)}catch(K){console.error("Failed to save viewer profile: %s",K)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},Qt.prototype.createDialog_=function(K){var ne=document.createElement("div");ne.classList.add("webvr-polyfill-viewer-selector"),ne.style.display="none";var pe=document.createElement("div");(xe=pe.style).position="fixed",xe.left=0,xe.top=0,xe.width="100%",xe.height="100%",xe.background="rgba(0, 0, 0, 0.3)",pe.addEventListener("click",this.hide.bind(this));var ut=document.createElement("div"),xe=ut.style;for(var Pt in xe.boxSizing="border-box",xe.position="fixed",xe.top="24px",xe.left="50%",xe.marginLeft="-140px",xe.width="280px",xe.padding="24px",xe.overflow="hidden",xe.background="#fafafa",xe.fontFamily="'Roboto', sans-serif",xe.boxShadow="0px 5px 20px #666",ut.appendChild(this.createH1_("Select your viewer")),K)ut.appendChild(this.createChoice_(Pt,K[Pt].label));return ut.appendChild(this.createButton_("Save",this.onSave_.bind(this))),ne.appendChild(pe),ne.appendChild(ut),ne},Qt.prototype.createH1_=function(K){var ne=document.createElement("h1"),pe=ne.style;return pe.color="black",pe.fontSize="20px",pe.fontWeight="bold",pe.marginTop=0,pe.marginBottom="24px",ne.innerHTML=K,ne},Qt.prototype.createChoice_=function(K,ne){var pe=document.createElement("div");pe.style.marginTop="8px",pe.style.color="black";var xe=document.createElement("input");xe.style.fontSize="30px",xe.setAttribute("id",K),xe.setAttribute("type","radio"),xe.setAttribute("value",K),xe.setAttribute("name","field");var Ge=document.createElement("label");return Ge.style.marginLeft="4px",Ge.setAttribute("for",K),Ge.innerHTML=ne,pe.appendChild(xe),pe.appendChild(Ge),pe},Qt.prototype.createButton_=function(K,ne){var pe=document.createElement("button");pe.innerHTML=K;var xe=pe.style;return xe.float="right",xe.textTransform="uppercase",xe.color="#1094f7",xe.fontSize="14px",xe.letterSpacing=0,xe.border=0,xe.background="none",xe.marginTop="16px",pe.addEventListener("click",ne),pe},"undefined"!=typeof window?window:void 0!==D||"undefined"!=typeof self&&self;var Tr=function(K){return K&&K.__esModule&&Object.prototype.hasOwnProperty.call(K,"default")?K.default:K}(function(K,ne){return K(ne={exports:{}},ne.exports),ne.exports}(function(K,ne){K.exports=function(pe){var xe={};function Ge(ut){if(xe[ut])return xe[ut].exports;var Pt=xe[ut]={i:ut,l:!1,exports:{}};return pe[ut].call(Pt.exports,Pt,Pt.exports,Ge),Pt.l=!0,Pt.exports}return Ge.m=pe,Ge.c=xe,Ge.d=function(ut,Pt,on){Ge.o(ut,Pt)||Object.defineProperty(ut,Pt,{configurable:!1,enumerable:!0,get:on})},Ge.n=function(ut){var Pt=ut&&ut.__esModule?function(){return ut.default}:function(){return ut};return Ge.d(Pt,"a",Pt),Pt},Ge.o=function(ut,Pt){return Object.prototype.hasOwnProperty.call(ut,Pt)},Ge.p="",Ge(Ge.s=0)}([function(pe,xe,Ge){var ut=function(){function Gt(An,li){for(var yi=0;yi<li.length;yi++){var Li=li[yi];Li.enumerable=Li.enumerable||!1,Li.configurable=!0,"value"in Li&&(Li.writable=!0),Object.defineProperty(An,Li.key,Li)}}return function(An,li,yi){return li&&Gt(An.prototype,li),yi&&Gt(An,yi),An}}(),on=Ge(1),$t="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,xt=function(){function Gt(){(function(Gt,An){if(!(Gt instanceof An))throw new TypeError("Cannot call a class as a function")})(this,Gt),$t?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",on),this.noSleepVideo.addEventListener("timeupdate",function(An){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return ut(Gt,[{key:"enable",value:function(){$t?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){$t?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),Gt}();pe.exports=xt},function(pe,xe,Ge){pe.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})),hr=1e3,Ji=[0,0,.5,1],Sr=[.5,0,.5,1],ds=window.requestAnimationFrame,Js=window.cancelAnimationFrame;function ar(K){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:K.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:K.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:K.canPresent},maxLayers:{writable:!1,enumerable:!0,value:K.maxLayers},hasOrientation:{enumerable:!0,get:function(){return he("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),K.hasOrientation}}})}function tr(K){var ne=!("wakelock"in(K=K||{}))||K.wakelock;this.isPolyfilled=!0,this.displayId=hr++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return he("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new ar({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,ne&&kr()&&(this.wakelock_=new Tr)}tr.prototype.getFrameData=function(K){return cr(K,this._getPose(),this)},tr.prototype.getPose=function(){return he("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},tr.prototype.resetPose=function(){return he("VRDisplay.prototype.resetPose"),this._resetPose()},tr.prototype.getImmediatePose=function(){return he("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},tr.prototype.requestAnimationFrame=function(K){return ds(K)},tr.prototype.cancelAnimationFrame=function(K){return Js(K)},tr.prototype.wrapForFullscreen=function(K){if(ce())return K;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var ne=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",ne.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==K)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=K,this.originalParent_=K.parentElement,this.originalParent_||document.body.appendChild(K),!this.fullscreenWrapper_.parentElement){var pe=this.fullscreenElement_.parentElement;pe.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),pe.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var xe=this;return function(){if(xe.fullscreenElement_){var ut=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];xe.fullscreenElement_.setAttribute("style",ut.join("; ")+";")}}(),this.fullscreenWrapper_},tr.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var K=this.fullscreenElement_;this.fullscreenElementCachedStyle_?K.setAttribute("style",this.fullscreenElementCachedStyle_):K.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var ne=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(K),this.originalParent_===ne?ne.insertBefore(K,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(K),ne.removeChild(this.fullscreenWrapper_),K}},tr.prototype.requestPresent=function(K){var ne=this.isPresenting,pe=this;return K instanceof Array||(he("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),K=[K]),new Promise(function(xe,Ge){if(pe.capabilities.canPresent)if(0==K.length||K.length>pe.capabilities.maxLayers)Ge(new Error("Invalid number of layers."));else{var ut=K[0];if(ut.source){var Pt=ut.leftBounds||Ji,on=ut.rightBounds||Sr;if(ne){var $t=pe.layer_;$t.source!==ut.source&&($t.source=ut.source);for(var xt=0;xt<4;xt++)$t.leftBounds[xt]=Pt[xt],$t.rightBounds[xt]=on[xt];return pe.wrapForFullscreen(pe.layer_.source),pe.updatePresent_(),void xe()}if(pe.layer_={predistorted:ut.predistorted,source:ut.source,leftBounds:Pt.slice(0),rightBounds:on.slice(0)},pe.waitingForPresent_=!1,pe.layer_&&pe.layer_.source){var Gt=pe.wrapForFullscreen(pe.layer_.source);pe.addFullscreenListeners_(Gt,function(){var Li=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;pe.isPresenting=Gt===Li,pe.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(rr){console.error("screen.orientation.lock() failed due to",rr.message)}),pe.waitingForPresent_=!1,pe.beginPresent_(),xe()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),pe.removeFullscreenWrapper(),pe.disableWakeLock(),pe.endPresent_(),pe.removeFullscreenListeners_()),pe.fireVRDisplayPresentChange_()},function(){!pe.waitingForPresent_||(pe.removeFullscreenWrapper(),pe.removeFullscreenListeners_(),pe.disableWakeLock(),pe.waitingForPresent_=!1,pe.isPresenting=!1,Ge(new Error("Unable to present.")))}),function(ne){if(Me())return!1;if(ne.requestFullscreen)ne.requestFullscreen();else if(ne.webkitRequestFullscreen)ne.webkitRequestFullscreen();else if(ne.mozRequestFullScreen)ne.mozRequestFullScreen();else{if(!ne.msRequestFullscreen)return!1;ne.msRequestFullscreen()}return!0}(Gt)?(pe.enableWakeLock(),pe.waitingForPresent_=!0):(ce()||Me())&&(pe.enableWakeLock(),pe.isPresenting=!0,pe.beginPresent_(),pe.fireVRDisplayPresentChange_(),xe())}!pe.waitingForPresent_&&!ce()&&(bn(),Ge(new Error("Unable to present.")))}else xe()}else Ge(new Error("VRDisplay is not capable of presenting."))})},tr.prototype.exitPresent=function(){var K=this.isPresenting,ne=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(pe,xe){K?(!bn()&&ce()&&(ne.endPresent_(),ne.fireVRDisplayPresentChange_()),Me()&&(ne.removeFullscreenWrapper(),ne.removeFullscreenListeners_(),ne.endPresent_(),ne.fireVRDisplayPresentChange_()),pe()):xe(new Error("Was not presenting to VRDisplay."))})},tr.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},tr.prototype.fireVRDisplayPresentChange_=function(){var K=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(K)},tr.prototype.fireVRDisplayConnect_=function(){var K=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(K)},tr.prototype.addFullscreenListeners_=function(K,ne,pe){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=K,this.fullscreenChangeHandler_=ne,this.fullscreenErrorHandler_=pe,ne&&(document.fullscreenEnabled?K.addEventListener("fullscreenchange",ne,!1):document.webkitFullscreenEnabled?K.addEventListener("webkitfullscreenchange",ne,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",ne,!1):document.msFullscreenEnabled&&K.addEventListener("msfullscreenchange",ne,!1)),pe&&(document.fullscreenEnabled?K.addEventListener("fullscreenerror",pe,!1):document.webkitFullscreenEnabled?K.addEventListener("webkitfullscreenerror",pe,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",pe,!1):document.msFullscreenEnabled&&K.addEventListener("msfullscreenerror",pe,!1))},tr.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var K=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var ne=this.fullscreenChangeHandler_;K.removeEventListener("fullscreenchange",ne,!1),K.removeEventListener("webkitfullscreenchange",ne,!1),document.removeEventListener("mozfullscreenchange",ne,!1),K.removeEventListener("msfullscreenchange",ne,!1)}if(this.fullscreenErrorHandler_){var pe=this.fullscreenErrorHandler_;K.removeEventListener("fullscreenerror",pe,!1),K.removeEventListener("webkitfullscreenerror",pe,!1),document.removeEventListener("mozfullscreenerror",pe,!1),K.removeEventListener("msfullscreenerror",pe,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},tr.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},tr.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},tr.prototype.beginPresent_=function(){},tr.prototype.endPresent_=function(){},tr.prototype.submitFrame=function(K){},tr.prototype.getEyeParameters=function(K){return null};var ho={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Jr_LEFT="left",Jr_RIGHT="right";function jr(K){var ne=bs({},ho);K=bs(ne,K||{}),tr.call(this,{wakelock:K.MOBILE_WAKE_LOCK}),this.config=K,this.displayName="Cardboard VRDisplay",this.capabilities=new ar({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ke(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new qi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Ei(this.dpdb_.getDeviceParams(),K.ADDITIONAL_VIEWERS),this.viewerSelector_=new Qt(K.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new at),ce()&&window.addEventListener("resize",this.onResize_.bind(this))}return(jr.prototype=Object.create(tr.prototype))._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},jr.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},jr.prototype._getFieldOfView=function(K){var ne;if(K==Jr_LEFT)ne=this.deviceInfo_.getFieldOfViewLeftEye();else{if(K!=Jr_RIGHT)return console.error("Invalid eye provided: %s",K),null;ne=this.deviceInfo_.getFieldOfViewRightEye()}return ne},jr.prototype._getEyeOffset=function(K){var ne;if(K==Jr_LEFT)ne=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(K!=Jr_RIGHT)return console.error("Invalid eye provided: %s",K),null;ne=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return ne},jr.prototype.getEyeParameters=function(K){var ne=this._getEyeOffset(K),pe=this._getFieldOfView(K),xe={offset:ne,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(xe,"fieldOfView",{enumerable:!0,get:function(){return he("VRFieldOfView","VRFrameData's projection matrices"),pe}}),xe},jr.prototype.onDeviceParamsUpdated_=function(K){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(K),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},jr.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},jr.prototype.beginPresent_=function(){var K=this.layer_.source.getContext("webgl");K||(K=this.layer_.source.getContext("experimental-webgl")),K||(K=this.layer_.source.getContext("webgl2")),K&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(K.canvas.width=kn()*this.bufferScale_,K.canvas.height=Dn()*this.bufferScale_,this.cardboardUI_=new Pn(K)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Pn(K)),this.distorter_=new W(K,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(ne){this.viewerSelector_.show(this.layer_.source.parentElement),ne.stopPropagation(),ne.preventDefault()}.bind(this),function(ne){this.exitPresent(),ne.stopPropagation(),ne.preventDefault()}.bind(this)),this.rotateInstructions_&&(Bt()&&kr()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},jr.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},jr.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},jr.prototype.submitFrame=function(K){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var ne=this.layer_.source.getContext("webgl");ne||(ne=this.layer_.source.getContext("experimental-webgl")),ne||(ne=this.layer_.source.getContext("webgl2"));var pe=ne.canvas;(pe.width!=this.lastWidth||pe.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=pe.width,this.lastHeight=pe.height,this.cardboardUI_.render()}},jr.prototype.onOrientationChange_=function(K){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},jr.prototype.onResize_=function(K){if(this.layer_){var ne=this.layer_.source.getContext("webgl");ne||(ne=this.layer_.source.getContext("experimental-webgl")),ne||(ne=this.layer_.source.getContext("webgl2")),ne.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),qr(ne.canvas)}},jr.prototype.onViewerChanged_=function(K){this.deviceInfo_.setViewer(K),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},jr.prototype.fireVRDisplayDeviceParamsChange_=function(){var K=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(K)},jr.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},jr.VRDisplay=tr,jr}()}(Y={exports:{}},Y.exports),Y.exports)),E={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function _(V){this.config=x(x({},E),V),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&w())&&(this.enable(),this.getVRDisplays().then(function(Y){Y&&Y[0]&&Y[0].fireVRDisplayConnect_&&Y[0].fireVRDisplayConnect_()}))}_.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(w()){var V=new y({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(V)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},_.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var V=this.native.VRFrameData,Y=new this.native.VRFrameData,ee=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(oe){oe instanceof V?ee.call(this,oe):(ee.call(this,Y),oe.pose=Y.pose,T(Y.leftProjectionMatrix,oe.leftProjectionMatrix),T(Y.rightProjectionMatrix,oe.rightProjectionMatrix),T(Y.leftViewMatrix,oe.leftViewMatrix),T(Y.rightViewMatrix,oe.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=y.VRDisplay,window.VRFrameData=y.VRFrameData},_.prototype.getVRDisplays=function(){var V=this;return this.hasNative?this.native.getVRDisplays.call(navigator).then(function(ee){return ee.length>0?ee:V.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},_.version="0.10.12",_.VRFrameData=y.VRFrameData,_.VRDisplay=y.VRDisplay;var R=Object.freeze({default:_}),F=R&&_||R;return void 0!==D&&D.window&&(D.document||(D.document=D.window.document),D.navigator||(D.navigator=D.window.navigator)),F},"object"==typeof Ue&&void 0!==ae?ae.exports=B():this.WebVRPolyfill=B()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(k,ae,Ue){var b=/\n/,D="\n",B=/\s/;function I(y,M,E,_){var R=y.indexOf(M,E);return-1===R||R>_?_:R}function w(y){return B.test(y)}function S(y,M,E,_){return{start:M,end:M+Math.min(_,E-M)}}ae.exports=function(y,M){return ae.exports.lines(y,M).map(function(_){return y.substring(_.start,_.end)}).join("\n")},ae.exports.lines=function(M,E){if(0===(E=E||{}).width&&"nowrap"!==E.mode)return[];M=M||"";var _="number"==typeof E.width?E.width:Number.MAX_VALUE,R=Math.max(0,E.start||0),F="number"==typeof E.end?E.end:M.length,O=E.mode,V=E.measure||S;return"pre"===O?function(y,M,E,_,R){for(var F=[],O=E,V=E;V<_&&V<M.length;V++){var Y=M.charAt(V),ee=b.test(Y);if(ee||V===_-1){var Ee=y(M,O,ee?V:V+1,R);F.push(Ee),O=V+1}}return F}(V,M,R,F,_):function(y,M,E,_,R,F){var O=[],V=R;for("nowrap"===F&&(V=Number.MAX_VALUE);E<_&&E<M.length;){for(var Y=I(M,D,E,_);E<Y&&w(M.charAt(E));)E++;var ee=y(M,E,Y,V),oe=E+(ee.end-ee.start),Ee=oe+D.length;if(oe<Y){for(;oe>E&&!w(M.charAt(oe));)oe--;if(oe===E)Ee>E+D.length&&Ee--,oe=Ee;else for(Ee=oe;oe>E&&w(M.charAt(oe-D.length));)oe--}if(oe>=E){var ve=y(M,E,oe,V);O.push(ve)}E=Ee}return O}(V,M,R,F,_,O)}},{}],71:[function(k,ae,Ue){"use strict";var b=k("global/window"),D=k("is-function"),B=k("parse-headers"),I=k("xtend");function x(_,R,F){var O=_;return D(R)?(F=R,"string"==typeof _&&(O={uri:_})):O=I(R,{uri:_}),O.callback=F,O}function S(_,R,F){return y(R=x(_,R,F))}function y(_){if(void 0===_.callback)throw new Error("callback argument missing");var R=!1,F=function(ht,_t,Bt){R||(R=!0,_.callback(ht,_t,Bt))};function V(){var ft=void 0;if(ft=oe.response?oe.response:oe.responseText||function(_){try{if("document"===_.responseType)return _.responseXML;if(""===_.responseType&&(!_.responseXML||"parsererror"!==_.responseXML.documentElement.nodeName))return _.responseXML}catch(F){}return null}(oe),fe)try{ft=JSON.parse(ft)}catch(ht){}return ft}function Y(ft){return clearTimeout(je),ft instanceof Error||(ft=new Error(""+(ft||"Unknown XMLHttpRequest Error"))),ft.statusCode=0,F(ft,it)}function ee(){if(!ve){var ft;clearTimeout(je);var ht=it,_t=null;return 0!==(ft=_.useXDR&&void 0===oe.status?200:1223===oe.status?204:oe.status)?(ht={body:V(),statusCode:ft,method:He,headers:{},url:Ce,rawRequest:oe},oe.getAllResponseHeaders&&(ht.headers=B(oe.getAllResponseHeaders()))):_t=new Error("Internal XMLHttpRequest Error"),F(_t,ht,ht.body)}}var oe=_.xhr||null;oe||(oe=_.cors||_.useXDR?new S.XDomainRequest:new S.XMLHttpRequest);var Ee,ve,je,Ce=oe.url=_.uri||_.url,He=oe.method=_.method||"GET",we=_.body||_.data,ce=oe.headers=_.headers||{},Me=!!_.sync,fe=!1,it={body:void 0,headers:{},statusCode:0,method:He,url:Ce,rawRequest:oe};if("json"in _&&!1!==_.json&&(fe=!0,ce.accept||ce.Accept||(ce.Accept="application/json"),"GET"!==He&&"HEAD"!==He&&(ce["content-type"]||ce["Content-Type"]||(ce["Content-Type"]="application/json"),we=JSON.stringify(!0===_.json?we:_.json))),oe.onreadystatechange=function(){4===oe.readyState&&setTimeout(ee,0)},oe.onload=ee,oe.onerror=Y,oe.onprogress=function(){},oe.onabort=function(){ve=!0},oe.ontimeout=Y,oe.open(He,Ce,!Me,_.username,_.password),Me||(oe.withCredentials=!!_.withCredentials),!Me&&_.timeout>0&&(je=setTimeout(function(){if(!ve){ve=!0,oe.abort("timeout");var ft=new Error("XMLHttpRequest timeout");ft.code="ETIMEDOUT",Y(ft)}},_.timeout)),oe.setRequestHeader)for(Ee in ce)ce.hasOwnProperty(Ee)&&oe.setRequestHeader(Ee,ce[Ee]);else if(_.headers&&!function(_){for(var R in _)if(_.hasOwnProperty(R))return!1;return!0}(_.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in _&&(oe.responseType=_.responseType),"beforeSend"in _&&"function"==typeof _.beforeSend&&_.beforeSend(oe),oe.send(we||null),oe}ae.exports=S,ae.exports.default=S,S.XMLHttpRequest=b.XMLHttpRequest||function(){},S.XDomainRequest="withCredentials"in new S.XMLHttpRequest?S.XMLHttpRequest:b.XDomainRequest,function(_,R){for(var F=0;F<_.length;F++)R(_[F])}(["get","put","post","patch","head","delete"],function(_){S["delete"===_?"del":_]=function(R,F,O){return(F=x(R,F,O)).method=_.toUpperCase(),y(F)}})},{"global/window":27,"is-function":33,"parse-headers":47,xtend:73}],72:[function(k,ae,Ue){ae.exports=void 0!==self.DOMParser?function(D){return(new self.DOMParser).parseFromString(D,"application/xml")}:void 0!==self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")?function(D){var B=new self.ActiveXObject("Microsoft.XMLDOM");return B.async="false",B.loadXML(D),B}:function(D){var B=document.createElement("div");return B.innerHTML=D,B}},{}],73:[function(k,ae,Ue){ae.exports=function(){for(var B={},I=0;I<arguments.length;I++){var w=arguments[I];for(var T in w)b.call(w,T)&&(B[T]=w[T])}return B};var b=Object.prototype.hasOwnProperty},{}],74:[function(k,ae,Ue){ae.exports={name:"aframe",version:"1.3.0",description:"A web framework for building virtual reality experiences.",homepage:"https://aframe.io/",main:"dist/aframe-master.js",scripts:{browserify:"browserify src/index.js -s 'AFRAME' -p browserify-derequire",build:"shx mkdir -p build/ && npm run browserify -- --debug -t [ envify --INSPECTOR_VERSION dev ] -o build/aframe.js",codecov:"codecov",dev:"npm run build && cross-env INSPECTOR_VERSION=dev node ./scripts/budo -t envify",dist:"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"npm run browserify -s -- --debug | exorcist dist/aframe-master.js.map > dist/aframe-master.js","dist:min":"npm run browserify -s -- --debug -p [ minifyify --map aframe-master.min.js.map --output dist/aframe-master.min.js.map ] -o dist/aframe-master.min.js",docs:"markserv --dir docs --port 9001",preghpages:"node ./scripts/preghpages.js",ghpages:"ghpages -p gh-pages/",lint:"semistandard -v | snazzy","lint:fix":"semistandard --fix",precommit:"npm run lint",prepush:"node scripts/testOnlyCheck.js",prerelease:"node scripts/release.js 1.1.0 1.2.0",start:"npm run dev","start:https":"cross-env SSL=true npm run dev",test:"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"mocha --ui tdd tests/node"},repository:"aframevr/aframe",license:"MIT",files:["dist/*","docs/**/*","src/**/*","vendor/**/*"],dependencies:{"custom-event-polyfill":"^1.0.6",debug:"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","document-register-element":"dmarcos/document-register-element#8ccc532b7f3744be954574caf3072a5fd260ca90","load-bmfont":"^1.2.3","object-assign":"^4.0.1",present:"0.0.6","promise-polyfill":"^3.1.0","super-animejs":"^3.1.0","super-three":"^0.137.0","three-bmfont-text":"dmarcos/three-bmfont-text#21d017046216e318362c48abd1a48bddfb6e0733","webvr-polyfill":"^0.10.12"},devDependencies:{browserify:"^13.1.0","browserify-css":"^0.8.4","browserify-derequire":"^0.9.4","browserify-istanbul":"^2.0.0",budo:"^9.2.0",chai:"^3.5.0","chai-shallow-deep-equal":"^1.4.0",chalk:"^1.1.3",codecov:"^1.0.1","cross-env":"^5.0.1",envify:"^3.4.1",exorcist:"^0.4.0",ghpages:"0.0.8","git-rev":"^0.2.1",glob:"^7.1.1",husky:"^0.11.7",istanbul:"^0.4.5",jsdom:"^9.11.0",karma:"1.4.1","karma-browserify":"^5.1.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^1.2.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.1.0","karma-sinon-chai":"1.2.4",lolex:"^1.5.1",markserv:"github:sukima/markserv#feature/fix-broken-websoketio-link",minifyify:"^7.3.3",mocha:"^3.0.2","mozilla-download":"^1.1.1","replace-in-file":"^2.5.3",semistandard:"^9.0.0",shelljs:"^0.7.7",shx:"^0.2.2",sinon:"^1.17.5","sinon-chai":"2.8.0",snazzy:"^5.0.0","too-wordy":"ngokevin/too-wordy",uglifyjs:"^2.4.10","write-good":"^0.9.1"},link:!0,browserify:{transform:["browserify-css","envify"]},semistandard:{ignore:["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},keywords:["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"browserify-css":{minify:!0},engines:{node:">= 4.6.0",npm:">= 2.15.9"}}},{}],75:[function(k,ae,Ue){var b=k("super-animejs"),D=k("../core/component").components,B=k("../core/component").registerComponent,I=k("../lib/three"),w=k("../utils"),T=new I.Color,x=new I.Color,S=w.entity.getComponentProperty,y=w.entity.setComponentProperty,M={},E="color",R="rotation",F="scale",O="components";function ee(ce){ce.x=I.Math.degToRad(ce.x),ce.y=I.Math.degToRad(ce.y),ce.z=I.Math.degToRad(ce.z)}function oe(ce,Me,fe){var je;for(je=0;je<Me.length;je++)ce.addEventListener(Me[je],fe)}function Ee(ce,Me,fe){var je;for(je=0;je<Me.length;je++)ce.removeEventListener(Me[je],fe)}function ve(ce,Me){var fe,je,it;for(je=He(Me),it=ce,fe=0;fe<je.length;fe++)it=it[je[fe]];if(void 0===it)throw console.log(ce),new Error("[animation] property ("+Me+") could not be found");return it}function Ce(ce,Me,fe,je){var it,ft,ht,_t;for(Me.startsWith("object3D.rotation")&&(fe=I.Math.degToRad(fe)),ft=He(Me),_t=ce,it=0;it<ft.length-1;it++)_t=_t[ft[it]];ht=ft[ft.length-1],je!==E?_t[ht]=fe:"r"in _t[ht]?(_t[ht].r=fe.r,_t[ht].g=fe.g,_t[ht].b=fe.b):(_t[ht].x=fe.r,_t[ht].y=fe.g,_t[ht].z=fe.b)}function He(ce){return ce in M||(M[ce]=ce.split(".")),M[ce]}function we(ce){return ce.isRawProperty||ce.property.startsWith(O)||ce.property.startsWith("object3D")}ae.exports.Component=B("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(ce){return!0===ce||"true"===ce||!1!==ce&&"false"!==ce&&parseInt(ce,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var ce=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){ce.animationIsPlaying=!1,ce.el.emit("animationcomplete",ce.eventDetail,!1),ce.id&&ce.el.emit("animationcomplete__"+ce.id,ce.eventDetail,!1)}}},update:function(ce){var Me=this.config,fe=this.data;this.animationIsPlaying=!1,this.data.enabled&&(!fe.property||(Me.autoplay=!1,Me.direction=fe.dir,Me.duration=fe.dur,Me.easing=fe.easing,Me.elasticity=fe.elasticity,Me.loop=fe.loop,Me.round=fe.round,this.createAndStartAnimation()))},tick:function(ce,Me){!this.animationIsPlaying||(this.time+=Me,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){!this.paused||(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var ce=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=b(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!ce.autoplay||ce.startEvents&&ce.startEvents.length)){if(ce.delay)return void setTimeout(this.beginAnimation,ce.delay);this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=b(this.config),this.data.delay)return void setTimeout(this.beginAnimation,this.data.delay);this.beginAnimation()}},updateConfigForRawColor:function(){var je,it,ft,ht,ce=this.config,Me=this.data,fe=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(it in je=""===Me.from?ve(fe,Me.property):Me.from,this.setColorConfig(je,Me.to),je=this.fromColor,ft=this.toColor,this.targetsArray.length=0,this.targetsArray.push(je),ce.targets=this.targetsArray,ft)ce[it]=ft[it];ce.update=(ht={},function(_t){var Bt;((Bt=_t.animatables[0].target).r!==ht.r||Bt.g!==ht.g||Bt.b!==ht.b)&&Ce(fe,Me.property,Bt,Me.type)})}},updateConfigForDefault:function(){var je,it,ht,_t,ce=this.config,Me=this.data,fe=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(je=""===Me.from?we(Me)?ve(fe,Me.property):S(fe,Me.property):Me.from,ht=Me.to,isNaN(je||ht)?(je=je&&je.toString(),ht=ht&&ht.toString()):(je=parseFloat(je),ht=parseFloat(ht)),(it="true"===Me.to||"false"===Me.to||!0===Me.to||!1===Me.to)&&(je="true"===Me.from||!0===Me.from?1:0,ht="true"===Me.to||!0===Me.to?1:0),this.targets.aframeProperty=je,ce.targets=this.targets,ce.aframeProperty=ht,ce.update=function(Bt){var _n;(_n=Bt.animatables[0].target.aframeProperty)!==_t&&(_t=_n,it&&(_n=_n>=1),we(Me)?Ce(fe,Me.property,_n,Me.type):y(fe,Me.property,_n))})},updateConfigForVector:function(){var je,it,ft,ht,ce=this.config,Me=this.data,fe=this.el;for(je in it=""!==Me.from?w.coordinates.parse(Me.from):S(fe,Me.property),ft=w.coordinates.parse(Me.to),Me.property===R&&(ee(it),ee(ft)),this.targetsArray.length=0,this.targetsArray.push(it),ce.targets=this.targetsArray,ft)ce[je]=ft[je];ce.update="position"!==Me.property&&Me.property!==R&&Me.property!==F?function(){var ht={};return function(_t){var Bt=_t.animatables[0].target;Bt.x===ht.x&&Bt.y===ht.y&&Bt.z===ht.z||(ht.x=Bt.x,ht.y=Bt.y,ht.z=Bt.z,y(fe,Me.property,Bt))}}():(ht={},function(_t){var Bt=_t.animatables[0].target;Me.property===F&&(Bt.x=Math.max(1e-4,Bt.x),Bt.y=Math.max(1e-4,Bt.y),Bt.z=Math.max(1e-4,Bt.z)),(Bt.x!==ht.x||Bt.y!==ht.y||Bt.z!==ht.z)&&(ht.x=Bt.x,ht.y=Bt.y,ht.z=Bt.z,fe.object3D[Me.property].set(Bt.x,Bt.y,Bt.z))})},updateConfig:function(){var ce;ce=function(ce,Me){var fe,je,it,ft;return ft=(it=Me.split("."))[1],!(fe=ce.components[je=it[0]]||D[je])||ft&&!fe.schema[ft]?null:ft?fe.schema[ft].type:fe.schema.type}(this.el,this.data.property),we(this.data)&&this.data.type===E?this.updateConfigForRawColor():"vec2"===ce||"vec3"===ce||"vec4"===ce?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(ce){var Me,fe=this.data,je=this.el,it=this;return!(""!==fe.from||!fe.property.startsWith(O)||(Me=He(fe.property)[1],je.components[Me])||(je.addEventListener("componentinitialized",function ft(ht){ht.detail.name===Me&&(ce(),it.animation=b(it.config),je.removeEventListener("componentinitialized",ft))}),0))},stopRelatedAnimations:function(){var ce,Me;for(Me in this.el.components)ce=this.el.components[Me],Me!==this.attrName&&"animation"===ce.name&&(!ce.animationIsPlaying||ce.data.property===this.data.property&&(ce.animationIsPlaying=!1))},addEventListeners:function(){var ce=this.data,Me=this.el;oe(Me,ce.startEvents,this.onStartEvent),oe(Me,ce.pauseEvents,this.pauseAnimation),oe(Me,ce.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var ce=this.data,Me=this.el;Ee(Me,ce.startEvents,this.onStartEvent),Ee(Me,ce.pauseEvents,this.pauseAnimation),Ee(Me,ce.resumeEvents,this.resumeAnimation)},setColorConfig:function(ce,Me){T.set(ce),x.set(Me),Me=this.toColor,(ce=this.fromColor).r=T.r,ce.g=T.g,ce.b=T.b,Me.r=x.r,Me.g=x.g,Me.b=x.b}})},{"../core/component":136,"../lib/three":184,"../utils":212,"super-animejs":56}],76:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../lib/three");ae.exports.Component=b("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var B,I=this.el;B=this.camera=new D.PerspectiveCamera,I.setObject3D("camera",B)},update:function(B){var I=this.data,w=this.camera;w.aspect=I.aspect||window.innerWidth/window.innerHeight,w.far=I.far,w.fov=I.fov,w.near=I.near,w.zoom=I.zoom,w.updateProjectionMatrix(),this.updateActiveCamera(B),this.updateSpectatorCamera(B)},updateActiveCamera:function(B){var I=this.data,w=this.el,T=this.system;B&&B.active===I.active||I.spectator||(I.active&&T.activeCameraEl!==w?T.setActiveCamera(w):!I.active&&T.activeCameraEl===w&&T.disableActiveCamera())},updateSpectatorCamera:function(B){var I=this.data,w=this.el,T=this.system;B&&B.spectator===I.spectator||(I.spectator&&T.spectatorCameraEl!==w?T.setSpectatorCamera(w):!I.spectator&&T.spectatorCameraEl===w&&T.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},{"../core/component":136,"../lib/three":184}],77:[function(k,ae,Ue){var y,M,E,_,b=k("../core/component").registerComponent,D=k("../utils/"),B=D.bind,I_CLICK="click",I_FUSING="fusing",I_MOUSEENTER="mouseenter",I_MOUSEDOWN="mousedown",I_MOUSELEAVE="mouseleave",I_MOUSEUP="mouseup",w_FUSING="cursor-fusing",w_HOVERING="cursor-hovering",w_HOVERED="cursor-hovered",T={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},x={DOWN:["selectstart"],UP:["selectend"]},S="a-mouse-cursor-hover";ae.exports.Component=b("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:D.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var y=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.updateCanvasBounds=D.debounce(function(){y.canvasBounds=y.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=B(this.onCursorDown,this),this.onCursorUp=B(this.onCursorUp,this),this.onIntersection=B(this.onIntersection,this),this.onIntersectionCleared=B(this.onIntersectionCleared,this),this.onMouseMove=B(this.onMouseMove,this),this.onEnterVR=B(this.onEnterVR,this)},update:function(y){this.data.rayOrigin!==y.rayOrigin&&this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var y=this.el;y.removeState(w_HOVERING),y.removeState(w_FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(w_HOVERED),this.removeEventListeners()},addEventListeners:function(){var y,M=this.data,E=this.el,_=this;function R(){y=E.sceneEl.canvas,!M.downEvents.length&&!M.upEvents.length&&(T.DOWN.forEach(function(F){y.addEventListener(F,_.onCursorDown)}),T.UP.forEach(function(F){y.addEventListener(F,_.onCursorUp)}))}(y=E.sceneEl.canvas)?R():E.sceneEl.addEventListener("render-target-loaded",R),M.downEvents.forEach(function(F){E.addEventListener(F,_.onCursorDown)}),M.upEvents.forEach(function(F){E.addEventListener(F,_.onCursorUp)}),E.addEventListener("raycaster-intersection",this.onIntersection),E.addEventListener("raycaster-closest-entity-changed",this.onIntersection),E.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),E.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),E.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var y,M=this.data,E=this.el,_=this;(y=E.sceneEl.canvas)&&!M.downEvents.length&&!M.upEvents.length&&(T.DOWN.forEach(function(R){y.removeEventListener(R,_.onCursorDown)}),T.UP.forEach(function(R){y.removeEventListener(R,_.onCursorUp)})),M.downEvents.forEach(function(R){E.removeEventListener(R,_.onCursorDown)}),M.upEvents.forEach(function(R){E.removeEventListener(R,_.onCursorUp)}),E.removeEventListener("raycaster-intersection",this.onIntersection),E.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),y.removeEventListener("mousemove",this.onMouseMove),y.removeEventListener("touchstart",this.onMouseMove),y.removeEventListener("touchmove",this.onMouseMove),E.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),E.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var y,M=this.el;(y=M.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),y.removeEventListener("touchmove",this.onMouseMove),M.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(y.addEventListener("mousemove",this.onMouseMove,!1),y.addEventListener("touchmove",this.onMouseMove,!1),M.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:(y=new THREE.Vector3,M=new THREE.Vector2,E=new THREE.Vector3,_={origin:E,direction:y},function(R){var Y,ee,F=this.canvasBounds,O=this.el.sceneEl.camera;O.parent.updateMatrixWorld(),ee=(Y="touchmove"===R.type||"touchstart"===R.type?R.touches.item(0):R).clientY-F.top,M.x=(Y.clientX-F.left)/F.width*2-1,M.y=-ee/F.height*2+1,O&&O.isPerspectiveCamera?(E.setFromMatrixPosition(O.matrixWorld),y.set(M.x,M.y,.5).unproject(O).sub(E).normalize()):O&&O.isOrthographicCamera?(E.set(M.x,M.y,(O.near+O.far)/(O.near-O.far)).unproject(O),y.set(0,0,-1).transformDirection(O.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+O.type),this.el.setAttribute("raycaster",_),"touchmove"===R.type&&R.preventDefault()}),onCursorDown:function(y){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===y.type&&(this.onMouseMove(y),this.el.components.raycaster.checkIntersections(),y.preventDefault()),this.twoWayEmit(I_MOUSEDOWN),this.cursorDownEl=this.intersectedEl},onCursorUp:function(y){if(this.isCursorDown){this.isCursorDown=!1;var M=this.data;this.twoWayEmit(I_MOUSEUP),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(I_MOUSEUP,this.intersectedEventDetail)),(!M.fuse||"mouse"===M.rayOrigin)&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(I_CLICK),this.cursorDownEl=null,"touchend"===y.type&&y.preventDefault()}},onIntersection:function(y){var M,_,R,F;F=y.detail.intersections[_=y.detail.els[0]===this.el?1:0],(R=y.detail.els[_])&&this.intersectedEl!==R&&(this.intersectedEl&&(M=this.el.components.raycaster.getIntersection(this.intersectedEl))&&M.distance<=F.distance||(this.clearCurrentIntersection(!0),this.setIntersection(R,F)))},onIntersectionCleared:function(y){-1!==y.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var y=this.el.sceneEl.xrSession,M=this;!y||"mouse"!==this.data.rayOrigin&&(x.DOWN.forEach(function(E){y.addEventListener(E,M.onCursorDown)}),x.UP.forEach(function(E){y.addEventListener(E,M.onCursorUp)}))},setIntersection:function(y,M){var E=this.el,_=this.data,R=this;this.intersectedEl!==y&&(this.intersectedEl=y,E.addState(w_HOVERING),y.addState(w_HOVERED),this.twoWayEmit(I_MOUSEENTER),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add(S),0!==_.fuseTimeout&&_.fuse&&(E.addState(w_FUSING),this.twoWayEmit(I_FUSING),this.fuseTimeout=setTimeout(function(){E.removeState(w_FUSING),R.twoWayEmit(I_CLICK)},_.fuseTimeout)))},clearCurrentIntersection:function(y){var E,_,R=this.el;!this.intersectedEl||(this.intersectedEl.removeState(w_HOVERED),R.removeState(w_HOVERING),R.removeState(w_FUSING),this.twoWayEmit(I_MOUSELEAVE),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove(S),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==y&&0!==(_=this.el.components.raycaster.intersections).length&&(E=_[_[0].object.el===R?1:0])&&this.setIntersection(E.object.el,E))},twoWayEmit:function(y){var _,M=this.el,E=this.intersectedEl;_=this.el.components.raycaster.getIntersection(E),this.eventDetail.intersectedEl=E,this.eventDetail.intersection=_,M.emit(y,this.eventDetail),E&&(this.intersectedEventDetail.intersection=_,E.emit(y,this.intersectedEventDetail))}})},{"../core/component":136,"../utils/":212}],78:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,M=k("../utils/").device.isWebXRAvailable,R=M?"google-daydream":"Daydream Controller";ae.exports.Component=b("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:M?{axes:{touchpad:[0,1]},buttons:["none","none","touchpad","menu","system"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var Y=this;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(ee){T(ee.detail.id,"down",Y)},this.onButtonUp=function(ee){T(ee.detail.id,"up",Y)},this.onButtonTouchStart=function(ee){T(ee.detail.id,"touchstart",Y)},this.onButtonTouchEnd=function(ee){T(ee.detail.id,"touchend",Y)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var Y=this.el;Y.addEventListener("buttonchanged",this.onButtonChanged),Y.addEventListener("buttondown",this.onButtonDown),Y.addEventListener("buttonup",this.onButtonUp),Y.addEventListener("touchstart",this.onButtonTouchStart),Y.addEventListener("touchend",this.onButtonTouchEnd),Y.addEventListener("model-loaded",this.onModelLoaded),Y.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Y=this.el;Y.removeEventListener("buttonchanged",this.onButtonChanged),Y.removeEventListener("buttondown",this.onButtonDown),Y.removeEventListener("buttonup",this.onButtonUp),Y.removeEventListener("touchstart",this.onButtonTouchStart),Y.removeEventListener("touchend",this.onButtonTouchEnd),Y.removeEventListener("model-loaded",this.onModelLoaded),Y.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,R,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var ee=this.data;this.el.setAttribute("tracked-controls",{armModel:ee.armModel,hand:ee.hand,idPrefix:R,id:R,orientationOffset:ee.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/google/vr_controller_daydream.obj",mtl:"https://cdn.aframe.io/controllers/google/vr_controller_daydream.mtl"})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(Y){var oe,ee=Y.detail.model;!this.data.model||((oe=this.buttonMeshes={}).menu=ee.getObjectByName("AppButton_AppButton_Cylinder.004"),oe.system=ee.getObjectByName("HomeButton_HomeButton_Cylinder.005"),oe.trackpad=ee.getObjectByName("TouchPad_TouchPad_Cylinder.003"),oe.touchpad=ee.getObjectByName("TouchPad_TouchPad_Cylinder.003"),ee.position.set(0,0,-.04))},onAxisMoved:function(Y){w(this,this.mapping.axes,Y)},onButtonChanged:function(Y){var ee=this.mapping.buttons[Y.detail.id];!ee||this.el.emit(ee+"changed",Y.detail.state)},updateModel:function(Y,ee){!this.data.model||this.updateButtonModel(Y,ee)},updateButtonModel:function(Y,ee){var oe=this.buttonMeshes;if(oe&&oe[Y]){var Ee;switch(ee){case"down":Ee=this.data.buttonHighlightColor;break;case"touchstart":Ee=this.data.buttonTouchedColor;break;default:Ee=this.data.buttonColor}oe[Y].material.color.set(Ee)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],79:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,x=k("../utils/").device.isWebXRAvailable,R=x?"samsung-gearvr":"Gear VR";ae.exports.Component=b("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:x?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var Y=this;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(ee){T(ee.detail.id,"down",Y)},this.onButtonUp=function(ee){T(ee.detail.id,"up",Y)},this.onButtonTouchStart=function(ee){T(ee.detail.id,"touchstart",Y)},this.onButtonTouchEnd=function(ee){T(ee.detail.id,"touchend",Y)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var Y=this.el;Y.addEventListener("buttonchanged",this.onButtonChanged),Y.addEventListener("buttondown",this.onButtonDown),Y.addEventListener("buttonup",this.onButtonUp),Y.addEventListener("touchstart",this.onButtonTouchStart),Y.addEventListener("touchend",this.onButtonTouchEnd),Y.addEventListener("model-loaded",this.onModelLoaded),Y.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Y=this.el;Y.removeEventListener("buttonchanged",this.onButtonChanged),Y.removeEventListener("buttondown",this.onButtonDown),Y.removeEventListener("buttonup",this.onButtonUp),Y.removeEventListener("touchstart",this.onButtonTouchStart),Y.removeEventListener("touchend",this.onButtonTouchEnd),Y.removeEventListener("model-loaded",this.onModelLoaded),Y.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,R,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var ee=this.data;this.el.setAttribute("tracked-controls",{armModel:ee.armModel,hand:ee.hand,idPrefix:R,id:R,orientationOffset:ee.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/samsung/gear_vr_controller.obj",mtl:"https://cdn.aframe.io/controllers/samsung/gear_vr_controller.mtl"})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(Y){var oe,ee=Y.detail.model;!this.data.model||((oe=this.buttonMeshes={}).trigger=ee.children[2],oe.trackpad=ee.children[1],oe.touchpad=ee.children[1])},onButtonChanged:function(Y){var ee=this.mapping.buttons[Y.detail.id];!ee||this.el.emit(ee+"changed",Y.detail.state)},onAxisMoved:function(Y){w(this,this.mapping.axes,Y)},updateModel:function(Y,ee){!this.data.model||this.updateButtonModel(Y,ee)},updateButtonModel:function(Y,ee){var oe=this.buttonMeshes;if(oe&&oe[Y]){var Ee;switch(ee){case"down":Ee=this.data.buttonHighlightColor;break;case"touchstart":Ee=this.data.buttonTouchedColor;break;default:Ee=this.data.buttonColor}oe[Y].material.color.set(Ee)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],80:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,x="generic";ae.exports.Component=b("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var y=this;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(M){T(M.detail.id,"down",y)},this.onButtonUp=function(M){T(M.detail.id,"up",y)},this.onButtonTouchStart=function(M){T(M.detail.id,"touchstart",y)},this.onButtonTouchEnd=function(M){T(M.detail.id,"touchend",y)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods(),this.el.addEventListener("controllerconnected",function(M){M.detail.name!==y.name&&(y.wasControllerConnected=!0,y.removeEventListeners(),y.removeControllersUpdateListener())})},addEventListeners:function(){var y=this.el;y.addEventListener("buttonchanged",this.onButtonChanged),y.addEventListener("buttondown",this.onButtonDown),y.addEventListener("buttonup",this.onButtonUp),y.addEventListener("touchstart",this.onButtonTouchStart),y.addEventListener("touchend",this.onButtonTouchEnd),y.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var y=this.el;y.removeEventListener("buttonchanged",this.onButtonChanged),y.removeEventListener("buttondown",this.onButtonDown),y.removeEventListener("buttonup",this.onButtonUp),y.removeEventListener("touchstart",this.onButtonTouchStart),y.removeEventListener("touchend",this.onButtonTouchEnd),y.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var y=this.data;I(this,x,{hand:y.hand?y.hand:void 0,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var y=this.el,M=this.data;this.el.components["tracked-controls"]?this.removeEventListeners():(y.setAttribute("tracked-controls",{hand:M.hand,idPrefix:x,orientationOffset:M.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(y){var M=this.mapping.buttons[y.detail.id];!M||this.el.emit(M+"changed",y.detail.state)},onAxisMoved:function(y){w(this,this.mapping.axes,y)},initDefaultModel:function(){var y=this.modelEl=document.createElement("a-entity");y.setAttribute("geometry",{primitive:"sphere",radius:.03}),y.setAttribute("material",{color:this.data.color}),this.el.appendChild(y)}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],81:[function(k,ae,Ue){var b=k("../core/geometry").geometries,D=k("../core/geometry").geometryNames,B=k("../core/component").registerComponent,I=k("../lib/three"),w=new I.BufferGeometry;ae.exports.Component=B("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:D,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(T){var y,x=this.data,S=this.el,M=this.system;this.geometry&&(M.unuseGeometry(T),this.geometry=null),this.geometry=M.getOrCreateGeometry(x),(y=S.getObject3D("mesh"))?y.geometry=this.geometry:((y=new I.Mesh).geometry=this.geometry,this.el.getAttribute("material")||(y.material=new I.MeshStandardMaterial({color:16777215*Math.random(),metalness:0,roughness:.5})),S.setObject3D("mesh",y))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=w,this.geometry=null},updateSchema:function(T){var x=this.oldData&&this.oldData.primitive,S=T.primitive,y=b[S]&&b[S].schema;if(!y)throw new Error("Unknown geometry schema `"+S+"`");x&&x===S||this.extendSchema(y)}})},{"../core/component":136,"../core/geometry":137,"../lib/three":184}],82:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../lib/three"),I=k("../utils/").debug("components:gltf-model:warn");ae.exports.Component=b("gltf-model",{schema:{type:"model"},init:function(){var w=this,T=this.system.getDRACOLoader(),x=this.system.getMeshoptDecoder();this.model=null,this.loader=new D.GLTFLoader,T&&this.loader.setDRACOLoader(T),this.ready=x?x.then(function(S){w.loader.setMeshoptDecoder(S)}):Promise.resolve()},update:function(){var w=this,T=this.el,x=this.data;!x||(this.remove(),this.ready.then(function(){w.loader.load(x,function(y){w.model=y.scene||y.scenes[0],w.model.animations=y.animations,T.setObject3D("mesh",w.model),T.emit("model-loaded",{format:"gltf",model:w.model})},void 0,function(y){I(y&&y.message?y.message:"Failed to load glTF model"),T.emit("model-error",{format:"gltf",src:x})})}))},remove:function(){!this.model||this.el.removeObject3D("mesh")}})},{"../core/component":136,"../lib/three":184,"../utils/":212}],83:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D={toonLeft:"https://cdn.aframe.io/controllers/hands/leftHand.glb",toonRight:"https://cdn.aframe.io/controllers/hands/rightHand.glb",lowPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandLow.glb",lowPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandLow.glb",highPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandHigh.glb",highPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandHigh.glb"},B_open="Open",B_point="Point",B_pointThumb="Point + Thumb",B_fist="Fist",B_hold="Hold",B_thumbUp="Thumb Up",I={};function w(x,S){var y;if(x){if("grip"===(y=I[x]))return y+(S?"close":"open");if("point"===y)return y+(S?"up":"down");if("pointing"===y||"pistol"===y)return y+(S?"start":"end")}}I[B_fist]="grip",I[B_thumbUp]="pistol",I[B_point]="pointing",ae.exports.Component=b("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},init:function(){var x=this,S=this.el;this.gesture=B_open,this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){x.handleButton("grip","down")},this.onGripUp=function(){x.handleButton("grip","up")},this.onTrackpadDown=function(){x.handleButton("trackpad","down")},this.onTrackpadUp=function(){x.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){x.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){x.handleButton("trackpad","touchend")},this.onTriggerDown=function(){x.handleButton("trigger","down")},this.onTriggerUp=function(){x.handleButton("trigger","up")},this.onTriggerTouchStart=function(){x.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){x.handleButton("trigger","touchend")},this.onGripTouchStart=function(){x.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){x.handleButton("grip","touchend")},this.onThumbstickDown=function(){x.handleButton("thumbstick","down")},this.onThumbstickUp=function(){x.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){x.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){x.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){x.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){x.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){x.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){x.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),S.addEventListener("controllerconnected",this.onControllerConnected),S.addEventListener("controllerdisconnected",this.onControllerDisconnected),S.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(x,S){var y=this.el.getObject3D("mesh");!y||!y.mixer||y.mixer.update(S/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var x=this.el;x.addEventListener("gripdown",this.onGripDown),x.addEventListener("gripup",this.onGripUp),x.addEventListener("trackpaddown",this.onTrackpadDown),x.addEventListener("trackpadup",this.onTrackpadUp),x.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),x.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),x.addEventListener("triggerdown",this.onTriggerDown),x.addEventListener("triggerup",this.onTriggerUp),x.addEventListener("triggertouchstart",this.onTriggerTouchStart),x.addEventListener("triggertouchend",this.onTriggerTouchEnd),x.addEventListener("griptouchstart",this.onGripTouchStart),x.addEventListener("griptouchend",this.onGripTouchEnd),x.addEventListener("thumbstickdown",this.onThumbstickDown),x.addEventListener("thumbstickup",this.onThumbstickUp),x.addEventListener("abuttontouchstart",this.onAorXTouchStart),x.addEventListener("abuttontouchend",this.onAorXTouchEnd),x.addEventListener("bbuttontouchstart",this.onBorYTouchStart),x.addEventListener("bbuttontouchend",this.onBorYTouchEnd),x.addEventListener("xbuttontouchstart",this.onAorXTouchStart),x.addEventListener("xbuttontouchend",this.onAorXTouchEnd),x.addEventListener("ybuttontouchstart",this.onBorYTouchStart),x.addEventListener("ybuttontouchend",this.onBorYTouchEnd),x.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),x.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var x=this.el;x.removeEventListener("gripdown",this.onGripDown),x.removeEventListener("gripup",this.onGripUp),x.removeEventListener("trackpaddown",this.onTrackpadDown),x.removeEventListener("trackpadup",this.onTrackpadUp),x.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),x.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),x.removeEventListener("triggerdown",this.onTriggerDown),x.removeEventListener("triggerup",this.onTriggerUp),x.removeEventListener("triggertouchstart",this.onTriggerTouchStart),x.removeEventListener("triggertouchend",this.onTriggerTouchEnd),x.removeEventListener("griptouchstart",this.onGripTouchStart),x.removeEventListener("griptouchend",this.onGripTouchEnd),x.removeEventListener("thumbstickdown",this.onThumbstickDown),x.removeEventListener("thumbstickup",this.onThumbstickUp),x.removeEventListener("abuttontouchstart",this.onAorXTouchStart),x.removeEventListener("abuttontouchend",this.onAorXTouchEnd),x.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),x.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),x.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),x.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),x.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),x.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),x.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),x.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(x){var S,y=this.el,M=this.data.hand,_=this.data.color,R=this;if(S={hand:M,model:!1},M!==x){var F=D[this.data.handModelStyle+M.charAt(0).toUpperCase()+M.slice(1)];this.loader.load(F,function(O){var V=O.scene.children[0],Y="left"===M?Math.PI/2:-Math.PI/2;V.mixer=new THREE.AnimationMixer(V),R.clips=O.animations,y.setObject3D("mesh",V),V.children[1].material.color=new THREE.Color(_),V.position.set(0,0,0),V.rotation.set(0,0,Y),y.setAttribute("magicleap-controls",S),y.setAttribute("vive-controls",S),y.setAttribute("oculus-touch-controls",S),y.setAttribute("windows-motion-controls",S),y.setAttribute("hp-mixed-reality-controls",S)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(x,S){var y,M="down"===S,E="touchstart"===S;if(0===S.indexOf("touch")){if(E===this.touchedButtons[x])return;this.touchedButtons[x]=E}else{if(M===this.pressedButtons[x])return;this.pressedButtons[x]=M}y=this.gesture,this.gesture=this.determineGesture(),this.gesture!==y&&(this.animateGesture(this.gesture,y),this.emitGestureEvents(this.gesture,y))},determineGesture:function(){var x,S=this.pressedButtons.grip,y=this.pressedButtons.surface||this.touchedButtons.surface,M=this.pressedButtons.trackpad||this.touchedButtons.trackpad,E=this.pressedButtons.trigger||this.touchedButtons.trigger,_=this.touchedButtons.AorX||this.touchedButtons.BorY;return function(x){var S=x&&x.controller;return S&&(S.id&&0===S.id.indexOf("OpenVR ")||S.profiles&&S.profiles[0]&&"htc-vive"===S.profiles[0])}(this.el.components["tracked-controls"])?S||E?x=B_fist:M&&(x=B_point):S?x=y||_||M?E?B_fist:B_point:E?B_thumbUp:B_pointThumb:E&&(x=B_hold),x},getClip:function(x){var S,y;for(y=0;y<this.clips.length;y++)if((S=this.clips[y]).name===x)return S},animateGesture:function(x,S){x?this.playAnimation(x||B_open,S,!1):this.playAnimation(S,S,!0)},emitGestureEvents:function(x,S){var M,y=this.el;S!==x&&((M=w(S,!1))&&y.emit(M),(M=w(x,!0))&&y.emit(M))},playAnimation:function(x,S,y){var M,E,R,_=this.el.getObject3D("mesh");if(_){if(_.mixer.stopAllAction(),M=this.getClip(x),(R=_.mixer.clipAction(M)).clampWhenFinished=!0,R.loop=THREE.LoopRepeat,R.repetitions=0,R.timeScale=y?-1:1,R.time=y?M.duration:0,R.weight=1,!S||x===S)return _.mixer.stopAllAction(),void R.play();M=this.getClip(S),(E=_.mixer.clipAction(M)).weight=.15,E.play(),R.play(),E.crossFadeTo(R,.15,!0)}}})},{"../core/component":136}],84:[function(k,ae,Ue){var R,b=k("../core/component").registerComponent,D=k("../utils/bind"),I=k("../utils/tracked-controls").checkControllerPresentAndSetup,x={left:"b_l_",right:"b_r_"},S=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],y={wrist:"wrist","thumb-metacarpal":"thumb1","thumb-phalanx-proximal":"thumb2","thumb-phalanx-distal":"thumb3","thumb-tip":"thumb_null","index-finger-metacarpal":"index0","index-finger-phalanx-proximal":"index1","index-finger-phalanx-intermediate":"index2","index-finger-phalanx-distal":"index3","index-finger-tip":"index_null","middle-finger-metacarpal":"middle0","middle-finger-phalanx-proximal":"middle1","middle-finger-phalanx-intermediate":"middle2","middle-finger-phalanx-distal":"middle3","middle-finger-tip":"middle_null","ring-finger-metacarpal":"ring0","ring-finger-phalanx-proximal":"ring1","ring-finger-phalanx-intermediate":"ring2","ring-finger-phalanx-distal":"ring3","ring-finger-tip":"ring_null","pinky-finger-metacarpal":"pinky0","pinky-finger-phalanx-proximal":"pinky1","pinky-finger-phalanx-intermediate":"pinky2","pinky-finger-phalanx-distal":"pinky3","pinky-finger-tip":"pinky_null"};ae.exports.Component=b("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"}},bindMethods:function(){this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var R=0;R<this.jointEls.length;++R)this.jointEls[R].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var R=0;R<this.jointEls.length;++R)this.jointEls[R].object3D.visible=!1},init:function(){var R=this.el.sceneEl,F=R.getAttribute("webxr").optionalFeatures;F.push("hand-tracking"),R.setAttribute("webxr",{optionalFeatures:F}),this.onModelLoaded=this.onModelLoaded.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3},this.indexTipPosition=new THREE.Vector3,this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace)},updateReferenceSpace:function(){var R=this,F=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,F){var O=R.el.sceneEl.systems.webxr.sessionReferenceSpaceType;F.requestReferenceSpace(O).then(function(V){R.referenceSpace=V.getOffsetReferenceSpace(new XRRigidTransform({x:0,y:1.5,z:0}))}).catch(function(V){throw R.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(O,"tracked-controls-webxr uses reference space "+O),V})}},checkIfControllerPresent:function(){var R=this.data;I(this,"",{hand:R.hand?R.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var F=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,O=this.el.sceneEl.frame;!F||!O||!this.el.components["tracked-controls-webxr"]||F.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),O.getJointPose&&this.updateHandModel(),this.detectGesture())},updateHandModel:function(){"dots"===this.data.modelStyle&&this.updateHandDotsModel(),"mesh"===this.data.modelStyle&&this.updateHandMeshModel()},getBone:function(R){for(var F=this.bones,O=0;O<F.length;O++)if(F[O].name===R)return F[O];return null},updateHandMeshModel:function(){var R=this.el.sceneEl.frame,F=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,O=this.referenceSpace;if(F&&this.mesh&&O)for(var V of(this.mesh.visible=!1,F.hand.values())){var Y,ee,oe;ee=R.getJointPose(V,O),y[V.jointName]&&null!=(Y=this.getBone(x[this.data.hand]+y[V.jointName]))&&ee&&(oe=ee.transform,this.mesh.visible=!0,Y.position.copy(oe.position).multiplyScalar(100),Y.quaternion.set(oe.orientation.x,oe.orientation.y,oe.orientation.z,oe.orientation.w))}},updateHandDotsModel:function(){var Y,ee,oe,R=this.el.sceneEl.frame,F=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,V=this.el.components["tracked-controls-webxr"].system.referenceSpace,Ee=0;for(var ve of F.hand.values())ee=(Y=this.jointEls[Ee++]).object3D,oe=R.getJointPose(ve,V),Y.object3D.visible=!!oe,oe&&(ee.matrix.elements=oe.transform.matrix,ee.matrix.decompose(ee.position,ee.rotation,ee.scale),Y.setAttribute("scale",{x:oe.radius,y:oe.radius,z:oe.radius}))},detectGesture:function(){this.detectPinch()},detectPinch:(R=new THREE.Vector3,function(){var F=this.el.sceneEl.frame,O=this.indexTipPosition,V=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,ee=this.referenceSpace||this.el.components["tracked-controls-webxr"].system.referenceSpace,oe=V.hand.get("index-finger-tip"),Ee=V.hand.get("thumb-tip");if(oe&&Ee){var ve=F.getJointPose(oe,ee),Ce=F.getJointPose(Ee,ee);if(ve&&Ce){R.copy(Ce.transform.position),O.copy(ve.transform.position);var He=O.distanceTo(R);He<.015&&!1===this.isPinched&&(this.isPinched=!0,this.pinchEventDetail.position.copy(O).lerp(R,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchstarted",this.pinchEventDetail)),He>.03&&!0===this.isPinched&&(this.isPinched=!1,this.pinchEventDetail.position.copy(O).lerp(R,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchended",this.pinchEventDetail)),this.isPinched&&(this.pinchEventDetail.position.copy(O).lerp(R,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchmoved",this.pinchEventDetail)),O.y+=1.5}}}),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){this.el.setAttribute("tracked-controls",{hand:this.data.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var R;this.checkIfControllerPresent(),R=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,this.el.getObject3D("mesh")&&(!R||!R.hand||!R.hand[0])&&(this.el.getObject3D("mesh").visible=!1)},initDefaultModel:function(){this.el.getObject3D("mesh")||("dots"===this.data.modelStyle&&this.initDotsModel(),"mesh"===this.data.modelStyle&&this.initMeshHandModel())},initDotsModel:function(){if(0===this.jointEls.length)for(var R=0;R<S.length;++R){var F=this.jointEl=document.createElement("a-entity");F.setAttribute("geometry",{primitive:"sphere",radius:1}),F.setAttribute("material",{color:this.data.modelColor}),F.object3D.visible=!1,this.el.appendChild(F),this.jointEls.push(F)}},initMeshHandModel:function(){this.el.setAttribute("gltf-model","left"===this.data.hand?"https://cdn.aframe.io/controllers/oculus-hands/v3/left.glb":"https://cdn.aframe.io/controllers/oculus-hands/v3/right.glb")},onModelLoaded:function(){var R=this.mesh=this.el.getObject3D("mesh").children[0],F=this.skinnedMesh=R.children[30];!this.skinnedMesh||(this.bones=F.skeleton.bones,this.el.removeObject3D("mesh"),R.position.set(0,1.5,0),R.rotation.set(0,0,0),F.frustumCulled=!1,F.material=new THREE.MeshStandardMaterial({skinning:!0,color:this.data.modelColor}),this.el.setObject3D("mesh",R))}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],85:[function(k,ae,Ue){var b=k("../core/component").registerComponent;ae.exports.Component=b("hide-on-enter-ar",{init:function(){var D=this;this.el.sceneEl.addEventListener("enter-vr",function(){D.el.sceneEl.is("ar-mode")&&(D.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){D.el.object3D.visible=!0})}})},{"../core/component":136}],86:[function(k,ae,Ue){var b=k("../utils/bind"),D=k("../core/component").registerComponent,B=k("../lib/three"),I=k("../utils/tracked-controls"),w=I.checkControllerPresentAndSetup,T=I.emitIfAxesChanged,x=I.onButtonEvent,S="hp-mixed-reality",M={x:0,y:0,z:.06},E={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"};ae.exports.Component=D("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var R=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=b(this.onButtonChanged,this),this.onButtonDown=function(F){x(F.detail.id,"down",R,R.data.hand)},this.onButtonUp=function(F){x(F.detail.id,"up",R,R.data.hand)},this.onButtonTouchEnd=function(F){x(F.detail.id,"touchend",R,R.data.hand)},this.onButtonTouchStart=function(F){x(F.detail.id,"touchstart",R,R.data.hand)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var R=this.data;this.controllerIndex="right"===R.hand?0:"left"===R.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=b(this.onModelLoaded,this),this.onControllersUpdate=b(this.onControllersUpdate,this),this.checkIfControllerPresent=b(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=b(this.removeControllersUpdateListener,this),this.onAxisMoved=b(this.onAxisMoved,this)},addEventListeners:function(){var R=this.el;R.addEventListener("buttonchanged",this.onButtonChanged),R.addEventListener("buttondown",this.onButtonDown),R.addEventListener("buttonup",this.onButtonUp),R.addEventListener("touchstart",this.onButtonTouchStart),R.addEventListener("touchend",this.onButtonTouchEnd),R.addEventListener("axismove",this.onAxisMoved),R.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var R=this.el;R.removeEventListener("buttonchanged",this.onButtonChanged),R.removeEventListener("buttondown",this.onButtonDown),R.removeEventListener("buttonup",this.onButtonUp),R.removeEventListener("touchstart",this.onButtonTouchStart),R.removeEventListener("touchend",this.onButtonTouchEnd),R.removeEventListener("axismove",this.onAxisMoved),R.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){w(this,S,{index:this.controllerIndex,hand:this.data.hand})},injectTrackedControls:function(){var F=this.data;this.el.setAttribute("tracked-controls",{idPrefix:S,hand:F.hand,controller:this.controllerIndex,orientationOffset:F.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/hp/mixed-reality/"+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(R){var F=this.mapping[this.data.hand].buttons[R.detail.id];!F||("trigger"===F&&console.log("analog value of trigger press: "+R.detail.state.value),this.el.emit(F+"changed",R.detail.state))},onModelLoaded:function(R){var F=R.detail.model;!this.data.model||(F.position.copy(M),F.rotation.copy(E),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new B.Vector3(0,0,0)}))},onAxisMoved:function(R){T(this,this.mapping.axes,R)}})},{"../core/component":136,"../lib/three":184,"../utils/bind":206,"../utils/tracked-controls":221}],87:[function(k,ae,Ue){k("./animation"),k("./camera"),k("./cursor"),k("./daydream-controls"),k("./gearvr-controls"),k("./geometry"),k("./generic-tracked-controller-controls"),k("./gltf-model"),k("./hand-tracking-controls"),k("./hand-controls"),k("./hide-on-enter-ar"),k("./hp-mixed-reality-controls"),k("./layer"),k("./laser-controls"),k("./light"),k("./line"),k("./link"),k("./look-controls"),k("./magicleap-controls"),k("./material"),k("./obj-model"),k("./oculus-go-controls"),k("./oculus-touch-controls"),k("./position"),k("./raycaster"),k("./rotation"),k("./scale"),k("./shadow"),k("./sound"),k("./text"),k("./tracked-controls"),k("./tracked-controls-webvr"),k("./tracked-controls-webxr"),k("./visible"),k("./valve-index-controls"),k("./vive-controls"),k("./vive-focus-controls"),k("./wasd-controls"),k("./windows-motion-controls"),k("./scene/ar-hit-test"),k("./scene/background"),k("./scene/debug"),k("./scene/device-orientation-permission-ui"),k("./scene/embedded"),k("./scene/inspector"),k("./scene/fog"),k("./scene/keyboard-shortcuts"),k("./scene/pool"),k("./scene/reflection"),k("./scene/screenshot"),k("./scene/stats"),k("./scene/vr-mode-ui")},{"./animation":75,"./camera":76,"./cursor":77,"./daydream-controls":78,"./gearvr-controls":79,"./generic-tracked-controller-controls":80,"./geometry":81,"./gltf-model":82,"./hand-controls":83,"./hand-tracking-controls":84,"./hide-on-enter-ar":85,"./hp-mixed-reality-controls":86,"./laser-controls":88,"./layer":89,"./light":90,"./line":91,"./link":92,"./look-controls":93,"./magicleap-controls":94,"./material":95,"./obj-model":96,"./oculus-go-controls":97,"./oculus-touch-controls":98,"./position":99,"./raycaster":100,"./rotation":101,"./scale":102,"./scene/ar-hit-test":103,"./scene/background":104,"./scene/debug":105,"./scene/device-orientation-permission-ui":106,"./scene/embedded":107,"./scene/fog":108,"./scene/inspector":109,"./scene/keyboard-shortcuts":110,"./scene/pool":111,"./scene/reflection":112,"./scene/screenshot":113,"./scene/stats":114,"./scene/vr-mode-ui":115,"./shadow":116,"./sound":117,"./text":118,"./tracked-controls":121,"./tracked-controls-webvr":119,"./tracked-controls-webxr":120,"./valve-index-controls":122,"./visible":123,"./vive-controls":124,"./vive-focus-controls":125,"./wasd-controls":126,"./windows-motion-controls":127}],88:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/");b("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var B=this.config,I=this.data,w=this.el,T=this,x={hand:I.hand,model:I.model};function S(M){var E=B[M.detail.name];if(E){var _=D.extend({showLine:!0},E.raycaster||{});M.detail.rayOrigin&&(_.origin=M.detail.rayOrigin.origin,_.direction=M.detail.rayOrigin.direction,_.showLine=!0),M.detail.rayOrigin||!T.modelReady?w.setAttribute("raycaster",_):w.setAttribute("raycaster","showLine",!0),w.setAttribute("cursor",D.extend({fuse:!1},E.cursor))}}w.setAttribute("daydream-controls",x),w.setAttribute("gearvr-controls",x),w.setAttribute("hp-mixed-reality-controls",x),w.setAttribute("magicleap-controls",x),w.setAttribute("oculus-go-controls",x),w.setAttribute("oculus-touch-controls",x),w.setAttribute("valve-index-controls",x),w.setAttribute("vive-controls",x),w.setAttribute("vive-focus-controls",x),w.setAttribute("windows-motion-controls",x),w.setAttribute("generic-tracked-controller-controls",x),w.addEventListener("controllerconnected",S),w.addEventListener("controllerdisconnected",function(){w.setAttribute("raycaster","showLine",!1)}),w.addEventListener("controllermodelready",function(M){S(M),T.modelReady=!0})},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"gearvr-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:.001,z:0}}},"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},{"../core/component":136,"../utils/":212}],89:[function(k,ae,Ue){var b=k("../core/component").registerComponent,B=k("../utils/").debug("components:layer:warn");ae.exports.Component=b("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var w=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=w.createFramebuffer();var T=this.el.sceneEl.getAttribute("webxr").requiredFeatures;T.push("layers"),this.el.sceneEl.getAttribute("webxr","requiredFeatures",T),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(w){this.data.src!==w.src&&this.updateSrc()},updateSrc:function(){var w=this.data.type;this.texture=void 0,"quad"!==w?"monocubemap"!==w&&"stereocubemap"!==w||this.loadCubeMapImages():this.loadQuadImage()},loadCubeMapImages:function(){var w,T=this.xrGLFactory,x=this.el.sceneEl.frame,S=this.data.src,y=this.data.type;this.visibilityChanged=!1,this.layer&&("monocubemap"!==y&&"stereocubemap"!==y||(this.pendingCubeMapUpdate=!S.complete,this.loadingScreen=!this.loadingScreen,"monocubemap"===y?(w=T.getSubImage(this.layer,x),this.loadCubeMapImage(w.colorTexture,S,0)):(w=T.getSubImage(this.layer,x,"left"),this.loadCubeMapImage(w.colorTexture,S,0),w=T.getSubImage(this.layer,x,"right"),this.loadCubeMapImage(w.colorTexture,S,6))))},loadQuadImage:function(){var w=this.data.src,T=this;this.el.sceneEl.systems.material.loadTexture(w,{src:w},function(S){T.el.sceneEl.renderer.initTexture(S),T.texture=S,"VIDEO"===w.tagName&&setTimeout(function(){T.textureIsVideo=!0},1e3),T.layer&&(T.layer.height=T.data.height/2||T.texture.image.height/1e3,T.layer.width=T.data.width/2||T.texture.image.width/1e3,T.needsRedraw=!0),T.updateQuadPanel()})},preGenerateCubeMapTextures:function(w,T){"monocubemap"===this.data.type?this.generateCubeMapTextures(w,0,T):(this.generateCubeMapTextures(w,0,T),this.generateCubeMapTextures(w,6,T))},generateCubeMapTextures:function(w,T,x){for(var _,S=this.data,y=this.cubeFaceSize,M=Math.min(w.width,w.height),E=[],F=0;F<6;F++){var O=document.createElement("CANVAS");O.width=O.height=y;var V=O.getContext("2d");S.rotateCubemap&&(2===F||3===F)&&(V.save(),V.translate(y,y),V.rotate(Math.PI)),V.drawImage(w,(F+T)*M,0,M,M,0,0,y,y),V.restore(),x&&x(),E.push(O)}return S.rotateCubemap&&(_=E[0],E[0]=E[1],E[1]=_,_=E[4],E[4]=E[5],E[5]=_),x&&x(),E},loadCubeMapImage:function(w,T,x){var y,S=this.el.sceneEl.renderer.getContext();S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,!1),S.bindTexture(S.TEXTURE_CUBE_MAP,w),y=!T.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(T,x);var M=0;y.forEach(function(E,_){S.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,0,0,S.RGBA,S.UNSIGNED_BYTE,E),M=S.getError()}),0!==M&&console.log("renderingError, WebGL Error Code: "+M),S.bindTexture(S.TEXTURE_CUBE_MAP,null)},tick:function(){!this.el.sceneEl.xrSession||(!this.layer&&this.el.sceneEl.is("vr-mode")&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&("quad"===this.data.type&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var w=this,T=this.data.type;this.el.sceneEl.xrSession.onvisibilitychange=function(x){w.visibilityChanged="hidden"!==x.session.visibilityState},"quad"!==T?"monocubemap"!==T&&"stereocubemap"!==T||this.initCubeMapLayer():this.initQuadLayer()},initQuadLayer:function(){var w=this.el.sceneEl,T=w.renderer.getContext(),x=this.xrGLFactory=new XRWebGLBinding(w.xrSession,T);!this.texture||(this.layer=x.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),w.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var w=this.data.src,T=this.el.sceneEl,x=T.renderer.getContext(),S=x.getParameter(x.MAX_CUBE_MAP_TEXTURE_SIZE),y=this.cubeFaceSize=Math.min(S,Math.min(w.width,w.height)),M=this.xrGLFactory=new XRWebGLBinding(T.xrSession,x);this.layer=M.createCubeLayer({space:this.referenceSpace,viewPixelWidth:y,viewPixelHeight:y,layout:"monocubemap"===this.data.type?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),T.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var w=this.cubeFaceSize,T=this.loadingScreenImages=[],x=0;x<6;x++){var S=document.createElement("CANVAS");S.width=S.height=w;var y=S.getContext("2d");S.width=S.height=w,y.fillStyle="black",y.fillRect(0,0,w,w),2!==x&&3!==x&&(y.translate(w,0),y.scale(-1,1),y.fillStyle="white",y.font="30px Arial",y.fillText("Loading",w/2,w/2)),T.push(S)}},destroyLayer:function(){!this.layer||(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(w){this.layerEnabled=w,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var w=this.quadPanelEl;this.quadPanelEl||(w=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(w)),w.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),w.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var w=this.el.sceneEl,T=this.el.sceneEl.renderer.getContext(),x=this.xrGLFactory.getSubImage(this.layer,w.frame),S=w.renderer.properties.get(this.texture).__webglTexture,y=T.getParameter(T.FRAMEBUFFER_BINDING);T.viewport(x.viewport.x,x.viewport.y,x.viewport.width,x.viewport.height),T.bindFramebuffer(T.FRAMEBUFFER,this.frameBuffer),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,x.colorTexture,0),function(w,T,x,S){var y=w.createFramebuffer();let M=x.viewport.x,E=x.viewport.y,_=x.viewport.x+x.viewport.width,R=x.viewport.y+x.viewport.height;"VIDEO"===S.tagName&&(w.bindTexture(w.TEXTURE_2D,T),w.texSubImage2D(w.TEXTURE_2D,0,0,0,S.width,S.height,w.RGB,w.UNSIGNED_BYTE,S)),w.bindFramebuffer(w.READ_FRAMEBUFFER,y),w.framebufferTexture2D(w.READ_FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,T,0),w.readBuffer(w.COLOR_ATTACHMENT0),w.blitFramebuffer(0,0,S.width,S.height,M,E,_,R,w.COLOR_BUFFER_BIT,w.NEAREST),w.bindFramebuffer(w.READ_FRAMEBUFFER,null),w.deleteFramebuffer(y)}(T,S,x,this.data.src),T.bindFramebuffer(T.FRAMEBUFFER,y)},updateTransform:function(){var w=this.el,T=this.position,x=this.quaternion;w.object3D.updateMatrixWorld(),T.setFromMatrixPosition(w.object3D.matrixWorld),x.setFromRotationMatrix(w.object3D.matrixWorld),this.layerEnabled||T.set(0,0,1e8),this.layer.transform=new XRRigidTransform(T,x)},onEnterVR:function(){var w=this.el.sceneEl,T=w.xrSession;w.hasWebXR&&XRWebGLBinding&&T?(T.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.needsRedraw=!0,this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()):B("The layer component requires WebXR and the layers API enabled")},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(w){this.referenceSpace=w}})},{"../core/component":136,"../utils/":212}],90:[function(k,ae,Ue){var b=k("../utils/bind"),D=k("../utils"),B=D.diff,I=k("../utils/debug"),w=k("../core/component").registerComponent,T=k("../lib/three"),x=T.Math.degToRad,S=I("components:light:warn"),y=new T.CubeTextureLoader,M={};ae.exports.Component=w("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var E=this.el;this.light=null,this.defaultTarget=null,this.rendererSystem=this.el.sceneEl.systems.renderer,this.system.registerLight(E)},update:function(E){var _=this.data,R=B(_,E),F=this.light,O=this.rendererSystem,V=this;if(!F||"type"in R)this.setLight(this.data),this.updateShadow();else{var Y=!1;Object.keys(R).forEach(function(ee){var oe=_[ee];switch(ee){case"color":F.color.set(oe),O.applyColorCorrection(F.color);break;case"groundColor":F.groundColor.set(oe),O.applyColorCorrection(F.groundColor);break;case"angle":F.angle=x(oe);break;case"target":null===oe?("spot"===_.type||"directional"===_.type)&&(F.target=V.defaultTarget):oe.hasLoaded?V.onSetTarget(oe,F):oe.addEventListener("loaded",b(V.onSetTarget,V,oe,F));break;case"envMap":this.updateProbeMap(_,F);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":Y||(V.updateShadow(),Y=!0);break;default:F[ee]=oe}})}},setLight:function(E){var _=this.el,R=this.getLight(E);R&&(this.light&&_.removeObject3D("light"),this.light=R,this.light.el=_,_.setObject3D("light",this.light),("spot"===E.type||"directional"===E.type||"hemisphere"===E.type)&&_.getObject3D("light").translateY(-1),"spot"===E.type&&(_.setObject3D("light-target",this.defaultTarget),_.getObject3D("light-target").position.set(0,0,-1)))},updateShadow:function(){var E=this.el,_=this.data,R=this.light;R.castShadow=_.castShadow;var F=E.getObject3D("cameraHelper");if(_.shadowCameraVisible&&!F?E.setObject3D("cameraHelper",new T.CameraHelper(R.shadow.camera)):!_.shadowCameraVisible&&F&&E.removeObject3D("cameraHelper"),!_.castShadow)return R;R.shadow.bias=_.shadowBias,R.shadow.radius=_.shadowRadius,R.shadow.mapSize.height=_.shadowMapHeight,R.shadow.mapSize.width=_.shadowMapWidth,R.shadow.camera.near=_.shadowCameraNear,R.shadow.camera.far=_.shadowCameraFar,R.shadow.camera instanceof T.OrthographicCamera?(R.shadow.camera.top=_.shadowCameraTop,R.shadow.camera.right=_.shadowCameraRight,R.shadow.camera.bottom=_.shadowCameraBottom,R.shadow.camera.left=_.shadowCameraLeft):R.shadow.camera.fov=_.shadowCameraFov,R.shadow.camera.updateProjectionMatrix(),F&&F.update()},getLight:function(E){var _=E.angle,R=new T.Color(E.color);this.rendererSystem.applyColorCorrection(R),R=R.getHex();var F=E.decay,O=E.distance,V=new T.Color(E.groundColor);this.rendererSystem.applyColorCorrection(V),V=V.getHex();var Y=E.intensity,ee=E.type,oe=E.target,Ee=null;switch(ee.toLowerCase()){case"ambient":return new T.AmbientLight(R,Y);case"directional":return Ee=new T.DirectionalLight(R,Y),this.defaultTarget=Ee.target,oe&&(oe.hasLoaded?this.onSetTarget(oe,Ee):oe.addEventListener("loaded",b(this.onSetTarget,this,oe,Ee))),Ee;case"hemisphere":return new T.HemisphereLight(R,V,Y);case"point":return new T.PointLight(R,Y,O,F);case"spot":return Ee=new T.SpotLight(R,Y,O,x(_),E.penumbra,F),this.defaultTarget=Ee.target,oe&&(oe.hasLoaded?this.onSetTarget(oe,Ee):oe.addEventListener("loaded",b(this.onSetTarget,this,oe,Ee))),Ee;case"probe":return Ee=new T.LightProbe,this.updateProbeMap(E,Ee),Ee;default:S("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",ee)}},updateProbeMap:function(E,_){E.envMap||_.copy(new T.LightProbe),M[E.envMap]instanceof window.Promise&&M[E.envMap].then(function(R){_.copy(R)}),M[E.envMap]instanceof T.LightProbe&&_.copy(M[E.envMap]),M[E.envMap]=new window.Promise(function(R){D.srcLoader.validateCubemapSrc(E.envMap,function(O){y.load(O,function(V){var Y=T.LightProbeGenerator.fromCubeTexture(V);M[E.envMap]=Y,_.copy(Y)})})})},onSetTarget:function(E,_){_.target=E.object3D},remove:function(){var E=this.el;E.removeObject3D("light"),E.getObject3D("cameraHelper")&&E.removeObject3D("cameraHelper")}})},{"../core/component":136,"../lib/three":184,"../utils":212,"../utils/bind":206,"../utils/debug":208}],91:[function(k,ae,Ue){var b=k("../core/component").registerComponent;function D(B,I){return!(!B||!I)&&B.x===I.x&&B.y===I.y&&B.z===I.z}ae.exports.Component=b("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var I,w,B=this.data;this.rendererSystem=this.el.sceneEl.systems.renderer,w=this.material=new THREE.LineBasicMaterial({color:B.color,opacity:B.opacity,transparent:B.opacity<1,visible:B.visible}),(I=this.geometry=new THREE.BufferGeometry).setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.rendererSystem.applyColorCorrection(w.color),this.line=new THREE.Line(I,w),this.el.setObject3D(this.attrName,this.line)},update:function(B){var I=this.data,w=this.geometry,T=!1,x=this.material,S=w.attributes.position.array;D(I.start,B.start)||(S[0]=I.start.x,S[1]=I.start.y,S[2]=I.start.z,T=!0),D(I.end,B.end)||(S[3]=I.end.x,S[4]=I.end.y,S[5]=I.end.z,T=!0),T&&(w.attributes.position.needsUpdate=!0,w.computeBoundingSphere()),x.color.setStyle(I.color),this.rendererSystem.applyColorCorrection(x.color),x.opacity=I.opacity,x.transparent=I.opacity<1,x.visible=I.visible},remove:function(){this.el.removeObject3D("line",this.line)}})},{"../core/component":136}],92:[function(k,ae,Ue){var I,w,T,x,b=k("../core/component").registerComponent,D=k("../core/shader").registerShader,B=k("../lib/three");ae.exports.Component=b("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new B.Quaternion,this.hiddenEls=[]},update:function(I){var S,w=this.data,T=this.el;!w.visualAspectEnabled||(this.initVisualAspect(),S=w.highlighted?w.highlightedColor:w.borderColor,T.setAttribute("material","backgroundColor",w.highlighted?w.highlightedColor:w.backgroundColor),T.setAttribute("material","strokeColor",S),w.on!==I.on&&this.updateEventListener(),void 0!==I.peekMode&&w.peekMode!==I.peekMode&&this.updatePeekMode(),w.image&&I.image!==w.image&&T.setAttribute("material","pano","string"==typeof w.image?w.image:w.image.src))},updatePeekMode:function(){var I=this.el,w=this.sphereEl;this.data.peekMode?(this.hideAll(),I.getObject3D("mesh").visible=!1,w.setAttribute("visible",!0)):(this.showAll(),I.getObject3D("mesh").visible=!0,w.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var I=this.el;!I.isPlaying||(this.removeEventListener(),I.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var I=this.data.on;!I||this.el.removeEventListener(I,this.navigate)},initVisualAspect:function(){var w,T,x,I=this.el;!this.data.visualAspectEnabled||this.visualAspectInitialized||(x=this.textEl=this.textEl||document.createElement("a-entity"),T=this.sphereEl=this.sphereEl||document.createElement("a-entity"),w=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),I.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),I.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),x.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),x.setAttribute("position","0 1.5 0"),I.appendChild(x),w.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),w.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),w.setAttribute("rotation","0 180 0"),w.setAttribute("position","0 0 0"),w.setAttribute("visible",!1),I.appendChild(w),T.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),T.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),T.setAttribute("visible",!1),I.appendChild(T),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:(I=new B.Vector3,w=new B.Vector3,T=new B.Quaternion,x=new B.Vector3,function(){var E,_,S=this.el,y=S.object3D,M=S.sceneEl.camera,R=this.textEl;if(this.data.visualAspectEnabled)if(y.updateMatrixWorld(),M.parent.updateMatrixWorld(),M.updateMatrixWorld(),y.matrix.decompose(w,T,x),w.setFromMatrixPosition(y.matrixWorld),I.setFromMatrixPosition(M.matrixWorld),(_=w.distanceTo(I))>20)this.previousQuaternion||(this.quaternionClone.copy(T),this.previousQuaternion=this.quaternionClone),y.lookAt(I);else{if(E=this.calculateCameraPortalOrientation(),_<.5){if(!0===this.semiSphereEl.getAttribute("visible"))return;R.setAttribute("text","width",1.5),E<=0?(R.setAttribute("position","0 0 0.75"),R.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(R.setAttribute("position","0 0 -0.75"),R.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),S.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=E}else R.setAttribute("rotation",E<=0?"0 180 0":"0 0 0"),R.setAttribute("text","width",5),R.setAttribute("position","0 1.5 0"),S.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(y.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}),hideAll:function(){var I=this.el,w=this.hiddenEls,T=this;w.length>0||I.sceneEl.object3D.traverse(function(x){x&&x.el&&x.el.hasAttribute("link-controls")||!x.el||x===I.sceneEl.object3D||x.el===I||x.el===T.sphereEl||x.el===I.sceneEl.cameraEl||!1===x.el.getAttribute("visible")||x.el===T.textEl||x.el===T.semiSphereEl||(x.el.setAttribute("visible",!1),w.push(x.el))})},showAll:function(){this.hiddenEls.forEach(function(I){I.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var I=new B.Matrix4,w=new B.Vector3,T=new B.Vector3(0,0,1),x=new B.Vector3(0,0,0);return function(){var S=this.el,y=S.sceneEl.camera;return w.set(0,0,0),T.set(0,0,1),x.set(0,0,0),S.object3D.matrixWorld.extractRotation(I),T.applyMatrix4(I),S.object3D.updateMatrixWorld(),S.object3D.localToWorld(x),y.parent.parent.updateMatrixWorld(),y.parent.updateMatrixWorld(),y.updateMatrixWorld(),y.localToWorld(w),w.sub(x).normalize(),T.normalize(),Math.sign(T.dot(w))}}(),remove:function(){this.removeEventListener()}}),D("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join("\n")})},{"../core/component":136,"../core/shader":146,"../lib/three":184}],93:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../lib/three"),B=k("../utils/"),I=B.bind,w=Math.PI/2;ae.exports.Component=b("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new D.Vector3,this.hmdQuaternion=new D.Quaternion,this.magicWindowAbsoluteEuler=new D.Euler,this.magicWindowDeltaEuler=new D.Euler,this.position=new D.Vector3,this.magicWindowObject=new D.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new D.Vector3,rotation:new D.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var T,x=this.data;(B.device.isMobile()||B.device.isMobileDeviceRequestingDesktopSite())&&(T=this.magicWindowControls=new D.DeviceOrientationControls(this.magicWindowObject),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission&&(T.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?T.enabled=x.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){T.enabled=x.magicWindowTrackingEnabled})))},update:function(T){var x=this.data;x.enabled!==T.enabled&&this.updateGrabCursor(x.enabled),T&&!x.magicWindowTrackingEnabled&&T.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=x.magicWindowTrackingEnabled),T&&!x.pointerLockEnabled!==T.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(T){!this.data.enabled||this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=I(this.onMouseDown,this),this.onMouseMove=I(this.onMouseMove,this),this.onMouseUp=I(this.onMouseUp,this),this.onTouchStart=I(this.onTouchStart,this),this.onTouchMove=I(this.onTouchMove,this),this.onTouchEnd=I(this.onTouchEnd,this),this.onEnterVR=I(this.onEnterVR,this),this.onExitVR=I(this.onExitVR,this),this.onPointerLockChange=I(this.onPointerLockChange,this),this.onPointerLockError=I(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new D.Object3D,this.yawObject=new D.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var T=this.el.sceneEl,x=T.canvas;x?(x.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),x.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),T.addEventListener("enter-vr",this.onEnterVR),T.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):T.addEventListener("render-target-loaded",I(this.addEventListeners,this))},removeEventListeners:function(){var T=this.el.sceneEl,x=T&&T.canvas;!x||(x.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),x.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),T.removeEventListener("enter-vr",this.onEnterVR),T.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var T=this.el.object3D,x=this.pitchObject,S=this.yawObject,y=this.el.sceneEl;(y.is("vr-mode")||y.is("ar-mode"))&&y.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),T.rotation.x=this.magicWindowDeltaEuler.x+x.rotation.x,T.rotation.y=this.magicWindowDeltaEuler.y+S.rotation.y,T.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var T=this.magicWindowAbsoluteEuler,x=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),T.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&0!==T.y&&(this.previousMagicWindowYaw=T.y),this.previousMagicWindowYaw&&(x.x=T.x,x.y+=T.y-this.previousMagicWindowYaw,x.z=T.z,this.previousMagicWindowYaw=T.y))},onMouseMove:function(T){var x,S,y,M=this.pitchObject,E=this.previousMouseEvent,_=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(S=T.movementX||T.mozMovementX||0,y=T.movementY||T.mozMovementY||0):(S=T.screenX-E.screenX,y=T.screenY-E.screenY),this.previousMouseEvent.screenX=T.screenX,this.previousMouseEvent.screenY=T.screenY,_.rotation.y+=.002*S*(x=this.data.reverseMouseDrag?1:-1),M.rotation.x+=.002*y*x,M.rotation.x=Math.max(-w,Math.min(w,M.rotation.x)))},onMouseDown:function(T){var x=this.el.sceneEl;if(this.data.enabled&&this.data.mouseEnabled&&(!x.is("vr-mode")&&!x.is("ar-mode")||!x.checkHeadsetConnected())&&0===T.button){var S=x&&x.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=T.screenX,this.previousMouseEvent.screenY=T.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(S.requestPointerLock?S.requestPointerLock():S.mozRequestPointerLock&&S.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(T){1!==T.touches.length||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:T.touches[0].pageX,y:T.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(T){var y;!this.touchStarted||!this.data.touchEnabled||(y=2*Math.PI*(T.touches[0].pageX-this.touchStart.x)/this.el.sceneEl.canvas.clientWidth,this.yawObject.rotation.y-=.5*y*(this.data.reverseTouchDrag?1:-1),this.touchStart={x:T.touches[0].pageX,y:T.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var T=this.el.sceneEl;!T.checkHeadsetConnected()||(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),T.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){!this.el.sceneEl.checkHeadsetConnected()||(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(T){var x=this.el.sceneEl;function S(){x.canvas.classList.add("a-grab-cursor")}function y(){x.canvas.classList.remove("a-grab-cursor")}x.canvas?T?S():y():x.addEventListener("render-target-loaded",T?S:y)},saveCameraPose:function(){var T=this.el;this.savedPose.position.copy(T.object3D.position),this.savedPose.rotation.copy(T.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var T=this.el,x=this.savedPose;!this.hasSavedPose||(T.object3D.position.copy(x.position),T.object3D.rotation.copy(x.rotation),this.hasSavedPose=!1)}})},{"../core/component":136,"../lib/three":184,"../utils/":212}],94:[function(k,ae,Ue){var b=k("../utils/bind"),D=k("../core/component").registerComponent,B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,y="magicleap-one";ae.exports.Component=D("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var _=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=b(this.onButtonChanged,this),this.onButtonDown=function(R){T(R.detail.id,"down",_)},this.onButtonUp=function(R){T(R.detail.id,"up",_)},this.onButtonTouchEnd=function(R){T(R.detail.id,"touchend",_)},this.onButtonTouchStart=function(R){T(R.detail.id,"touchstart",_)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var _=this.data;this.controllerIndex="right"===_.hand?0:"left"===_.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=b(this.onModelLoaded,this),this.onControllersUpdate=b(this.onControllersUpdate,this),this.checkIfControllerPresent=b(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=b(this.removeControllersUpdateListener,this),this.onAxisMoved=b(this.onAxisMoved,this)},addEventListeners:function(){var _=this.el;_.addEventListener("buttonchanged",this.onButtonChanged),_.addEventListener("buttondown",this.onButtonDown),_.addEventListener("buttonup",this.onButtonUp),_.addEventListener("touchstart",this.onButtonTouchStart),_.addEventListener("touchend",this.onButtonTouchEnd),_.addEventListener("axismove",this.onAxisMoved),_.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var _=this.el;_.removeEventListener("buttonchanged",this.onButtonChanged),_.removeEventListener("buttondown",this.onButtonDown),_.removeEventListener("buttonup",this.onButtonUp),_.removeEventListener("touchstart",this.onButtonTouchStart),_.removeEventListener("touchend",this.onButtonTouchEnd),_.removeEventListener("axismove",this.onAxisMoved),_.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,y,{index:this.controllerIndex,hand:this.data.hand})},injectTrackedControls:function(){var R=this.data;this.el.setAttribute("tracked-controls",{idPrefix:y,hand:R.hand,controller:this.controllerIndex,orientationOffset:R.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/magicleap/magicleap-one-controller.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(_){var R=this.mapping.buttons[_.detail.id];!R||("trigger"===R&&console.log("analog value of trigger press: "+_.detail.state.value),this.el.emit(R+"changed",_.detail.state))},onModelLoaded:function(_){_.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(_){w(this,this.mapping.axes,_)},updateModel:function(_,R){},setButtonColor:function(_,R){}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],95:[function(k,ae,Ue){var b=k("../utils/"),D=k("../core/component"),B=k("../lib/three"),I=k("../core/shader"),w=b.debug("components:material:error"),x=I.shaders;function _(R,F){R.dispose(),F.unregisterMaterial(R)}ae.exports.Component=(0,D.registerComponent)("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:I.shaderNames,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0}},init:function(){this.material=null},update:function(R){var F=this.data;(!this.shader||F.shader!==R.shader)&&this.updateShader(F.shader),this.shader.update(this.data),this.updateMaterial(R)},updateSchema:function(R){var F,O,V,Y;F=this.oldData&&this.oldData.shader,(V=x[Y=(O=R&&R.shader)||F]&&x[Y].schema)||w("Unknown shader schema "+Y),(!F||O!==F)&&(this.extendSchema(V),this.updateBehavior())},updateBehavior:function(){var R,Y,F=this.el.sceneEl,O=this.schema,V=this;function ee(oe,Ee){var ve;for(ve in Y)Y[ve]=oe;V.shader.update(Y)}for(R in this.tick=void 0,Y={},O)"time"===O[R].type&&(this.tick=ee,Y[R]=!0);!F||(this.tick?F.addBehavior(this):F.removeBehavior(this))},updateShader:function(R){var V,F=this.data,O=x[R]&&x[R].Shader;if(!O)throw new Error("Unknown shader "+R);(V=this.shader=new O).el=this.el,V.init(F),this.setMaterial(V.material),this.updateSchema(F)},updateMaterial:function(R){var V,F=this.data,O=this.material;for(V in O.alphaTest=F.alphaTest,O.depthTest=!1!==F.depthTest,O.depthWrite=!1!==F.depthWrite,O.opacity=F.opacity,O.flatShading=F.flatShading,O.side=function(R){switch(R){case"back":return B.BackSide;case"double":return B.DoubleSide;default:return B.FrontSide}}(F.side),O.transparent=!1!==F.transparent||F.opacity<1,O.vertexColors=function(R){switch(R){case"face":return B.FaceColors;case"vertex":return B.VertexColors;default:return B.NoColors}}(F.vertexColors),O.visible=F.visible,O.blending=function(R){switch(R){case"none":return B.NoBlending;case"additive":return B.AdditiveBlending;case"subtractive":return B.SubtractiveBlending;case"multiply":return B.MultiplyBlending;default:return B.NormalBlending}}(F.blending),O.dithering=F.dithering,R)break;V&&(R.alphaTest!==F.alphaTest||R.side!==F.side||R.vertexColors!==F.vertexColors)&&(O.needsUpdate=!0)},remove:function(){var R=new B.MeshBasicMaterial,F=this.material,O=this.el.getObject3D("mesh");O&&(O.material=R),_(F,this.system)},setMaterial:function(R){var O,F=this.el,V=this.system;this.material&&_(this.material,V),this.material=R,V.registerMaterial(R),(O=F.getObject3D("mesh"))?O.material=R:F.addEventListener("object3dset",function Y(ee){"mesh"!==ee.detail.type||ee.target!==F||(F.getObject3D("mesh").material=R,F.removeEventListener("object3dset",Y))})}})},{"../core/component":136,"../core/shader":146,"../lib/three":184,"../utils/":212}],96:[function(k,ae,Ue){var b=k("../utils/debug"),D=k("../core/component").registerComponent,B=k("../lib/three"),I=b("components:obj-model:warn");ae.exports.Component=D("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var w=this;this.model=null,this.objLoader=new B.OBJLoader,this.mtlLoader=new B.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(T){!w.model||"material"===T.detail.name&&w.applyMaterial()})},update:function(){var w=this.data;!w.obj||(this.resetMesh(),this.loadObj(w.obj,w.mtl))},remove:function(){!this.model||this.resetMesh()},resetMesh:function(){this.el.removeObject3D("mesh")},loadObj:function(w,T){var x=this,S=this.el,y=this.mtlLoader,M=this.objLoader,E=this.el.sceneEl.systems.renderer,_=T.substr(0,T.lastIndexOf("/")+1);if(T)return S.hasAttribute("material")&&I("Material component properties are ignored when a .MTL is provided"),y.setResourcePath(_),void y.load(T,function(R){R.preload(),M.setMaterials(R),M.load(w,function(F){x.model=F,x.model.traverse(function(O){if(O.isMesh){var V=O.material;V.color&&E.applyColorCorrection(V.color),V.map&&E.applyColorCorrection(V.map),V.emissive&&E.applyColorCorrection(V.emissive),V.emissiveMap&&E.applyColorCorrection(V.emissiveMap)}}),S.setObject3D("mesh",F),S.emit("model-loaded",{format:"obj",model:F})})});M.load(w,function(F){x.model=F,x.applyMaterial(),S.setObject3D("mesh",F),S.emit("model-loaded",{format:"obj",model:F})})},applyMaterial:function(){var w=this.el.components.material;!w||this.model.traverse(function(T){T instanceof B.Mesh&&(T.material=w.material)})}})},{"../core/component":136,"../lib/three":184,"../utils/debug":208}],97:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,x=k("../utils/").device.isWebXRAvailable,E=x?"oculus-go":"Oculus Go";ae.exports.Component=b("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:x?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var O=this;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(V){T(V.detail.id,"down",O)},this.onButtonUp=function(V){T(V.detail.id,"up",O)},this.onButtonTouchStart=function(V){T(V.detail.id,"touchstart",O)},this.onButtonTouchEnd=function(V){T(V.detail.id,"touchend",O)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var O=this.el;O.addEventListener("buttonchanged",this.onButtonChanged),O.addEventListener("buttondown",this.onButtonDown),O.addEventListener("buttonup",this.onButtonUp),O.addEventListener("touchstart",this.onButtonTouchStart),O.addEventListener("touchend",this.onButtonTouchEnd),O.addEventListener("model-loaded",this.onModelLoaded),O.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var O=this.el;O.removeEventListener("buttonchanged",this.onButtonChanged),O.removeEventListener("buttondown",this.onButtonDown),O.removeEventListener("buttonup",this.onButtonUp),O.removeEventListener("touchstart",this.onButtonTouchStart),O.removeEventListener("touchend",this.onButtonTouchEnd),O.removeEventListener("model-loaded",this.onModelLoaded),O.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var V=this.data;this.el.setAttribute("tracked-controls",{armModel:V.armModel,hand:V.hand,idPrefix:E,orientationOffset:V.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(O){var Y,V=O.detail.model;!this.data.model||((Y=this.buttonMeshes={}).trigger=V.getObjectByName("oculus_go_button_trigger"),Y.trackpad=V.getObjectByName("oculus_go_touchpad"),Y.touchpad=V.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(O){var V=this.mapping.buttons[O.detail.id];!V||this.el.emit(V+"changed",O.detail.state)},onAxisMoved:function(O){w(this,this.mapping.axes,O)},updateModel:function(O,V){!this.data.model||this.updateButtonModel(O,V)},updateButtonModel:function(O,V){var Y=this.buttonMeshes;if(Y&&Y[O]){var ee,oe;switch(V){case"down":ee=this.data.buttonHighlightColor;break;case"touchstart":ee=this.data.buttonTouchedColor;break;default:ee=this.data.buttonColor}(oe=Y[O]).material.color.set(ee),this.rendererSystem.applyColorCorrection(oe.material.color)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],98:[function(k,ae,Ue){var b=k("../utils/bind"),D=k("../core/component").registerComponent,B=k("../lib/three"),I=k("../utils/tracked-controls"),w=I.checkControllerPresentAndSetup,T=I.emitIfAxesChanged,x=I.onButtonEvent,S=k("../utils/").device.isWebXRAvailable,y="oculus-touch",E=S?y:"Oculus Touch",_="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",R={left:{modelUrl:_+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new B.Vector3(-.005,.003,-.055),modelPivotRotation:new B.Euler(0,0,0)},right:{modelUrl:_+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new B.Vector3(.005,.003,-.055),modelPivotRotation:new B.Euler(0,0,0)}},F={left:{modelUrl:_+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new B.Vector3(-.005,.036,-.037),modelPivotRotation:new B.Euler(Math.PI/4.5,0,0)},right:{modelUrl:_+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new B.Vector3(.005,.036,-.037),modelPivotRotation:new B.Euler(Math.PI/4.5,0,0)}},V="oculus-touch",Y={"oculus-touch":S?F:R,"oculus-touch-v2":{left:{modelUrl:_+"gen2-left.gltf",rayOrigin:{origin:{x:-.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new B.Vector3(0,0,0),modelPivotRotation:new B.Euler(0,0,0)},right:{modelUrl:_+"gen2-right.gltf",rayOrigin:{origin:{x:.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new B.Vector3(0,0,0),modelPivotRotation:new B.Euler(0,0,0)}},"oculus-touch-v3":{left:{modelUrl:_+"v3-left.glb",rayOrigin:{origin:{x:.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new B.Vector3(.01,-.01,.05),modelPivotRotation:new B.Euler(Math.PI/4,0,0)},right:{modelUrl:_+"v3-right.glb",rayOrigin:{origin:{x:-.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new B.Vector3(-.01,-.01,.05),modelPivotRotation:new B.Euler(Math.PI/4,0,0)}}};ae.exports.Component=D("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:S?{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}}:{left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},bindMethods:function(){this.onModelLoaded=b(this.onModelLoaded,this),this.onControllersUpdate=b(this.onControllersUpdate,this),this.checkIfControllerPresent=b(this.checkIfControllerPresent,this),this.onAxisMoved=b(this.onAxisMoved,this)},init:function(){var ve=this;this.onButtonChanged=b(this.onButtonChanged,this),this.onButtonDown=function(Ce){x(Ce.detail.id,"down",ve,ve.data.hand)},this.onButtonUp=function(Ce){x(Ce.detail.id,"up",ve,ve.data.hand)},this.onButtonTouchStart=function(Ce){x(Ce.detail.id,"touchstart",ve,ve.data.hand)},this.onButtonTouchEnd=function(Ce){x(Ce.detail.id,"touchend",ve,ve.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var ve=this.el;ve.addEventListener("buttonchanged",this.onButtonChanged),ve.addEventListener("buttondown",this.onButtonDown),ve.addEventListener("buttonup",this.onButtonUp),ve.addEventListener("touchstart",this.onButtonTouchStart),ve.addEventListener("touchend",this.onButtonTouchEnd),ve.addEventListener("axismove",this.onAxisMoved),ve.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var ve=this.el;ve.removeEventListener("buttonchanged",this.onButtonChanged),ve.removeEventListener("buttondown",this.onButtonDown),ve.removeEventListener("buttonup",this.onButtonUp),ve.removeEventListener("touchstart",this.onButtonTouchStart),ve.removeEventListener("touchend",this.onButtonTouchEnd),ve.removeEventListener("axismove",this.onAxisMoved),ve.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){w(this,E,{hand:this.data.hand})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(ve){var He,Ce=this.data;if(Ce.model){if(this.displayModel=Y[Ce.controllerType]||Y[V],"auto"===Ce.controllerType){var we=this.el.sceneEl.systems["tracked-controls-webvr"];we&&we.vrDisplay?/^Oculus Quest$/.test(we.vrDisplay.displayName)&&(this.displayModel=Y["oculus-touch-v2"]):(He=V,He=-1!==ve.profiles.indexOf("oculus-touch-v2")?"oculus-touch-v2":He,He=-1!==ve.profiles.indexOf("oculus-touch-v3")?"oculus-touch-v3":He,this.displayModel=Y[He])}this.el.setAttribute("gltf-model",this.displayModel[Ce.hand].modelUrl)}},injectTrackedControls:function(ve){var Ce=this.data;this.el.setAttribute("tracked-controls",{id:S?y:"right"===Ce.hand?"Oculus Touch (Right)":"Oculus Touch (Left)",hand:Ce.hand,orientationOffset:Ce.orientationOffset,handTrackingEnabled:!1}),this.loadModel(ve)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(ve){var we,Ce=this.mapping[this.data.hand].buttons[ve.detail.id],He=this.buttonMeshes;!Ce||(("trigger"===Ce||"grip"===Ce)&&(we=ve.detail.state.value),He&&("trigger"===Ce&&He.trigger&&(He.trigger.rotation.x=this.originalXRotationTrigger-we*(Math.PI/26)),"grip"===Ce&&He.grip&&(He.grip.position.x=this.originalXPositionGrip+("left"===this.data.hand?-1:1)*we*.004)),this.el.emit(Ce+"changed",ve.detail.state))},onModelLoaded:function(ve){var He,Ce=this.controllerObject3D=ve.detail.model;!this.data.model||((He=this.buttonMeshes={}).grip=Ce.getObjectByName("buttonHand"),this.originalXPositionGrip=He.grip&&He.grip.position.x,He.thumbstick=Ce.getObjectByName("stick"),He.trigger=Ce.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=He.trigger&&He.trigger.rotation.x,He.xbutton=Ce.getObjectByName("buttonX"),He.abutton=Ce.getObjectByName("buttonA"),He.ybutton=Ce.getObjectByName("buttonY"),He.bbutton=Ce.getObjectByName("buttonB"),Ce.position.copy(this.displayModel[this.data.hand].modelPivotOffset),Ce.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin}))},onAxisMoved:function(ve){T(this,this.mapping[this.data.hand].axes,ve)},updateModel:function(ve,Ce){!this.data.model||this.updateButtonModel(ve,Ce)},updateButtonModel:function(ve,Ce){var He,ce=this.buttonMeshes;!this.data.model||ce&&ce[ve]&&((He=ce[ve]).material.color.set("up"===Ce||"touchend"===Ce?this.data.buttonColor:"touchstart"===Ce?this.data.buttonTouchColor:this.data.buttonHighlightColor),this.rendererSystem.applyColorCorrection(He.material.color))}})},{"../core/component":136,"../lib/three":184,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],99:[function(k,ae,Ue){var b=k("../core/component").registerComponent;ae.exports.Component=b("position",{schema:{type:"vec3"},update:function(){var B=this.data;this.el.object3D.position.set(B.x,B.y,B.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},{"../core/component":136}],100:[function(k,ae,Ue){var y,M,b=k("../core/component").registerComponent,D=k("../lib/three"),I=k("../utils/").debug("components:raycaster:warn"),w=/^[\w\s-.,[\]#]*$/,T={childList:!0,attributes:!0,subtree:!0},x_INTERSECT="raycaster-intersected",x_INTERSECTION="raycaster-intersection",x_INTERSECT_CLEAR="raycaster-intersected-cleared",x_INTERSECTION_CLEAR="raycaster-intersection-cleared",x_INTERSECTION_CLOSEST_ENTITY_CHANGED="raycaster-closest-entity-changed";function S(y,M){var E;for(y.length=M.length,E=0;E<M.length;E++)y[E]=M[E]}ae.exports.Component=b("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new D.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new D.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new D.Vector3,this.otherLineEndVec3=new D.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(y){var M=this.data,E=this.el,_=this.raycaster;_.far=M.far,_.near=M.near,M.showLine&&(M.far!==y.far||M.origin!==y.origin||M.direction!==y.direction||!y.showLine)&&(this.unitLineEndVec3.copy(M.origin).add(M.direction).normalize(),this.drawLine()),!M.showLine&&y.showLine&&E.removeAttribute("line"),M.objects!==y.objects&&!w.test(M.objects)&&I('[raycaster] Selector "'+M.objects+'" may not update automatically with DOM changes.'),M.objects||I('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),M.autoRefresh!==y.autoRefresh&&E.isPlaying&&(M.autoRefresh?this.addEventListeners():this.removeEventListeners()),y.enabled&&!M.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){!this.data.autoRefresh||(this.observer.observe(this.el.sceneEl,T),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var M,y=this.data;M=this.el.sceneEl.querySelectorAll(y.objects?y.objects:"*"),this.objects=this.flattenObject3DMaps(M),this.dirty=!1},tock:function(y){var M=this.data,E=this.prevCheckTime;!M.enabled||E&&y-E<M.interval||(this.prevCheckTime=y,this.checkIntersections())},checkIntersections:function(){var _,F,y=this.clearedIntersectedEls,M=this.el,E=this.data,R=this.intersectedEls,O=this.intersections,V=this.newIntersectedEls,Y=this.newIntersections,ee=this.prevIntersectedEls,oe=this.rawIntersections;for(this.dirty&&this.refreshObjects(),S(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),oe.length=0,this.raycaster.intersectObjects(this.objects,!0,oe),O.length=0,R.length=0,_=0;_<oe.length;_++)F=oe[_],(!E.showLine||F.object!==M.getObject3D("line"))&&F.object.el&&(O.push(F),R.push(F.object.el));for(Y.length=0,V.length=0,_=0;_<O.length;_++)-1===ee.indexOf(O[_].object.el)&&(Y.push(O[_]),V.push(O[_].object.el));for(y.length=0,_=0;_<ee.length;_++)-1===R.indexOf(ee[_])&&(ee[_].emit(x_INTERSECT_CLEAR,this.intersectedClearedDetail),y.push(ee[_]));for(y.length&&M.emit(x_INTERSECTION_CLEAR,this.intersectionClearedDetail),_=0;_<V.length;_++)V[_].emit(x_INTERSECT,this.intersectedDetail);Y.length&&(this.intersectionDetail.els=V,this.intersectionDetail.intersections=Y,M.emit(x_INTERSECTION,this.intersectionDetail)),(0===ee.length&&O.length>0||ee.length>0&&0===O.length||ee.length&&O.length&&ee[0]!==O[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=O,M.emit(x_INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),E.showLine&&setTimeout(this.updateLine)},updateLine:function(){var E,M=this.intersections;M.length&&(E=M[0].object.el===this.el&&M[1]?M[1].distance:M[0].distance),this.drawLine(E)},getIntersection:function(y){var M,E;for(M=0;M<this.intersections.length;M++)if((E=this.intersections[M]).object.el===y)return E;return null},updateOriginDirection:(y=new D.Vector3,M=new D.Vector3,function(){var _=this.el,R=this.data;R.useWorldCoordinates?this.raycaster.set(R.origin,R.direction):(_.object3D.updateMatrixWorld(),M.setFromMatrixPosition(_.object3D.matrixWorld),(0!==R.origin.x||0!==R.origin.y||0!==R.origin.z)&&(M=_.object3D.localToWorld(M.copy(R.origin))),y.copy(R.direction).transformDirection(_.object3D.matrixWorld).normalize(),this.raycaster.set(M,y))}),drawLine:function(y){var _,M=this.data,E=this.el;_=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,void 0===y&&(y=M.far===1/0?1e3:M.far),this.lineData.start=M.origin,this.lineData.end=_.copy(this.unitLineEndVec3).multiplyScalar(y),this.lineData.color=M.lineColor,this.lineData.opacity=M.lineOpacity,E.setAttribute("line",this.lineData)},flattenObject3DMaps:function(y){var M,E,_=this.objects;for(_.length=0,E=0;E<y.length;E++)if(y[E].isEntity&&y[E].object3D)for(M in y[E].object3DMap)_.push(y[E].getObject3D(M));return _},clearAllIntersections:function(){var y;for(y=0;y<this.intersectedEls.length;y++)this.intersectedEls[y].emit(x_INTERSECT_CLEAR,this.intersectedClearedDetail);S(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(x_INTERSECTION_CLEAR,this.intersectionClearedDetail)}})},{"../core/component":136,"../lib/three":184,"../utils/":212}],101:[function(k,ae,Ue){var b=k("../lib/three").Math.degToRad,D=k("../core/component").registerComponent;ae.exports.Component=D("rotation",{schema:{type:"vec3"},update:function(){var B=this.data,I=this.el.object3D;I.rotation.set(b(B.x),b(B.y),b(B.z)),I.rotation.order="YXZ"},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},{"../core/component":136,"../lib/three":184}],102:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=1e-5;ae.exports.Component=b("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var B=this.data;this.el.object3D.scale.set(0===B.x?D:B.x,0===B.y?D:B.y,0===B.z?D:B.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},{"../core/component":136}],103:[function(k,ae,Ue){var S,y,M,D=k("../../core/component").registerComponent,B=k("../../lib/three"),w=(y=new B.Quaternion,M=new B.Vector3,function(_,R,F){R.position.copy(_.transform.position),R.quaternion.copy(_.transform.orientation),M.copy(F),y.copy(_.transform.orientation),M.applyQuaternion(y),R.position.sub(M)});function T(y,M){this.renderer=y,this.xrHitTestSource=null,y.xr.addEventListener("sessionend",function(){this.xrHitTestSource=null}.bind(this)),y.xr.addEventListener("sessionstart",function(){this.sessionStart(M)}.bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(M)}function x(y){console.warn(y.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}w.tempFakePose={transform:{orientation:new B.Quaternion,position:new B.Vector3}},T.prototype.previousFrameAnchors=new Set,T.prototype.anchorToObject3D=new Map,T.prototype.sessionStart=function(M){this.session=this.renderer.xr.getSession(),"requestHitTestSource"in this.session?M.space?this.session.requestHitTestSource(M).then(function(E){this.xrHitTestSource=E}.bind(this)).catch(x):M.profile&&this.session.requestHitTestSourceForTransientInput(M).then(function(E){this.xrHitTestSource=E,this.transient=!0}.bind(this)).catch(x):x({message:"No requestHitTestSource on the session."})},T.prototype.anchorFromLastHitTestResult=function(y,M){var E=this.lastHitTest;if(E){var _={object3D:y,offset:M};Array.from(this.anchorToObject3D.entries()).forEach(function(R){var O=R[0];R[1].object3D===y&&(this.anchorToObject3D.delete(O),O.delete())}.bind(this)),E.createAnchor&&E.createAnchor().then(function(R){this.anchorToObject3D.set(R,_)}.bind(this)).catch(function(R){console.warn(R.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},T.prototype.doHit=function(M){if(this.renderer.xr.isPresenting){var R,F,E=this.renderer.xr.getReferenceSpace(),_=M.getViewerPose(E);if(this.xrHitTestSource&&_)return this.transient?(R=M.getHitTestResultsForTransientInput(this.xrHitTestSource)).length>0&&(F=R[0].results).length>0&&(this.lastHitTest=F[0],F[0].getPose(E)):(R=M.getHitTestResults(this.xrHitTestSource)).length>0&&(this.lastHitTest=R[0],R[0].getPose(E))}},T.updateAnchorPoses=function(y,M){var E=y.trackedAnchors||T.prototype.previousFrameAnchors;T.prototype.previousFrameAnchors.forEach(function(_){E.has(_)||T.prototype.anchorToObject3D.delete(_)}),E.forEach(function(_){var R,F;try{R=y.getPose(_.anchorSpace,M)}catch(Y){}R&&(F=T.prototype.anchorToObject3D.get(_),w(R,F.object3D,F.offset))})},ae.exports.Component=D("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:"data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new B.OrthographicCamera,this.orthoCam.layers.set(21),this.textureTarget=new B.WebGLRenderTarget(512,512,{}),this.basicMaterial=new B.MeshBasicMaterial({color:0,side:B.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new B.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var y=this.el.getAttribute("webxr"),M=y.optionalFeatures;(!M.includes("hit-test")||!M.includes("anchors"))&&(M.push("hit-test"),M.push("anchors"),this.el.setAttribute("webxr",y)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",function(){this.hitTest=null}.bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",function(){if(this.el.is("ar-mode")){var E=this.el.sceneEl.renderer,_=this.session=E.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,S||(S=new Map),_.requestReferenceSpace("viewer").then(function(O){this.hitTest=new T(E,{space:O}),S.set(O,this.hitTest),this.el.emit("ar-hit-test-start")}.bind(this));var R="generic-touchscreen",F=new T(E,{profile:R});_.addEventListener("selectstart",function(O){if(!0===this.data.enabled){var V=O.inputSource;this.bboxMesh.visible=!0,!0===this.hasPosedOnce&&(this.el.emit("ar-hit-test-select-start",{inputSource:V,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),V.profiles[0]===R?this.hitTest=F:(this.hitTest=S.get(V)||new T(E,{space:V.targetRaySpace}),S.set(V,this.hitTest)))}}.bind(this)),_.addEventListener("selectend",function(O){if(this.hitTest&&!0===this.data.enabled){var Y,V=O.inputSource;!0===this.hasPosedOnce&&(this.bboxMesh.visible=!1,this.data.target&&(Y=this.data.target.object3D)&&(w.tempFakePose.transform.position.copy(this.bboxMesh.position),w.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),w(w.tempFakePose,Y,this.bboxOffset),Y.visible=!0,this.hitTest.anchorFromLastHitTestResult(Y,this.bboxOffset)),this.el.emit("ar-hit-test-select",{inputSource:V,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}else this.hitTest=null}.bind(this))}}.bind(this)),this.bboxOffset=new B.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(21),this.data.target.object3D.traverse(function(y){y.layers.enable(21)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var y=new B.PlaneGeometry(1,1),M=new B.MeshBasicMaterial({transparent:!0,color:16777215});y.rotateX(-Math.PI/2),y.rotateY(-Math.PI/2),this.bbox=new B.Box3,this.bboxMesh=new B.Mesh(y,M),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var y,E,_,M=this.el.sceneEl.renderer,R=M.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),E=M.getRenderTarget(),M.setRenderTarget(this.textureTarget),M.xr.enabled=!1,_=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,M.render(this.el.object3D,this.orthoCam),this.el.object3D.background=_,this.el.object3D.overrideMaterial=null,M.xr.enabled=R,M.setRenderTarget(E),M.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),y=this.context.getImageData(0,0,512,512);for(var F=0;F<262144;F++)0!==y.data[4*F+3]&&255!==y.data[4*F+3]&&(y.data[4*F+3]=128);this.context.putImageData(y,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var y,_,M=this.el.sceneEl.frame;M&&T.updateAnchorPoses(M,this.el.sceneEl.renderer.xr.getReferenceSpace()),this.bboxNeedsUpdate&&(this.bboxNeedsUpdate=!1,this.data.target&&"map"!==this.data.type||(this.textureCache.has(this.data.src)?_=this.textureCache.get(this.data.src):(_=(new B.TextureLoader).load(this.data.src),this.textureCache.set(this.data.src,_)),this.bboxMesh.material.map=_,this.bboxMesh.material.needsUpdate=!0),this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),"footprint"===this.data.type&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)),this.hitTest&&(y=this.hitTest.doHit(M))&&(!0!==this.hasPosedOnce&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(y.transform.position),this.bboxMesh.quaternion.copy(y.transform.orientation))}})},{"../../core/component":136,"../../lib/three":184}],104:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../core/component").components;ae.exports.Component=b("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function(){var B=this.data;this.el.object3D.background=B.transparent?null:new THREE.Color(B.color)},remove:function(){this.el.object3D.background=this.data.transparent?null:D[this.name].schema.color.default}})},{"../../core/component":136}],105:[function(k,ae,Ue){var b=k("../../core/component").registerComponent;ae.exports.Component=b("debug",{schema:{default:!0}})},{"../../core/component":136}],106:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,B=k("../../utils/").bind,I=k("../../constants/"),y="a-dialog-buttons-container",M="a-dialog-button";function V(Y,ee){var oe,Ee,ve,Ce;return(oe=document.createElement("div")).classList.add("a-modal"),oe.setAttribute(I.AFRAME_INJECTED,""),(Ee=document.createElement("div")).className="a-dialog",Ee.setAttribute(I.AFRAME_INJECTED,""),oe.appendChild(Ee),(ve=document.createElement("div")).classList.add("a-dialog-text-container"),Ee.appendChild(ve),(Ce=document.createElement("div")).classList.add("a-dialog-text"),Ce.innerHTML=Y,ve.appendChild(Ce),Ee.appendChild(ee),oe}ae.exports.Component=b("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},init:function(){var Y=this;if(this.data.enabled){if("localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&"http:"===location.protocol&&this.showHTTPAlert(),"undefined"==typeof DeviceOrientationEvent||!DeviceOrientationEvent.requestPermission)return void(this.permissionGranted=!0);this.onDeviceMotionDialogAllowClicked=B(this.onDeviceMotionDialogAllowClicked,this),this.onDeviceMotionDialogDenyClicked=B(this.onDeviceMotionDialogDenyClicked,this),DeviceOrientationEvent.requestPermission().catch(function(){Y.devicePermissionDialogEl=function(Y,ee,oe,Ee,ve){var Ce,He,we;return(Ce=document.createElement("div")).classList.add(y),(He=document.createElement("button")).classList.add(M,"a-dialog-deny-button"),He.setAttribute(I.AFRAME_INJECTED,""),He.innerHTML=Y,Ce.appendChild(He),(we=document.createElement("button")).classList.add(M,"a-dialog-allow-button"),we.setAttribute(I.AFRAME_INJECTED,""),we.innerHTML=ee,Ce.appendChild(we),we.addEventListener("click",function(ce){ce.stopPropagation(),Ee()}),He.addEventListener("click",function(ce){ce.stopPropagation(),ve()}),V(oe,Ce)}(Y.data.denyButtonText,Y.data.allowButtonText,Y.data.deviceMotionMessage,Y.onDeviceMotionDialogAllowClicked,Y.onDeviceMotionDialogDenyClicked),Y.el.appendChild(Y.devicePermissionDialogEl)}).then(function(){Y.el.emit("deviceorientationpermissiongranted"),Y.permissionGranted=!0})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var Y=this,ee=function(Y,ee,oe){var Ee,ve;return(Ee=document.createElement("div")).classList.add(y),(ve=document.createElement("button")).classList.add(M,"a-dialog-ok-button"),ve.setAttribute(I.AFRAME_INJECTED,""),ve.innerHTML=Y,Ee.appendChild(ve),ve.addEventListener("click",function(Ce){Ce.stopPropagation(),oe()}),V(ee,Ee)}(Y.data.cancelButtonText,Y.data.httpsMessage,function(){Y.el.removeChild(ee)});this.el.appendChild(ee)},onDeviceMotionDialogAllowClicked:function(){var Y=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(ee){"granted"===ee?(Y.el.emit("deviceorientationpermissiongranted"),Y.permissionGranted=!0):Y.el.emit("deviceorientationpermissionrejected"),Y.remove()}).catch(console.error)}})},{"../../constants/":128,"../../core/component":136,"../../utils/":212}],107:[function(k,ae,Ue){var b=k("../../core/component").registerComponent;ae.exports.Component=b("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function(){var D=this.el,B=D.querySelector(".a-enter-vr");!0===this.data?(B&&B.classList.add("embedded"),D.removeFullScreenStyles()):(B&&B.classList.remove("embedded"),D.addFullScreenStyles())}})},{"../../core/component":136}],108:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../lib/three"),I=k("../../utils/debug")("components:fog:warn");ae.exports.Component=b("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function(){var T=this.data,x=this.el,S=this.el.object3D.fog;if(x.isScene)return S&&T.type===S.name?void Object.keys(this.schema).forEach(function(y){var M=T[y];"color"===y&&(M=new D.Color(M)),S[y]=M}):(x.object3D.fog=function(T){var x;return(x="exponential"===T.type?new D.FogExp2(T.color,T.density):new D.Fog(T.color,T.near,T.far)).name=T.type,x}(T),void x.systems.material.updateMaterials());I("Fog component can only be applied to <a-scene>")},remove:function(){var T=this.el.object3D.fog;!T||(T.far=0,T.near=.1)}})},{"../../core/component":136,"../../lib/three":184,"../../utils/debug":208}],109:[function(k,ae,Ue){(function(b){var D=k("../../constants").AFRAME_INJECTED,B=k("../../../package"),I=k("../../core/component").registerComponent,w=k("../../utils/");var R,S="https://unpkg.com/aframe-inspector@"+((R=B.version.split("."))[2]="x",R.join(".")+"/dist/aframe-inspector.min.js");ae.exports.Component=I("inspector",{schema:{url:{default:"dev"===b.env.INSPECTOR_VERSION?"https://aframe.io/aframe-inspector/dist/aframe-inspector.js":S}},init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var _;!this.firstPlay||"false"!==(_=w.getUrlParameter("inspector"))&&_&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(_){73!==_.keyCode||!(_.ctrlKey&&_.altKey||_.getModifierState("AltGraph"))||this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(_){"INJECT_AFRAME_INSPECTOR"===_.data&&this.openInspector()},openInspector:function(_){var F,R=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(_):(this.showLoader(),(F=document.createElement("script")).src=this.data.url,F.setAttribute("data-name","aframe-inspector"),F.setAttribute(D,""),F.onload=function(){AFRAME.INSPECTOR.open(_),R.hideLoader(),R.removeEventListeners()},F.onerror=function(){R.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(F),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})}).call(this,k("_process"))},{"../../../package":74,"../../constants":128,"../../core/component":136,"../../utils/":212,_process:49}],110:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../utils/").shouldCaptureKeyEvent;ae.exports.Component=b("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(B){this.enterVREnabled=this.data.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(B){var I=this.el;!D(B)||(this.enterVREnabled&&70===B.keyCode&&I.enterVR(),this.enterVREnabled&&27===B.keyCode&&I.exitVR())}})},{"../../core/component":136,"../../utils/":212}],111:[function(k,ae,Ue){var b=k("../../utils/debug"),D=k("../../core/component").registerComponent,B=b("components:pool:warn");ae.exports.Component=D("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function(){var I;for(this.availableEls=[],this.usedEls=[],this.data.mixin||B("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||B("Container "+this.data.container+" not found.")),this.container=this.container||this.el,I=0;I<this.data.size;++I)this.createEntity()},update:function(I){var w=this.data;(I.mixin!==w.mixin||I.size!==w.size)&&this.initPool()},createEntity:function(){var I;(I=document.createElement("a-entity")).play=this.wrapPlay(I.play),I.setAttribute("mixin",this.data.mixin),I.object3D.visible=!1,I.pause(),this.container.appendChild(I),this.availableEls.push(I)},wrapPlay:function(I){var w=this.usedEls;return function(){-1!==w.indexOf(this)&&I.call(this)}},requestEntity:function(){var I;if(0===this.availableEls.length){if(!1===this.data.dynamic)return void B("Requested entity from empty pool: "+this.attrName);B("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return I=this.availableEls.shift(),this.usedEls.push(I),I.object3D.visible=!0,I},returnEntity:function(I){var w=this.usedEls.indexOf(I);if(-1!==w)return this.usedEls.splice(w,1),this.availableEls.push(I),I.object3D.visible=!1,I.pause(),I;B("The returned entity was not previously pooled from "+this.attrName)}})},{"../../core/component":136,"../../utils/debug":208}],112:[function(k,ae,Ue){var b=k("../../core/component").registerComponent;ae.exports.Component=b("reflection",{schema:{directionalLight:{type:"selector"}},init:function(){var B=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var I=this.el.getAttribute("webxr"),w=I.optionalFeatures;w.includes("light-estimation")||(w.push("light-estimation"),this.el.setAttribute("webxr",I)),this.el.addEventListener("enter-vr",function(){B.el.renderer.xr.getSession().requestLightProbe&&B.el.is("ar-mode")&&B.startLightProbe()}),this.el.addEventListener("exit-vr",function(){B.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var B=this.el.renderer,I=B.xr.getSession(),w=this,T=B.getContext();if(!this.probeLight){var x=document.createElement("a-light");x.setAttribute("type","probe"),x.setAttribute("intensity",0),this.el.appendChild(x),this.probeLight=x}switch(I.preferredReflectionFormat){case"srgba8":T.getExtension("EXT_sRGB");break;case"rgba16f":T.getExtension("OES_texture_half_float")}this.glBinding=new XRWebGLBinding(I,T),T.getExtension("EXT_sRGB"),T.getExtension("OES_texture_half_float"),I.requestLightProbe().then(function(S){w.xrLightProbe=S,S.addEventListener("reflectionchange",w.updateXRCubeMap.bind(w))}).catch(function(S){console.warn("Lighting estimation not supported: "+S.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var B=this.el.renderer,I=this.glBinding.getReflectionCubeMap(this.xrLightProbe);I&&(B.properties.get(this.lightingEstimationTexture).__webglTexture=I,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture)},tick:function(){var B=this.el.object3D,I=this.el.renderer,w=this.el.frame;if(w&&this.xrLightProbe){var T=w.getLightEstimate(this.xrLightProbe);T&&function(B,I,w,T){var x=Math.max(B.primaryLightIntensity.x,Math.max(B.primaryLightIntensity.y,B.primaryLightIntensity.z));I.sh.fromArray(B.sphericalHarmonicsCoefficients),I.intensity=1,w&&(w.color.setRGB(B.primaryLightIntensity.x/x,B.primaryLightIntensity.y/x,B.primaryLightIntensity.z/x),w.intensity=x,T.copy(B.primaryLightDirection))}(T,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(B.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(I,B),this.el.object3D.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&w&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.removeChild(this.probeLight)}})},{"../../core/component":136}],113:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../lib/three"),B=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),I=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join("\n");ae.exports.Component=b("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function(){var w=this.el,T=this;function x(){var S=w.renderer.getContext();!S||(T.cubeMapSize=S.getParameter(S.MAX_CUBE_MAP_TEXTURE_SIZE),T.material=new D.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:B,fragmentShader:I,side:D.DoubleSide}),T.quad=new D.Mesh(new D.PlaneBufferGeometry(1,1),T.material),T.quad.visible=!1,T.camera=new D.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),T.canvas=document.createElement("canvas"),T.ctx=T.canvas.getContext("2d"),w.object3D.add(T.quad),T.onKeyDown=T.onKeyDown.bind(T))}w.renderer?x():w.addEventListener("render-target-loaded",x)},getRenderTarget:function(w,T){return new D.WebGLRenderTarget(w,T,{encoding:D.sRGBEncoding,minFilter:D.LinearFilter,magFilter:D.LinearFilter,wrapS:D.ClampToEdgeWrapping,wrapT:D.ClampToEdgeWrapping,format:D.RGBAFormat,type:D.UnsignedByteType})},resize:function(w,T){this.quad.scale.set(w,T,1),this.camera.left=-1*w/2,this.camera.right=w/2,this.camera.top=T/2,this.camera.bottom=-1*T/2,this.camera.updateProjectionMatrix(),this.canvas.width=w,this.canvas.height=T},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(w){this.data&&83===w.keyCode&&w.ctrlKey&&w.altKey&&this.capture(w.shiftKey?"equirectangular":"perspective")},setCapture:function(w){var x,S,y,M,T=this.el;return"perspective"===w?(this.quad.visible=!1,S=this.data.camera&&this.data.camera.components.camera.camera||T.camera,x={width:this.data.width,height:this.data.height}):(S=this.camera,M=new D.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:D.RGBFormat,generateMipmaps:!0,minFilter:D.LinearMipmapLinearFilter,encoding:D.sRGBEncoding}),y=new D.CubeCamera(T.camera.near,T.camera.far,M),T.camera.getWorldPosition(y.position),T.camera.getWorldQuaternion(y.quaternion),y.update(T.renderer,T.object3D),this.quad.material.uniforms.map.value=y.renderTarget.texture,x={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:S,size:x,projection:w}},capture:function(w){var S,T=this.el.renderer.xr.enabled,x=this.el.renderer;x.xr.enabled=!1,S=this.setCapture(w),this.renderCapture(S.camera,S.size,S.projection),this.saveCapture(),x.xr.enabled=T},getCanvas:function(w){var T=this.el.renderer.xr.enabled,x=this.el.renderer,S=this.setCapture(w);return x.xr.enabled=!1,this.renderCapture(S.camera,S.size,S.projection),x.xr.enabled=T,this.canvas},renderCapture:function(w,T,x){var M,E,_,S=this.el.renderer.autoClear,y=this.el,R=y.renderer;E=this.getRenderTarget(T.width,T.height),_=new Uint8Array(4*T.width*T.height),this.resize(T.width,T.height),R.autoClear=!0,R.clear(),R.setRenderTarget(E),R.render(y.object3D,w),R.autoClear=S,R.readRenderTargetPixels(E,0,0,T.width,T.height,_),R.setRenderTarget(null),"perspective"===x&&(_=this.flipPixelsVertically(_,T.width,T.height)),M=new ImageData(new Uint8ClampedArray(_),T.width,T.height),this.quad.visible=!1,this.ctx.putImageData(M,0,0)},flipPixelsVertically:function(w,T,x){for(var S=w.slice(0),y=0;y<T;++y)for(var M=0;M<x;++M)S[4*y+M*T*4]=w[4*y+(x-M)*T*4],S[4*y+1+M*T*4]=w[4*y+1+(x-M)*T*4],S[4*y+2+M*T*4]=w[4*y+2+(x-M)*T*4],S[4*y+3+M*T*4]=w[4*y+3+(x-M)*T*4];return S},saveCapture:function(){this.canvas.toBlob(function(w){var T="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",x=document.createElement("a"),S=URL.createObjectURL(w);x.href=S,x.setAttribute("download",T),x.innerHTML="downloading...",x.style.display="none",document.body.appendChild(x),setTimeout(function(){x.click(),document.body.removeChild(x)},1)},"image/png")}})},{"../../core/component":136,"../../lib/three":184}],114:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../../vendor/rStats"),B=k("../../utils");k("../../../vendor/rStats.extras"),k("../../lib/rStatsAframe");var I=window.aframeStats,w=B.bind,T="a-hidden",x=window.threeStats;ae.exports.Component=b("stats",{schema:{default:!0},init:function(){var y=this.el;"false"!==B.getUrlParameter("stats")&&(this.stats=function(y){var M=new x(y.renderer),E=new I(y);return new D({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:y.isMobile?[]:[M,E]})}(y),this.statsEl=document.querySelector(".rs-base"),this.hideBound=w(this.hide,this),this.showBound=w(this.show,this),y.addEventListener("enter-vr",this.hideBound),y.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var y=this.stats;!y||(y("rAF").tick(),y("FPS").frame(),y().update())},hide:function(){this.statsEl.classList.add(T)},show:function(){this.statsEl.classList.remove(T)}})},{"../../../vendor/rStats":224,"../../../vendor/rStats.extras":223,"../../core/component":136,"../../lib/rStatsAframe":183,"../../utils":212}],115:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../constants/"),B=k("../../utils/"),I=B.bind,y="a-hidden";function F(O){O.addEventListener("touchstart",function(){O.classList.remove("resethover")}),O.addEventListener("touchend",function(){O.classList.add("resethover")})}ae.exports.Component=b("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterARButton:{default:""}},init:function(){var O=this,V=this.el;"false"!==B.getUrlParameter("ui")&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),V.addEventListener("enter-vr",this.updateEnterInterfaces),V.addEventListener("exit-vr",this.updateEnterInterfaces),V.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(Y){"loaderReady"===Y.data.type&&(O.insideLoader=!0,O.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=I(this.onEnterVRButtonClick,this),this.onEnterARButtonClick=I(this.onEnterARButtonClick,this),this.onModalClick=I(this.onModalClick,this),this.toggleOrientationModalIfNeeded=I(this.toggleOrientationModalIfNeeded,this),this.updateEnterInterfaces=I(this.updateEnterInterfaces,this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var O=this.data,V=this.el;if(!O.enabled||this.insideLoader||"false"===B.getUrlParameter("ui"))return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(O.enterVRButton?(this.enterVREl=document.querySelector(O.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=function(O){var V,Y;return(Y=document.createElement("div")).classList.add("a-enter-vr"),Y.setAttribute(D.AFRAME_INJECTED,""),(V=document.createElement("button")).className="a-enter-vr-button",V.setAttribute("title","Enter VR mode with a headset or fullscreen mode on a desktop. Visit https://webvr.rocks or https://webvr.info for more information."),V.setAttribute(D.AFRAME_INJECTED,""),B.device.isMobile()&&F(V),Y.appendChild(V),V.addEventListener("click",function(ee){O(),ee.stopPropagation()}),Y}(this.onEnterVRButtonClick),V.appendChild(this.enterVREl)),O.enterARButton?(this.enterAREl=document.querySelector(O.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=function(O){var V,Y;return(Y=document.createElement("div")).classList.add("a-enter-ar"),Y.setAttribute(D.AFRAME_INJECTED,""),(V=document.createElement("button")).className="a-enter-ar-button",V.setAttribute("title","Enter AR mode with a headset or handheld device. Visit https://webvr.rocks or https://webvr.info for more information."),V.setAttribute(D.AFRAME_INJECTED,""),B.device.isMobile()&&F(V),Y.appendChild(V),V.addEventListener("click",function(ee){O(),ee.stopPropagation()}),Y}(this.onEnterARButtonClick),V.appendChild(this.enterAREl)),this.orientationModalEl=function(O){var V=document.createElement("div");V.className="a-orientation-modal",V.classList.add(y),V.setAttribute(D.AFRAME_INJECTED,"");var Y=document.createElement("button");return Y.setAttribute(D.AFRAME_INJECTED,""),Y.innerHTML="Exit VR",Y.addEventListener("click",O),V.appendChild(Y),V}(this.onModalClick),V.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(O){O&&O.parentNode&&O.parentNode.removeChild(O)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){!this.enterVREl||(this.el.is("vr-mode")?this.enterVREl.classList.add(y):this.enterVREl.classList.remove(y))},toggleEnterARButtonIfNeeded:function(){!this.enterAREl||(this.el.is("vr-mode")||!B.device.checkARSupport()?this.enterAREl.classList.add(y):this.enterAREl.classList.remove(y))},toggleOrientationModalIfNeeded:function(){var O=this.el,V=this.orientationModalEl;!V||!O.isMobile||(!B.device.isLandscape()&&O.is("vr-mode")?V.classList.remove(y):V.classList.add(y))}})},{"../../constants/":128,"../../core/component":136,"../../utils/":212}],116:[function(k,ae,Ue){var b=k("../core/component"),D=k("../lib/three"),B=k("../utils/bind");ae.exports.Component=(0,b.registerComponent)("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=B(this.update,this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var w=this.data;this.updateDescendants(w.cast,w.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(w,T){var x=this.el.sceneEl;this.el.object3D.traverse(function(S){if(S instanceof D.Mesh&&(S.castShadow=w,S.receiveShadow=T,x.hasLoaded&&S.material))for(var y=Array.isArray(S.material)?S.material:[S.material],M=0;M<y.length;M++)y[M].needsUpdate=!0})}})},{"../core/component":136,"../lib/three":184,"../utils/bind":206}],117:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/debug"),B=k("../lib/three"),I=D("components:sound:warn");ae.exports.Component=b("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var w=this;this.listener=null,this.audioLoader=new B.AudioLoader,this.pool=new B.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){w.playSound()}},update:function(w){var x,S,T=this.data,y=T.src!==w.src;if(y){if(!T.src)return;this.setupSound()}for(x=0;x<this.pool.children.length;x++)S=this.pool.children[x],T.positional&&(S.setDistanceModel(T.distanceModel),S.setMaxDistance(T.maxDistance),S.setRefDistance(T.refDistance),S.setRolloffFactor(T.rolloffFactor)),S.setLoop(T.loop),S.setVolume(T.volume),S.isPaused=!1;if(T.on!==w.on&&this.updateEventListener(w.on),y){var M=this;this.loaded=!1,this.audioLoader.load(T.src,function(E){for(x=0;x<M.pool.children.length;x++)(S=M.pool.children[x]).setBuffer(E);M.loaded=!0,B.Cache.remove(T.src),(M.data.autoplay||M.mustPlay)&&M.playSound(),M.el.emit("sound-loaded",M.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var w;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(w=0;w<this.pool.children.length;w++)this.pool.children[w].disconnect()}catch(x){I("Audio source not properly disconnected")}},updateEventListener:function(w){var T=this.el;w&&T.removeEventListener(w,this.playSoundBound),T.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var T,y,w=this.el,x=w.sceneEl,S=this;this.pool.children.length>0&&(this.stopSound(),w.removeObject3D("sound"));var M=this.listener=x.audioListener||new B.AudioListener;for(x.audioListener=M,x.camera&&x.camera.add(M),x.addEventListener("camera-set-active",function(E){E.detail.cameraEl.getObject3D("camera").add(M)}),this.pool=new B.Group,T=0;T<this.data.poolSize;T++)y=this.data.positional?new B.PositionalAudio(M):new B.Audio(M),this.pool.add(y);for(w.setObject3D(this.attrName,this.pool),T=0;T<this.pool.children.length;T++)(y=this.pool.children[T]).onEnded=function(){this.isPlaying=!1,S.el.emit("sound-ended",S.evtDetail,!1)}},pauseSound:function(){var w,T;for(this.isPlaying=!1,w=0;w<this.pool.children.length;w++)(T=this.pool.children[w]).source&&T.source.buffer&&T.isPlaying&&!T.isPaused&&(T.isPaused=!0,T.pause())},playSound:function(w){var T,x,S;if(!this.loaded)return I("Sound not loaded yet. It will be played once it finished loading"),void(this.mustPlay=!0);for(T=!1,this.isPlaying=!0,x=0;x<this.pool.children.length;x++)if(!(S=this.pool.children[x]).isPlaying&&S.buffer&&!T){w&&w(S),S.play(),S.isPaused=!1,T=!0;continue}T?this.mustPlay=!1:I("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var w,T;for(this.isPlaying=!1,w=0;w<this.pool.children.length;w++){if(!(T=this.pool.children[w]).source||!T.source.buffer)return;T.stop()}}})},{"../core/component":136,"../lib/three":184,"../utils/debug":208}],118:[function(k,ae,Ue){var b=k("three-bmfont-text"),D=k("load-bmfont"),B=k("../core/component").registerComponent,I=k("../core/shader"),w=k("../lib/three"),T=k("../utils/"),x=T.debug("components:text:error"),S=I.shaders,y=T.debug("components:text:warn"),_="https://cdn.aframe.io/fonts/",R={aileronsemibold:_+"Aileron-Semibold.fnt",dejavu:_+"DejaVu-sdf.fnt",exo2bold:_+"Exo2Bold.fnt",exo2semibold:_+"Exo2SemiBold.fnt",kelsonsans:_+"KelsonSans.fnt",monoid:_+"Monoid.fnt",mozillavr:_+"mozillavr.fnt",roboto:_+"Roboto-msdf.json",sourcecodepro:_+"SourceCodePro.fnt"},F=["roboto"],O="roboto";ae.exports.FONTS=R;var fe,je,it,ft,V=new function(){var fe=this.cache={};this.get=function(je,it){return je in fe||(fe[je]=it()),fe[je]}},Y={},ee={},oe=/^\w+:/;function we(fe,je,it){return fe||(.5+je)*it}ae.exports.Component=B("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:O},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:S},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=b(),this.createOrUpdateMaterial()},update:function(fe){var je=this.data,it=this.currentFont;ee[je.font]?this.texture=ee[je.font]:(this.texture=ee[je.font]=new w.Texture,this.texture.anisotropy=16),this.createOrUpdateMaterial(),fe.font===je.font?it&&(this.updateGeometry(this.geometry,it),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var je,ft,_t,fe=this.data,it=this.material,ht=this.shaderData;if(_t=fe.shader,-1!==F.indexOf(fe.font)||fe.font.indexOf("-msdf.")>=0?_t="msdf":fe.font in R&&-1===F.indexOf(fe.font)&&(_t="sdf"),je=(this.shaderObject&&this.shaderObject.name)!==_t,ht.alphaTest=fe.alphaTest,ht.color=fe.color,ht.map=this.texture,ht.opacity=fe.opacity,ht.side=function(fe){switch(fe){case"back":return w.FrontSide;case"double":return w.DoubleSide;default:return w.BackSide}}(fe.side),ht.transparent=fe.transparent,ht.negate=fe.negate,!je)return this.shaderObject.update(ht),it.transparent=ht.transparent,void(it.side=ht.side);ft=function(fe,je,it){var ft,ht;return(ht=new S[je].Shader).el=fe,ht.init(it),ht.update(it),(ft=ht.material).transparent=it.transparent,{material:ft,shader:ht}}(this.el,_t,ht),this.material=ft.material,this.shaderObject=ft.shader,this.material.side=ht.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var it,fe=this.data,je=this.el,ft=this.geometry,ht=this;fe.font||y("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),it=this.lookupFont(fe.font||O)||fe.font,V.get(it,function(){return function(fe,je){return new Promise(function(it,ft){D(fe,function(ht,_t){if(ht)return x("Error loading font",fe),void ft(ht);fe.indexOf("/Roboto-msdf.json")>=0&&(je=30),je&&_t.chars.map(function(_n){_n.yoffset+=je}),it(_t)})})}(it,fe.yOffset)}).then(function(Bt){var _n;if(1!==Bt.pages.length)throw new Error("Currently only single-page bitmap fonts are supported.");Y[it]||(Bt.widthFactor=Y[Bt]=function(fe){var je=0,it=0,ft=0;return fe.chars.map(function(ht){je+=ht.xadvance,ht.id>=48&&ht.id<=57&&(ft++,it+=ht.xadvance)}),ft?it/ft:je/fe.chars.length}(Bt)),ht.currentFont=Bt,_n=ht.getFontImageSrc(),V.get(_n,function(){return function(fe){return new Promise(function(je,it){(new w.ImageLoader).load(fe,function(ft){je(ft)},void 0,function(){x("Error loading font image",fe),it(null)})})}(_n)}).then(function(kn){var Dn=ht.texture;Dn.image=kn,Dn.needsUpdate=!0,ee[fe.font]=Dn,ht.texture=Dn,ht.initMesh(),ht.currentFont=Bt,ht.updateGeometry(ft,Bt),ht.updateLayout(),ht.mesh.visible=!0,je.emit("textfontset",{font:fe.font,fontObj:Bt})}).catch(function(kn){x(kn.message),x(kn.stack)})}).catch(function(_t){x(_t.message),x(_t.stack)})},initMesh:function(){this.mesh||(this.mesh=new w.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var fe=this.lookupFont(this.data.font||O)||this.data.font,je=this.currentFont.pages[0];return je.match(oe)&&0!==je.indexOf("http")?fe.replace(/(\.fnt)|(\.json)/,".png"):w.LoaderUtils.extractUrlBase(fe)+je},updateLayout:function(){var fe,je,_t,Bt,_n,vi,bn,qn,_r,it=this.el,ft=this.data,ht=this.geometry,kn=this.mesh;if(kn&&ht.layout){if(_t=it.getAttribute("geometry"),Bt=(vi=(bn=ft.width||_t&&_t.width||1)/we(ft.wrapPixels,ft.wrapCount,this.currentFont.widthFactor))*((_n=ht.layout).height+_n.descender),_t&&"plane"===_t.primitive&&(_t.width||it.setAttribute("geometry","width",bn),_t.height||it.setAttribute("geometry","height",Bt)),"left"===(fe="align"===ft.anchor?ft.align:ft.anchor))qn=0;else if("right"===fe)qn=-1*_n.width;else{if("center"!==fe)throw new TypeError("Invalid text.anchor property value",fe);qn=-1*_n.width/2}if("bottom"===(je=ft.baseline))_r=0;else if("top"===je)_r=-1*_n.height+_n.ascender;else{if("center"!==je)throw new TypeError("Invalid text.baseline property value",je);_r=-1*_n.height/2}kn.position.x=qn*vi+ft.xOffset,kn.position.y=_r*vi,kn.position.z=ft.zOffset,kn.scale.set(vi,-1*vi,vi)}},lookupFont:function(fe){return R[fe]},updateGeometry:(fe={},je={},it=/\\n/g,ft=/\\t/g,function(ht,_t){var Bt=this.data;je.font=_t,je.lineHeight=Bt.lineHeight&&isFinite(Bt.lineHeight)?Bt.lineHeight:_t.common.lineHeight,je.text=Bt.value.toString().replace(it,"\n").replace(ft,"\t"),je.width=we(Bt.wrapPixels,Bt.wrapCount,_t.widthFactor),ht.update(T.extend(fe,Bt,je))})})},{"../core/component":136,"../core/shader":146,"../lib/three":184,"../utils/":212,"load-bmfont":37,"three-bmfont-text":64}],119:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/tracked-controls"),B=k("../constants").DEFAULT_CAMERA_HEIGHT,I=k("../lib/three"),w=k("../constants").DEFAULT_HANDEDNESS,T_x=.175,T_y=-.3,T_z=-.03,x_x=0,x_y=0,x_z=-.175,S={touches:[]},y_AXISMOVE="axismove",y_BUTTONCHANGED="buttonchanged",y_BUTTONDOWN="buttondown",y_BUTTONUP="buttonup",y_TOUCHSTART="touchstart",y_TOUCHEND="touchend";ae.exports.Component=b("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new I.Vector3,this.controllerQuaternion=new I.Quaternion,this.controllerEuler=new I.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(M,E){var _=this.el.getObject3D("mesh");_&&_.update&&_.update(E/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return B},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var M=this.data,E=D.findMatchingControllerWebVR(this.system.controllers,M.id,M.idPrefix,M.hand,M.controller);this.controller=E,this.el.components["tracked-controls"].controller=E,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(M){var O,Y,ee,oe,E=this.controller,_=this.controllerEuler,R=this.controllerQuaternion,F=this.deltaControllerPosition;Y=this.getHeadElement().object3D,oe=this.defaultUserHeight(),ee=E.pose,O=(E?E.hand:void 0)||w,M.copy(Y.position),F.set(T_x*("left"===O?-1:"right"===O?1:0),T_y,T_z),F.multiplyScalar(oe),F.applyAxisAngle(Y.up,Y.rotation.y),M.add(F),F.set(x_x,x_y,x_z),F.multiplyScalar(oe),ee.orientation?R.fromArray(ee.orientation):R.copy(Y.quaternion),_.setFromQuaternion(R),_.set(_.x,_.y,0),F.applyEuler(_),M.add(F)},updatePose:function(){var R,O,M=this.controller,E=this.data,_=this.el.object3D,F=this.system.vrDisplay;!M||((R=M.pose).position?_.position.fromArray(R.position):E.armModel&&this.applyArmModel(_.position),R.orientation&&_.quaternion.fromArray(R.orientation),F&&R.position&&(O=this.el.sceneEl.renderer.xr.getStandingMatrix(),_.matrix.compose(_.position,_.quaternion,_.scale),_.matrix.multiplyMatrices(O,_.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),_.rotateX(this.data.orientationOffset.x*I.Math.DEG2RAD),_.rotateY(this.data.orientationOffset.y*I.Math.DEG2RAD),_.rotateZ(this.data.orientationOffset.z*I.Math.DEG2RAD))},updateButtons:function(){var _,E=this.controller;if(E){for(_=0;_<E.buttons.length;++_)this.buttonStates[_]||(this.buttonStates[_]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[_]||(this.buttonEventDetails[_]={id:_,state:this.buttonStates[_]}),this.handleButton(_,E.buttons[_]);this.handleAxes()}},handleButton:function(M,E){return!!(this.handlePress(M,E)|this.handleTouch(M,E)|this.handleValue(M,E))&&(this.el.emit(y_BUTTONCHANGED,this.buttonEventDetails[M],!1),!0)},handleAxes:function(){var _,M=!1,E=this.controller.axes,R=this.axis,F=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),_=0;_<E.length;++_)F.push(R[_]!==E[_]),F[_]&&(M=!0);if(!M)return!1;for(this.axis.splice(0,this.axis.length),_=0;_<E.length;_++)this.axis.push(E[_]);return this.el.emit(y_AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(M,E){var R=this.buttonStates[M];return E.pressed!==R.pressed&&(this.el.emit(E.pressed?y_BUTTONDOWN:y_BUTTONUP,this.buttonEventDetails[M],!1),R.pressed=E.pressed,!0)},handleTouch:function(M,E){var R=this.buttonStates[M];return E.touched!==R.touched&&(this.el.emit(E.touched?y_TOUCHSTART:y_TOUCHEND,this.buttonEventDetails[M],!1,S),R.touched=E.touched,!0)},handleValue:function(M,E){var _=this.buttonStates[M];return E.value!==_.value&&(_.value=E.value,!0)}})},{"../constants":128,"../core/component":136,"../lib/three":184,"../utils/tracked-controls":221}],120:[function(k,ae,Ue){var b=k("../utils/tracked-controls"),D=k("../core/component").registerComponent,B_AXISMOVE="axismove",B_BUTTONCHANGED="buttonchanged",B_BUTTONDOWN="buttondown",B_BUTTONUP="buttonup",B_TOUCHSTART="touchstart",B_TOUCHEND="touchend";ae.exports.Component=D("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var I=this.el.sceneEl;this.updateController(),I.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(I){return!(!this.controller||this.controller.gamepad||"none"!==I.inputSource.handedness&&I.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=b.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var I=this.el.sceneEl,w=this.controller;!w||!I.frame||!this.system.referenceSpace||w.hand||(this.pose=I.frame.getPose(w.targetRaySpace,this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var I=this.el.object3D,w=this.pose;!w||(I.matrix.elements=w.transform.matrix,I.matrix.decompose(I.position,I.rotation,I.scale))},updateButtons:function(){var w,x,T=this.controller;if(T&&T.gamepad){for(x=T.gamepad,w=0;w<x.buttons.length;++w)this.buttonStates[w]||(this.buttonStates[w]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[w]||(this.buttonEventDetails[w]={id:w,state:this.buttonStates[w]}),this.handleButton(w,x.buttons[w]);this.handleAxes()}},handleButton:function(I,w){return!!(this.handlePress(I,w)|this.handleTouch(I,w)|this.handleValue(I,w))&&(this.el.emit(B_BUTTONCHANGED,this.buttonEventDetails[I],!1),!0)},handleAxes:function(){var T,I=!1,w=this.controller.gamepad.axes,x=this.axis,S=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),T=0;T<w.length;++T)S.push(x[T]!==w[T]),S[T]&&(I=!0);if(!I)return!1;for(this.axis.splice(0,this.axis.length),T=0;T<w.length;T++)this.axis.push(w[T]);return this.el.emit(B_AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(I,w){var x=this.buttonStates[I];return w.pressed!==x.pressed&&(this.el.emit(w.pressed?B_BUTTONDOWN:B_BUTTONUP,this.buttonEventDetails[I],!1),x.pressed=w.pressed,!0)},handleTouch:function(I,w){var x=this.buttonStates[I];return w.touched!==x.touched&&(this.el.emit(w.touched?B_TOUCHSTART:B_TOUCHEND,this.buttonEventDetails[I],!1),x.touched=w.touched,!0)},handleValue:function(I,w){var T=this.buttonStates[I];return w.value!==T.value&&(T.value=w.value,!0)}})},{"../core/component":136,"../utils/tracked-controls":221}],121:[function(k,ae,Ue){var b=k("../core/component").registerComponent;ae.exports.Component=b("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1}},update:function(){var D=this.data,B=this.el;B.sceneEl.hasWebXR?B.setAttribute("tracked-controls-webxr",{id:D.id,hand:D.hand,index:D.controller,iterateControllerProfiles:D.iterateControllerProfiles,handTrackingEnabled:D.handTrackingEnabled}):B.setAttribute("tracked-controls-webvr",D)}})},{"../core/component":136}],122:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../lib/three"),I=k("../utils/tracked-controls"),w=I.checkControllerPresentAndSetup,T=I.emitIfAxesChanged,x=I.onButtonEvent,S="https://cdn.aframe.io/controllers/valve/index/valve-index-",y={left:S+"left.glb",right:S+"right.glb"},M="valve",E=k("../utils/").device.isWebXRAvailable,O={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},V=E?O:{left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},Y=E?{left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}}:{left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}};ae.exports.Component=b("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var ee=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(oe){x(oe.detail.id,"down",ee)},this.onButtonUp=function(oe){x(oe.detail.id,"up",ee)},this.onButtonTouchEnd=function(oe){x(oe.detail.id,"touchend",ee)},this.onButtonTouchStart=function(oe){x(oe.detail.id,"touchstart",ee)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},addEventListeners:function(){var ee=this.el;ee.addEventListener("buttonchanged",this.onButtonChanged),ee.addEventListener("buttondown",this.onButtonDown),ee.addEventListener("buttonup",this.onButtonUp),ee.addEventListener("touchend",this.onButtonTouchEnd),ee.addEventListener("touchstart",this.onButtonTouchStart),ee.addEventListener("model-loaded",this.onModelLoaded),ee.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var ee=this.el;ee.removeEventListener("buttonchanged",this.onButtonChanged),ee.removeEventListener("buttondown",this.onButtonDown),ee.removeEventListener("buttonup",this.onButtonUp),ee.removeEventListener("touchend",this.onButtonTouchEnd),ee.removeEventListener("touchstart",this.onButtonTouchStart),ee.removeEventListener("model-loaded",this.onModelLoaded),ee.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var ee=this.data;w(this,M,{index:"right"===ee.hand?0:"left"===ee.hand?1:2,iterateControllerProfiles:!0,hand:ee.hand})},injectTrackedControls:function(){var oe=this.data;this.el.setAttribute("tracked-controls",{idPrefix:M,controller:"right"===oe.hand?1:"left"===oe.hand?0:2,hand:oe.hand,orientationOffset:oe.orientationOffset}),this.loadModel()},loadModel:function(){var ee=this.data;!ee.model||this.el.setAttribute("gltf-model",""+y[ee.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(ee){var oe=this.mapping.buttons[ee.detail.id],Ee=this.buttonMeshes;!oe||("trigger"===oe&&Ee&&Ee.trigger&&(Ee.trigger.rotation.x=this.triggerOriginalRotationX-ee.detail.state.value*(Math.PI/40)),this.el.emit(oe+"changed",ee.detail.state))},onModelLoaded:function(ee){var oe,Ee=ee.detail.model,ve=this;!this.data.model||((oe=this.buttonMeshes={}).grip={left:Ee.getObjectByName("leftgrip"),right:Ee.getObjectByName("rightgrip")},oe.menu=Ee.getObjectByName("menubutton"),oe.system=Ee.getObjectByName("systembutton"),oe.trackpad=Ee.getObjectByName("touchpad"),oe.trigger=Ee.getObjectByName("trigger"),this.triggerOriginalRotationX=oe.trigger.rotation.x,Object.keys(oe).forEach(function(Ce){ve.setButtonColor(Ce,ve.data.buttonColor)}),Ee.position.copy(Y[this.data.hand]),Ee.rotation.copy(V[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controlls",model:this.data.model,rayOrigin:new B.Vector3(0,0,0)}))},onAxisMoved:function(ee){T(this,this.mapping.axes,ee)},updateModel:function(ee,oe){!this.data.model||-1===oe.indexOf("touch")&&this.setButtonColor(ee,"up"===oe?this.data.buttonColor:this.data.buttonHighlightColor)},setButtonColor:function(ee,oe){}})},{"../core/component":136,"../lib/three":184,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],123:[function(k,ae,Ue){var b=k("../core/component").registerComponent;ae.exports.Component=b("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},{"../core/component":136}],124:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,y=k("../utils/").device.isWebXRAvailable,_=y?"htc-vive":"OpenVR ";ae.exports.Component=b("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:y?{axes:{thumbstick:[0,1]},buttons:["trigger","grip","trackpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},init:function(){var V=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(Y){T(Y.detail.id,"down",V)},this.onButtonUp=function(Y){T(Y.detail.id,"up",V)},this.onButtonTouchEnd=function(Y){T(Y.detail.id,"touchend",V)},this.onButtonTouchStart=function(Y){T(Y.detail.id,"touchstart",V)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var V=this.data;this.controllerIndex="right"===V.hand?0:"left"===V.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},addEventListeners:function(){var V=this.el;V.addEventListener("buttonchanged",this.onButtonChanged),V.addEventListener("buttondown",this.onButtonDown),V.addEventListener("buttonup",this.onButtonUp),V.addEventListener("touchend",this.onButtonTouchEnd),V.addEventListener("touchstart",this.onButtonTouchStart),V.addEventListener("model-loaded",this.onModelLoaded),V.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var V=this.el;V.removeEventListener("buttonchanged",this.onButtonChanged),V.removeEventListener("buttondown",this.onButtonDown),V.removeEventListener("buttonup",this.onButtonUp),V.removeEventListener("touchend",this.onButtonTouchEnd),V.removeEventListener("touchstart",this.onButtonTouchStart),V.removeEventListener("model-loaded",this.onModelLoaded),V.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,_,{index:this.controllerIndex,hand:this.data.hand})},injectTrackedControls:function(){var Y=this.data;this.el.setAttribute("tracked-controls",{idPrefix:_,hand:Y.hand,controller:this.controllerIndex,orientationOffset:Y.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",mtl:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl"})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(V){var Y=this.mapping.buttons[V.detail.id],ee=this.buttonMeshes;!Y||("trigger"===Y&&ee&&ee.trigger&&(ee.trigger.rotation.x=-V.detail.state.value*(Math.PI/12)),this.el.emit(Y+"changed",V.detail.state))},onModelLoaded:function(V){var Y,ee=V.detail.model,oe=this;!this.data.model||((Y=this.buttonMeshes={}).grip={left:ee.getObjectByName("leftgrip"),right:ee.getObjectByName("rightgrip")},Y.menu=ee.getObjectByName("menubutton"),Y.system=ee.getObjectByName("systembutton"),Y.trackpad=ee.getObjectByName("touchpad"),Y.trigger=ee.getObjectByName("trigger"),Object.keys(Y).forEach(function(Ee){oe.setButtonColor(Ee,oe.data.buttonColor)}),ee.position.set(0,-.015,.04))},onAxisMoved:function(V){w(this,this.mapping.axes,V)},updateModel:function(V,Y){!this.data.model||-1===Y.indexOf("touch")&&this.setButtonColor(V,"up"===Y?this.data.buttonColor:this.data.buttonHighlightColor)},setButtonColor:function(V,Y){var ee=this.buttonMeshes,oe=this.rendererSystem;if(ee){if("grip"===V)return ee.grip.left.material.color.set(Y),ee.grip.right.material.color.set(Y),oe.applyColorCorrection(ee.grip.left.material.color),void oe.applyColorCorrection(ee.grip.right.material.color);ee[V].material.color.set(Y),oe.applyColorCorrection(ee[V].material.color)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],125:[function(k,ae,Ue){var b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,x="HTC Vive Focus";ae.exports.Component=b("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=D(this.removeControllersUpdateListener,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var y=this;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(M){T(M.detail.id,"down",y)},this.onButtonUp=function(M){T(M.detail.id,"up",y)},this.onButtonTouchStart=function(M){T(M.detail.id,"touchstart",y)},this.onButtonTouchEnd=function(M){T(M.detail.id,"touchend",y)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var y=this.el;y.addEventListener("buttonchanged",this.onButtonChanged),y.addEventListener("buttondown",this.onButtonDown),y.addEventListener("buttonup",this.onButtonUp),y.addEventListener("touchstart",this.onButtonTouchStart),y.addEventListener("touchend",this.onButtonTouchEnd),y.addEventListener("model-loaded",this.onModelLoaded),y.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var y=this.el;y.removeEventListener("buttonchanged",this.onButtonChanged),y.removeEventListener("buttondown",this.onButtonDown),y.removeEventListener("buttonup",this.onButtonUp),y.removeEventListener("touchstart",this.onButtonTouchStart),y.removeEventListener("touchend",this.onButtonTouchEnd),y.removeEventListener("model-loaded",this.onModelLoaded),y.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){I(this,x,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var M=this.data;this.el.setAttribute("tracked-controls",{armModel:M.armModel,idPrefix:x,orientationOffset:M.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/vive/focus-controller/focus-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(y){var E,M=y.detail.model;!this.data.model||((E=this.buttonMeshes={}).trigger=M.getObjectByName("BumperKey"),E.triggerPressed=M.getObjectByName("BumperKey_Press"),E.triggerPressed&&(E.triggerPressed.visible=!1),E.trackpad=M.getObjectByName("TouchPad"),E.trackpadPressed=M.getObjectByName("TouchPad_Press"),E.trackpadPressed&&(E.trackpadPressed.visible=!1))},onButtonChanged:function(y){var M=this.mapping.buttons[y.detail.id];!M||this.el.emit(M+"changed",y.detail.state)},onAxisMoved:function(y){w(this,this.mapping.axes,y)},updateModel:function(y,M){!this.data.model||this.updateButtonModel(y,M)},updateButtonModel:function(y,M){var E=this.buttonMeshes,_=y+"Pressed";if(E&&E[y]&&E[_]){var R;switch(M){case"down":R=this.data.buttonHighlightColor;break;case"touchstart":R=this.data.buttonTouchedColor}R&&E[_].material.color.set(R),E[_].visible=!!R,E[y].visible=!R}}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],126:[function(k,ae,Ue){var E,_,b=k("../constants").keyboardevent.KEYCODE_TO_CODE,D=k("../core/component").registerComponent,B=k("../lib/three"),I=k("../utils/"),w=I.bind,T=I.shouldCaptureKeyEvent,x=1e-5,y=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];ae.exports.Component=D("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function(){this.keys={},this.easing=1.1,this.velocity=new B.Vector3,this.onBlur=w(this.onBlur,this),this.onContextMenu=w(this.onContextMenu,this),this.onFocus=w(this.onFocus,this),this.onKeyDown=w(this.onKeyDown,this),this.onKeyUp=w(this.onKeyUp,this),this.onVisibilityChange=w(this.onVisibilityChange,this),this.attachVisibilityEventListeners()},tick:function(E,_){var R=this.data,F=this.el,O=this.velocity;!O[R.adAxis]&&!O[R.wsAxis]&&function(E){var _;for(_ in E)return!1;return!0}(this.keys)||(this.updateVelocity(_/=1e3),(O[R.adAxis]||O[R.wsAxis])&&F.object3D.position.add(this.getMovementVector(_)))},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(E){var _,R,F,ee,oe,O=this.data,V=this.keys,Y=this.velocity;if(R=O.adAxis,ee=O.wsAxis,E>.2)return Y[R]=0,void(Y[ee]=0);var Ee=Math.pow(1/this.easing,60*E);0!==Y[R]&&(Y[R]=Y[R]*Ee),0!==Y[ee]&&(Y[ee]=Y[ee]*Ee),Math.abs(Y[R])<x&&(Y[R]=0),Math.abs(Y[ee])<x&&(Y[ee]=0),O.enabled&&(_=O.acceleration,O.adEnabled&&(F=O.adInverted?-1:1,(V.KeyA||V.ArrowLeft)&&(Y[R]-=F*_*E),(V.KeyD||V.ArrowRight)&&(Y[R]+=F*_*E)),O.wsEnabled&&(oe=O.wsInverted?-1:1,(V.KeyW||V.ArrowUp)&&(Y[ee]-=oe*_*E),(V.KeyS||V.ArrowDown)&&(Y[ee]+=oe*_*E)))},getMovementVector:(E=new B.Vector3(0,0,0),_=new B.Euler(0,0,0,"YXZ"),function(R){var F=this.el.getAttribute("rotation");return E.copy(this.velocity),E.multiplyScalar(R),F&&(_.set(B.Math.degToRad(this.data.fly?F.x:0),B.Math.degToRad(F.y),0),E.applyEuler(_)),E}),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var E=Object.keys(this.keys),_=0;_<E.length;_++)delete this.keys[E[_]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(E){var _;!T(E)||-1!==y.indexOf(_=E.code||b[E.keyCode])&&(this.keys[_]=!0)},onKeyUp:function(E){delete this.keys[E.code||b[E.keyCode]]}})},{"../constants":128,"../core/component":136,"../lib/three":184,"../utils/":212}],127:[function(k,ae,Ue){var ve,b=k("../core/component").registerComponent,D=k("../utils/bind"),B=k("../utils/tracked-controls"),I=B.checkControllerPresentAndSetup,w=B.emitIfAxesChanged,T=B.onButtonEvent,x=k("../utils/"),S=x.debug("components:windows-motion-controls:debug"),y=x.debug("components:windows-motion-controls:warn"),M=k("../constants").DEFAULT_HANDEDNESS,_={left:"left.glb",right:"right.glb",default:"universal.glb"},R=k("../utils/").device.isWebXRAvailable,V=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,Y=R?"windows-mixed-reality":"Spatial Controller (Spatial Interaction Source) ";ae.exports.Component=b("windows-motion-controls",{schema:{hand:{default:M},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:R?{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"}:{axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=D(this.onModelError,this),this.onModelLoaded=D(this.onModelLoaded,this),this.onControllersUpdate=D(this.onControllersUpdate,this),this.checkIfControllerPresent=D(this.checkIfControllerPresent,this),this.onAxisMoved=D(this.onAxisMoved,this)},init:function(){var ve=this,Ce=this.el;this.onButtonChanged=D(this.onButtonChanged,this),this.onButtonDown=function(He){T(He.detail.id,"down",ve)},this.onButtonUp=function(He){T(He.detail.id,"up",ve)},this.onButtonTouchStart=function(He){T(He.detail.id,"touchstart",ve)},this.onButtonTouchEnd=function(He){T(He.detail.id,"touchend",ve)},this.onControllerConnected=function(){ve.setModelVisibility(!0)},this.onControllerDisconnected=function(){ve.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},Ce.addEventListener("controllerconnected",this.onControllerConnected),Ce.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var ve=this.el;ve.addEventListener("buttonchanged",this.onButtonChanged),ve.addEventListener("buttondown",this.onButtonDown),ve.addEventListener("buttonup",this.onButtonUp),ve.addEventListener("touchstart",this.onButtonTouchStart),ve.addEventListener("touchend",this.onButtonTouchEnd),ve.addEventListener("axismove",this.onAxisMoved),ve.addEventListener("model-error",this.onModelError),ve.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var ve=this.el;ve.removeEventListener("buttonchanged",this.onButtonChanged),ve.removeEventListener("buttondown",this.onButtonDown),ve.removeEventListener("buttonup",this.onButtonUp),ve.removeEventListener("touchstart",this.onButtonTouchStart),ve.removeEventListener("touchend",this.onButtonTouchEnd),ve.removeEventListener("axismove",this.onAxisMoved),ve.removeEventListener("model-error",this.onModelError),ve.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){I(this,Y,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var ve=this.createControllerModelUrl();this.loadModel(ve)}else this.modelReady()},createControllerModelUrl:function(ve){var Ce=this.el.components["tracked-controls"],He=Ce?Ce.controller:null,we="default",ce=this.data.hand;if(He&&!window.hasNativeWebXRImplementation&&(ce=He.hand,!ve)){var fe=He.id.match(V);we=fe&&fe[0]||we}return"https://cdn.aframe.io/controllers/microsoft/"+we+"/"+(_[ce]||_.default)},injectTrackedControls:function(){var ve=this.data;this.el.setAttribute("tracked-controls",{idPrefix:Y,controller:ve.pair,hand:ve.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(ve){var Ce=this.createControllerModelUrl(!0);ve.detail.src!==Ce?(y("Failed to load controller model for device, attempting to load default."),this.loadModel(Ce)):y("Failed to load default controller model.")},loadModel:function(ve){this.el.setAttribute("gltf-model","url("+ve+")")},onModelLoaded:function(ve){var we,ce,Me,fe,Ce=this.controllerModel=ve.detail.model,He=this.loadedMeshInfo;if(S("Processing model"),He.buttonMeshes={},He.axisMeshes={},Ce){for(we=0;we<this.mapping.buttons.length;we++)(ce=this.mapping.buttonMeshNames[this.mapping.buttons[we]])?(Me=Ce.getObjectByName(ce))?(fe={index:we,value:je(Me,"VALUE"),pressed:je(Me,"PRESSED"),unpressed:je(Me,"UNPRESSED")}).value&&fe.pressed&&fe.unpressed?He.buttonMeshes[this.mapping.buttons[we]]=fe:y("Missing button submesh under mesh with name: "+ce+"(VALUE: "+!!fe.value+", PRESSED: "+!!fe.pressed+", UNPRESSED:"+!!fe.unpressed+")"):y("Missing button mesh with name: "+ce):S("Skipping unknown button at index: "+we+" with mapped name: "+this.mapping.buttons[we]);for(we=0;we<this.mapping.axisMeshNames.length;we++)(ce=this.mapping.axisMeshNames[we])?(Me=Ce.getObjectByName(ce))?(fe={index:we,value:je(Me,"VALUE"),min:je(Me,"MIN"),max:je(Me,"MAX")}).value&&fe.min&&fe.max?He.axisMeshes[we]=fe:y("Missing axis submesh under mesh with name: "+ce+"(VALUE: "+!!fe.value+", MIN: "+!!fe.min+", MAX:"+!!fe.max+")"):y("Missing axis mesh with name: "+ce):S("Skipping unknown axis at index: "+we);this.calculateRayOriginFromMesh(Ce),this.setModelVisibility()}function je(it,ft){for(var ht=0,_t=it.children.length;ht<_t;ht++){var Bt=it.children[ht];if(Bt&&Bt.name===ft)return Bt}}S("Model load complete.")},calculateRayOriginFromMesh:(ve=new THREE.Quaternion,function(Ce){var He;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,He=Ce.getObjectByName(this.mapping.pointingPoseMeshName)){var we=Ce.parent;we&&(Ce.parent=null,Ce.updateMatrixWorld(!0),Ce.parent=we),He.getWorldPosition(this.rayOrigin.origin),He.getWorldQuaternion(ve),this.rayOrigin.direction.applyQuaternion(ve),we&&Ce.updateMatrixWorld(!0)}else S("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}),lerpAxisTransform:function(){var ve=new THREE.Quaternion;return function(Ce,He){var we=this.loadedMeshInfo.axisMeshes[Ce];if(we){var ce=we.min,Me=we.max,fe=we.value,je=.5*He+.5;fe.setRotationFromQuaternion(ve.copy(ce.quaternion).slerp(Me.quaternion,je)),fe.position.lerpVectors(ce.position,Me.position,je)}}}(),lerpButtonTransform:function(){var ve=new THREE.Quaternion;return function(Ce,He){var we=this.loadedMeshInfo.buttonMeshes[Ce];if(we){var ce=we.unpressed,Me=we.pressed,fe=we.value;fe.setRotationFromQuaternion(ve.copy(ce.quaternion).slerp(Me.quaternion,He)),fe.position.lerpVectors(ce.position,Me.position,He)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(ve){var Ce=this.mapping.buttons[ve.detail.id];Ce&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(Ce,ve.detail.state.value),this.el.emit(Ce+"changed",ve.detail.state))},onAxisMoved:function(ve){var Ce=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var He=0;He<Ce;He++)this.lerpAxisTransform(He,ve.detail.axis[He]||0);w(this,this.mapping.axes,ve)},setModelVisibility:function(ve){var Ce=this.el.getObject3D("mesh");this.modelVisible=ve=void 0!==ve?ve:this.modelVisible,Ce&&(Ce.visible=ve)}})},{"../constants":128,"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],128:[function(k,ae,Ue){ae.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:k("./keyboardevent")}},{"./keyboardevent":129}],129:[function(k,ae,Ue){ae.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},{}],130:[function(k,ae,Ue){var b=k("./a-node"),D=k("../utils/bind"),B=k("../utils/debug"),I=k("./a-register-element").registerElement,w=k("../lib/three"),T=new w.FileLoader,x=B("core:a-assets:warn");function S(F){if(F.hasAttribute("autoplay")||"auto"===F.getAttribute("preload"))return new Promise(function(O,V){if(4===F.readyState)return O();if(F.error)return V();function Y(){for(var ee=0,oe=0;oe<F.buffered.length;oe++)ee+=F.buffered.end(oe)-F.buffered.start(oe);ee>=F.duration&&("VIDEO"===F.tagName&&w.Cache.add(F.getAttribute("src"),F),O())}F.addEventListener("loadeddata",Y,!1),F.addEventListener("progress",Y,!1),F.addEventListener("error",V,!1)})}function y(F){var O=function(F){var V;return F.hasAttribute("crossorigin")||null!==(V=F.getAttribute("src"))&&(-1===V.indexOf("://")||function(F){var O=F.indexOf("://")>-1?F.split("/")[2]:F.split("/")[0];return O.substring(0,O.indexOf(":"))}(V)===window.location.host)?F:(x('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',V),F.crossOrigin="anonymous",F.cloneNode(!0))}(F);return O.tagName&&"video"===O.tagName.toLowerCase()&&(O.setAttribute("playsinline",""),O.setAttribute("webkit-playsinline","")),O!==F&&(F.parentNode.appendChild(O),F.parentNode.removeChild(F)),O}function _(F){var O=R(F),V=O.lastIndexOf(".");return V>=0&&".glb"===O.slice(V,F.search(/\?|#|$/))?"arraybuffer":"text"}function R(F){var O=document.createElement("a");O.href=F;var V=O.search.replace(/^\?/,""),Y=F.replace(V,"").replace("?","");return Y.substring(Y.lastIndexOf("/")+1)}ae.exports=I("a-assets",{prototype:Object.create(b.prototype,{createdCallback:{value:function(){this.isAssets=!0,this.fileLoader=T,this.timeout=null}},attachedCallback:{value:function(){var O,Y,ee,oe,Ee,ve,F=this,V=[];if(!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(Ee=this.querySelectorAll("img"),O=0;O<Ee.length;O++)oe=y(Ee[O]),V.push(new Promise(function(Ce,He){w.Cache.add(Ee[O].getAttribute("src"),oe),oe.onload=Ce,oe.onerror=He}));for(ee=this.querySelectorAll("audio, video"),O=0;O<ee.length;O++)!(Y=y(ee[O])).src&&!Y.srcObject&&x("Audio/video asset has neither `src` nor `srcObject` attributes."),V.push(S(Y));Promise.all(V).then(D(this.load,this)),ve=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){F.hasLoaded||(x("Asset loading timed out in ",ve,"ms"),F.emit("timeout"),F.load())},ve)}},detachedCallback:{value:function(){this.timeout&&clearTimeout(this.timeout)}},load:{value:function(){b.prototype.load.call(this,null,function(O){return O.isAssetItem&&O.hasAttribute("src")})}}})}),I("a-asset-item",{prototype:Object.create(b.prototype,{createdCallback:{value:function(){this.data=null,this.isAssetItem=!0}},attachedCallback:{value:function(){var F=this,O=this.getAttribute("src");T.setResponseType(this.getAttribute("response-type")||_(O)),T.load(O,function(Y){F.data=Y,setTimeout(function(){b.prototype.load.call(F)})},function(Y){F.emit("progress",{loadedBytes:Y.loaded,totalBytes:Y.total,xhr:Y})},function(Y){F.emit("error",{xhr:Y})})}}})}),ae.exports.inferResponseType=_,ae.exports.getFileNameFromURL=R},{"../lib/three":184,"../utils/bind":206,"../utils/debug":208,"./a-node":134,"./a-register-element":135}],131:[function(k,ae,Ue){var b=k("../utils/debug"),D=k("./a-register-element").registerElement,B=b("core:cubemap:warn");ae.exports=D("a-cubemap",{prototype:Object.create(window.HTMLElement.prototype,{attachedCallback:{value:function(){this.srcs=this.validate()},writable:window.debug},validate:{value:function(){var w,I=this.querySelectorAll("[src]"),T=[];if(6===I.length){for(w=0;w<I.length;w++)T.push(I[w].getAttribute("src"));return T}B("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")},writable:window.debug}})})},{"../utils/debug":208,"./a-register-element":135}],132:[function(k,ae,Ue){var T,ee,b=k("./a-node"),D=k("./component").components,B=k("./a-register-element").registerElement,I=k("../lib/three"),w=k("../utils/"),x=w.debug("core:a-entity:debug"),S=w.debug("core:a-entity:warn"),y="__",M=["position","rotation","scale","visible"],E={once:!0},_=Object.create(b.prototype,{createdCallback:{value:function(){this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new I.Group,this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}},attributeChangedCallback:{value:function(ee,oe,Ee){var ve=this.components[ee];ve&&ve.justInitialized&&""===Ee?delete ve.justInitialized:!ve&&null===Ee||this.setEntityAttribute(ee,oe,Ee)}},attachedCallback:{value:function(){var ee,oe=this.sceneEl,Ee=this;if(this.addToParent(),!this.isScene){if(!oe)return void this.load();if((ee=oe.querySelector("a-assets"))&&!ee.hasLoaded)return void ee.addEventListener("loaded",function(){Ee.load()});this.load()}}},detachedCallback:{value:function(){var ee;if(this.parentEl){for(ee in this.components)this.removeComponent(ee,!1);this.isScene||(this.removeFromParent(),b.prototype.detachedCallback.call(this),this.object3D.el=null)}}},getObject3D:{value:function(ee){return this.object3DMap[ee]}},setObject3D:{value:function(ee,oe){var Ee,ve=this;if(!(oe instanceof I.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(Ee=this.getObject3D(ee))&&this.object3D.remove(Ee),oe.el=this,oe.children.length&&oe.traverse(function(He){He.el=ve}),this.object3D.add(oe),this.object3DMap[ee]=oe,this.emit("object3dset",{object:oe,type:ee})}},removeObject3D:{value:function(ee){var oe=this.getObject3D(ee);oe?(this.object3D.remove(oe),delete this.object3DMap[ee],this.emit("object3dremove",{type:ee})):S("Tried to remove `Object3D` of type:",ee,"which was not defined.")}},getOrCreateObject3D:{value:function(ee,oe){var Ee=this.getObject3D(ee);return!Ee&&oe&&(Ee=new oe,this.setObject3D(ee,Ee)),S("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),Ee}},add:{value:function(ee){if(!ee.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(ee.object3D),this.emit("child-attached",{el:ee})}},addToParent:{value:function(){var ee=this.parentEl=this.parentNode;!ee||!ee.add||this.attachedToParent||(ee.add(this),this.attachedToParent=!0)}},removeFromParent:{value:function(){var ee=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,ee.emit("child-detached",{el:this})}},load:{value:function(){var ee=this;this.hasLoaded||!this.parentEl||b.prototype.load.call(this,function(){!ee.parentEl||(ee.updateComponents(),(ee.isScene||ee.parentEl.isPlaying)&&ee.play())})},writable:window.debug},remove:{value:function(ee){ee?this.object3D.remove(ee.object3D):this.parentNode.removeChild(this)}},getChildEntities:{value:function(){for(var ee=this.children,oe=[],Ee=0;Ee<ee.length;Ee++){var ve=ee[Ee];ve instanceof T&&oe.push(ve)}return oe}},initComponent:{value:function(ee,oe,Ee){var ve,Ce,He,we;if(we=(He=w.split(ee,y))[0],Ce=He.length>2?He.slice(1).join("__"):He[1],D[we]&&(R(this,ee)||void 0!==oe||Ee)&&!(ee in this.components)){if(this.initComponentDependencies(we),Ce&&!D[we].multiple)throw new Error("Trying to initialize multiple components of type `"+we+"`. There can only be one component of this type per entity.");ve=new D[we].Component(this,oe,Ce),this.isPlaying&&ve.play(),this.hasAttribute(ee)||(ve.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,ee,"")),x("Component initialized: %s",ee)}},writable:window.debug},initComponentDependencies:{value:function(ee){var ve,Ce;if(D[ee]&&(ve=D[ee].dependencies))for(Ce=0;Ce<ve.length;Ce++)this.initComponent(ve[Ce],window.HTMLElement.prototype.getAttribute.call(this,ve[Ce])||void 0,!0)}},removeComponent:{value:function(ee,oe){var Ee;if(Ee=this.components[ee]){if(!Ee.initialized)return void this.addEventListener("componentinitialized",function ve(Ce){Ce.detail.name===ee&&(this.removeComponent(ee,oe),this.removeEventListener("componentinitialized",ve))});Ee.pause(),Ee.remove(),oe&&(Ee.destroy(),delete this.components[ee]),this.emit("componentremoved",Ee.evtDetail,!1)}},writable:window.debug},updateComponents:{value:function(){var ee,oe,Ee,ve,Ce=this.componentsToUpdate;if(this.hasLoaded){for(Ee=0;Ee<this.mixinEls.length;Ee++)for(ve in this.mixinEls[Ee].componentCache)V(ve)&&(Ce[ve]=!0);if(this.getExtraComponents)for(ve in oe=this.getExtraComponents())V(ve)&&(Ce[ve]=!0);for(Ee=0;Ee<this.attributes.length;++Ee)-1===M.indexOf(ve=this.attributes[Ee].name)&&V(ve)&&(Ce[ve]=!0);for(Ee=0;Ee<M.length;Ee++)this.hasAttribute(ve=M[Ee])&&this.updateComponent(ve,this.getDOMAttribute(ve));for(ve in Ce)ee=O(this.getDOMAttribute(ve),oe&&oe[ve]),this.updateComponent(ve,ee),delete Ce[ve]}},writable:window.debug},updateComponent:{value:function(ee,oe,Ee){var ve=this.components[ee];if(ve)return null!==oe||R(this,ee)?void ve.updateProperties(oe,Ee):void this.removeComponent(ee,!0);this.initComponent(ee,oe,!1)}},removeAttribute:{value:function(ee,oe){var Ee=this.components[ee];Ee&&void 0===oe&&this.removeComponent(ee,!0),Ee&&void 0!==oe?Ee.resetProperty(oe):("mixin"===ee&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,ee))}},play:{value:function(){var ee,oe,Ee;if(!this.isPlaying&&this.hasLoaded){for(Ee in this.isPlaying=!0,this.components)this.components[Ee].play();for(ee=this.getChildEntities(),oe=0;oe<ee.length;oe++)ee[oe].play();this.emit("play")}},writable:!0},pause:{value:function(){var ee,oe,Ee;if(this.isPlaying){for(Ee in this.isPlaying=!1,this.components)this.components[Ee].pause();for(ee=this.getChildEntities(),oe=0;oe<ee.length;oe++)ee[oe].pause();this.emit("pause")}},writable:!0},setEntityAttribute:{value:function(ee,oe,Ee){if(D[ee]||this.components[ee])this.updateComponent(ee,Ee);else if("mixin"===ee){if(Ee===this.computedMixinStr)return;this.mixinUpdate(Ee,oe)}}},mixinUpdate:{value:(ee=[],function(oe,Ee){var ve,Ce,He,we,ce=this;if(this.hasLoaded){for(Ee=Ee||this.getAttribute("mixin"),He=this.updateMixins(oe,Ee),ee.length=0,we=0;we<this.mixinEls.length;we++)for(ve in this.mixinEls[we].componentCache)-1===ee.indexOf(ve)&&(this.components[ve]?this.components[ve].handleMixinUpdate():this.initComponent(ve,null),ee.push(ve));for(we=0;we<He.oldMixinIds.length;we++)if(Ce=document.getElementById(He.oldMixinIds[we]))for(ve in Ce.componentCache)-1===ee.indexOf(ve)&&this.components[ve]&&(this.getDOMAttribute(ve)?this.components[ve].handleMixinUpdate():this.removeComponent(ve,!0))}else this.addEventListener("loaded",function(){ce.mixinUpdate(oe,Ee)},E)})},setAttribute:{value:function(){var ee={};return function(oe,Ee,ve){var Ce,He,we,ce,fe;if(we=(ce=oe.indexOf(y))>0?oe.substring(0,ce):oe,!D[we])return"mixin"===oe&&this.mixinUpdate(Ee),void b.prototype.setAttribute.call(this,oe,Ee);if(!this.components[oe]&&this.hasAttribute(oe)&&this.updateComponent(oe,window.HTMLElement.prototype.getAttribute.call(this,oe)),void 0!==ve&&"string"==typeof Ee&&Ee.length>0&&"string"==typeof w.styleParser.parse(Ee)){for(fe in ee)delete ee[fe];(Ce=ee)[Ee]=ve,He=!1}else Ce=Ee,He=!0===ve;this.updateComponent(oe,Ce,He),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[oe].flushToDOM()}}(),writable:window.debug},flushToDOM:{value:function(ee){var Ee,Ce,He,oe=this.components,ve=this.children;for(He in oe)oe[He].flushToDOM();if(ee)for(Ce=0;Ce<ve.length;++Ce)(Ee=ve[Ce]).flushToDOM&&Ee.flushToDOM(ee)}},getAttribute:{value:function(ee){var oe;return"position"===ee?this.object3D.position:"rotation"===ee?function(ee){var oe=I.Math.radToDeg,Ee=ee.object3D.rotation,ve=ee.rotationObj;return ve.x=oe(Ee.x),ve.y=oe(Ee.y),ve.z=oe(Ee.z),ve}(this):"scale"===ee?this.object3D.scale:"visible"===ee?this.object3D.visible:(oe=this.components[ee])?oe.data:window.HTMLElement.prototype.getAttribute.call(this,ee)},writable:window.debug},getDOMAttribute:{value:function(ee){var oe=this.components[ee];return oe?oe.attrValue:window.HTMLElement.prototype.getAttribute.call(this,ee)},writable:window.debug},addState:{value:function(ee){this.is(ee)||(this.states.push(ee),this.emit("stateadded",ee))}},removeState:{value:function(ee){var oe=this.states.indexOf(ee);-1!==oe&&(this.states.splice(oe,1),this.emit("stateremoved",ee))}},is:{value:function(ee){return-1!==this.states.indexOf(ee)}},inspect:{value:function(){this.sceneEl.components.inspector.openInspector(this)}},destroy:{value:function(){var ee;if(this.parentNode)S("Entity can only be destroyed if detached from scenegraph.");else for(ee in this.components)this.components[ee].destroy()}}});function R(ee,oe){return!(!ee.components[oe]||!ee.components[oe].attrValue)||function(ee,oe){var Ee,ve=!1;for(Ee=0;Ee<oe.length&&!(ve=oe[Ee].hasAttribute(ee));++Ee);return ve}(oe,ee.mixinEls)}function O(ee,oe){return oe?oe.constructor===Object?w.extend(oe,w.styleParser.parse(ee||{})):ee||oe:ee}function V(ee){return-1!==ee.indexOf(y)&&(ee=w.split(ee,y)[0]),!!D[ee]}T=B("a-entity",{prototype:_}),ae.exports=T},{"../lib/three":184,"../utils/":212,"./a-node":134,"./a-register-element":135,"./component":136}],133:[function(k,ae,Ue){var b=k("./a-node"),D=k("./a-register-element").registerElement,B=k("./component").components,I=k("../utils");ae.exports=D("a-mixin",{prototype:Object.create(b.prototype,{createdCallback:{value:function(){this.componentCache={},this.id=this.getAttribute("id"),this.isMixin=!0}},attributeChangedCallback:{value:function(T,x,S){this.cacheAttribute(T,S),this.updateEntities()}},attachedCallback:{value:function(){this.sceneEl=this.closestScene(),this.cacheAttributes(),this.updateEntities(),this.load()}},setAttribute:{value:function(T,x){window.HTMLElement.prototype.setAttribute.call(this,T,x),this.cacheAttribute(T,x)}},cacheAttribute:{value:function(T,x){var S,y;y=I.split(T,"__")[0],(S=B[y])&&(void 0===x&&(x=window.HTMLElement.prototype.getAttribute.call(this,T)),this.componentCache[T]=S.parseAttrValueForCache(x))}},getAttribute:{value:function(T){return this.componentCache[T]||window.HTMLElement.prototype.getAttribute.call(this,T)}},cacheAttributes:{value:function(){var S,T=this.attributes;for(S=0;S<T.length;S++)this.cacheAttribute(T[S].name)}},updateEntities:{value:function(){var T,x,S;if(this.sceneEl)for(x=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),S=0;S<x.length;S++)(T=x[S]).hasLoaded&&!T.isMixin&&T.mixinUpdate(this.id)}}})})},{"../utils":212,"./a-node":134,"./a-register-element":135,"./component":136}],134:[function(k,ae,Ue){var T,x,S,b=k("./a-register-element").registerElement,D=k("./a-register-element").isNode,B=k("../utils/"),I=B.debug("core:a-node:warn"),w=B.debug("core:a-node:error");ae.exports=b("a-node",{prototype:Object.create(window.HTMLElement.prototype,{createdCallback:{value:function(){this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]},writable:window.debug},attachedCallback:{value:function(){var T;this.sceneEl=this.closestScene(),this.sceneEl||I("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(T=this.getAttribute("mixin"))&&this.updateMixins(T)},writable:window.debug},attributeChangedCallback:{value:function(T,x,S){S!==this.computedMixinStr&&"mixin"===T&&!this.isMixin&&this.updateMixins(S,x)}},closestScene:{value:function(){for(var x=this;x&&!x.isScene;)x=x.parentElement;return x}},closest:{value:function(x){for(var S=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,y=this;y&&!S.call(y,x);)y=y.parentElement;return y}},detachedCallback:{value:function(){this.hasLoaded=!1}},load:{value:function(T,x){var y,M=this;this.hasLoaded||(x=x||D,y=this.getChildren().filter(x).map(function(E){return new Promise(function(R){if(E.hasLoaded)return R();E.addEventListener("loaded",R)})}),Promise.all(y).then(function(){M.hasLoaded=!0,T&&T(),M.emit("loaded",void 0,!1)}).catch(function(E){w("Failure loading node: ",E)}))},writable:!0},getChildren:{value:function(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:(T=[],x=[],S={},function(y,M){var E,_,R;for(T.length=0,x.length=0,_=y?B.split(y.trim(),/\s+/):T,R=M?B.split(M.trim(),/\s+/):x,S.newMixinIds=_,S.oldMixinIds=R,E=0;E<R.length;E++)-1===_.indexOf(R[E])&&this.unregisterMixin(R[E]);for(this.computedMixinStr="",this.mixinEls.length=0,E=0;E<_.length;E++)this.registerMixin(document.getElementById(_[E]));return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),S})},registerMixin:{value:function(T){var x,S,y;if(T){if(y=T.getAttribute("mixin"))for(x=B.split(y.trim(),/\s+/),S=0;S<x.length;S++)this.registerMixin(document.getElementById(x[S]));this.computedMixinStr=this.computedMixinStr+" "+T.id,this.mixinEls.push(T)}}},setAttribute:{value:function(T,x){"mixin"===T&&this.updateMixins(x),window.HTMLElement.prototype.setAttribute.call(this,T,x)}},unregisterMixin:{value:function(T){var x,S=this.mixinEls;for(x=0;x<S.length;++x)if(T===S[x].id){S.splice(x,1);break}}},emit:{value:function(){var T={};return function(x,S,y,M){void 0===y&&(y=!0),T.bubbles=!!y,T.detail=S,M&&(T=B.extend({},M,T)),this.dispatchEvent(new CustomEvent(x,T))}}(),writable:window.debug}})})},{"../utils/":212,"./a-register-element":135}],135:[function(k,ae,Ue){k("document-register-element");var b,D,B=ae.exports.knownTags={};function x(M,E,_,R){E.forEach(function(F){!function(M,E,_,R){var F=_[E],O=R[E];!F||!O||F!==O&&(M[E]={value:function(){return O.apply(this,arguments),F.apply(this,arguments)},writable:window.debug})}(M,F,_,R)})}function y(M,E){Object.getOwnPropertyNames(M).forEach(function(R){var F;E[R]||(F=Object.getOwnPropertyDescriptor(M,R),E[R]={value:M[R],writable:F.writable})})}ae.exports.isNode=function(M){return M.tagName.toLowerCase()in B||M.isNode},ae.exports.registerElement=function(M,E){var _=Object.getPrototypeOf(E.prototype),R=E,F=b&&_===b.prototype,O=D&&_===D.prototype;return(F||O)&&function(M){B[M.toLowerCase()]=!0}(M),F&&(R=function(M){var E={};return x(E,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],M,b.prototype),y(M,E),E}(E.prototype),R={prototype:Object.create(_,R)}),O&&(R=function(M){var E={};return x(E,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],M,b.prototype),x(E,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],M,D.prototype),y(M,E),E}(E.prototype),R={prototype:Object.create(_,R)}),Object.getOwnPropertyNames(R.prototype).forEach(function(V){var Y=R.prototype[V];"function"==typeof Y&&(Y.displayName=V)}),document.registerElement(M,R)},ae.exports.wrapMethods=x,b=k("./a-node"),D=k("./a-entity")},{"./a-entity":132,"./a-node":134,"document-register-element":12}],136:[function(k,ae,Ue){var b=k("./schema"),D=k("./scene/scenes"),B=k("./system"),I=k("../utils/"),w=ae.exports.components={},T=b.parseProperties,x=b.parseProperty,S=b.process,y=b.isSingleProperty,M=b.stringifyProperties,E=b.stringifyProperty,_=I.styleParser,R=I.debug("core:component:warn"),F=document.currentScript,O=new RegExp("[A-Z]+"),V={},Y=ae.exports.Component=function(fe,je,it){var ft=this;this.el=fe,this.id=it,this.attrName=this.name+(it?"__"+it:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.isSingleProperty=y(this.schema),this.isSinglePropertyObject=this.isSingleProperty&&ce(x(void 0,this.schema))&&!(this.schema.default instanceof window.HTMLElement),this.isObjectBased=!this.isSingleProperty||this.isSinglePropertyObject,this.el.components[this.attrName]=this,this.objectPool=V[this.name];const ht=this.events;this.events={},function(fe,je){var it;for(it in je)fe.events[it]=je[it].bind(fe)}(this,ht),this.attrValue=void 0,this.isObjectBased?(this.nextData=this.objectPool.use(),I.objectPool.removeUnusedKeys(this.nextData,this.schema),this.oldData=this.objectPool.use(),I.objectPool.removeUnusedKeys(this.oldData,this.schema),this.previousOldData=this.objectPool.use(),I.objectPool.removeUnusedKeys(this.previousOldData,this.schema),this.parsingAttrValue=this.objectPool.use(),I.objectPool.removeUnusedKeys(this.parsingAttrValue,this.schema)):(this.nextData=void 0,this.oldData=void 0,this.previousOldData=void 0,this.parsingAttrValue=void 0),this.throttledEmitComponentChanged=I.throttleComponentChanged(function(){fe.emit("componentchanged",ft.evtDetail,!1)},200),this.updateProperties(je)};if(Y.prototype={schema:{},init:function(){},events:{},update:function(fe){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(fe,je){var it=this.schema;return this.isSingleProperty?x(fe,it):T(_.parse(fe),it,!0,this.name,je)},stringify:function(fe){var je=this.schema;return"string"==typeof fe?fe:this.isSingleProperty?E(fe,je):(fe=M(fe,je),_.stringify(fe))},updateCachedAttrValue:function(fe,je){var it,ft,ht;if(void 0!==fe){if(null===fe)return this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),void(this.attrValue=void 0);if(fe instanceof Object&&!(fe instanceof window.HTMLElement)?(ft=this.objectPool.use(),it=I.extend(ft,fe)):it=this.parseAttrValueForCache(fe),this.isObjectBased&&!je&&this.attrValue)for(ht in this.attrValue)void 0===it[ht]&&(it[ht]=this.attrValue[ht]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),I.objectPool.clearObject(this.attrValue),this.attrValue=ve(this.attrValue,it,this.isObjectBased),I.objectPool.clearObject(ft)}},parseAttrValueForCache:function(fe){var je;return"string"!=typeof fe?fe:(this.isSingleProperty?"string"==typeof(je=this.schema.parse(fe))&&(je=fe):(I.objectPool.clearObject(this.parsingAttrValue),je=_.parse(fe,this.parsingAttrValue)),je)},flushToDOM:function(fe){var je=fe?this.data:this.attrValue;null!=je&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(je))},updateProperties:function(fe,je){this.el.hasLoaded?(null!==fe&&(fe=this.parseAttrValueForCache(fe)),this.updateCachedAttrValue(fe,je),this.initialized?(this.updateComponent(fe,je),this.callUpdateHandler()):this.initComponent()):this.updateCachedAttrValue(fe)},initComponent:function(){var je,fe=this.el;this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),!fe.initializingComponents[this.name]&&(fe.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete fe.initializingComponents[this.name],this.oldData=ve(this.oldData,this.data,this.isObjectBased),je=this.isObjectBased?this.objectPool.use():void 0,this.update(je),this.isObjectBased&&this.objectPool.recycle(je),fe.isPlaying&&this.play(),fe.emit("componentinitialized",this.evtDetail,!1))},updateComponent:function(fe,je){var it,ft;if(je)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));if(this.isSingleProperty)return this.isObjectBased&&x(fe,this.schema),void(this.data=fe);if(T(fe,this.schema,!0,this.name),this.schemaChangeKeys.length)for(it in fe)if(this.schema[it].schemaChange){ft=!0;break}if(ft)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));for(it in fe)void 0!==fe[it]&&(this.data[it]=fe[it])},callUpdateHandler:function(){var fe;this.previousOldData instanceof Object&&I.objectPool.clearObject(this.previousOldData),this.isObjectBased?Ee(this.previousOldData,this.oldData):this.previousOldData=this.oldData,fe=!I.deepEqual(this.oldData,this.data),(this.isPositionRotationScale||fe)&&(this.oldData instanceof Object&&I.objectPool.clearObject(this.oldData),this.oldData=ve(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData),this.throttledEmitComponentChanged())},handleMixinUpdate:function(){this.data=this.buildData(this.attrValue),this.callUpdateHandler()},resetProperty:function(fe){if(this.isObjectBased){if(!(fe in this.attrValue))return;delete this.attrValue[fe],this.data[fe]=this.schema[fe].default}else this.attrValue=this.schema.default,this.data=this.schema.default;this.updateProperties(this.attrValue)},extendSchema:function(fe){var je;je=I.extend({},w[this.name].schema),I.extend(je,fe),this.schema=S(je),this.el.emit("schemachanged",this.evtDetail)},buildData:function(fe,je,it){var ft,ht,_t,Bt,_n,vi,qn,kn=this.nextData,Dn=this.schema,bn=this.el.mixinEls;if(ft=fe&&fe.constructor===Array?fe.length:null!=fe,this.isObjectBased&&I.objectPool.clearObject(kn),this.isSingleProperty)ht=this.isObjectBased?Ee(kn,Dn.default):Me(Dn.default)?I.clone(Dn.default):Dn.default;else for(Bt in ht=(qn=!je&&this.attrValue)instanceof Object?Ee(kn,qn):kn,Dn)_t=Dn[Bt].default,void 0===ht[Bt]&&(ht[Bt]=Me(_t)?I.clone(_t):_t);for(vi=0;vi<bn.length;vi++)(_n=bn[vi].getAttribute(this.attrName))&&(ht=ve(ht,_n,this.isObjectBased));if(ft){if(this.isSingleProperty)return ce(fe)?(Ee(this.parsingAttrValue,fe),x(this.parsingAttrValue,Dn)):x(fe,Dn);ht=ve(ht,fe,this.isObjectBased)}else if(this.isSingleProperty)return x(ht,Dn);return T(ht,Dn,void 0,this.name,it)},eventsAttach:function(){var fe;for(fe in this.eventsDetach(),this.events)this.el.addEventListener(fe,this.events[fe])},eventsDetach:function(){var fe;for(fe in this.events)this.el.removeEventListener(fe,this.events[fe])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}},window.debug)var oe=ae.exports.registrationOrderWarnings={};function Ee(fe,je){var it,ft;for(ft in je)void 0!==je[ft]&&(fe[ft]=Me(it=je[ft])?I.clone(it):it);return fe}function ve(fe,je,it){var ft;if(it&&je.constructor===Object){for(ft in je)void 0!==je[ft]&&(fe[ft]=je[ft]&&je[ft].constructor===Object?I.clone(je[ft]):je[ft]);return fe}return je}function Ce(fe){return fe.tick||fe.tock}function ce(fe){return fe&&fe.constructor===Object&&!(fe instanceof window.HTMLElement)}function Me(fe){return fe&&(fe.constructor===Object||fe.constructor===Array)&&!(fe instanceof window.HTMLElement)}ae.exports.registerComponent=function(fe,je){var it,ft,_t,Bt,ht={};if(document.currentScript&&document.currentScript!==F&&D.forEach(function(kn){kn.hasLoaded||document.currentScript.compareDocumentPosition(kn)!==Node.DOCUMENT_POSITION_FOLLOWING&&(R("The component `"+fe+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(oe[fe]=!0))}),!0===O.test(fe)&&R("The component name `"+fe+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+fe.toLowerCase()+"`"),-1!==fe.indexOf("__"))throw new Error("The component name `"+fe+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(je).forEach(function(_n){ht[_n]={value:je[_n],writable:!0}}),w[fe])throw new Error("The component `"+fe+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");if((it=function(_n,kn,Dn){Y.call(this,_n,kn,Dn)}).prototype=Object.create(Y.prototype,ht),it.prototype.name=fe,it.prototype.isPositionRotationScale="position"===fe||"rotation"===fe||"scale"===fe,it.prototype.constructor=it,it.prototype.system=B&&B.systems[fe],it.prototype.play=function(fe){return function(){var it=this.el.sceneEl;!this.initialized||!this.el.isPlaying||this.isPlaying||(fe.call(this),this.isPlaying=!0,this.eventsAttach(),Ce(this)&&it.addBehavior(this))}}(it.prototype.play),it.prototype.pause=function(fe){return function(){var it=this.el.sceneEl;!this.isPlaying||(fe.call(this),this.isPlaying=!1,this.eventsDetach(),Ce(this)&&it.removeBehavior(this))}}(it.prototype.pause),_t=I.extend(S(it.prototype.schema,it.prototype.name)),!(Bt=y(it.prototype.schema)))for(ft in it.prototype.schemaChangeKeys=[],_t)_t[ft].schemaChange&&it.prototype.schemaChangeKeys.push(ft);return V[fe]=I.objectPool.createPool(),w[fe]={Component:it,dependencies:it.prototype.dependencies,isSingleProp:Bt,multiple:it.prototype.multiple,name:fe,parse:it.prototype.parse,parseAttrValueForCache:it.prototype.parseAttrValueForCache,schema:_t,stringify:it.prototype.stringify,type:it.prototype.type},it}},{"../utils/":212,"./scene/scenes":143,"./schema":145,"./system":147}],137:[function(k,ae,Ue){var D=k("./schema").process,B=ae.exports.geometries={},I=ae.exports.geometryNames=[],w=k("../lib/three"),T=ae.exports.Geometry=function(){};T.prototype={schema:{},init:function(x){return this.geometry=new w.BufferGeometry,this.geometry},update:function(x){}},ae.exports.registerGeometry=function(x,S){var y,M={};if(Object.keys(S).forEach(function(_){M[_]={value:S[_],writable:!0}}),B[x])throw new Error("The geometry `"+x+"` has been already registered");return(y=function(){T.call(this)}).prototype=Object.create(T.prototype,M),y.prototype.name=x,y.prototype.constructor=y,B[x]={Geometry:y,schema:D(y.prototype.schema)},I.push(x),y}},{"../lib/three":184,"./schema":145}],138:[function(k,ae,Ue){var b=k("../utils/coordinates"),D=k("debug"),B=D("core:propertyTypes:warn"),I=D("core:propertyTypes:warn"),w=ae.exports.propertyTypes={},T=/[,> .[\]:]/,x=/\url\((.+)\)/;function S(ce,Me,fe,je){"type"in w?B("Property type "+ce+" is already registered."):w[ce]={default:Me,parse:fe||_,stringify:je||R}}function E(ce){var Me,fe;return"string"!=typeof ce?ce:(fe=ce.match(x))?fe[1]:"#"===ce.charAt(0)?(Me=document.getElementById(ce.substring(1)))?"CANVAS"===Me.tagName||"VIDEO"===Me.tagName||"IMG"===Me.tagName?Me:Me.getAttribute("src"):void I('"'+ce+'" asset not found.'):ce}function _(ce){return ce}function R(ce){return null===ce?"null":ce.toString()}function O(ce){return parseInt(ce,10)}function Ce(ce){return b.parse(ce,this.default)}function we(ce,Me){return null===ce||"object"==typeof ce&&Object.keys(ce).length===Me&&!("number"!=typeof ce.x||"number"!=typeof ce.y||Me>2&&"number"!=typeof ce.z||Me>3&&"number"!=typeof ce.w)}S("audio","",E),S("array",[],function(ce){return Array.isArray(ce)?ce:ce&&"string"==typeof ce?ce.split(",").map(function(fe){return fe.trim()}):[]},function(ce){return ce.join(", ")}),S("asset","",E),S("boolean",!1,function(ce){return"false"!==ce&&!1!==ce}),S("color","#FFF",_,R),S("int",0,O),S("number",0,function(ce){return parseFloat(ce,10)}),S("map","",E),S("model","",E),S("selector",null,function(ce){return ce?"string"!=typeof ce?ce:"#"!==ce[0]||T.test(ce)?document.querySelector(ce):document.getElementById(ce.substring(1)):null},function(ce){return ce.getAttribute?"#"+ce.getAttribute("id"):R(ce)}),S("selectorAll",null,function(ce){return ce?"string"!=typeof ce?ce:Array.prototype.slice.call(document.querySelectorAll(ce),0):null},function(ce){return ce instanceof Array?ce.map(function(Me){return"#"+Me.getAttribute("id")}).join(", "):R(ce)}),S("src","",function(ce){return I("`src` property type is deprecated. Use `asset` instead."),E(ce)}),S("string","",_,R),S("time",0,O),S("vec2",{x:0,y:0},Ce,b.stringify),S("vec3",{x:0,y:0,z:0},Ce,b.stringify),S("vec4",{x:0,y:0,z:0,w:1},Ce,b.stringify),ae.exports.registerPropertyType=S,ae.exports.isValidDefaultValue=function(ce,Me){return!("audio"===ce&&"string"!=typeof Me||"array"===ce&&!Array.isArray(Me)||"asset"===ce&&"string"!=typeof Me||"boolean"===ce&&"boolean"!=typeof Me||"color"===ce&&"string"!=typeof Me||"int"===ce&&"number"!=typeof Me||"number"===ce&&"number"!=typeof Me||"map"===ce&&"string"!=typeof Me||"model"===ce&&"string"!=typeof Me||"selector"===ce&&"string"!=typeof Me&&null!==Me||"selectorAll"===ce&&"string"!=typeof Me&&null!==Me||"src"===ce&&"string"!=typeof Me||"string"===ce&&"string"!=typeof Me||"time"===ce&&"number"!=typeof Me)&&("vec2"===ce?we(Me,2):"vec3"===ce?we(Me,3):"vec4"!==ce||we(Me,4))},ae.exports.isValidDefaultCoordinate=we},{"../utils/coordinates":207,debug:8}],139:[function(k,ae,Ue){var b=k("./metaTags").inject,D=k("./wakelock"),B=k("./loadingScreen"),I=k("../a-register-element"),w=k("./scenes"),T=k("../system").systems,x=k("../../lib/three"),S=k("../../utils/"),y=k("../a-entity"),M=k("../a-node"),E=k("./postMessage"),_=S.bind,R=S.device.isIOS(),F=S.device.isMobile(),O=S.device.isWebXRAvailable,V=I.registerElement,Y=S.debug("core:a-scene:warn");function ee(we,ce){var Me,fe=window.devicePixelRatio;return!ce||-1===ce.width&&-1===ce.height||we.width*fe<ce.width&&we.height*fe<ce.height||(Me=we.width/we.height,we.width*fe>ce.width&&-1!==ce.width&&(we.width=Math.round(ce.width/fe),we.height=Math.round(ce.width/Me/fe)),we.height*fe>ce.height&&-1!==ce.height&&(we.height=Math.round(ce.height/fe),we.width=Math.round(ce.height*Me/fe))),we}function oe(we,ce,Me,fe){return we.parentElement?ce?ee({height:we.parentElement.offsetHeight,width:we.parentElement.offsetWidth},Me):function(we,ce){var Me;return Me={height:document.body.offsetHeight,width:document.body.offsetWidth},ce?Me:ee(Me,we)}(Me,fe):{height:0,width:0}}function He(we){var ce;function Me(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||we.exitVR(),document.activeElement.blur(),document.body.focus()}(ce=document.createElement("canvas")).classList.add("a-canvas"),ce.dataset.aframeCanvas=!0,we.appendChild(ce),document.addEventListener("fullscreenchange",Me),document.addEventListener("mozfullscreenchange",Me),document.addEventListener("webkitfullscreenchange",Me),document.addEventListener("MSFullscreenChange",Me),ce.addEventListener("touchmove",function(fe){fe.preventDefault()}),we.canvas=ce,we.emit("render-target-loaded",{target:ce}),setTimeout(_(we.resize,we),0)}R&&k("../../utils/ios-orientationchange-blank-bug"),ae.exports.AScene=V("a-scene",{prototype:Object.create(y.prototype,{createdCallback:{value:function(){this.clock=new x.Clock,this.isIOS=R,this.isMobile=F,this.hasWebXR=O,this.isAR=!1,this.isScene=!0,this.object3D=new x.Scene;var we=this;this.object3D.onAfterRender=function(ce,Me,fe){we.isPlaying&&we.tock(we.time,we.delta,fe)},this.resize=_(this.resize,this),this.render=_(this.render,this),this.systems={},this.systemNames=[],this.time=this.delta=0,this.behaviors={tick:[],tock:[]},this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("vr-mode-ui",""),this.setAttribute("device-orientation-permission-ui","")}},addFullScreenStyles:{value:function(){document.documentElement.classList.add("a-fullscreen")}},removeFullScreenStyles:{value:function(){document.documentElement.classList.remove("a-fullscreen")}},attachedCallback:{value:function(){var we=this,ce=this.hasAttribute("embedded");He(this),this.setupRenderer(),B.setup(this,oe),this.resize(),ce||this.addFullScreenStyles(),E(this),b(this),D(this),this.onVRPresentChangeBound=_(this.onVRPresentChange,this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){we.enterVR()},this.exitVRBound=function(){we.exitVR()},this.exitVRTrueBound=function(){we.exitVR(!0)},this.pointerRestrictedBound=function(){we.pointerRestricted()},this.pointerUnrestrictedBound=function(){we.pointerUnrestricted()},O||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){we.attachedCallbackPostCamera()}),this.initSystems(),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){we.enterVR()})}},attachedCallbackPostCamera:{value:function(){var ce=this;window.addEventListener("load",undefined),window.addEventListener("resize",function(){ce.isIOS?setTimeout(ce.resize,100):ce.resize()}),this.play(),w.push(this)},writable:window.debug},initSystems:{value:function(){var we;for(we in this.initSystem("camera"),T)"camera"!==we&&this.initSystem(we)}},initSystem:{value:function(we){this.systems[we]||(this.systems[we]=new T[we](this),this.systemNames.push(we))}},detachedCallback:{value:function(){var we=w.indexOf(this);w.splice(we,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.xr.dispose()}},addBehavior:{value:function(we){var ce,fe,Me=this.behaviors;for(fe in Me)!we[fe]||-1===(ce=this.behaviors[fe]).indexOf(we)&&ce.push(we)}},getPointerLockElement:{value:function(){return document.pointerLockElement},writable:window.debug},checkHeadsetConnected:{value:S.device.checkHeadsetConnected,writable:window.debug},enterAR:{value:function(){var we;if(!this.hasWebXR)throw we="Failed to enter AR mode, WebXR not supported.",new Error(we);if(!S.device.checkARSupport())throw we="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(we);return this.enterVR(!0)}},enterVR:{value:function(we){var Me,je,ce=this,fe=ce.renderer.xr;if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){if(fe.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound),fe.setReferenceSpaceType(this.sceneEl.systems.webxr.sessionReferenceSpaceType);var ft=we?"immersive-ar":"immersive-vr";return je=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(kn,Dn){navigator.xr.requestSession(ft,je).then(function(bn){ce.xrSession=bn,fe.layersEnabled=-1!==je.requiredFeatures.indexOf("layers"),fe.setSession(bn),bn.addEventListener("end",ce.exitVRBound),Bt(kn)},function(bn){throw new Error("Failed to enter "+("immersive-ar"===ft?"AR":"VR")+" mode (`requestSession`) "+bn)})})}if(Me=S.device.getVRDisplay(),fe.setDevice(Me),Me.isPresenting&&!window.hasNativeWebVRImplementation)return Bt(),Promise.resolve();var ht=this.getAttribute("renderer");return Me.requestPresent([{source:this.canvas,attributes:{highRefreshRate:ht.highRefreshRate,foveationLevel:ht.foveationLevel}}]).then(Bt,function(kn){throw ce.removeState("vr-mode"),kn&&kn.message?new Error("Failed to enter VR mode (`requestPresent`): "+kn.message):new Error("Failed to enter VR mode (`requestPresent`).")})}return Bt(),Promise.resolve();function Bt(kn){var Dn;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(Dn=new CustomEvent("vrdisplaypresentchange",{detail:{display:S.device.getVRDisplay()}}),window.dispatchEvent(Dn)),ce.addState(we?"ar-mode":"vr-mode"),ce.emit("enter-vr",{target:ce}),!O&&ce.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),ce.addFullScreenStyles(),!ce.isMobile&&!ce.checkHeadsetConnected()&&function(we){(we.requestFullscreen||we.webkitRequestFullscreen||we.mozRequestFullScreen||we.msRequestFullscreen).apply(we,[{navigationUI:"hide"}])}(ce.canvas),ce.resize(),kn&&kn()}},writable:!0},exitVR:{value:function(){var ce,we=this,Me=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(Me.enabled=!1,ce=S.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0,Me.setSession(null);else if(ce.isPresenting)return ce.exitPresent().then(fe,function(it){throw it&&it.message?new Error("Failed to exit VR mode (`exitPresent`): "+it.message):new Error("Failed to exit VR mode (`exitPresent`).")})}else!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)||(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return fe(),Promise.resolve();function fe(){we.removeState("vr-mode"),we.removeState("ar-mode"),we.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),we.hasAttribute("embedded")&&we.removeFullScreenStyles(),we.resize(),we.isIOS&&S.forceCanvasResizeSafariMobile(we.canvas),we.renderer.setPixelRatio(window.devicePixelRatio),we.emit("exit-vr",{target:we})}},writable:!0},pointerRestricted:{value:function(){if(this.canvas){var we=this.getPointerLockElement();we&&we!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}},pointerUnrestricted:{value:function(){var we=this.getPointerLockElement();we&&we===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}},onVRPresentChange:{value:function(we){var ce=we.display||we.detail.display;ce&&ce.isPresenting?this.enterVR():this.exitVR()}},getAttribute:{value:function(we){var ce=this.systems[we];return ce?ce.data:y.prototype.getAttribute.call(this,we)}},getComputedAttribute:{value:function(we){Y("`getComputedAttribute` is deprecated. Use `getAttribute` instead."),this.getAttribute(we)}},getDOMAttribute:{value:function(we){var ce=this.systems[we];return ce?ce.data:y.prototype.getDOMAttribute.call(this,we)}},setAttribute:{value:function(we,ce,Me){var fe=this.systems[we];if(fe)return M.prototype.setAttribute.call(this,we,ce),void fe.updateProperties(ce);y.prototype.setAttribute.call(this,we,ce,Me)}},removeBehavior:{value:function(we){var ce,Me,je,fe=this.behaviors;for(Me in fe)!we[Me]||-1!==(je=(ce=this.behaviors[Me]).indexOf(we))&&ce.splice(je,1)}},resize:{value:function(){var fe,je,we=this.camera,ce=this.canvas;fe=this.renderer.xr.enabled&&this.renderer.xr.isPresenting,we&&ce&&(!this.is("vr-mode")||!this.isMobile&&!fe)&&(je=oe(ce,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),we.aspect=je.width/je.height,we.updateProjectionMatrix(),this.renderer.setSize(je.width,je.height,!1),this.emit("rendererresize",null,!1))},writable:!0},setupRenderer:{value:function(){var ce,Me,fe,je,we=this;je={alpha:!0,antialias:!F,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:1920,width:1920},this.hasAttribute("renderer")&&(fe=this.getAttribute("renderer"),(Me=S.styleParser.parse(fe)).precision&&(je.precision=Me.precision+"p"),Me.antialias&&"auto"!==Me.antialias&&(je.antialias="true"===Me.antialias),Me.logarithmicDepthBuffer&&"auto"!==Me.logarithmicDepthBuffer&&(je.logarithmicDepthBuffer="true"===Me.logarithmicDepthBuffer),Me.alpha&&(je.alpha="true"===Me.alpha),this.maxCanvasSize={width:Me.maxCanvasWidth?parseInt(Me.maxCanvasWidth):this.maxCanvasSize.width,height:Me.maxCanvasHeight?parseInt(Me.maxCanvasHeight):this.maxCanvasSize.height}),(ce=this.renderer=new x.WebGLRenderer(je)).setPixelRatio(window.devicePixelRatio),ce.sortObjects=!1,this.camera&&ce.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){ce.xr.setPoseTarget(we.camera.el.object3D)})},writable:window.debug},play:{value:function(){var we=this,ce=this;this.renderStarted?y.prototype.play.call(this):(this.addEventListener("loaded",function(){var fe,Me=this.renderer,je=this.renderer.xr;y.prototype.play.call(this),!ce.renderStarted&&(ce.resize(),ce.renderer&&(window.performance&&window.performance.mark("render-started"),B.remove(),(fe=S.device.getVRDisplay())&&fe.isPresenting&&(je.setDevice(fe),je.enabled=!0,ce.enterVR()),Me.setAnimationLoop(this.render),ce.renderStarted=!0,ce.emit("renderstart")))}),setTimeout(function(){y.prototype.load.call(we)}))}},updateComponent:{value:function(we){we in T||y.prototype.updateComponent.apply(this,arguments)}},tick:{value:function(we,ce){var Me,fe=this.systems;for(Me=0;Me<this.behaviors.tick.length;Me++)!this.behaviors.tick[Me].el.isPlaying||this.behaviors.tick[Me].tick(we,ce);for(Me=0;Me<this.systemNames.length;Me++)!fe[this.systemNames[Me]].tick||fe[this.systemNames[Me]].tick(we,ce)}},tock:{value:function(we,ce,Me){var fe,je=this.systems;for(fe=0;fe<this.behaviors.tock.length;fe++)!this.behaviors.tock[fe].el.isPlaying||this.behaviors.tock[fe].tock(we,ce,Me);for(fe=0;fe<this.systemNames.length;fe++)!je[this.systemNames[fe]].tock||je[this.systemNames[fe]].tock(we,ce,Me)}},render:{value:function(we,ce){var Me=this.renderer;this.frame=ce,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var fe=null;this.is("ar-mode")&&(fe=this.object3D.background,this.object3D.background=null),Me.render(this.object3D,this.camera),fe&&(this.object3D.background=fe)},writable:!0}})}),ae.exports.setupCanvas=He},{"../../lib/three":184,"../../utils/":212,"../../utils/ios-orientationchange-blank-bug":213,"../a-entity":132,"../a-node":134,"../a-register-element":135,"../system":147,"./loadingScreen":140,"./metaTags":141,"./postMessage":142,"./scenes":143,"./wakelock":144}],140:[function(k,ae,Ue){var B,I,w,D=k("../../utils/").styleParser,T="loading-screen";function S(M){var E=B.hasAttribute("embedded"),_=w(B.canvas,E,B.maxCanvasSize,B.is("vr-mode"));M.aspect=_.width/_.height,M.updateProjectionMatrix(),B.renderer.setSize(_.width,_.height,!1)}ae.exports.setup=function(E,_){w=_;var Y,ee,oe,Ee,ve,Ce,He,we,ce,Me,R=(B=E).hasAttribute(T)?D.parse(B.getAttribute(T)):void 0,F=R&&R.dotsColor||"white",O=R&&R.backgroundColor||"#24CAFF";void 0!==R&&"true"!==R.enabled&&void 0!==R.enabled||(Y=new THREE.Scene,ee=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),oe=new THREE.MeshBasicMaterial({color:F}),Ee=new THREE.Mesh(ee,oe),ve=Ee.clone(),Ce=Ee.clone(),He=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),we=new THREE.Clock,ce=0,Me=function(){B.renderer.render(Y,He),ce=we.getElapsedTime()%4,Ee.visible=ce>=1,ve.visible=ce>=2,Ce.visible=ce>=3},Y.background=new THREE.Color(O),Y.add(He),Ee.position.set(-1,0,-15),ve.position.set(0,0,-15),Ce.position.set(1,0,-15),He.add(Ee),He.add(ve),He.add(Ce),(I=document.createElement("div")).className="a-loader-title",I.innerHTML=document.title,I.style.display="none",B.appendChild(I),setTimeout(function(){B.hasLoaded||(S(He),I.style.display="block",window.addEventListener("resize",function(){S(He)}),B.renderer.setAnimationLoop(Me))},200))},ae.exports.remove=function(){window.removeEventListener("resize",S),I&&(I.style.display="none")}},{"../../utils/":212}],141:[function(k,ae,Ue){var S,b=k("../../constants/"),D=k("../../utils").extend,B=ae.exports.MOBILE_HEAD_TAGS=[w({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),w({name:"mobile-web-app-capable",content:"yes"}),w({name:"theme-color",content:"black"})],I=[w({name:"apple-mobile-web-app-capable",content:"yes"}),w({name:"apple-mobile-web-app-status-bar-style",content:"black"}),(S={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},{tagName:"link",attributes:S,exists:function(){return document.querySelector('link[rel="'+S.rel+'"]')}})];function w(S){return{tagName:"meta",attributes:S,exists:function(){return document.querySelector('meta[name="'+S.name+'"]')}}}ae.exports.inject=function(y){var _,M=document.head,E=M.querySelector("script"),R=[];return B.forEach(F),y.isIOS&&I.forEach(F),R;function F(O){!O||O.exists()||(_=function(S){if(S&&S.tagName){var y=document.createElement(S.tagName);return y.setAttribute(b.AFRAME_INJECTED,""),D(y,S.attributes)}}(O))&&(E?E.parentNode.insertBefore(_,E):M.appendChild(_),R.push(_))}}},{"../../constants/":128,"../../utils":212}],142:[function(k,ae,Ue){var b=k("../../utils/bind"),D=k("../../utils/").isIframed;function B(I){if(I.data)switch(I.data.type){case"vr":switch(I.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}}ae.exports=function(w){!D()||window.addEventListener("message",b(B,w))}},{"../../utils/":212,"../../utils/bind":206}],143:[function(k,ae,Ue){ae.exports=[]},{}],144:[function(k,ae,Ue){var b=k("../../../vendor/wakelock/wakelock");ae.exports=function(B){if(B.isMobile){var I=B.wakelock=new b;B.addEventListener("enter-vr",function(){I.request()}),B.addEventListener("exit-vr",function(){I.release()})}}},{"../../../vendor/wakelock/wakelock":227}],145:[function(k,ae,Ue){var E,b=k("../utils/"),D=k("./propertyTypes"),I=D.isValidDefaultValue,w=D.propertyTypes,T=(0,b.debug)("core:schema:warn");function x(E){return"type"in E?"string"==typeof E.type:"default"in E}function S(E,_){var F,O,R=E.default,V=E.type;return E.type?"bool"===E.type?V="boolean":"float"===E.type&&(V="number"):V=void 0===R||"boolean"!=typeof R&&"number"!=typeof R?Array.isArray(R)?"array":"string":typeof R,(O=w[V])||T("Unknown property type for component `"+_+"`: "+V),F=!!E.parse,E.parse=E.parse||O.parse,E.stringify=E.stringify||O.stringify,E.type=V,"default"in E?!F&&!I(V,R)&&T("Default value `"+R+"` does not match type `"+V+"` in component `"+_+"`"):E.default=O.default,E}function y(E,_){return(null==E||""===E)&&(E=_.default,Array.isArray(E)&&(E=E.slice())),_.parse(E,_.default)}function M(E,_){return"object"!=typeof E?E:_&&null!==E?_.stringify(E):JSON.stringify(E)}ae.exports.isSingleProperty=x,ae.exports.process=function(E,_){var R;if(x(E))return S(E,_);for(R in E)E[R]=S(E[R],_);return E},ae.exports.processPropertyDefinition=S,ae.exports.parseProperties=(E=[],function(_,R,F,O,V){var Y,ee;for(ee in E.length=0,F?_:R)F&&void 0===_[ee]||E.push(ee);if(null===_||"object"!=typeof _)return _;for(ee in _)void 0!==_[ee]&&!R[ee]&&!V&&T("Unknown property `"+ee+"` for component/system `"+O+"`.");for(Y=0;Y<E.length;Y++){if(!R[ee=E[Y]])return;_[ee]=y(_[ee],R[ee])}return _}),ae.exports.parseProperty=y,ae.exports.stringifyProperties=function(E,_){var R,F,O,Y,V={};for(R in E)F=_[R],"object"==typeof(Y=O=E[R])&&(Y=M(O,F),F||T("Unknown component property: "+R)),V[R]=Y;return V},ae.exports.stringifyProperty=M},{"../utils/":212,"./propertyTypes":138}],146:[function(k,ae,Ue){var D=k("./schema").process,B=ae.exports.shaders={},I=ae.exports.shaderNames=[],w=k("../lib/three"),T=k("../utils"),x={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},S=ae.exports.Shader=function(){};S.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(y){return this.attributes=this.initVariables(y,"attribute"),this.uniforms=this.initVariables(y,"uniform"),this.material=new(this.raw?w.RawShaderMaterial:w.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(y,M){var E,_=this.schema,R={};for(E in _)_[E].is===M&&(R[E]={type:x[_[E].type],value:void 0});return R},update:function(y){this.updateVariables(y,"attribute"),this.updateVariables(y,"uniform")},updateVariables:function(y,M){var E,_,F,R=this.schema;for(E in F="uniform"===M?this.uniforms:this.attributes,y)if(R[E]&&R[E].is===M){if("map"===R[E].type){if(!F[E]||F[E].value===y[E])continue;this.setMapOnTextureLoad(F,E,_="_texture_"+E),T.material.updateMapMaterialFromData(_,E,this,y);continue}F[E].value=this.parseValue(R[E].type,y[E]),F[E].needsUpdate=!0}},parseValue:function(y,M){var E;switch(y){case"vec2":return new w.Vector2(M.x,M.y);case"vec3":return new w.Vector3(M.x,M.y,M.z);case"vec4":return new w.Vector4(M.x,M.y,M.z,M.w);case"color":return E=new w.Color(M),new w.Vector3(E.r,E.g,E.b);case"map":return w.ImageUtils.loadTexture(M);default:return M}},setMapOnTextureLoad:function(y,M,E){var _=this;this.el.addEventListener("materialtextureloaded",function(){y[M].value=_.material[E],y[M].needsUpdate=!0})}},ae.exports.registerShader=function(y,M){var E,_={};if(Object.keys(M).forEach(function(R){_[R]={value:M[R],writable:!0}}),B[y])throw new Error("The shader "+y+" has been already registered");return(E=function(){S.call(this)}).prototype=Object.create(S.prototype,_),E.prototype.name=y,E.prototype.constructor=E,B[y]={Shader:E,schema:D(E.prototype.schema)},I.push(y),E}},{"../lib/three":184,"../utils":212,"./schema":145}],147:[function(k,ae,Ue){var b=k("./component"),D=k("./schema"),B=k("../utils/"),I=D.parseProperties,w=D.parseProperty,T=D.process,x=D.isSingleProperty,S=B.styleParser,y=ae.exports.systems={},M=ae.exports.System=function(E){var _=b&&b.components[this.name];this.el=E,this.sceneEl=E,_&&(_.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};M.prototype={schema:{},init:function(){},update:function(E){},updateProperties:function(E){var _=this.data;!Object.keys(D).length||(this.buildData(E),this.update(_))},buildData:function(E){var _=this.schema;!Object.keys(_).length||(E=E||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),this.data=x(_)?w(E,_):I(S.parse(E)||{},_))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},ae.exports.registerSystem=function(E,_){var R,F,O={},V=B.findAllScenes(document);if(Object.keys(_).forEach(function(Y){O[Y]={value:_[Y],writable:!0}}),y[E])throw new Error("The system `"+E+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");for((F=function(Y){M.call(this,Y)}).prototype=Object.create(M.prototype,O),F.prototype.name=E,F.prototype.constructor=F,F.prototype.schema=B.extend(T(F.prototype.schema)),y[E]=F,R=0;R<V.length;R++)V[R].initSystem(E)}},{"../utils/":212,"./component":136,"./schema":145}],148:[function(k,ae,Ue){k("./pivot")},{"./pivot":149}],149:[function(k,ae,Ue){var b=k("../../core/component").registerComponent,D=k("../../lib/three"),B=new D.Vector3,I=new D.Vector3;b("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var w=this.data,T=this.el,x=T.object3D.parent,S=T.object3D,y=new D.Group;B.copy(S.position),I.copy(S.rotation),x.remove(S),y.add(S),x.add(y),T.object3D=y,S.position.set(-1*w.x,-1*w.y,-1*w.z),y.position.set(w.x+B.x,w.y+B.y,w.z+B.z),y.rotation.copy(S.rotation),S.rotation.set(0,0,0)}})},{"../../core/component":136,"../../lib/three":184}],150:[function(k,ae,Ue){var b=k("../../core/component").components,D=k("../../core/shader").shaders,B=k("../../utils/"),I={};function w(T){var x=T.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();"fog"===T&&(x="material-fog"),"visible"===T&&(x="material-visible"),I[x]="material."+T}Object.keys(b.material.schema).forEach(w),Object.keys(D.standard.schema).forEach(w),ae.exports=function(){return{defaultComponents:{material:{}},mappings:B.extend({},I)}}},{"../../core/component":136,"../../core/shader":146,"../../utils/":212}],151:[function(k,ae,Ue){k("./primitives/a-camera"),k("./primitives/a-cursor"),k("./primitives/a-curvedimage"),k("./primitives/a-gltf-model"),k("./primitives/a-image"),k("./primitives/a-light"),k("./primitives/a-link"),k("./primitives/a-obj-model"),k("./primitives/a-sky"),k("./primitives/a-sound"),k("./primitives/a-text"),k("./primitives/a-video"),k("./primitives/a-videosphere"),k("./primitives/meshPrimitives")},{"./primitives/a-camera":153,"./primitives/a-cursor":154,"./primitives/a-curvedimage":155,"./primitives/a-gltf-model":156,"./primitives/a-image":157,"./primitives/a-light":158,"./primitives/a-link":159,"./primitives/a-obj-model":160,"./primitives/a-sky":161,"./primitives/a-sound":162,"./primitives/a-text":163,"./primitives/a-video":164,"./primitives/a-videosphere":165,"./primitives/meshPrimitives":166}],152:[function(k,ae,Ue){var b=k("../../core/a-entity"),D=k("../../core/component").components,B=k("../../core/a-register-element").registerElement,I=k("../../utils/"),w=I.debug,T=I.entity.setComponentProperty,x=w("extras:primitives:debug"),S=w("extras:primitives:warn"),y=ae.exports.primitives={};ae.exports.registerPrimitive=function(R,F){R=R.toLowerCase(),x("Registering <%s>",R),F.defaultAttributes&&S("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var O=B(R,{prototype:Object.create(b.prototype,{defaultComponentsFromPrimitive:{value:F.defaultComponents||F.defaultAttributes||{}},deprecated:{value:F.deprecated||null},deprecatedMappings:{value:F.deprecatedMappings||{}},mappings:{value:F.mappings||{}},createdCallback:{value:function(){F.deprecated&&console.warn(F.deprecated),this.resolveMappingCollisions()}},resolveMappingCollisions:{value:function(){var V=this.mappings,Y=this;Object.keys(V).forEach(function(oe){var Ee;oe!==oe.toLowerCase()&&S("Mapping keys should be specified in lower case. The mapping key "+oe+" may not be recognized"),D[oe]&&(Ee=V[oe].replace(".","-"),V[Ee]=V[oe],delete V[oe],console.warn("The primitive "+Y.tagName.toLowerCase()+" has a mapping collision. The attribute "+oe+" has the same name as a registered component and has been renamed to "+Ee))})}},getExtraComponents:{value:function(){var V,Y,ee,oe,Ee,ve,Ce=this;for(Y=I.clone(this.defaultComponentsFromPrimitive),(Ee=this.getAttribute("mixin"))&&(Ee=Ee.trim().split(" ")).forEach(function(je){var it=Ce.sceneEl.querySelector("#"+je).componentCache;Object.keys(it).forEach(function(ht){Y[ht]=function(fe,je){return we(fe)?ce(je):we(je)?ce(fe):Me(fe)&&Me(je)?I.extendDeep(fe,je):ce(je)}(Y[ht],it[ht])})}),ee=0;ee<this.attributes.length;ee++)if(oe=this.mappings[(V=this.attributes[ee]).name]){(ve=I.entity.getComponentPropertyPath(oe)).constructor===Array?(Y[ve[0]]=Y[ve[0]]||{},Y[ve[0]][ve[1]]=V.value.trim()):Y[ve]=V.value.trim();continue}return Y;function we(fe){return void 0===fe}function ce(fe){return Me(fe)?I.extendDeep({},fe):fe}function Me(fe){return null!==fe&&fe.constructor===Object}}},attributeChangedCallback:{value:function(V,Y,ee){var oe=this.mappings[V];V in this.deprecatedMappings&&console.warn(this.deprecatedMappings[V]),V&&oe&&T(this,oe,ee)}}})});return y[R]=O,O},ae.exports.definePrimitive=function(_,R,F){F=F||{},Object.keys(R).map(function(V){!function(_,R){Object.keys(D[_].schema).map(function(O){var V=O.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();void 0!==R[V]&&(V=_+"-"+O),R[V]=_+"."+O})}(V,F)}),ae.exports.registerPrimitive(_,I.extendDeep({},null,{defaultComponents:R,mappings:F}))}},{"../../core/a-entity":132,"../../core/a-register-element":135,"../../core/component":136,"../../utils/":212}],153:[function(k,ae,Ue){(0,k("../primitives").registerPrimitive)("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},{"../primitives":152}],154:[function(k,ae,Ue){var b=k("../getMeshMixin");(0,k("../primitives").registerPrimitive)("a-cursor",k("../../../utils/").extendDeep({},b(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],155:[function(k,ae,Ue){var b=k("../getMeshMixin");(0,k("../primitives").registerPrimitive)("a-curvedimage",k("../../../utils/").extendDeep({},b(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],156:[function(k,ae,Ue){(0,k("../primitives").registerPrimitive)("a-gltf-model",{mappings:{src:"gltf-model"}})},{"../primitives":152}],157:[function(k,ae,Ue){var b=k("../getMeshMixin");(0,k("../primitives").registerPrimitive)("a-image",k("../../../utils/").extendDeep({},b(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],158:[function(k,ae,Ue){(0,k("../primitives").registerPrimitive)("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap"}})},{"../primitives":152}],159:[function(k,ae,Ue){(0,k("../primitives").registerPrimitive)("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},{"../primitives":152}],160:[function(k,ae,Ue){var b=k("../getMeshMixin")();(0,k("../primitives").registerPrimitive)("a-obj-model",k("../../../utils/").extendDeep({},b,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],161:[function(k,ae,Ue){var b=k("../getMeshMixin"),D=k("../primitives").registerPrimitive,B=k("../../../utils/"),I=k("./meshPrimitives");D("a-sky",B.extendDeep({},b(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:B.extendDeep({},I["a-sphere"].prototype.mappings)}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152,"./meshPrimitives":166}],162:[function(k,ae,Ue){(0,k("../primitives").registerPrimitive)("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},{"../primitives":152}],163:[function(k,ae,Ue){(0,k("../primitives").definePrimitive)("a-text",{text:{anchor:"align",width:5}})},{"../primitives":152}],164:[function(k,ae,Ue){var b=k("../getMeshMixin");(0,k("../primitives").registerPrimitive)("a-video",k("../../../utils/").extendDeep({},b(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],165:[function(k,ae,Ue){var b=k("../getMeshMixin");(0,k("../primitives").registerPrimitive)("a-videosphere",k("../../../utils/").extendDeep({},b(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],166:[function(k,ae,Ue){var b=k("../getMeshMixin"),D=k("../../../core/geometry").geometries,B=k("../../../core/geometry").geometryNames,I=k("../primitives").registerPrimitive,w=k("../../../utils/"),T=ae.exports={};function x(S){return S.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}B.forEach(function(y){var M=D[y],E=x(y),_={};Object.keys(M.schema).forEach(function(V){_[x(V)]="geometry."+V});var R="a-"+E,F=I(R,w.extendDeep({},b(),{defaultComponents:{geometry:{primitive:y}},mappings:_}));T[R]=F})},{"../../../core/geometry":137,"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],167:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(B){this.geometry=new D.BoxGeometry(B.width,B.height,B.depth,B.segmentsWidth,B.segmentsHeight,B.segmentsDepth)}})},{"../core/geometry":137,"../lib/three":184}],168:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(I){this.geometry=new D.CircleGeometry(I.radius,I.segments,B(I.thetaStart),B(I.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],169:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(I){this.geometry=new D.CylinderGeometry(I.radiusTop,I.radiusBottom,I.height,I.segmentsRadial,I.segmentsHeight,I.openEnded,B(I.thetaStart),B(I.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],170:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(I){this.geometry=new D.CylinderGeometry(I.radius,I.radius,I.height,I.segmentsRadial,I.segmentsHeight,I.openEnded,B(I.thetaStart),B(I.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],171:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(B){this.geometry=new D.DodecahedronGeometry(B.radius,B.detail)}})},{"../core/geometry":137,"../lib/three":184}],172:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(B){this.geometry=new D.IcosahedronGeometry(B.radius,B.detail)}})},{"../core/geometry":137,"../lib/three":184}],173:[function(k,ae,Ue){k("./box.js"),k("./circle.js"),k("./cone.js"),k("./cylinder.js"),k("./dodecahedron.js"),k("./icosahedron.js"),k("./octahedron.js"),k("./plane.js"),k("./ring.js"),k("./sphere.js"),k("./tetrahedron.js"),k("./torus.js"),k("./torusKnot.js"),k("./triangle.js")},{"./box.js":167,"./circle.js":168,"./cone.js":169,"./cylinder.js":170,"./dodecahedron.js":171,"./icosahedron.js":172,"./octahedron.js":174,"./plane.js":175,"./ring.js":176,"./sphere.js":177,"./tetrahedron.js":178,"./torus.js":179,"./torusKnot.js":180,"./triangle.js":181}],174:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(B){this.geometry=new D.OctahedronGeometry(B.radius,B.detail)}})},{"../core/geometry":137,"../lib/three":184}],175:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(B){this.geometry=new D.PlaneGeometry(B.width,B.height,B.segmentsWidth,B.segmentsHeight)}})},{"../core/geometry":137,"../lib/three":184}],176:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(I){this.geometry=new D.RingGeometry(I.radiusInner,I.radiusOuter,I.segmentsTheta,I.segmentsPhi,B(I.thetaStart),B(I.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],177:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(I){this.geometry=new D.SphereGeometry(I.radius,I.segmentsWidth,I.segmentsHeight,B(I.phiStart),B(I.phiLength),B(I.thetaStart),B(I.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],178:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(B){this.geometry=new D.TetrahedronGeometry(B.radius,B.detail)}})},{"../core/geometry":137,"../lib/three":184}],179:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=D.Math.degToRad;b("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(I){this.geometry=new D.TorusGeometry(I.radius,2*I.radiusTubular,I.segmentsRadial,I.segmentsTubular,B(I.arc))}})},{"../core/geometry":137,"../lib/three":184}],180:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three");b("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(B){this.geometry=new D.TorusKnotGeometry(B.radius,2*B.radiusTubular,B.segmentsTubular,B.segmentsRadial,B.p,B.q)}})},{"../core/geometry":137,"../lib/three":184}],181:[function(k,ae,Ue){var b=k("../core/geometry").registerGeometry,D=k("../lib/three"),B=new D.Quaternion,I=new D.Vector3(0,0,1),w=new D.Vector2,T=new D.Vector2,x=new D.Vector2;b("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(S){var y,M,E,_,R,F,V,Y;(E=new D.Triangle).a.set(S.vertexA.x,S.vertexA.y,S.vertexA.z),E.b.set(S.vertexB.x,S.vertexB.y,S.vertexB.z),E.c.set(S.vertexC.x,S.vertexC.y,S.vertexC.z),M=E.getNormal(new D.Vector3),B.setFromUnitVectors(M,I),_=E.a.clone().applyQuaternion(B),R=E.b.clone().applyQuaternion(B),F=E.c.clone().applyQuaternion(B),w.set(Math.min(_.x,R.x,F.x),Math.min(_.y,R.y,F.y)),T.set(Math.max(_.x,R.x,F.x),Math.max(_.y,R.y,F.y)),x.set(0,0).subVectors(T,w),_=(new D.Vector2).subVectors(_,w).divide(x),R=(new D.Vector2).subVectors(R,w).divide(x),F=(new D.Vector2).subVectors(F,w).divide(x),y=this.geometry=new D.BufferGeometry,V=[M.x,M.y,M.z,M.x,M.y,M.z,M.x,M.y,M.z],Y=[_.x,_.y,R.x,R.y,F.x,F.y],y.setAttribute("position",new D.Float32BufferAttribute([E.a.x,E.a.y,E.a.z,E.b.x,E.b.y,E.b.z,E.c.x,E.c.y,E.c.z],3)),y.setAttribute("normal",new D.Float32BufferAttribute(V,3)),y.setAttribute("uv",new D.Float32BufferAttribute(Y,2))}})},{"../core/geometry":137,"../lib/three":184}],182:[function(k,ae,Ue){if(window.Promise=window.Promise||k("promise-polyfill"),window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=void 0!==navigator.xr,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var D=k("./utils/isIOSOlderThan10")(window.navigator.userAgent)?1/window.devicePixelRatio:1,B=k("webvr-polyfill"),I={BUFFER_SCALE:D,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new B(I)}var w=k("./utils/"),T=w.debug;w.isIE11&&(k("custom-event-polyfill"),k("../vendor/starts-with-polyfill"));var x=T("A-Frame:error"),S=T("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&S("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&"file:"===window.location.protocol&&x("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server."),k("present"),w.device.isBrowserEnvironment&&(k("./style/aframe.css"),k("./style/rStats.css"));var y=k("./core/scene/a-scene").AScene,M=k("./core/component").components,E=k("./core/component").registerComponent,_=k("./core/geometry").registerGeometry,R=k("./extras/primitives/primitives").registerPrimitive,F=k("./core/shader").registerShader,O=k("./core/system").registerSystem,V=k("./core/shader").shaders,Y=k("./core/system").systems,ee=window.THREE=k("./lib/three"),oe=k("../package");k("./components/index"),k("./geometries/index"),k("./shaders/index"),k("./systems/index");var Ee=k("./core/a-node"),ve=k("./core/a-entity");k("./core/a-assets"),k("./core/a-cubemap"),k("./core/a-mixin"),k("./extras/components/"),k("./extras/primitives/"),console.log("A-Frame Version: 1.3.0 (Date 2022-02-04, Commit #cc3516ce)"),console.log("THREE Version (https://github.com/supermedium/three.js):",oe.dependencies["super-three"]),console.log("WebVR Polyfill Version:",oe.dependencies["webvr-polyfill"]),ae.exports=window.AFRAME={AComponent:k("./core/component").Component,AEntity:ve,ANode:Ee,ANIME:k("super-animejs"),AScene:y,components:M,coreComponents:Object.keys(M),geometries:k("./core/geometry").geometries,registerComponent:E,registerElement:k("./core/a-register-element").registerElement,registerGeometry:_,registerPrimitive:R,registerShader:F,registerSystem:O,primitives:{getMeshMixin:k("./extras/primitives/getMeshMixin"),primitives:k("./extras/primitives/primitives").primitives},scenes:k("./core/scene/scenes"),schema:k("./core/schema"),shaders:V,systems:Y,THREE:ee,utils:w,version:oe.version}},{"../package":74,"../vendor/starts-with-polyfill":225,"./components/index":87,"./core/a-assets":130,"./core/a-cubemap":131,"./core/a-entity":132,"./core/a-mixin":133,"./core/a-node":134,"./core/a-register-element":135,"./core/component":136,"./core/geometry":137,"./core/scene/a-scene":139,"./core/scene/scenes":143,"./core/schema":145,"./core/shader":146,"./core/system":147,"./extras/components/":148,"./extras/primitives/":151,"./extras/primitives/getMeshMixin":150,"./extras/primitives/primitives":152,"./geometries/index":173,"./lib/three":184,"./shaders/index":186,"./style/aframe.css":193,"./style/rStats.css":194,"./systems/index":198,"./utils/":212,"./utils/isIOSOlderThan10":215,"custom-event-polyfill":7,present:48,"promise-polyfill":50,"super-animejs":56,"webvr-polyfill":69}],183:[function(k,ae,Ue){window.aframeStats=function(b){var D=null,B=b;return{update:function(){var E;D("te").set((E=B.querySelectorAll("*"),Array.prototype.slice.call(E).filter(function(_){return _.isEntity}),E.length)),window.performance.getEntriesByName&&D("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(E){D=E},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}},"object"==typeof ae&&(ae.exports={aframeStats:window.aframeStats})},{}],184:[function(k,ae,Ue){(function(b){var D=b.THREE=k("super-three");D.TextureLoader&&(D.TextureLoader.prototype.crossOrigin="anonymous"),D.ImageLoader&&(D.ImageLoader.prototype.crossOrigin="anonymous"),D.Cache&&(D.Cache.enabled=!0),k("../../vendor/DeviceOrientationControls"),k("super-three/examples/js/loaders/DRACOLoader"),k("super-three/examples/js/loaders/GLTFLoader"),k("super-three/examples/js/loaders/OBJLoader"),k("super-three/examples/js/loaders/MTLLoader"),k("super-three/examples/js/utils/BufferGeometryUtils"),k("super-three/examples/js/lights/LightProbeGenerator"),D.DRACOLoader.prototype.crossOrigin="anonymous",D.GLTFLoader.prototype.crossOrigin="anonymous",D.MTLLoader.prototype.crossOrigin="anonymous",D.OBJLoader.prototype.crossOrigin="anonymous",ae.exports=D}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../vendor/DeviceOrientationControls":222,"super-three":57,"super-three/examples/js/lights/LightProbeGenerator":58,"super-three/examples/js/loaders/DRACOLoader":59,"super-three/examples/js/loaders/GLTFLoader":60,"super-three/examples/js/loaders/MTLLoader":61,"super-three/examples/js/loaders/OBJLoader":62,"super-three/examples/js/utils/BufferGeometryUtils":63}],185:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=k("../lib/three"),B=k("../utils/");function I(w,T){return T.color.set(w.color),T.fog=w.fog,T.wireframe=w.wireframe,T.wireframeLinewidth=w.wireframeLinewidth,T}ae.exports.Shader=b("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(w){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new D.Color},this.textureSrc=null,I(w,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new D.MeshBasicMaterial(this.materialData),B.material.updateMap(this,w)},update:function(w){this.updateMaterial(w),B.material.updateMap(this,w)},updateMaterial:function(w){var T;for(T in I(w,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.materialData)this.material[T]=this.materialData[T]}})},{"../core/shader":146,"../lib/three":184,"../utils/":212}],186:[function(k,ae,Ue){k("./flat"),k("./standard"),k("./phong"),k("./sdf"),k("./msdf"),k("./ios10hls"),k("./shadow")},{"./flat":185,"./ios10hls":187,"./msdf":188,"./phong":189,"./sdf":190,"./shadow":191,"./standard":192}],187:[function(k,ae,Ue){var b=k("../core/shader").registerShader;ae.exports.Shader=b("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join("\n")})},{"../core/shader":146}],188:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=!!document.createElement("canvas").getContext("webgl2"),B=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),I=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),w=D?I:B,T=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture2D(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n"),x=["#version 300 es","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  fragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n");ae.exports.Shader=b("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:w,fragmentShader:D?x:T})},{"../core/shader":146}],189:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=k("../lib/three"),B=k("../utils/"),I=new D.CubeTextureLoader,w={};function T(x,S){switch(S.color.set(x.color),S.specular.set(x.emissive),S.emissive.set(x.emissive),S.emissiveIntensity=x.emissiveIntensity,S.fog=x.fog,S.transparent=x.transparent,S.wireframe=x.wireframe,S.wireframeLinewidth=x.wireframeLinewidth,S.shininess=x.shininess,S.flatShading=x.flatShading,S.wireframe=x.wireframe,S.wireframeLinewidth=x.wireframeLinewidth,S.reflectivity=x.reflectivity,S.refractionRatio=x.refractionRatio,x.combine){case"mix":S.combine=D.MixOperation;break;case"multiply":S.combine=D.MultiplyOperation;break;case"add":S.combine=D.AddOperation}return x.normalMap&&(S.normalScale=x.normalScale),x.ambientOcclusionMap&&(S.aoMapIntensity=x.ambientOcclusionMapIntensity),x.bumpMap&&(S.aoMapIntensity=x.bumpMapScale),x.displacementMap&&(S.displacementScale=x.displacementScale,S.displacementBias=x.displacementBias),S}ae.exports.Shader=b("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(x){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new D.Color,specular:new D.Color,emissive:new D.Color},this.textureSrc=null,T(x,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new D.MeshPhongMaterial(this.materialData),B.material.updateMap(this,x)},update:function(x){this.updateMaterial(x),B.material.updateMap(this,x),x.normalMap&&B.material.updateDistortionMap("normal",this,x),x.displacementMap&&B.material.updateDistortionMap("displacement",this,x),x.ambientOcclusionMap&&B.material.updateDistortionMap("ambientOcclusion",this,x),x.bump&&B.material.updateDistortionMap("bump",this,x),this.updateEnvMap(x)},updateMaterial:function(x){var S;for(S in T(x,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.materialData)this.material[S]=this.materialData[S]},updateEnvMap:function(x){var S=this,y=this.material,M=x.envMap,E=x.sphericalEnvMap,_=x.refract,R=this.el.sceneEl;if(!M&&!E||this.isLoadingEnvMap)return Object.defineProperty(y,"envMap",{get:function(){return R.object3D.environment},set:function(F){delete this.envMap,this.envMap=F}}),void(y.needsUpdate=!0);this.isLoadingEnvMap=!0,delete y.envMap,E?this.el.sceneEl.systems.material.loadTexture(E,{src:E},function(O){S.isLoadingEnvMap=!1,O.mapping=_?D.EquirectangularRefractionMapping:D.EquirectangularReflectionMapping,y.envMap=O,B.material.handleTextureEvents(S.el,O),y.needsUpdate=!0}):w[M]?w[M].then(function(F){S.isLoadingEnvMap=!1,y.envMap=F,B.material.handleTextureEvents(S.el,F),y.needsUpdate=!0}):w[M]=new Promise(function(F){B.srcLoader.validateCubemapSrc(M,function(V){I.load(V,function(Y){S.isLoadingEnvMap=!1,y.envMap=Y,Y.mapping=_?D.CubeRefractionMapping:D.CubeReflectionMapping,B.material.handleTextureEvents(S.el,Y),F(Y)})})})}})},{"../core/shader":146,"../lib/three":184,"../utils/":212}],190:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=!!document.createElement("canvas").getContext("webgl2"),B=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),I=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),w=D?I:B,T=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture2D(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture2D(map, box.xy).a, width)","        + contour(texture2D(map, box.zw).a, width)","        + contour(texture2D(map, box.xw).a, width)","        + contour(texture2D(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture2D(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  gl_FragColor = vec4(color, opacity * alpha);","}"].join("\n"),x=["#version 300 es","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture(map, box.xy).a, width)","        + contour(texture(map, box.zw).a, width)","        + contour(texture(map, box.xw).a, width)","        + contour(texture(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  fragColor = vec4(color, opacity * alpha);","}"].join("\n");ae.exports.Shader=b("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:w,fragmentShader:D?x:T})},{"../core/shader":146}],191:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=k("../lib/three");ae.exports.Shader=b("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(B){this.rendererSystem=this.el.sceneEl.systems.renderer,this.material=new D.ShadowMaterial},update:function(B){this.material.opacity=B.opacity,this.material.alphaToCoverage=B.alphaToCoverage,this.material.transparent=B.transparent}})},{"../core/shader":146,"../lib/three":184}],192:[function(k,ae,Ue){var b=k("../core/shader").registerShader,D=k("../lib/three"),B=k("../utils/"),I=new D.CubeTextureLoader,w={};function T(x,S){return S.color.set(x.color),S.emissive.set(x.emissive),S.emissiveIntensity=x.emissiveIntensity,S.fog=x.fog,S.metalness=x.metalness,S.roughness=x.roughness,S.wireframe=x.wireframe,S.wireframeLinewidth=x.wireframeLinewidth,x.normalMap&&(S.normalScale=x.normalScale),x.ambientOcclusionMap&&(S.aoMapIntensity=x.ambientOcclusionMapIntensity),x.displacementMap&&(S.displacementScale=x.displacementScale,S.displacementBias=x.displacementBias),S}ae.exports.Shader=b("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(x){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new D.Color,emissive:new D.Color},T(x,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.material=new D.MeshStandardMaterial(this.materialData),B.material.updateMap(this,x),x.normalMap&&B.material.updateDistortionMap("normal",this,x),x.displacementMap&&B.material.updateDistortionMap("displacement",this,x),x.ambientOcclusionMap&&B.material.updateDistortionMap("ambientOcclusion",this,x),x.metalnessMap&&B.material.updateDistortionMap("metalness",this,x),x.roughnessMap&&B.material.updateDistortionMap("roughness",this,x),this.updateEnvMap(x)},update:function(x){this.updateMaterial(x),B.material.updateMap(this,x),x.normalMap&&B.material.updateDistortionMap("normal",this,x),x.displacementMap&&B.material.updateDistortionMap("displacement",this,x),x.ambientOcclusionMap&&B.material.updateDistortionMap("ambientOcclusion",this,x),x.metalnessMap&&B.material.updateDistortionMap("metalness",this,x),x.roughnessMap&&B.material.updateDistortionMap("roughness",this,x),this.updateEnvMap(x)},updateMaterial:function(x){var S,y=this.material;for(S in T(x,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.materialData)y[S]=this.materialData[S]},updateEnvMap:function(x){var S=this,y=this.material,M=x.envMap,E=x.sphericalEnvMap;if(!M&&!E||this.isLoadingEnvMap)return y.envMap=null,void(y.needsUpdate=!0);this.isLoadingEnvMap=!0,E?this.el.sceneEl.systems.material.loadTexture(E,{src:E},function(R){S.isLoadingEnvMap=!1,R.mapping=D.EquirectangularReflectionMapping,y.envMap=R,B.material.handleTextureEvents(S.el,R),y.needsUpdate=!0}):w[M]?w[M].then(function(_){S.isLoadingEnvMap=!1,y.envMap=_,B.material.handleTextureEvents(S.el,_),y.needsUpdate=!0}):w[M]=new Promise(function(_){B.srcLoader.validateCubemapSrc(M,function(F){I.load(F,function(O){S.isLoadingEnvMap=!1,y.envMap=O,B.material.handleTextureEvents(S.el,O),_(O)})})})}})},{"../core/shader":146,"../lib/three":184,"../utils/":212}],193:[function(k,ae,Ue){var b="html.a-fullscreen{bottom:0;left:0;position:fixed;right:0;top:0}html.a-fullscreen body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}html.a-fullscreen .a-canvas{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;position:fixed!important}html:not(.a-fullscreen) .a-enter-ar,html:not(.a-fullscreen) .a-enter-vr{right:5px;bottom:5px}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}canvas.a-canvas.a-mouse-cursor-hover:hover{cursor:pointer}.a-inspector-loader{background-color:#ed3160;position:fixed;left:3px;top:3px;padding:6px 10px;color:#fff;text-decoration:none;font-size:12px;font-family:Roboto,sans-serif;text-align:center;z-index:99999;width:204px}@keyframes dots-1{from{opacity:0}25%{opacity:1}}@keyframes dots-2{from{opacity:0}50%{opacity:1}}@keyframes dots-3{from{opacity:0}75%{opacity:1}}@-webkit-keyframes dots-1{from{opacity:0}25%{opacity:1}}@-webkit-keyframes dots-2{from{opacity:0}50%{opacity:1}}@-webkit-keyframes dots-3{from{opacity:0}75%{opacity:1}}.a-inspector-loader .dots span{animation:dots-1 2s infinite steps(1);-webkit-animation:dots-1 2s infinite steps(1)}.a-inspector-loader .dots span:first-child+span{animation-name:dots-2;-webkit-animation-name:dots-2}.a-inspector-loader .dots span:first-child+span+span{animation-name:dots-3;-webkit-animation-name:dots-3}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-ar,.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;position:absolute;right:20px;bottom:20px}.a-enter-ar{right:80px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff;user-select:none;outline:0}.a-enter-vr-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.35)}.a-enter-ar-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.2)}.a-enter-ar-button,.a-enter-vr-button{background-size:90% 90%;border:0;bottom:0;cursor:pointer;min-width:58px;min-height:34px;padding-right:0;padding-top:0;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999;border-radius:8px;touch-action:manipulation}.a-enter-ar-button{background-size:100% 90%;margin-right:10px;border-radius:7px}.a-enter-ar-button:active,.a-enter-ar-button:hover,.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#ef2d5e}.a-enter-vr-button.resethover{background-color:rgba(0,0,0,.35)}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:\"Insert phone into Cardboard holder.\";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}.a-loader-title{background-color:rgba(0,0,0,.6);font-family:sans-serif,monospace;text-align:center;font-size:20px;height:50px;font-weight:300;line-height:50px;position:absolute;right:0;left:0;top:0;color:#fff}.a-modal{background:0 0/50% 50% rgba(0,0,0,.6);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-dialog{position:relative;left:50%;top:50%;transform:translate(-50%,-50%);z-index:199995;width:300px;height:200px;background-size:contain;background-color:#fff;font-family:sans-serif,monospace;font-size:20px;border-radius:3px;padding:6px}.a-dialog-text-container{width:100%;height:70%;align-self:flex-start;display:flex;justify-content:center;align-content:center;flex-direction:column}.a-dialog-text{display:inline-block;font-weight:400;font-size:14pt;margin:8px}.a-dialog-buttons-container{display:inline-flex;align-self:flex-end;width:100%;height:30%}.a-dialog-button{cursor:pointer;align-self:center;opacity:.9;height:80%;width:50%;font-size:12pt;margin:4px;border-radius:2px;text-align:center;border:none;display:inline-block;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);user-select:none}.a-dialog-permission-button:hover{box-shadow:0 7px 14px rgba(0,0,0,.2),0 2px 2px rgba(0,0,0,.2)}.a-dialog-allow-button{background-color:#00ceff}.a-dialog-deny-button{background-color:#ff005b}.a-dialog-ok-button{background-color:#00ceff;width:100%}.a-dom-overlay:not(.a-no-style){overflow:hidden;position:absolute;pointer-events:none;box-sizing:border-box;bottom:0;left:0;right:0;top:0;padding:1em}.a-dom-overlay:not(.a-no-style)>*{pointer-events:auto}";k("browserify-css").createStyle(b,{href:"src/style/aframe.css"}),ae.exports=b},{"browserify-css":4}],194:[function(k,ae,Ue){var b=".rs-base{background-color:#333;color:#fafafa;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-base.alarm{color:#b70000;text-shadow:0 0 0 #b70000,0 0 1px #fff,0 0 1px #fff,0 0 2px #fff,0 0 2px #fff,0 0 3px #fff,0 0 3px #fff,0 0 4px #fff,0 0 4px #fff}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}";k("browserify-css").createStyle(b,{href:"src/style/rStats.css"}),ae.exports=b},{"browserify-css":4}],195:[function(k,ae,Ue){var b=k("../constants/"),D=k("../core/system").registerSystem,B="data-aframe-default-camera";ae.exports.System=D("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var w,T,x=this.sceneEl,S=this;if(!x.camera||x.camera.el.getAttribute("camera").spectator)if((w=x.querySelectorAll("a-camera, [camera]")).length)for(this.numUserCameras=w.length,T=0;T<w.length;T++)w[T].addEventListener("object3dset",function(y){"camera"===y.detail.type&&S.checkUserCamera(this)}),w[T].isNode?w[T].load():w[T].addEventListener("nodeready",function(){this.load()});else this.createDefaultCamera();else x.emit("cameraready",{cameraEl:x.camera.el})},checkUserCamera:function(w){var T,x=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(!(T=w.getAttribute("camera")).active||T.spectator)return void(this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera());this.initialCameraFound=!0,x.camera=w.getObject3D("camera"),x.emit("cameraready",{cameraEl:w})}},createDefaultCamera:function(){var w,T=this.sceneEl;(w=document.createElement("a-entity")).setAttribute("camera",{active:!0}),w.setAttribute("position",{x:0,y:b.DEFAULT_CAMERA_HEIGHT,z:0}),w.setAttribute("wasd-controls",""),w.setAttribute("look-controls",""),w.setAttribute(b.AFRAME_INJECTED,""),w.addEventListener("object3dset",function(x){"camera"===x.detail.type&&(T.camera=x.detail.object,T.emit("cameraready",{cameraEl:w}))}),T.appendChild(w)},disableActiveCamera:function(){var w;(w=this.sceneEl.querySelectorAll("[camera]"))[w.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(w){var T,x,S,y,M=this.activeCameraEl,E=this.sceneEl;if((y=w.getObject3D("camera"))&&w!==this.activeCameraEl){var _=E.querySelector("["+B+"]");for(w!==(_&&_.querySelector("[camera]"))&&function(w){var T;!w.camera||(T=w.querySelector("["+B+"]"))&&w.removeChild(T)}(E),this.activeCameraEl=w,this.activeCameraEl.play(),E.camera=y,M&&M.setAttribute("camera","active",!1),x=E.querySelectorAll("[camera]"),S=0;S<x.length;S++)(T=x[S]).isEntity&&w!==T&&(T.setAttribute("camera","active",!1),T.pause());E.emit("camera-set-active",{cameraEl:w})}},setSpectatorCamera:function(w){var y,x=this.spectatorCameraEl,S=this.sceneEl;w.getObject3D("camera")&&w!==this.spectatorCameraEl&&(x&&x.setAttribute("camera","spectator",!1),y=this.spectatorCameraEl=w,S.addEventListener("enter-vr",this.wrapRender),S.addEventListener("exit-vr",this.unwrapRender),y.setAttribute("camera","active",!1),y.play(),S.emit("camera-set-spectator",{cameraEl:w}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){!this.originalRender||(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(w,T){var x,y,S=this.sceneEl;x=S.renderer.xr.enabled,this.originalRender.call(S.renderer,w,T),this.spectatorCameraEl&&!S.isMobile&&x&&(y=this.spectatorCameraEl.components.camera.camera,S.renderer.xr.enabled=!1,this.originalRender.call(S.renderer,w,y),S.renderer.xr.enabled=x)}})},{"../constants/":128,"../core/system":147}],196:[function(k,ae,Ue){var b=k("../core/geometry").geometries,D=k("../core/system").registerSystem;function B(T){var x=T.primitive,S=b[x]&&b[x].Geometry,y=new S;if(!S)throw new Error("Unknown geometry `"+x+"`");return y.init(T),y.geometry}ae.exports.System=D("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(T){var S,y,x=this.cache;return T.skipCache?B(T):(S=x[y=this.hash(T)],function(T,x){T[x]=void 0===T[x]?1:T[x]+1}(this.cacheCount,y),S||(S=B(T),x[y]=S,S))},unuseGeometry:function(T){var M,x=this.cache,S=this.cacheCount;T.skipCache||x[M=this.hash(T)]&&(function(T,x){T[x]--}(S,M),!(S[M]>0)&&(x[M].dispose(),delete x[M],delete S[M]))},hash:function(T){return JSON.stringify(T)}})},{"../core/geometry":137,"../core/system":147}],197:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../lib/three");ae.exports.System=b("gltf-model",{schema:{dracoDecoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var I=this.data.dracoDecoderPath,w=this.data.meshoptDecoderPath;!this.dracoLoader&&I&&(this.dracoLoader=new D.DRACOLoader,this.dracoLoader.setDecoderPath(I)),!this.meshoptDecoder&&w&&(this.meshoptDecoder=function(I){return new Promise(function(w,T){var x=document.createElement("script");document.body.appendChild(x),x.onload=w,x.onerror=T,x.async=!0,x.src=I})}(w).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},{"../core/system":147,"../lib/three":184}],198:[function(k,ae,Ue){k("./camera"),k("./geometry"),k("./gltf-model"),k("./light"),k("./material"),k("./renderer"),k("./shadow"),k("./tracked-controls-webvr"),k("./tracked-controls-webxr"),k("./webxr")},{"./camera":195,"./geometry":196,"./gltf-model":197,"./light":199,"./material":200,"./renderer":201,"./shadow":202,"./tracked-controls-webvr":203,"./tracked-controls-webxr":204,"./webxr":205}],199:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../utils/bind"),B=k("../constants/"),I="data-aframe-default-light";ae.exports.System=b("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",D(this.setupDefaultLights,this))},registerLight:function(w){w.hasAttribute(I)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var w,T=this.sceneEl;if(this.defaultLights){w=document.querySelectorAll("["+I+"]");for(var x=0;x<w.length;x++)T.removeChild(w[x]);this.defaultLights=!1}},setupDefaultLights:function(){var T,x,w=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((T=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),T.setAttribute(I,""),T.setAttribute(B.AFRAME_INJECTED,""),w.appendChild(T),(x=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),x.setAttribute("position",{x:-.5,y:1,z:1}),x.setAttribute(I,""),x.setAttribute(B.AFRAME_INJECTED,""),w.appendChild(x),this.defaultLights=!0)}})},{"../constants/":128,"../core/system":147,"../utils/bind":206}],200:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../lib/three"),B=k("../utils/"),I=k("../utils/material").isHLS,w=k("../utils/material").setTextureProperties,T=B.bind,x=B.debug,S=x("components:texture:error"),y=new D.TextureLoader,M=x("components:texture:warn");y.setCrossOrigin("anonymous"),ae.exports.System=b("material",{init:function(){this.materials={},this.textureCounts={},this.textureCache={},this.sceneEl.addEventListener("materialtextureloaded",T(this.onMaterialTextureLoaded,this))},clearTextureCache:function(){this.textureCache={}},loadTexture:function(O,V,Y){var ee=this;if("CANVAS"!==O.tagName){if("VIDEO"===O.tagName)return!O.src&&!O.srcObject&&!O.childElementCount&&M("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes."),void this.loadVideo(O,V,Y);B.srcLoader.validateSrc(O,function(ve){ee.loadImage(ve,V,Y)},function(ve){ee.loadVideo(ve,V,Y)})}else this.loadCanvas(O,V,Y)},loadImage:function(O,V,Y){var ee=this.hash(V),oe=this.textureCache;oe[ee]||(oe[ee]=function(O,V){return new Promise(function(ee,oe){function ve(Ce){w(Ce,V),Ce.needsUpdate=!0,ee(Ce)}"string"!=typeof O?ve(new D.Texture(O)):y.load(O,ve,function(){},function(Ce){S("`$s` could not be fetched (Error code: %s; Response: %s)",Ce.status,Ce.statusText)})})}(O,V)),oe[ee].then(Y)},loadCanvas:function(O,V,Y){var ee;ee=new D.CanvasTexture(O),w(ee,V),Y(ee)},loadVideo:function(O,V,Y){var ee,oe,ve,Ce,Ee=this.textureCache;function He(we){we.texture.needsUpdate=!0,Y(we.texture,we.videoEl)}if("string"!=typeof O){if(Ee[ee=this.hashVideo(V,ve=O)])return void Ee[ee].then(He);!function(O){O.autoplay=O.hasAttribute("autoplay")&&"false"!==O.getAttribute("autoplay"),O.controls=O.hasAttribute("controls")&&"false"!==O.getAttribute("controls"),"false"===O.getAttribute("loop")&&O.removeAttribute("loop"),"false"===O.getAttribute("preload")&&(O.preload="none"),O.crossOrigin=O.crossOrigin||"anonymous",O.setAttribute("playsinline",""),O.setAttribute("webkit-playsinline","")}(ve)}ve=ve||function(O,V,Y){var ee=document.createElement("video");return ee.width=V,ee.height=Y,ee.setAttribute("playsinline",""),ee.setAttribute("webkit-playsinline",""),ee.autoplay=!0,ee.loop=!0,ee.crossOrigin="anonymous",ee.addEventListener("error",function(){M("`$s` is not a valid video",O)},!0),ee.src=O,ee}(O,V.width,V.height),Ee[ee=this.hashVideo(V,ve)]?Ee[ee].then(He):((oe=new D.VideoTexture(ve)).minFilter=D.LinearFilter,w(oe,V),this.sceneEl.isIOS&&I(ve.src||ve.getAttribute("src"),ve.type||ve.getAttribute("type"))&&(oe.format=D.RGBAFormat,oe.needsCorrectionBGRA=!0,oe.flipY=!1,oe.needsCorrectionFlipY=!0),Ce={texture:oe,videoEl:ve},Ee[ee]=Promise.resolve(Ce),He(Ce))},hash:function(O){return O.src.tagName&&((O=B.extendDeep({},O)).src=O.src.src),JSON.stringify(O)},hashVideo:function(O,V){return function(O,V){var Y,oe,Ee,ee=V.getAttribute("id");if(ee)return ee;for(oe="",Ee=O||{},Y=0;Y<V.attributes.length;Y++)Ee[V.attributes[Y].name]=V.attributes[Y].value;return Object.keys(Ee).sort().forEach(function(ve){oe+=ve+":"+Ee[ve]+";"}),oe}(O,V)},registerMaterial:function(O){this.materials[O.uuid]=O},unregisterMaterial:function(O){delete this.materials[O.uuid];var V=this.textureCounts;Object.keys(O).filter(function(Y){return O[Y]&&O[Y].isTexture}).forEach(function(Y){V[O[Y].uuid]--,V[O[Y].uuid]<=0&&O[Y].dispose()})},updateMaterials:function(O){var V=this.materials;Object.keys(V).forEach(function(Y){V[Y].needsUpdate=!0})},onMaterialTextureLoaded:function(O){this.textureCounts[O.detail.texture.uuid]||(this.textureCounts[O.detail.texture.uuid]=0),this.textureCounts[O.detail.texture.uuid]++}})},{"../core/system":147,"../lib/three":184,"../utils/":212,"../utils/material":216}],201:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../utils/"),B=k("../lib/three"),w=(0,D.debug)("components:renderer:warn");ae.exports.System=b("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:D.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:1920},maxCanvasHeight:{default:1920},physicallyCorrectLights:{default:!1},precision:{default:"high",oneOf:["high","medium","low"]},sortObjects:{default:!1},colorManagement:{default:!1},gammaOutput:{default:!1},alpha:{default:!0},foveationLevel:{default:0}},init:function(){var T=this.data,x=this.el,S=x.renderer;S.sortObjects=T.sortObjects,S.physicallyCorrectLights=T.physicallyCorrectLights,(T.colorManagement||T.gammaOutput)&&(S.outputEncoding=B.sRGBEncoding,T.gammaOutput&&w('Property `gammaOutput` is deprecated. Use `renderer="colorManagement: true;"` instead.')),x.hasAttribute("antialias")&&w('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),x.hasAttribute("logarithmicDepthBuffer")&&w('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.')},applyColorCorrection:function(T){!this.data.colorManagement||!T||(T.isColor?T.convertSRGBToLinear():T.isTexture&&(T.encoding=B.sRGBEncoding))}})},{"../core/system":147,"../lib/three":184,"../utils/":212}],202:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../lib/three"),B={basic:D.BasicShadowMap,pcf:D.PCFShadowMap,pcfsoft:D.PCFSoftShadowMap};ae.exports.System=b("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var I=this.sceneEl,w=this.data;this.shadowMapEnabled=!1,I.renderer&&(I.renderer.shadowMap.type=B[w.type],I.renderer.shadowMap.autoUpdate=w.autoUpdate,this.setShadowMapEnabled(this.shadowMapEnabled))},update:function(I){I.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.data.enabled)},setShadowMapEnabled:function(I){var w=this.sceneEl.renderer;this.shadowMapEnabled=this.data.enabled&&I,w&&(w.shadowMap.enabled=this.shadowMapEnabled)}})},{"../core/system":147,"../lib/three":184}],203:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../utils"),B=D.device.isWebXRAvailable;ae.exports.System=b("tracked-controls-webvr",{init:function(){var I=this;this.controllers=[],this.isChrome=-1!==navigator.userAgent.indexOf("Chrome"),this.updateControllerList(),this.throttledUpdateControllerList=D.throttle(this.updateControllerList,500,this),!B&&(!navigator.getVRDisplays||this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(w){w.length&&(I.vrDisplay=w[0])})}))},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var w,T,x,S,I=this.controllers;if(T=navigator.getGamepads&&navigator.getGamepads()){for(S=I.length,I.length=0,x=0;x<T.length;++x)(w=T[x])&&w.pose&&I.push(w);I.length!==S&&this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":147,"../utils":212}],204:[function(k,ae,Ue){var b=k("../core/system").registerSystem,D=k("../utils");ae.exports.System=b("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=D.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var B=this,I=this.el.xrSession;if(!I)return this.referenceSpace=void 0,this.controllers=[],void(this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1)));var w=B.el.sceneEl.systems.webxr.sessionReferenceSpaceType;I.requestReferenceSpace(w).then(function(T){B.referenceSpace=T}).catch(function(T){throw B.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(w,'tracked-controls-webxr uses reference space "'+w+'".'),T})},updateControllerList:function(){var w,B=this.el.xrSession,I=this.oldControllers;if(!B){if(0===this.oldControllersLength)return;return this.oldControllersLength=0,this.controllers=[],void this.el.emit("controllersupdated",void 0,!1)}if(B.inputSources){if(this.controllers=B.inputSources,this.oldControllersLength===this.controllers.length){var T=!0;for(w=0;w<this.controllers.length;++w)if(this.controllers[w]!==I[w]||this.controllers[w].gamepad!==I[w].gamepad){T=!1;break}if(T)return}for(I.length=0,w=0;w<this.controllers.length;w++)I.push(this.controllers[w]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":147,"../utils":212}],205:[function(k,ae,Ue){var b=k("../core/system").registerSystem,B=k("../utils/").debug("systems:webxr:warn");ae.exports.System=b("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var I=this.data;this.sessionConfiguration={requiredFeatures:I.requiredFeatures,optionalFeatures:I.optionalFeatures},this.sessionReferenceSpaceType=I.referenceSpaceType,I.overlayElement&&(I.overlayElement.classList.remove("a-dom-overlay"),I.optionalFeatures.includes("dom-overlay")||(I.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",I)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:I.overlayElement},I.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(I){return!("viewer"!==I&&"local"!==I&&!this.sessionConfiguration.requiredFeatures.includes(I)&&!this.sessionConfiguration.optionalFeatures.includes(I))},warnIfFeatureNotRequested:function(I,w){this.wasFeatureRequested(I)||B((w?w+" ":"")+'Please add the feature "'+I+"\" to a-scene's webxr system options in requiredFeatures/optionalFeatures.")}})},{"../core/system":147,"../utils/":212}],206:[function(k,ae,Ue){ae.exports=function(D,B){return I=Array.prototype.slice.call(arguments,2),function(){var T=I.concat(Array.prototype.slice.call(arguments,0));return D.apply(B,T)};var I}},{}],207:[function(k,ae,Ue){var b=k("./debug"),D=k("object-assign"),B=b("utils:coordinates:warn"),I=["x","y","z","w"],w=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;ae.exports.regex=w;var T="object",x=/\s+/g;function M(_){return w.test(_)}function E(_){return null!=_&&_.constructor===String?parseFloat(_,10):_}ae.exports.parse=function(_,R){var F,O,V,Y,ee,oe,Ee,ve,Ce;if(_&&_ instanceof Object)return Ee=void 0===_.y?R&&R.y:_.y,ve=void 0===_.z?R&&R.z:_.z,Ce=void 0===_.w?R&&R.w:_.w,null!=(oe=void 0===_.x?R&&R.x:_.x)&&(_.x=E(oe)),null!=Ee&&(_.y=E(Ee)),null!=ve&&(_.z=E(ve)),null!=Ce&&(_.w=E(Ce)),_;if(null==_)return typeof R===T?D({},R):R;for(F=_.trim().split(x),ee={},Y=0;Y<I.length;Y++)if(V=I[Y],F[Y])ee[V]=parseFloat(F[Y],10);else{if(void 0===(O=R&&R[V]))continue;ee[V]=E(O)}return ee},ae.exports.stringify=function(_){var R;return typeof _!==T?_:(R=_.x+" "+_.y,null!=_.z&&(R+=" "+_.z),null!=_.w&&(R+=" "+_.w),R)},ae.exports.isCoordinates=M,ae.exports.isCoordinate=function(_){return B("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),M(_)},ae.exports.toVector3=function(_){return new THREE.Vector3(_.x,_.y,_.z)}},{"./debug":208,"object-assign":39}],208:[function(k,ae,Ue){(function(b){var D=k("debug"),B=k("object-assign"),I={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},w=function(M){var E=D(M);return E.color=function(M){var E=function(M){var E=M.split(":");return E[E.length-1]}(M);return I.colors&&I.colors[E]||null}(M),E};B(w,D);var y=function(){try{return window.localStorage}catch(M){}}();y&&(parseInt(y.logs,10)||"true"===y.logs)?w.enable("*"):w.enable("*:error,*:info,*:warn"),b.browser&&(window.logs=w),ae.exports=w}).call(this,k("_process"))},{_process:49,debug:8,"object-assign":39}],209:[function(k,ae,Ue){(function(b){var B,D=k("debug")("device:error"),I=!1,w=!1,T=ae.exports.isWebXRAvailable=!window.debug&&void 0!==navigator.xr;if(window.addEventListener("vrdisplayactivate",function(Ee){var ve;T||(ve=document.createElement("canvas"),B=Ee.display,ve.getContext("webgl",{}),B.requestPresent([{source:ve}]).then(function(){},function(){}))}),T){var x=function(){var Ee=document.querySelector("a-scene");Ee?Ee.hasLoaded?Ee.components["vr-mode-ui"].updateEnterInterfaces():Ee.addEventListener("loaded",x):window.addEventListener("DOMContentLoaded",x)},S=function(Ee){D("WebXR session support error: "+Ee.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(Ee){I=Ee,x()}).catch(S),navigator.xr.isSessionSupported("immersive-ar").then(function(Ee){w=Ee,x()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){I=!0,x()}).catch(S),navigator.xr.supportsSession("immersive-ar").then(function(){w=!0,x()}).catch(function(){})):D("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(Ee){var ve=document.querySelector("a-scene");B=Ee.length&&Ee[0],ve&&ve.emit("displayconnected",{vrDisplay:B})});function y(){return B}ae.exports.getVRDisplay=y,ae.exports.checkHeadsetConnected=function(){return I||w||!!y()},ae.exports.checkARSupport=function(){return w};var ve,Ee,_=(Ee=!1,ve=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ve)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ve.substr(0,4)))&&(Ee=!0),(F()||R()||oe())&&(Ee=!0),ee()&&(Ee=!1),function(){return Ee});function R(Ee){var ve=Ee||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(ve)}function F(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function V(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function Y(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function ee(){return V()||Y()}function oe(){return/R7 Build/.test(window.navigator.userAgent)}ae.exports.isMobile=_,ae.exports.isTablet=R,ae.exports.isIOS=F,ae.exports.isMobileDeviceRequestingDesktopSite=function(){return!_()&&!ee()&&void 0!==window.orientation},ae.exports.isOculusBrowser=V,ae.exports.isFirefoxReality=Y,ae.exports.isMobileVR=ee,ae.exports.isR7=oe,ae.exports.isLandscape=function(){var Ee=window.orientation;return oe()&&(Ee+=90),90===Ee||-90===Ee},ae.exports.isBrowserEnvironment=!(b&&!b.browser),ae.exports.isNodeEnvironment=!ae.exports.isBrowserEnvironment}).call(this,k("_process"))},{_process:49,debug:8}],210:[function(k,ae,Ue){var b={};function D(B,I){return b[I=I||"."]||(b[I]={}),b[I][B]=-1!==B.indexOf(I)?B.split(I):B,b[I][B]}ae.exports.getComponentPropertyPath=D,ae.exports.propertyPathCache=b,ae.exports.getComponentProperty=function(B,I,w){var T;return-1!==I.indexOf(w=w||".")?(T=D(I,w)).constructor===String?B.getAttribute(T):B.getAttribute(T[0])[T[1]]:B.getAttribute(I)},ae.exports.setComponentProperty=function(B,I,w,T){var x;-1===I.indexOf(T=T||".")?B.setAttribute(I,w):(x=D(I,T)).constructor===String?B.setAttribute(x,w):B.setAttribute(x[0],x[1],w)}},{}],211:[function(k,ae,Ue){ae.exports=function(D){var B=D.style.width,I=D.style.height;D.style.width=parseInt(B,10)+1+"px",D.style.height=parseInt(I,10)+1+"px",setTimeout(function(){D.style.width=B,D.style.height=I},200)}},{}],212:[function(k,ae,Ue){var b=k("./debug"),D=k("deep-assign"),B=k("./device"),I=k("object-assign"),w=k("./object-pool"),T=b("utils:warn");ae.exports.bind=k("./bind"),ae.exports.coordinates=k("./coordinates"),ae.exports.debug=b,ae.exports.device=B,ae.exports.entity=k("./entity"),ae.exports.forceCanvasResizeSafariMobile=k("./forceCanvasResizeSafariMobile"),ae.exports.isIE11=k("./is-ie11"),ae.exports.material=k("./material"),ae.exports.objectPool=w,ae.exports.split=k("./split").split,ae.exports.styleParser=k("./styleParser"),ae.exports.trackedControls=k("./tracked-controls"),ae.exports.checkHeadsetConnected=function(){return T("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),B.checkHeadsetConnected(arguments)},ae.exports.isGearVR=ae.exports.device.isGearVR=function(){T("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},ae.exports.isIOS=function(){return T("`utils.isIOS` has moved to `utils.device.isIOS`"),B.isIOS(arguments)},ae.exports.isOculusGo=ae.exports.device.isOculusGo=function(){T("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},ae.exports.isMobile=function(){return T("`utils.isMobile has moved to `utils.device.isMobile`"),B.isMobile(arguments)},ae.exports.throttle=function(S,y,M){var E;return M&&(S=ae.exports.bind(S,M)),function(){var _=Date.now();(void 0===E||(void 0===E?y:_-E)>=y)&&(E=_,S.apply(null,arguments))}},ae.exports.throttleComponentChanged=function(S,y,M){var E,_;return M&&(S=ae.exports.bind(S,M)),function(){var R=Date.now(),F=void 0===E?y:R-E,O=arguments;void 0===E||F>=y?(clearTimeout(_),E=R,S.apply(null,O)):(clearTimeout(_),_=setTimeout(function(){E=Date.now(),S.apply(this,O)},y-F))}},ae.exports.throttleTick=function(S,y,M){var E;return M&&(S=ae.exports.bind(S,M)),function(_,R){var F=void 0===E?R:_-E;(void 0===E||F>=y)&&(E=_,S(_,F))}},ae.exports.debounce=function(S,y,M){var E;return function(){var _=this,R=arguments,F=function(){E=null,M||S.apply(_,R)},O=M&&!E;clearTimeout(E),E=setTimeout(F,y),O&&S.apply(_,R)}},ae.exports.extend=I,ae.exports.extendDeep=D,ae.exports.clone=function(S){return JSON.parse(JSON.stringify(S))};var S,x=(S=w.createPool(function(){return[]}),function(y,M){var E,_,R,F,O,V;if(void 0===y||void 0===M||null===y||null===M||!(y&&M&&y.constructor===Object&&M.constructor===Object||y.constructor===Array&&M.constructor===Array))return y===M;for(E in _=S.use(),R=S.use(),_.length=0,R.length=0,y)_.push(E);for(E in M)R.push(E);if(_.length!==R.length)return S.recycle(_),S.recycle(R),!1;for(F=0;F<_.length;++F)if(V=M[_[F]],"object"==typeof(O=y[_[F]])||"object"==typeof V||Array.isArray(O)&&Array.isArray(V)){if(O===V)continue;if(!x(O,V))return S.recycle(_),S.recycle(R),!1}else if(O!==V)return S.recycle(_),S.recycle(R),!1;return S.recycle(_),S.recycle(R),!0});ae.exports.deepEqual=x,ae.exports.diff=function(){var S=[];return function(y,M,E){var _,R,F,O,V,Y,ee;for(V in O=E||{},S.length=0,y)S.push(V);if(!M)return O;for(F in M)-1===S.indexOf(F)&&S.push(F);for(Y=0;Y<S.length;Y++)R=M[V=S[Y]],((ee=(_=y[V])&&R&&_.constructor===Object&&R.constructor===Object)&&!x(_,R)||!ee&&_!==R)&&(O[V]=R);return O}}(),ae.exports.shouldCaptureKeyEvent=function(S){return!S.metaKey&&document.activeElement===document.body},ae.exports.splitString=function(S,y){void 0===y&&(y=" ");var M=new RegExp(y,"g");return(S=(S||"").replace(M,y)).split(y)},ae.exports.getElData=function(S,y){y=y||{};var M={};return Object.keys(y).forEach(function(_){S.hasAttribute(_)&&(M[_]=S.getAttribute(_))}),M},ae.exports.getUrlParameter=function(S){S=S.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var M=new RegExp("[\\?&]"+S+"=([^&#]*)").exec(location.search);return null===M?"":decodeURIComponent(M[1].replace(/\+/g," "))},ae.exports.isIframed=function(){return window.top!==window.self},ae.exports.findAllScenes=function(S){for(var y=[],M=S.getElementsByTagName("*"),E=0,_=M.length;E<_;E++)M[E].isScene&&y.push(M[E]);return y},ae.exports.srcLoader=k("./src-loader")},{"./bind":206,"./coordinates":207,"./debug":208,"./device":209,"./entity":210,"./forceCanvasResizeSafariMobile":211,"./is-ie11":214,"./material":216,"./object-pool":217,"./split":218,"./src-loader":219,"./styleParser":220,"./tracked-controls":221,"deep-assign":10,"object-assign":39}],213:[function(k,ae,Ue){window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},{}],214:[function(k,ae,Ue){var D,B;ae.exports=11===(D=-1,B=navigator.userAgent,"Microsoft Internet Explorer"===navigator.appName?null!=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(B)&&(D=parseFloat(RegExp.$1)):"Netscape"===navigator.appName&&null!=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})").exec(B)&&(D=parseFloat(RegExp.$1)),D)},{}],215:[function(k,ae,Ue){ae.exports=function(D){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(D)}},{}],216:[function(k,ae,Ue){var b=k("../lib/three"),D=["application/x-mpegurl","application/vnd.apple.mpegurl"],B=new Set(["emissiveMap","envMap","map","specularMap"]);function I(T,x){var S=x.offset||{x:0,y:0},y=x.repeat||{x:1,y:1};!!x.npot&&(T.wrapS=b.ClampToEdgeWrapping,T.wrapT=b.ClampToEdgeWrapping,T.magFilter=b.LinearFilter,T.minFilter=b.LinearFilter),(1!==y.x||1!==y.y)&&(T.wrapS=b.RepeatWrapping,T.wrapT=b.RepeatWrapping,T.repeat.set(y.x,y.y)),(0!==S.x||0!==S.y)&&T.offset.set(S.x,S.y)}function w(T,x){!x||(T.emit("materialtextureloaded",{src:x.image,texture:x}),x.image&&"VIDEO"===x.image.tagName&&(x.image.addEventListener("loadeddata",function(){!T.components||!T.components.material||(x.needsCorrectionBGRA&&x.needsCorrectionFlipY&&-1!==["standard","flat"].indexOf(T.components.material.data.shader)&&T.setAttribute("material","shader","ios10hls"),T.emit("materialvideoloadeddata",{src:x.image,texture:x}))}),x.image.addEventListener("ended",function(){T.emit("materialvideoended",{src:x.image,texture:x})})))}ae.exports.setTextureProperties=I,ae.exports.updateMapMaterialFromData=function(T,x,S,y){var M=S.el,E=S.material,_=M.sceneEl.systems.renderer,R=y[x];if(S.materialSrcs||(S.materialSrcs={}),!R)return delete S.materialSrcs[T],void O(null);function O(V){E[T]=V,V&&B.has(T)&&_.applyColorCorrection(V),E.needsUpdate=!0,w(M,V)}R===S.materialSrcs[T]&&E[T]?I(E[T],y):(S.materialSrcs[T]=R,R instanceof b.Texture?O(R):M.sceneEl.systems.material.loadTexture(R,{src:R,repeat:y.repeat,offset:y.offset,npot:y.npot},function(V){S.materialSrcs[T]===R&&O(V)}))},ae.exports.updateMap=function(T,x){return ae.exports.updateMapMaterialFromData("map","src",T,x)},ae.exports.updateDistortionMap=function(T,x,S){var y=T;"ambientOcclusion"===T&&(y="ao");var M=x.el,E=x.material,_=M.sceneEl.systems.renderer,R=S[T+"Map"],F={};if(F.src=R,F.offset=S[T+"TextureOffset"],F.repeat=S[T+"TextureRepeat"],F.wrap=S[T+"TextureWrap"],R){if(R===x[T+"TextureSrc"])return;return x[T+"TextureSrc"]=R,void M.sceneEl.systems.material.loadTexture(R,F,O)}function O(V){var Y=y+"Map";E[Y]=V,V&&B.has(Y)&&_.applyColorCorrection(V),V&&I(V,S),E.needsUpdate=!0,w(M,V)}E.map&&O(null)},ae.exports.handleTextureEvents=w,ae.exports.isHLS=function(T,x){return!!(x&&D.includes(x.toLowerCase())||T&&T.toLowerCase().indexOf(".m3u8")>0)}},{"../lib/three":184}],217:[function(k,ae,Ue){var b=Object.freeze(Object.create(null));function D(){return{}}function B(w){var T;if(w&&w.constructor===Object)for(T in w)w[T]=void 0}ae.exports.createPool=function(T){var x=[],S=null;function E(R){var F,O;if((R=void 0===R?x.length:R)>0&&null==S&&(S=0),R>0)for(F=x.length,x.length+=Number(R),O=F;O<x.length;O++)x[O]=T();return x.length}return T=T||D,{grow:E,pool:x,recycle:function(R){if(R instanceof Object){if(null===S||-1===S)return void(x[x.length]=R);x[--S]=R}},size:function(){return x.length},use:function(){var R;return(null===S||S===x.length)&&E(x.length||5),R=x[S],x[S++]=b,B(R),R}}},ae.exports.clearObject=B,ae.exports.removeUnusedKeys=function(w,T){var x;if(w&&w.constructor===Object)for(x in w)x in T||delete w[x]}},{}],218:[function(k,ae,Ue){var b;ae.exports.split=(b={},function(D,B){return B in b||(b[B]={}),D in b[B]||(b[B][D]=D.split(B)),b[B][D]})},{}],219:[function(k,ae,Ue){var D=k("./debug")("utils:src-loader:warn");function B(y,M,E){!function(y,M){var E;y.tagName?M("IMG"===y.tagName):((E=new XMLHttpRequest).open("HEAD",y),E.addEventListener("load",function(_){var R;E.status>=200&&E.status<300?null==(R=E.getResponseHeader("Content-Type"))?x(y,M):R.startsWith("image")?M(!0):M(!1):x(y,M),E.abort()}),E.send())}(y,function(R){R?M(y):E(y)})}function w(y){var M=y.match(/\url\((.+)\)/);if(M)return M[1]}function x(y,M){var E=new Image;E.addEventListener("load",function(){M(!0)}),E.addEventListener("error",function(){M(!1)}),E.src=y}ae.exports={parseUrl:w,validateSrc:B,validateCubemapSrc:function(y,M){var E,R,F,_="",O=[];for(R=0;R<5;R++)_+="(url\\((?:[^\\)]+)\\),\\s*)";function V(Y){O.push(Y),6===O.length&&M(O)}if(_+="(url\\((?:[^\\)]+)\\)\\s*)",F=y.match(new RegExp(_)))for(R=1;R<7;R++)B(w(F[R]),V);else if(E=function(y){try{var M=document.querySelector(y);return M||D('No element was found matching the selector: "%s"',y),M}catch(E){return void D('"%s" is not a valid selector',y)}}(y)){if("A-CUBEMAP"===E.tagName&&E.srcs)return M(E.srcs);D('Selector "%s" does not point to <a-cubemap>',y)}}}},{"./debug":208}],220:[function(k,ae,Ue){var b=/-([a-z])/g;function D(S){return S.replace(b,x)}function B(S){var y,M;for(M in S)M!==(y=D(M))&&(S[y]=S[M],delete S[M]);return S}ae.exports.parse=function(S,y){var M;return"string"!=typeof S||(M=function(S,y){var M,E,_,R,F,O;for(y=y||{},M=I(S),E=0;E<M.length;E++)(_=M[E])&&(R=_.indexOf(":"),F=_.substr(0,R).trim(),O=_.substr(R+1).trim(),y[F]=O);return y}(S,y))[""]?S:B(M)},ae.exports.stringify=function(S){return"string"==typeof S?S:function(S){var y,M=0,E=0,_="";for(y in S)M++;for(y in S)_+=y+": "+S[y],E<M-1&&(_+="; "),E++;return _}(S)},ae.exports.toCamelCase=D,ae.exports.transformKeysToCamelCase=B;var S,y,I=(S=[],y=/url\([^)]+$/,function(E){var R,_="",F=0;for(S.length=0;F<E.length;)-1===(R=E.indexOf(";",F))&&(R=E.length),_+=E.substring(F,R),y.test(_)?(_+=";",F=R+1):(S.push(_.trim()),_="",F=R+1);return S});function x(S){return S[1].toUpperCase()}},{}],221:[function(k,ae,Ue){var b=k("../constants").DEFAULT_HANDEDNESS,D=["x","y","z","w"];function I(S,y,M){var E,R,_=S.el.sceneEl;return!!(y&&(R=_&&_.systems["tracked-controls-webvr"],R)&&(E=R.controllers,E.length))&&!!T(E,null,y,M.hand,M.index||0)}function w(S,y,M){var E,_=S.el.sceneEl,R=_&&_.systems["tracked-controls-webxr"];return!!(R&&(E=R.controllers,E&&E.length))&&x(E,y,M.hand,M.index,M.iterateControllerProfiles,M.handTracking)}function T(S,y,M,E,_){var R,F,O=0;for(F=0;F<S.length;F++)if(R=S[F],(!M||R.id.startsWith(M))&&(M||R.id===y)&&(!E||!R.hand||E===R.hand)){if(!E||R.hand)return R;if(O===2*_+(E===b?0:1))return R;++O}}function x(S,y,M,E,_,R){var F,O,V,oe,Y=!1;for(F=0;F<S.length;F++){if(oe=(V=S[F]).profiles,R)Y=V.hand;else if(_)for(O=0;O<oe.length&&!(Y=oe[O].startsWith(y));O++);else Y=oe.length>0&&oe[0].startsWith(y);if(Y)if("right"===V.handedness||"left"===V.handedness){if(V.handedness===M)return S[F]}else if(F===E)return S[F]}}ae.exports.checkControllerPresentAndSetup=function(S,y,M){var _,O,E=S.el,R=E.sceneEl.hasWebXR;if(O=!!(_=(R?w:I)(S,y,M)),S.controllerPresent&&!S.controllerEventsActive&&!R&&S.addEventListeners(),O===S.controllerPresent)return O;S.controllerPresent=O,O?(S.addEventListeners(),S.injectTrackedControls(_),E.emit("controllerconnected",{name:S.name,component:S})):(S.removeEventListeners(),E.emit("controllerdisconnected",{name:S.name,component:S}))},ae.exports.isControllerPresentWebVR=I,ae.exports.isControllerPresentWebXR=w,ae.exports.findMatchingControllerWebVR=T,ae.exports.findMatchingControllerWebXR=x,ae.exports.emitIfAxesChanged=function(S,y,M){var E,_,R,F,O;for(_ in y){for(E=y[_],R=!1,O=0;O<E.length;O++)M.detail.changed[E[O]]&&(R=!0);if(R){for(F={},O=0;O<E.length;O++)F[D[O]]=M.detail.axis[E[O]];S.el.emit(_+"moved",F)}}},ae.exports.onButtonEvent=function(S,y,M,E){var R=(E?M.mapping[E]:M.mapping).buttons[S];M.el.emit(R+y),M.updateModel&&M.updateModel(R,y)}},{"../constants":128}],222:[function(k,ae,Ue){THREE.DeviceOrientationControls=function(b){var D=this;this.object=b,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var T,x,S,y,B=function(T){D.deviceOrientation=T},I=function(){D.screenOrientation=window.orientation||0},w=(T=new THREE.Vector3(0,0,1),x=new THREE.Euler,S=new THREE.Quaternion,y=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(M,E,_,R,F){x.set(_,E,-R,"YXZ"),M.setFromEuler(x),M.multiply(y),M.multiply(S.setFromAxisAngle(T,-F))});this.connect=function(){I(),window.addEventListener("orientationchange",I,!1),window.addEventListener("deviceorientation",B,!1),D.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",I,!1),window.removeEventListener("deviceorientation",B,!1),D.enabled=!1},this.update=function(){if(!1!==D.enabled){var T=D.deviceOrientation;if(T){var x=T.alpha?THREE.Math.degToRad(T.alpha)+D.alphaOffset:0,S=T.beta?THREE.Math.degToRad(T.beta):0,y=T.gamma?THREE.Math.degToRad(T.gamma):0,M=D.screenOrientation?THREE.Math.degToRad(D.screenOrientation):0;w(D.object.quaternion,x,S,y,M)}}},this.dispose=function(){D.disconnect()},this.connect()}},{}],223:[function(k,ae,Ue){window.glStats=function(){var b=null,D=0,B=0,I=0,w=0,T=0,x=0,S=0;function y(Y,ee){return function(){ee.apply(this,arguments),Y.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=y(WebGLRenderingContext.prototype.drawArrays,function(){D++,arguments[0]==this.POINTS?x+=arguments[2]:T+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=y(WebGLRenderingContext.prototype.drawElements,function(){B++,w+=arguments[1]/3,T+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=y(WebGLRenderingContext.prototype.useProgram,function(){I++}),WebGLRenderingContext.prototype.bindTexture=y(WebGLRenderingContext.prototype.bindTexture,function(){S++}),{update:function(){b("allcalls").set(D+B),b("drawElements").set(B),b("drawArrays").set(D),b("bindTexture").set(S),b("useProgram").set(I),b("glfaces").set(w),b("glvertices").set(T),b("glpoints").set(x)},start:function(){D=0,B=0,I=0,w=0,T=0,x=0,S=0},end:function(){},attach:function(Y){b=Y},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(b){var D=null;return{update:function(){D("renderer.info.memory.geometries").set(b.info.memory.geometries),D("renderer.info.programs").set(b.info.programs.length),D("renderer.info.memory.textures").set(b.info.memory.textures),D("renderer.info.render.calls").set(b.info.render.calls),D("renderer.info.render.triangles").set(b.info.render.triangles),D("renderer.info.render.points").set(b.info.render.points)},start:function(){},end:function(){},attach:function(M){D=M},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var b=null,D=0,B=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var x=Math.log(1024);function S(R){var O=Math.floor(Math.log(R)/x);return Math.round(100*R/Math.pow(1024,O))/100}return{update:function(){D=S(performance.memory.usedJSHeapSize),B=S(performance.memory.totalJSHeapSize),b("memory").set(D),b("total").set(B)},start:function(){D=0},end:function(){},attach:function(R){b=R},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},"object"==typeof ae&&(ae.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats})},{}],224:[function(k,ae,Ue){"use strict";(function(){"performance"in window||(window.performance={});var b=window.performance;if(!("now"in b)){var D=Date.now();b.timing&&b.timing.navigationStart&&(D=b.timing.navigationStart),b.now=function(){return Date.now()-D}}b.mark||(b.mark=function(){}),b.measure||(b.measure=function(){})})(),window.rStats=function(D){function B(Ce,He){for(var we=Object.keys(Ce),ce=0,Me=we.length;ce<Me;ce++)He(we[ce])}var w=D||{},T=w.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];(w.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",(w.CSSPath?w.CSSPath:"")+"rStats.css"]).forEach(function(Ce){!function(Ce){var He=document.createElement("link");He.href=Ce,He.rel="stylesheet",He.type="text/css",document.getElementsByTagName("head")[0].appendChild(He)}(Ce)}),w.values||(w.values={});var M,E,_=10,F={};function O(Ce,He,we){var ce=we||{},Me=document.createElement("canvas"),fe=Me.getContext("2d"),je=0,it=0,ft=ce.color?ce.color:"#666666",ht=document.createElement("canvas"),_t=ht.getContext("2d");ht.width=1,ht.height=20,_t.fillStyle="#444444",_t.fillRect(0,0,1,20),_t.fillStyle=ft,_t.fillRect(0,_,1,_),_t.fillStyle="#ffffff",_t.globalAlpha=.5,_t.fillRect(0,_,1,1),_t.globalAlpha=1;var Bt=document.createElement("canvas"),_n=Bt.getContext("2d");return Bt.width=1,Bt.height=20,_n.fillStyle="#444444",_n.fillRect(0,0,1,20),_n.fillStyle="#b70000",_n.fillRect(0,_,1,_),_n.globalAlpha=.5,_n.fillStyle="#ffffff",_n.fillRect(0,_,1,1),_n.globalAlpha=1,Me.width=200,Me.height=_,Me.style.width=Me.width+"px",Me.style.height=Me.height+"px",Me.className="rs-canvas",Ce.appendChild(Me),fe.fillStyle="#444444",fe.fillRect(0,0,Me.width,Me.height),{draw:function(vi,bn){(it+=.1*(vi-it))>(je*=.99)&&(je=it),fe.drawImage(Me,1,0,Me.width-1,Me.height,0,0,Me.width-1,Me.height),fe.drawImage(bn?Bt:ht,Me.width-1,Me.height-it*Me.height/je-_)}}}function V(Ce,He){var we=document.createElement("canvas"),ce=we.getContext("2d");return we.width=200,we.height=_*He,we.style.width=we.width+"px",we.style.height=we.height+"px",we.className="rs-canvas",Ce.appendChild(we),ce.fillStyle="#444444",ce.fillRect(0,0,we.width,we.height),{draw:function(je){ce.drawImage(we,1,0,we.width-1,we.height,0,0,we.width-1,we.height);var it=0;B(je,function(ft){var ht=je[ft]*we.height;ce.fillStyle=T[ft],ce.fillRect(we.width-1,it,1,ht),it+=ht})}}}function Y(Ce,He){var ce,we=Ce,Me=0,fe=0,je=0,it=0,ft=performance.now(),ht=0,_t=document.createElement("div"),Bt=document.createElement("span"),_n=document.createElement("div"),kn=document.createTextNode(""),Dn=w?w.values[we.toLowerCase()]:null,vi=new O(_t,we,Dn),bn=!1;function qn(cr){if(Dn&&Dn.average){it+=cr,ht++;var Kr=performance.now();Kr-ft>=(Dn.avgMs||1e3)&&(je=it/ht,it=0,ft=Kr,ht=0)}}function _r(){ce=performance.now(),w.userTimingAPI&&performance.mark(we+"-start"),bn=!0}function Zr(){Me=performance.now()-ce,w.userTimingAPI&&(performance.mark(we+"-end"),bn&&performance.measure(we,we+"-start",we+"-end")),qn(Me)}return Bt.className="rs-counter-id",Bt.textContent=Dn&&Dn.caption?Dn.caption:we,_n.className="rs-counter-value",_n.appendChild(kn),_t.appendChild(Bt),_t.appendChild(_n),He?He.div.appendChild(_t):E.appendChild(_t),ce=performance.now(),{set:function(cr){qn(Me=cr)},start:_r,tick:function(){Zr(),_r()},end:Zr,frame:function(){var cr=performance.now(),Kr=cr-ce;fe++,Kr>1e3&&(Me=Dn&&!1===Dn.interpolate?fe:1e3*fe/Kr,fe=0,ce=cr,qn(Me))},value:function(){return Me},draw:function(){kn.nodeValue=Math.round(100*(Dn&&Dn.average?je:Me))/100;var Kr=Dn&&(Dn.below&&Me<Dn.below||Dn.over&&Me>Dn.over);vi.draw(Me,Kr),_t.className=Kr?"rs-counter-base alarm":"rs-counter-base"}}}function oe(Ce){var He=Ce.toLowerCase();if(void 0===He&&(He="default"),F[He])return F[He];var we=null;w&&w.groups&&B(w.groups,function(Me){var fe=w.groups[parseInt(Me,10)];!we&&-1!==fe.values.indexOf(He.toLowerCase())&&(we=fe)});var ce=new Y(He,we);return F[He]=ce,ce}function ve(){B(w.plugins,function(Ce){w.plugins[Ce].update()}),B(F,function(Ce){F[Ce].draw()}),w&&w.fractions&&B(w.fractions,function(Ce){var He=w.fractions[parseInt(Ce,10)],we=[],ce=F[He.base.toLowerCase()];ce&&(ce=ce.value(),B(w.fractions[Ce].steps,function(Me){var fe=w.fractions[Ce].steps[parseInt(Me,10)].toLowerCase(),je=F[fe];je&&we.push(je.value()/ce)})),He.graph.draw(we)})}return function(){if(w.plugins){w.values||(w.values={}),w.groups||(w.groups=[]),w.fractions||(w.fractions=[]);for(var Ce=0;Ce<w.plugins.length;Ce++)w.plugins[Ce].attach(oe),B(w.plugins[Ce].values,function(He){w.values[He]=w.plugins[Ce].values[He]}),w.groups=w.groups.concat(w.plugins[Ce].groups),w.fractions=w.fractions.concat(w.plugins[Ce].fractions)}else w.plugins={};(M=document.createElement("div")).className="rs-base",(E=document.createElement("div")).className="rs-container",E.style.height="auto",M.appendChild(E),document.body.appendChild(M),w&&(w.groups&&B(w.groups,function(He){var we=w.groups[parseInt(He,10)],ce=document.createElement("div");ce.className="rs-group",we.div=ce;var Me=document.createElement("h1");Me.textContent=we.caption,Me.addEventListener("click",function(fe){this.classList.toggle("hidden"),fe.preventDefault()}.bind(ce)),E.appendChild(Me),E.appendChild(ce)}),w.fractions&&B(w.fractions,function(He){var we=w.fractions[parseInt(He,10)],ce=document.createElement("div");ce.className="rs-fraction";var Me=document.createElement("div");Me.className="rs-legend";var fe=0;B(w.fractions[He].steps,function(it){var ft=document.createElement("p");ft.textContent=w.fractions[He].steps[it],ft.style.color=T[fe],Me.appendChild(ft),fe++}),ce.appendChild(Me),ce.style.height=fe*_+"px",we.div=ce;var je=new V(ce,fe);we.graph=je,E.appendChild(ce)}))}(),function(Ce){return Ce?oe(Ce):{element:M,update:ve}}},"object"==typeof ae&&(ae.exports=window.rStats)},{}],225:[function(k,ae,Ue){String.prototype.startsWith||(String.prototype.startsWith=function(b,D){return this.substr(D=D||0,b.length)===b})},{}],226:[function(k,ae,Ue){ae.exports={base64:function(D,B){return"data:"+D+";base64,"+B},isMobile:function(){var B,D=!1;return B=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(B)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(B.substr(0,4)))&&(D=!0),D},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch(D){return!0}},appendQueryParameter:function(D,B,I){var w=D.indexOf("?")<0?"?":"&";return D+(w+B+"=")+I},getQueryParameter:function(D){D=D.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var I=new RegExp("[\\?&]"+D+"=([^&#]*)").exec(location.search);return null===I?"":decodeURIComponent(I[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90==window.orientation||-90==window.orientation}}},{}],227:[function(k,ae,Ue){var w,b=k("./util.js");function D(){var w=document.createElement("video");w.addEventListener("ended",function(){w.play()}),this.request=function(){w.paused&&(w.src=b.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),w.play())},this.release=function(){w.pause(),w.src=""}}function B(){var w=null;this.request=function(){w||(w=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){w&&(clearInterval(w),w=null)}}ae.exports=(w=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||w.match(/iPod/i)?B:D},{"./util.js":226}]},{},[182])(182)},277:()=>{"use strict";!function(le){const he=le.performance;function Se(er){he&&he.mark&&he.mark(er)}function me(er,Un){he&&he.measure&&he.measure(er,Un)}Se("Zone");const Re=le.__Zone_symbol_prefix||"__zone_symbol__";function ie(er){return Re+er}const W=!0===le[ie("forceDuplicateZoneCheck")];if(le.Zone){if(W||"function"!=typeof le.Zone.__symbol__)throw new Error("Zone already loaded.");return le.Zone}let H=(()=>{class er{constructor($e,bt){this._parent=$e,this._name=bt?bt.name||"unnamed":"<root>",this._properties=bt&&bt.properties||{},this._zoneDelegate=new Pe(this,this._parent&&this._parent._zoneDelegate,bt)}static assertZonePatched(){if(le.Promise!==Zi.ZoneAwarePromise)throw new Error("Zone.js has detected that ZoneAwarePromise `(window|global).Promise` has been overwritten.\nMost likely cause is that a Promise polyfill has been loaded after Zone.js (Polyfilling Promise api is not necessary when zone.js is loaded. If you must load one, do so before loading zone.js.)")}static get root(){let $e=er.current;for(;$e.parent;)$e=$e.parent;return $e}static get current(){return ur.zone}static get currentTask(){return Xi}static __load_patch($e,bt,fi=!1){if(Zi.hasOwnProperty($e)){if(!fi&&W)throw Error("Already loaded patch: "+$e)}else if(!le["__Zone_disable_"+$e]){const Ki="Zone:"+$e;Se(Ki),Zi[$e]=bt(le,er,wi),me(Ki,Ki)}}get parent(){return this._parent}get name(){return this._name}get($e){const bt=this.getZoneWith($e);if(bt)return bt._properties[$e]}getZoneWith($e){let bt=this;for(;bt;){if(bt._properties.hasOwnProperty($e))return bt;bt=bt._parent}return null}fork($e){if(!$e)throw new Error("ZoneSpec required!");return this._zoneDelegate.fork(this,$e)}wrap($e,bt){if("function"!=typeof $e)throw new Error("Expecting function got: "+$e);const fi=this._zoneDelegate.intercept(this,$e,bt),Ki=this;return function(){return Ki.runGuarded(fi,this,arguments,bt)}}run($e,bt,fi,Ki){ur={parent:ur,zone:this};try{return this._zoneDelegate.invoke(this,$e,bt,fi,Ki)}finally{ur=ur.parent}}runGuarded($e,bt=null,fi,Ki){ur={parent:ur,zone:this};try{try{return this._zoneDelegate.invoke(this,$e,bt,fi,Ki)}catch(os){if(this._zoneDelegate.handleError(this,os))throw os}}finally{ur=ur.parent}}runTask($e,bt,fi){if($e.zone!=this)throw new Error("A task can only be run in the zone of creation! (Creation: "+($e.zone||Ar).name+"; Execution: "+this.name+")");if($e.state===di&&($e.type===Ei||$e.type===En))return;const Ki=$e.state!=Lt;Ki&&$e._transitionTo(Lt,Nt),$e.runCount++;const os=Xi;Xi=$e,ur={parent:ur,zone:this};try{$e.type==En&&$e.data&&!$e.data.isPeriodic&&($e.cancelFn=void 0);try{return this._zoneDelegate.invokeTask(this,$e,bt,fi)}catch(Ae){if(this._zoneDelegate.handleError(this,Ae))throw Ae}}finally{$e.state!==di&&$e.state!==sn&&($e.type==Ei||$e.data&&$e.data.isPeriodic?Ki&&$e._transitionTo(Nt,Lt):($e.runCount=0,this._updateTaskCount($e,-1),Ki&&$e._transitionTo(di,Lt,di))),ur=ur.parent,Xi=os}}scheduleTask($e){if($e.zone&&$e.zone!==this){let fi=this;for(;fi;){if(fi===$e.zone)throw Error(`can not reschedule task to ${this.name} which is descendants of the original zone ${$e.zone.name}`);fi=fi.parent}}$e._transitionTo(vt,di);const bt=[];$e._zoneDelegates=bt,$e._zone=this;try{$e=this._zoneDelegate.scheduleTask(this,$e)}catch(fi){throw $e._transitionTo(sn,vt,di),this._zoneDelegate.handleError(this,fi),fi}return $e._zoneDelegates===bt&&this._updateTaskCount($e,1),$e.state==vt&&$e._transitionTo(Nt,vt),$e}scheduleMicroTask($e,bt,fi,Ki){return this.scheduleTask(new Ye(Sn,$e,bt,fi,Ki,void 0))}scheduleMacroTask($e,bt,fi,Ki,os){return this.scheduleTask(new Ye(En,$e,bt,fi,Ki,os))}scheduleEventTask($e,bt,fi,Ki,os){return this.scheduleTask(new Ye(Ei,$e,bt,fi,Ki,os))}cancelTask($e){if($e.zone!=this)throw new Error("A task can only be cancelled in the zone of creation! (Creation: "+($e.zone||Ar).name+"; Execution: "+this.name+")");$e._transitionTo(Fn,Nt,Lt);try{this._zoneDelegate.cancelTask(this,$e)}catch(bt){throw $e._transitionTo(sn,Fn),this._zoneDelegate.handleError(this,bt),bt}return this._updateTaskCount($e,-1),$e._transitionTo(di,Fn),$e.runCount=0,$e}_updateTaskCount($e,bt){const fi=$e._zoneDelegates;-1==bt&&($e._zoneDelegates=null);for(let Ki=0;Ki<fi.length;Ki++)fi[Ki]._updateTaskCount($e.type,bt)}}return er.__symbol__=ie,er})();const de={name:"",onHasTask:(er,Un,$e,bt)=>er.hasTask($e,bt),onScheduleTask:(er,Un,$e,bt)=>er.scheduleTask($e,bt),onInvokeTask:(er,Un,$e,bt,fi,Ki)=>er.invokeTask($e,bt,fi,Ki),onCancelTask:(er,Un,$e,bt)=>er.cancelTask($e,bt)};class Pe{constructor(Un,$e,bt){this._taskCounts={microTask:0,macroTask:0,eventTask:0},this.zone=Un,this._parentDelegate=$e,this._forkZS=bt&&(bt&&bt.onFork?bt:$e._forkZS),this._forkDlgt=bt&&(bt.onFork?$e:$e._forkDlgt),this._forkCurrZone=bt&&(bt.onFork?this.zone:$e._forkCurrZone),this._interceptZS=bt&&(bt.onIntercept?bt:$e._interceptZS),this._interceptDlgt=bt&&(bt.onIntercept?$e:$e._interceptDlgt),this._interceptCurrZone=bt&&(bt.onIntercept?this.zone:$e._interceptCurrZone),this._invokeZS=bt&&(bt.onInvoke?bt:$e._invokeZS),this._invokeDlgt=bt&&(bt.onInvoke?$e:$e._invokeDlgt),this._invokeCurrZone=bt&&(bt.onInvoke?this.zone:$e._invokeCurrZone),this._handleErrorZS=bt&&(bt.onHandleError?bt:$e._handleErrorZS),this._handleErrorDlgt=bt&&(bt.onHandleError?$e:$e._handleErrorDlgt),this._handleErrorCurrZone=bt&&(bt.onHandleError?this.zone:$e._handleErrorCurrZone),this._scheduleTaskZS=bt&&(bt.onScheduleTask?bt:$e._scheduleTaskZS),this._scheduleTaskDlgt=bt&&(bt.onScheduleTask?$e:$e._scheduleTaskDlgt),this._scheduleTaskCurrZone=bt&&(bt.onScheduleTask?this.zone:$e._scheduleTaskCurrZone),this._invokeTaskZS=bt&&(bt.onInvokeTask?bt:$e._invokeTaskZS),this._invokeTaskDlgt=bt&&(bt.onInvokeTask?$e:$e._invokeTaskDlgt),this._invokeTaskCurrZone=bt&&(bt.onInvokeTask?this.zone:$e._invokeTaskCurrZone),this._cancelTaskZS=bt&&(bt.onCancelTask?bt:$e._cancelTaskZS),this._cancelTaskDlgt=bt&&(bt.onCancelTask?$e:$e._cancelTaskDlgt),this._cancelTaskCurrZone=bt&&(bt.onCancelTask?this.zone:$e._cancelTaskCurrZone),this._hasTaskZS=null,this._hasTaskDlgt=null,this._hasTaskDlgtOwner=null,this._hasTaskCurrZone=null;const fi=bt&&bt.onHasTask;(fi||$e&&$e._hasTaskZS)&&(this._hasTaskZS=fi?bt:de,this._hasTaskDlgt=$e,this._hasTaskDlgtOwner=this,this._hasTaskCurrZone=Un,bt.onScheduleTask||(this._scheduleTaskZS=de,this._scheduleTaskDlgt=$e,this._scheduleTaskCurrZone=this.zone),bt.onInvokeTask||(this._invokeTaskZS=de,this._invokeTaskDlgt=$e,this._invokeTaskCurrZone=this.zone),bt.onCancelTask||(this._cancelTaskZS=de,this._cancelTaskDlgt=$e,this._cancelTaskCurrZone=this.zone))}fork(Un,$e){return this._forkZS?this._forkZS.onFork(this._forkDlgt,this.zone,Un,$e):new H(Un,$e)}intercept(Un,$e,bt){return this._interceptZS?this._interceptZS.onIntercept(this._interceptDlgt,this._interceptCurrZone,Un,$e,bt):$e}invoke(Un,$e,bt,fi,Ki){return this._invokeZS?this._invokeZS.onInvoke(this._invokeDlgt,this._invokeCurrZone,Un,$e,bt,fi,Ki):$e.apply(bt,fi)}handleError(Un,$e){return!this._handleErrorZS||this._handleErrorZS.onHandleError(this._handleErrorDlgt,this._handleErrorCurrZone,Un,$e)}scheduleTask(Un,$e){let bt=$e;if(this._scheduleTaskZS)this._hasTaskZS&&bt._zoneDelegates.push(this._hasTaskDlgtOwner),bt=this._scheduleTaskZS.onScheduleTask(this._scheduleTaskDlgt,this._scheduleTaskCurrZone,Un,$e),bt||(bt=$e);else if($e.scheduleFn)$e.scheduleFn($e);else{if($e.type!=Sn)throw new Error("Task is missing scheduleFn.");Nn($e)}return bt}invokeTask(Un,$e,bt,fi){return this._invokeTaskZS?this._invokeTaskZS.onInvokeTask(this._invokeTaskDlgt,this._invokeTaskCurrZone,Un,$e,bt,fi):$e.callback.apply(bt,fi)}cancelTask(Un,$e){let bt;if(this._cancelTaskZS)bt=this._cancelTaskZS.onCancelTask(this._cancelTaskDlgt,this._cancelTaskCurrZone,Un,$e);else{if(!$e.cancelFn)throw Error("Task is not cancelable");bt=$e.cancelFn($e)}return bt}hasTask(Un,$e){try{this._hasTaskZS&&this._hasTaskZS.onHasTask(this._hasTaskDlgt,this._hasTaskCurrZone,Un,$e)}catch(bt){this.handleError(Un,bt)}}_updateTaskCount(Un,$e){const bt=this._taskCounts,fi=bt[Un],Ki=bt[Un]=fi+$e;if(Ki<0)throw new Error("More tasks executed then were scheduled.");0!=fi&&0!=Ki||this.hasTask(this.zone,{microTask:bt.microTask>0,macroTask:bt.macroTask>0,eventTask:bt.eventTask>0,change:Un})}}class Ye{constructor(Un,$e,bt,fi,Ki,os){if(this._zone=null,this.runCount=0,this._zoneDelegates=null,this._state="notScheduled",this.type=Un,this.source=$e,this.data=fi,this.scheduleFn=Ki,this.cancelFn=os,!bt)throw new Error("callback is not defined");this.callback=bt;const Ae=this;this.invoke=Un===Ei&&fi&&fi.useG?Ye.invokeTask:function(){return Ye.invokeTask.call(le,Ae,this,arguments)}}static invokeTask(Un,$e,bt){Un||(Un=this),Oi++;try{return Un.runCount++,Un.zone.runTask(Un,$e,bt)}finally{1==Oi&&Pn(),Oi--}}get zone(){return this._zone}get state(){return this._state}cancelScheduleRequest(){this._transitionTo(di,vt)}_transitionTo(Un,$e,bt){if(this._state!==$e&&this._state!==bt)throw new Error(`${this.type} '${this.source}': can not transition to '${Un}', expecting state '${$e}'${bt?" or '"+bt+"'":""}, was '${this._state}'.`);this._state=Un,Un==di&&(this._zoneDelegates=null)}toString(){return this.data&&void 0!==this.data.handleId?this.data.handleId.toString():Object.prototype.toString.call(this)}toJSON(){return{type:this.type,state:this.state,source:this.source,zone:this.zone.name,runCount:this.runCount}}}const rt=ie("setTimeout"),Dt=ie("Promise"),un=ie("then");let rn,Tn=[],dn=!1;function On(er){if(rn||le[Dt]&&(rn=le[Dt].resolve(0)),rn){let Un=rn[un];Un||(Un=rn.then),Un.call(rn,er)}else le[rt](er,0)}function Nn(er){0===Oi&&0===Tn.length&&On(Pn),er&&Tn.push(er)}function Pn(){if(!dn){for(dn=!0;Tn.length;){const er=Tn;Tn=[];for(let Un=0;Un<er.length;Un++){const $e=er[Un];try{$e.zone.runTask($e,null,null)}catch(bt){wi.onUnhandledError(bt)}}}wi.microtaskDrainDone(),dn=!1}}const Ar={name:"NO ZONE"},di="notScheduled",vt="scheduling",Nt="scheduled",Lt="running",Fn="canceling",sn="unknown",Sn="microTask",En="macroTask",Ei="eventTask",Zi={},wi={symbol:ie,currentZoneFrame:()=>ur,onUnhandledError:qi,microtaskDrainDone:qi,scheduleMicroTask:Nn,showUncaughtError:()=>!H[ie("ignoreConsoleErrorUncaughtError")],patchEventTarget:()=>[],patchOnProperties:qi,patchMethod:()=>qi,bindArguments:()=>[],patchThen:()=>qi,patchMacroTask:()=>qi,patchEventPrototype:()=>qi,isIEOrEdge:()=>!1,getGlobalObjects:()=>{},ObjectDefineProperty:()=>qi,ObjectGetOwnPropertyDescriptor:()=>{},ObjectCreate:()=>{},ArraySlice:()=>[],patchClass:()=>qi,wrapWithCurrentZone:()=>qi,filterProperties:()=>[],attachOriginToPatched:()=>qi,_redefineProperty:()=>qi,patchCallbacks:()=>qi,nativeScheduleMicroTask:On};let ur={parent:null,zone:new H(null,null)},Xi=null,Oi=0;function qi(){}me("Zone","Zone"),le.Zone=H}("undefined"!=typeof window&&window||"undefined"!=typeof self&&self||global);const ko=Object.getOwnPropertyDescriptor,oa=Object.defineProperty,pa=Object.getPrototypeOf,Ko=Object.create,xr=Array.prototype.slice,ks="addEventListener",Is="removeEventListener",k=Zone.__symbol__(ks),ae=Zone.__symbol__(Is),Ue="true",b="false",D=Zone.__symbol__("");function B(le,he){return Zone.current.wrap(le,he)}function I(le,he,Se,me,Re){return Zone.current.scheduleMacroTask(le,he,Se,me,Re)}const w=Zone.__symbol__,T="undefined"!=typeof window,x=T?window:void 0,S=T&&x||"object"==typeof self&&self||global;function M(le,he){for(let Se=le.length-1;Se>=0;Se--)"function"==typeof le[Se]&&(le[Se]=B(le[Se],he+"_"+Se));return le}function _(le){return!le||!1!==le.writable&&!("function"==typeof le.get&&void 0===le.set)}const R="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,F=!("nw"in S)&&void 0!==S.process&&"[object process]"==={}.toString.call(S.process),O=!F&&!R&&!(!T||!x.HTMLElement),V=void 0!==S.process&&"[object process]"==={}.toString.call(S.process)&&!R&&!(!T||!x.HTMLElement),Y={},ee=function(le){if(!(le=le||S.event))return;let he=Y[le.type];he||(he=Y[le.type]=w("ON_PROPERTY"+le.type));const Se=this||le.target||S,me=Se[he];let Re;if(O&&Se===x&&"error"===le.type){const ie=le;Re=me&&me.call(this,ie.message,ie.filename,ie.lineno,ie.colno,ie.error),!0===Re&&le.preventDefault()}else Re=me&&me.apply(this,arguments),null!=Re&&!Re&&le.preventDefault();return Re};function oe(le,he,Se){let me=ko(le,he);if(!me&&Se&&ko(Se,he)&&(me={enumerable:!0,configurable:!0}),!me||!me.configurable)return;const Re=w("on"+he+"patched");if(le.hasOwnProperty(Re)&&le[Re])return;delete me.writable,delete me.value;const ie=me.get,W=me.set,H=he.substr(2);let de=Y[H];de||(de=Y[H]=w("ON_PROPERTY"+H)),me.set=function(Pe){let Ye=this;!Ye&&le===S&&(Ye=S),Ye&&("function"==typeof Ye[de]&&Ye.removeEventListener(H,ee),W&&W.call(Ye,null),Ye[de]=Pe,"function"==typeof Pe&&Ye.addEventListener(H,ee,!1))},me.get=function(){let Pe=this;if(!Pe&&le===S&&(Pe=S),!Pe)return null;const Ye=Pe[de];if(Ye)return Ye;if(ie){let rt=ie.call(this);if(rt)return me.set.call(this,rt),"function"==typeof Pe.removeAttribute&&Pe.removeAttribute(he),rt}return null},oa(le,he,me),le[Re]=!0}function Ee(le,he,Se){if(he)for(let me=0;me<he.length;me++)oe(le,"on"+he[me],Se);else{const me=[];for(const Re in le)"on"==Re.substr(0,2)&&me.push(Re);for(let Re=0;Re<me.length;Re++)oe(le,me[Re],Se)}}const ve=w("originalInstance");function Ce(le){const he=S[le];if(!he)return;S[w(le)]=he,S[le]=function(){const Re=M(arguments,le);switch(Re.length){case 0:this[ve]=new he;break;case 1:this[ve]=new he(Re[0]);break;case 2:this[ve]=new he(Re[0],Re[1]);break;case 3:this[ve]=new he(Re[0],Re[1],Re[2]);break;case 4:this[ve]=new he(Re[0],Re[1],Re[2],Re[3]);break;default:throw new Error("Arg list too long.")}},ce(S[le],he);const Se=new he(function(){});let me;for(me in Se)"XMLHttpRequest"===le&&"responseBlob"===me||function(Re){"function"==typeof Se[Re]?S[le].prototype[Re]=function(){return this[ve][Re].apply(this[ve],arguments)}:oa(S[le].prototype,Re,{set:function(ie){"function"==typeof ie?(this[ve][Re]=B(ie,le+"."+Re),ce(this[ve][Re],ie)):this[ve][Re]=ie},get:function(){return this[ve][Re]}})}(me);for(me in he)"prototype"!==me&&he.hasOwnProperty(me)&&(S[le][me]=he[me])}function He(le,he,Se){let me=le;for(;me&&!me.hasOwnProperty(he);)me=pa(me);!me&&le[he]&&(me=le);const Re=w(he);let ie=null;if(me&&(!(ie=me[Re])||!me.hasOwnProperty(Re))&&(ie=me[Re]=me[he],_(me&&ko(me,he)))){const H=Se(ie,Re,he);me[he]=function(){return H(this,arguments)},ce(me[he],ie)}return ie}function we(le,he,Se){let me=null;function Re(ie){const W=ie.data;return W.args[W.cbIdx]=function(){ie.invoke.apply(this,arguments)},me.apply(W.target,W.args),ie}me=He(le,he,ie=>function(W,H){const de=Se(W,H);return de.cbIdx>=0&&"function"==typeof H[de.cbIdx]?I(de.name,H[de.cbIdx],de,Re):ie.apply(W,H)})}function ce(le,he){le[w("OriginalDelegate")]=he}let Me=!1,fe=!1;function it(){if(Me)return fe;Me=!0;try{const le=x.navigator.userAgent;(-1!==le.indexOf("MSIE ")||-1!==le.indexOf("Trident/")||-1!==le.indexOf("Edge/"))&&(fe=!0)}catch(le){}return fe}Zone.__load_patch("ZoneAwarePromise",(le,he,Se)=>{const me=Object.getOwnPropertyDescriptor,Re=Object.defineProperty,W=Se.symbol,H=[],de=!0===le[W("DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION")],Pe=W("Promise"),Ye=W("then");Se.onUnhandledError=Ae=>{if(Se.showUncaughtError()){const Fe=Ae&&Ae.rejection;Fe?console.error("Unhandled Promise rejection:",Fe instanceof Error?Fe.message:Fe,"; Zone:",Ae.zone.name,"; Task:",Ae.task&&Ae.task.source,"; Value:",Fe,Fe instanceof Error?Fe.stack:void 0):console.error(Ae)}},Se.microtaskDrainDone=()=>{for(;H.length;){const Ae=H.shift();try{Ae.zone.runGuarded(()=>{throw Ae.throwOriginal?Ae.rejection:Ae})}catch(Fe){un(Fe)}}};const Dt=W("unhandledPromiseRejectionHandler");function un(Ae){Se.onUnhandledError(Ae);try{const Fe=he[Dt];"function"==typeof Fe&&Fe.call(this,Ae)}catch(Fe){}}function Tn(Ae){return Ae&&Ae.then}function dn(Ae){return Ae}function rn(Ae){return $e.reject(Ae)}const On=W("state"),Nn=W("value"),Pn=W("finally"),Ar=W("parentPromiseValue"),di=W("parentPromiseState"),Nt=null,Fn=!1;function Sn(Ae,Fe){return ke=>{try{wi(Ae,Fe,ke)}catch(ot){wi(Ae,!1,ot)}}}const Zi=W("currentTaskTrace");function wi(Ae,Fe,ke){const ot=function(){let Ae=!1;return function(ke){return function(){Ae||(Ae=!0,ke.apply(null,arguments))}}}();if(Ae===ke)throw new TypeError("Promise resolved with itself");if(Ae[On]===Nt){let at=null;try{("object"==typeof ke||"function"==typeof ke)&&(at=ke&&ke.then)}catch(Ct){return ot(()=>{wi(Ae,!1,Ct)})(),Ae}if(Fe!==Fn&&ke instanceof $e&&ke.hasOwnProperty(On)&&ke.hasOwnProperty(Nn)&&ke[On]!==Nt)Xi(ke),wi(Ae,ke[On],ke[Nn]);else if(Fe!==Fn&&"function"==typeof at)try{at.call(ke,ot(Sn(Ae,Fe)),ot(Sn(Ae,!1)))}catch(Ct){ot(()=>{wi(Ae,!1,Ct)})()}else{Ae[On]=Fe;const Ct=Ae[Nn];if(Ae[Nn]=ke,Ae[Pn]===Pn&&!0===Fe&&(Ae[On]=Ae[di],Ae[Nn]=Ae[Ar]),Fe===Fn&&ke instanceof Error){const Ut=he.currentTask&&he.currentTask.data&&he.currentTask.data.__creationTrace__;Ut&&Re(ke,Zi,{configurable:!0,enumerable:!1,writable:!0,value:Ut})}for(let Ut=0;Ut<Ct.length;)Oi(Ae,Ct[Ut++],Ct[Ut++],Ct[Ut++],Ct[Ut++]);if(0==Ct.length&&Fe==Fn){Ae[On]=0;let Ut=ke;try{throw new Error("Uncaught (in promise): "+function(Ae){return Ae&&Ae.toString===Object.prototype.toString?(Ae.constructor&&Ae.constructor.name||"")+": "+JSON.stringify(Ae):Ae?Ae.toString():Object.prototype.toString.call(Ae)}(ke)+(ke&&ke.stack?"\n"+ke.stack:""))}catch(mn){Ut=mn}de&&(Ut.throwOriginal=!0),Ut.rejection=ke,Ut.promise=Ae,Ut.zone=he.current,Ut.task=he.currentTask,H.push(Ut),Se.scheduleMicroTask()}}}return Ae}const ur=W("rejectionHandledHandler");function Xi(Ae){if(0===Ae[On]){try{const Fe=he[ur];Fe&&"function"==typeof Fe&&Fe.call(this,{rejection:Ae[Nn],promise:Ae})}catch(Fe){}Ae[On]=Fn;for(let Fe=0;Fe<H.length;Fe++)Ae===H[Fe].promise&&H.splice(Fe,1)}}function Oi(Ae,Fe,ke,ot,at){Xi(Ae);const Ct=Ae[On],Ut=Ct?"function"==typeof ot?ot:dn:"function"==typeof at?at:rn;Fe.scheduleMicroTask("Promise.then",()=>{try{const mn=Ae[Nn],Qt=!!ke&&Pn===ke[Pn];Qt&&(ke[Ar]=mn,ke[di]=Ct);const Rt=Fe.run(Ut,void 0,Qt&&Ut!==rn&&Ut!==dn?[]:[mn]);wi(ke,!0,Rt)}catch(mn){wi(ke,!1,mn)}},ke)}const er=function(){},Un=le.AggregateError;class $e{static toString(){return"function ZoneAwarePromise() { [native code] }"}static resolve(Fe){return wi(new this(null),!0,Fe)}static reject(Fe){return wi(new this(null),Fn,Fe)}static any(Fe){if(!Fe||"function"!=typeof Fe[Symbol.iterator])return Promise.reject(new Un([],"All promises were rejected"));const ke=[];let ot=0;try{for(let Ut of Fe)ot++,ke.push($e.resolve(Ut))}catch(Ut){return Promise.reject(new Un([],"All promises were rejected"))}if(0===ot)return Promise.reject(new Un([],"All promises were rejected"));let at=!1;const Ct=[];return new $e((Ut,mn)=>{for(let Qt=0;Qt<ke.length;Qt++)ke[Qt].then(Rt=>{at||(at=!0,Ut(Rt))},Rt=>{Ct.push(Rt),ot--,0===ot&&(at=!0,mn(new Un(Ct,"All promises were rejected")))})})}static race(Fe){let ke,ot,at=new this((mn,Qt)=>{ke=mn,ot=Qt});function Ct(mn){ke(mn)}function Ut(mn){ot(mn)}for(let mn of Fe)Tn(mn)||(mn=this.resolve(mn)),mn.then(Ct,Ut);return at}static all(Fe){return $e.allWithCallback(Fe)}static allSettled(Fe){return(this&&this.prototype instanceof $e?this:$e).allWithCallback(Fe,{thenCallback:ot=>({status:"fulfilled",value:ot}),errorCallback:ot=>({status:"rejected",reason:ot})})}static allWithCallback(Fe,ke){let ot,at,Ct=new this((Rt,Bn)=>{ot=Rt,at=Bn}),Ut=2,mn=0;const Qt=[];for(let Rt of Fe){Tn(Rt)||(Rt=this.resolve(Rt));const Bn=mn;try{Rt.then(Hn=>{Qt[Bn]=ke?ke.thenCallback(Hn):Hn,Ut--,0===Ut&&ot(Qt)},Hn=>{ke?(Qt[Bn]=ke.errorCallback(Hn),Ut--,0===Ut&&ot(Qt)):at(Hn)})}catch(Hn){at(Hn)}Ut++,mn++}return Ut-=2,0===Ut&&ot(Qt),Ct}constructor(Fe){const ke=this;if(!(ke instanceof $e))throw new Error("Must be an instanceof Promise.");ke[On]=Nt,ke[Nn]=[];try{Fe&&Fe(Sn(ke,!0),Sn(ke,Fn))}catch(ot){wi(ke,!1,ot)}}get[Symbol.toStringTag](){return"Promise"}get[Symbol.species](){return $e}then(Fe,ke){let ot=this.constructor[Symbol.species];(!ot||"function"!=typeof ot)&&(ot=this.constructor||$e);const at=new ot(er),Ct=he.current;return this[On]==Nt?this[Nn].push(Ct,at,Fe,ke):Oi(this,Ct,at,Fe,ke),at}catch(Fe){return this.then(null,Fe)}finally(Fe){let ke=this.constructor[Symbol.species];(!ke||"function"!=typeof ke)&&(ke=$e);const ot=new ke(er);ot[Pn]=Pn;const at=he.current;return this[On]==Nt?this[Nn].push(at,ot,Fe,Fe):Oi(this,at,ot,Fe,Fe),ot}}$e.resolve=$e.resolve,$e.reject=$e.reject,$e.race=$e.race,$e.all=$e.all;const bt=le[Pe]=le.Promise;le.Promise=$e;const fi=W("thenPatched");function Ki(Ae){const Fe=Ae.prototype,ke=me(Fe,"then");if(ke&&(!1===ke.writable||!ke.configurable))return;const ot=Fe.then;Fe[Ye]=ot,Ae.prototype.then=function(at,Ct){return new $e((mn,Qt)=>{ot.call(this,mn,Qt)}).then(at,Ct)},Ae[fi]=!0}return Se.patchThen=Ki,bt&&(Ki(bt),He(le,"fetch",Ae=>function(Ae){return function(Fe,ke){let ot=Ae.apply(Fe,ke);if(ot instanceof $e)return ot;let at=ot.constructor;return at[fi]||Ki(at),ot}}(Ae))),Promise[he.__symbol__("uncaughtPromiseErrors")]=H,$e}),Zone.__load_patch("toString",le=>{const he=Function.prototype.toString,Se=w("OriginalDelegate"),me=w("Promise"),Re=w("Error"),ie=function(){if("function"==typeof this){const Pe=this[Se];if(Pe)return"function"==typeof Pe?he.call(Pe):Object.prototype.toString.call(Pe);if(this===Promise){const Ye=le[me];if(Ye)return he.call(Ye)}if(this===Error){const Ye=le[Re];if(Ye)return he.call(Ye)}}return he.call(this)};ie[Se]=he,Function.prototype.toString=ie;const W=Object.prototype.toString;Object.prototype.toString=function(){return"function"==typeof Promise&&this instanceof Promise?"[object Promise]":W.call(this)}});let ft=!1;if("undefined"!=typeof window)try{const le=Object.defineProperty({},"passive",{get:function(){ft=!0}});window.addEventListener("test",le,le),window.removeEventListener("test",le,le)}catch(le){ft=!1}const ht={useG:!0},_t={},Bt={},_n=new RegExp("^"+D+"(\\w+)(true|false)$"),kn=w("propagationStopped");function Dn(le,he){const Se=(he?he(le):le)+b,me=(he?he(le):le)+Ue,Re=D+Se,ie=D+me;_t[le]={},_t[le][b]=Re,_t[le][Ue]=ie}function vi(le,he,Se,me){const Re=me&&me.add||ks,ie=me&&me.rm||Is,W=me&&me.listeners||"eventListeners",H=me&&me.rmAll||"removeAllListeners",de=w(Re),Pe="."+Re+":",Dt=function(Nn,Pn,Ar){if(Nn.isRemoved)return;const di=Nn.callback;let vt;"object"==typeof di&&di.handleEvent&&(Nn.callback=Lt=>di.handleEvent(Lt),Nn.originalDelegate=di);try{Nn.invoke(Nn,Pn,[Ar])}catch(Lt){vt=Lt}const Nt=Nn.options;return Nt&&"object"==typeof Nt&&Nt.once&&Pn[ie].call(Pn,Ar.type,Nn.originalDelegate?Nn.originalDelegate:Nn.callback,Nt),vt};function un(Nn,Pn,Ar){if(!(Pn=Pn||le.event))return;const di=Nn||Pn.target||le,vt=di[_t[Pn.type][Ar?Ue:b]];if(vt){const Nt=[];if(1===vt.length){const Lt=Dt(vt[0],di,Pn);Lt&&Nt.push(Lt)}else{const Lt=vt.slice();for(let Fn=0;Fn<Lt.length&&(!Pn||!0!==Pn[kn]);Fn++){const sn=Dt(Lt[Fn],di,Pn);sn&&Nt.push(sn)}}if(1===Nt.length)throw Nt[0];for(let Lt=0;Lt<Nt.length;Lt++){const Fn=Nt[Lt];he.nativeScheduleMicroTask(()=>{throw Fn})}}}const Tn=function(Nn){return un(this,Nn,!1)},dn=function(Nn){return un(this,Nn,!0)};function rn(Nn,Pn){if(!Nn)return!1;let Ar=!0;Pn&&void 0!==Pn.useG&&(Ar=Pn.useG);const di=Pn&&Pn.vh;let vt=!0;Pn&&void 0!==Pn.chkDup&&(vt=Pn.chkDup);let Nt=!1;Pn&&void 0!==Pn.rt&&(Nt=Pn.rt);let Lt=Nn;for(;Lt&&!Lt.hasOwnProperty(Re);)Lt=pa(Lt);if(!Lt&&Nn[Re]&&(Lt=Nn),!Lt||Lt[de])return!1;const Fn=Pn&&Pn.eventNameToString,sn={},Sn=Lt[de]=Lt[Re],En=Lt[w(ie)]=Lt[ie],Ei=Lt[w(W)]=Lt[W],Zi=Lt[w(H)]=Lt[H];let wi;function ur(ke,ot){return!ft&&"object"==typeof ke&&ke?!!ke.capture:ft&&ot?"boolean"==typeof ke?{capture:ke,passive:!0}:ke?"object"==typeof ke&&!1!==ke.passive?Object.assign(Object.assign({},ke),{passive:!0}):ke:{passive:!0}:ke}Pn&&Pn.prepend&&(wi=Lt[w(Pn.prepend)]=Lt[Pn.prepend]);const $e=Ar?function(ke){if(!sn.isExisting)return Sn.call(sn.target,sn.eventName,sn.capture?dn:Tn,sn.options)}:function(ke){return Sn.call(sn.target,sn.eventName,ke.invoke,sn.options)},bt=Ar?function(ke){if(!ke.isRemoved){const ot=_t[ke.eventName];let at;ot&&(at=ot[ke.capture?Ue:b]);const Ct=at&&ke.target[at];if(Ct)for(let Ut=0;Ut<Ct.length;Ut++)if(Ct[Ut]===ke){Ct.splice(Ut,1),ke.isRemoved=!0,0===Ct.length&&(ke.allRemoved=!0,ke.target[at]=null);break}}if(ke.allRemoved)return En.call(ke.target,ke.eventName,ke.capture?dn:Tn,ke.options)}:function(ke){return En.call(ke.target,ke.eventName,ke.invoke,ke.options)},Ki=Pn&&Pn.diff?Pn.diff:function(ke,ot){const at=typeof ot;return"function"===at&&ke.callback===ot||"object"===at&&ke.originalDelegate===ot},os=Zone[w("UNPATCHED_EVENTS")],Ae=le[w("PASSIVE_EVENTS")],Fe=function(ke,ot,at,Ct,Ut=!1,mn=!1){return function(){const Qt=this||le;let Rt=arguments[0];Pn&&Pn.transferEventName&&(Rt=Pn.transferEventName(Rt));let Bn=arguments[1];if(!Bn)return ke.apply(this,arguments);if(F&&"uncaughtException"===Rt)return ke.apply(this,arguments);let Hn=!1;if("function"!=typeof Bn){if(!Bn.handleEvent)return ke.apply(this,arguments);Hn=!0}if(di&&!di(ke,Bn,Qt,arguments))return;const Ci=ft&&!!Ae&&-1!==Ae.indexOf(Rt),Tr=ur(arguments[2],Ci);if(os)for(let ne=0;ne<os.length;ne++)if(Rt===os[ne])return Ci?ke.call(Qt,Rt,Bn,Tr):ke.apply(this,arguments);const hr=!!Tr&&("boolean"==typeof Tr||Tr.capture),Ji=!(!Tr||"object"!=typeof Tr)&&Tr.once,Sr=Zone.current;let ds=_t[Rt];ds||(Dn(Rt,Fn),ds=_t[Rt]);const Js=ds[hr?Ue:b];let tr,Ri=Qt[Js],ar=!1;if(Ri){if(ar=!0,vt)for(let ne=0;ne<Ri.length;ne++)if(Ki(Ri[ne],Bn))return}else Ri=Qt[Js]=[];const ho=Qt.constructor.name,Jr=Bt[ho];Jr&&(tr=Jr[Rt]),tr||(tr=ho+ot+(Fn?Fn(Rt):Rt)),sn.options=Tr,Ji&&(sn.options.once=!1),sn.target=Qt,sn.capture=hr,sn.eventName=Rt,sn.isExisting=ar;const jr=Ar?ht:void 0;jr&&(jr.taskData=sn);const K=Sr.scheduleEventTask(tr,Bn,jr,at,Ct);return sn.target=null,jr&&(jr.taskData=null),Ji&&(Tr.once=!0),!ft&&"boolean"==typeof K.options||(K.options=Tr),K.target=Qt,K.capture=hr,K.eventName=Rt,Hn&&(K.originalDelegate=Bn),mn?Ri.unshift(K):Ri.push(K),Ut?Qt:void 0}};return Lt[Re]=Fe(Sn,Pe,$e,bt,Nt),wi&&(Lt.prependListener=Fe(wi,".prependListener:",function(ke){return wi.call(sn.target,sn.eventName,ke.invoke,sn.options)},bt,Nt,!0)),Lt[ie]=function(){const ke=this||le;let ot=arguments[0];Pn&&Pn.transferEventName&&(ot=Pn.transferEventName(ot));const at=arguments[2],Ct=!!at&&("boolean"==typeof at||at.capture),Ut=arguments[1];if(!Ut)return En.apply(this,arguments);if(di&&!di(En,Ut,ke,arguments))return;const mn=_t[ot];let Qt;mn&&(Qt=mn[Ct?Ue:b]);const Rt=Qt&&ke[Qt];if(Rt)for(let Bn=0;Bn<Rt.length;Bn++){const Hn=Rt[Bn];if(Ki(Hn,Ut))return Rt.splice(Bn,1),Hn.isRemoved=!0,0===Rt.length&&(Hn.allRemoved=!0,ke[Qt]=null,"string"==typeof ot)&&(ke[D+"ON_PROPERTY"+ot]=null),Hn.zone.cancelTask(Hn),Nt?ke:void 0}return En.apply(this,arguments)},Lt[W]=function(){const ke=this||le;let ot=arguments[0];Pn&&Pn.transferEventName&&(ot=Pn.transferEventName(ot));const at=[],Ct=bn(ke,Fn?Fn(ot):ot);for(let Ut=0;Ut<Ct.length;Ut++){const mn=Ct[Ut];at.push(mn.originalDelegate?mn.originalDelegate:mn.callback)}return at},Lt[H]=function(){const ke=this||le;let ot=arguments[0];if(ot){Pn&&Pn.transferEventName&&(ot=Pn.transferEventName(ot));const at=_t[ot];if(at){const mn=ke[at[b]],Qt=ke[at[Ue]];if(mn){const Rt=mn.slice();for(let Bn=0;Bn<Rt.length;Bn++){const Hn=Rt[Bn];this[ie].call(this,ot,Hn.originalDelegate?Hn.originalDelegate:Hn.callback,Hn.options)}}if(Qt){const Rt=Qt.slice();for(let Bn=0;Bn<Rt.length;Bn++){const Hn=Rt[Bn];this[ie].call(this,ot,Hn.originalDelegate?Hn.originalDelegate:Hn.callback,Hn.options)}}}}else{const at=Object.keys(ke);for(let Ct=0;Ct<at.length;Ct++){const mn=_n.exec(at[Ct]);let Qt=mn&&mn[1];Qt&&"removeListener"!==Qt&&this[H].call(this,Qt)}this[H].call(this,"removeListener")}if(Nt)return this},ce(Lt[Re],Sn),ce(Lt[ie],En),Zi&&ce(Lt[H],Zi),Ei&&ce(Lt[W],Ei),!0}let On=[];for(let Nn=0;Nn<Se.length;Nn++)On[Nn]=rn(Se[Nn],me);return On}function bn(le,he){if(!he){const ie=[];for(let W in le){const H=_n.exec(W);let de=H&&H[1];if(de&&(!he||de===he)){const Pe=le[W];if(Pe)for(let Ye=0;Ye<Pe.length;Ye++)ie.push(Pe[Ye])}}return ie}let Se=_t[he];Se||(Dn(he),Se=_t[he]);const me=le[Se[b]],Re=le[Se[Ue]];return me?Re?me.concat(Re):me.slice():Re?Re.slice():[]}function qn(le,he){const Se=le.Event;Se&&Se.prototype&&he.patchMethod(Se.prototype,"stopImmediatePropagation",me=>function(Re,ie){Re[kn]=!0,me&&me.apply(Re,ie)})}function _r(le,he,Se,me,Re){const ie=Zone.__symbol__(me);if(he[ie])return;const W=he[ie]=he[me];he[me]=function(H,de,Pe){return de&&de.prototype&&Re.forEach(function(Ye){const rt=`${Se}.${me}::`+Ye,Dt=de.prototype;if(Dt.hasOwnProperty(Ye)){const un=le.ObjectGetOwnPropertyDescriptor(Dt,Ye);un&&un.value?(un.value=le.wrapWithCurrentZone(un.value,rt),le._redefineProperty(de.prototype,Ye,un)):Dt[Ye]&&(Dt[Ye]=le.wrapWithCurrentZone(Dt[Ye],rt))}else Dt[Ye]&&(Dt[Ye]=le.wrapWithCurrentZone(Dt[Ye],rt))}),W.call(he,H,de,Pe)},le.attachOriginToPatched(he[me],W)}function Zr(le,he,Se){if(!Se||0===Se.length)return he;const me=Se.filter(ie=>ie.target===le);if(!me||0===me.length)return he;const Re=me[0].ignoreProperties;return he.filter(ie=>-1===Re.indexOf(ie))}function Lr(le,he,Se,me){le&&Ee(le,Zr(le,he,Se),me)}function kr(le){return Object.getOwnPropertyNames(le).filter(he=>he.startsWith("on")&&he.length>2).map(he=>he.substring(2))}Zone.__load_patch("util",(le,he,Se)=>{const me=kr(le);Se.patchOnProperties=Ee,Se.patchMethod=He,Se.bindArguments=M,Se.patchMacroTask=we;const Re=he.__symbol__("BLACK_LISTED_EVENTS"),ie=he.__symbol__("UNPATCHED_EVENTS");le[ie]&&(le[Re]=le[ie]),le[Re]&&(he[Re]=he[ie]=le[Re]),Se.patchEventPrototype=qn,Se.patchEventTarget=vi,Se.isIEOrEdge=it,Se.ObjectDefineProperty=oa,Se.ObjectGetOwnPropertyDescriptor=ko,Se.ObjectCreate=Ko,Se.ArraySlice=xr,Se.patchClass=Ce,Se.wrapWithCurrentZone=B,Se.filterProperties=Zr,Se.attachOriginToPatched=ce,Se._redefineProperty=Object.defineProperty,Se.patchCallbacks=_r,Se.getGlobalObjects=()=>({globalSources:Bt,zoneSymbolEventNames:_t,eventNames:me,isBrowser:O,isMix:V,isNode:F,TRUE_STR:Ue,FALSE_STR:b,ZONE_SYMBOL_PREFIX:D,ADD_EVENT_LISTENER_STR:ks,REMOVE_EVENT_LISTENER_STR:Is})});const qr=w("zoneTask");function cr(le,he,Se,me){let Re=null,ie=null;Se+=me;const W={};function H(Pe){const Ye=Pe.data;return Ye.args[0]=function(){return Pe.invoke.apply(this,arguments)},Ye.handleId=Re.apply(le,Ye.args),Pe}function de(Pe){return ie.call(le,Pe.data.handleId)}Re=He(le,he+=me,Pe=>function(Ye,rt){if("function"==typeof rt[0]){const Dt={isPeriodic:"Interval"===me,delay:"Timeout"===me||"Interval"===me?rt[1]||0:void 0,args:rt},un=rt[0];rt[0]=function(){try{return un.apply(this,arguments)}finally{Dt.isPeriodic||("number"==typeof Dt.handleId?delete W[Dt.handleId]:Dt.handleId&&(Dt.handleId[qr]=null))}};const Tn=I(he,rt[0],Dt,H,de);if(!Tn)return Tn;const dn=Tn.data.handleId;return"number"==typeof dn?W[dn]=Tn:dn&&(dn[qr]=Tn),dn&&dn.ref&&dn.unref&&"function"==typeof dn.ref&&"function"==typeof dn.unref&&(Tn.ref=dn.ref.bind(dn),Tn.unref=dn.unref.bind(dn)),"number"==typeof dn||dn?dn:Tn}return Pe.apply(le,rt)}),ie=He(le,Se,Pe=>function(Ye,rt){const Dt=rt[0];let un;"number"==typeof Dt?un=W[Dt]:(un=Dt&&Dt[qr],un||(un=Dt)),un&&"string"==typeof un.type?"notScheduled"!==un.state&&(un.cancelFn&&un.data.isPeriodic||0===un.runCount)&&("number"==typeof Dt?delete W[Dt]:Dt&&(Dt[qr]=null),un.zone.cancelTask(un)):Pe.apply(le,rt)})}Zone.__load_patch("legacy",le=>{const he=le[Zone.__symbol__("legacyPatch")];he&&he()}),Zone.__load_patch("queueMicrotask",(le,he,Se)=>{Se.patchMethod(le,"queueMicrotask",me=>function(Re,ie){he.current.scheduleMicroTask("queueMicrotask",ie[0])})}),Zone.__load_patch("timers",le=>{const Se="clear";cr(le,"set",Se,"Timeout"),cr(le,"set",Se,"Interval"),cr(le,"set",Se,"Immediate")}),Zone.__load_patch("requestAnimationFrame",le=>{cr(le,"request","cancel","AnimationFrame"),cr(le,"mozRequest","mozCancel","AnimationFrame"),cr(le,"webkitRequest","webkitCancel","AnimationFrame")}),Zone.__load_patch("blocking",(le,he)=>{const Se=["alert","prompt","confirm"];for(let me=0;me<Se.length;me++)He(le,Se[me],(ie,W,H)=>function(de,Pe){return he.current.run(ie,le,Pe,H)})}),Zone.__load_patch("EventTarget",(le,he,Se)=>{(function(le,he){he.patchEventPrototype(le,he)})(le,Se),function(le,he){if(Zone[he.symbol("patchEventTarget")])return;const{eventNames:Se,zoneSymbolEventNames:me,TRUE_STR:Re,FALSE_STR:ie,ZONE_SYMBOL_PREFIX:W}=he.getGlobalObjects();for(let de=0;de<Se.length;de++){const Pe=Se[de],Dt=W+(Pe+ie),un=W+(Pe+Re);me[Pe]={},me[Pe][ie]=Dt,me[Pe][Re]=un}const H=le.EventTarget;H&&H.prototype&&he.patchEventTarget(le,he,[H&&H.prototype])}(le,Se);const me=le.XMLHttpRequestEventTarget;me&&me.prototype&&Se.patchEventTarget(le,Se,[me.prototype])}),Zone.__load_patch("MutationObserver",(le,he,Se)=>{Ce("MutationObserver"),Ce("WebKitMutationObserver")}),Zone.__load_patch("IntersectionObserver",(le,he,Se)=>{Ce("IntersectionObserver")}),Zone.__load_patch("FileReader",(le,he,Se)=>{Ce("FileReader")}),Zone.__load_patch("on_property",(le,he,Se)=>{!function(le,he){if(F&&!V||Zone[le.symbol("patchEvents")])return;const Se=he.__Zone_ignore_on_properties;let me=[];if(O){const Re=window;me=me.concat(["Document","SVGElement","Element","HTMLElement","HTMLBodyElement","HTMLMediaElement","HTMLFrameSetElement","HTMLFrameElement","HTMLIFrameElement","HTMLMarqueeElement","Worker"]);const ie=function(){try{const le=x.navigator.userAgent;if(-1!==le.indexOf("MSIE ")||-1!==le.indexOf("Trident/"))return!0}catch(le){}return!1}()?[{target:Re,ignoreProperties:["error"]}]:[];Lr(Re,kr(Re),Se&&Se.concat(ie),pa(Re))}me=me.concat(["XMLHttpRequest","XMLHttpRequestEventTarget","IDBIndex","IDBRequest","IDBOpenDBRequest","IDBDatabase","IDBTransaction","IDBCursor","WebSocket"]);for(let Re=0;Re<me.length;Re++){const ie=he[me[Re]];ie&&ie.prototype&&Lr(ie.prototype,kr(ie.prototype),Se)}}(Se,le)}),Zone.__load_patch("customElements",(le,he,Se)=>{!function(le,he){const{isBrowser:Se,isMix:me}=he.getGlobalObjects();(Se||me)&&le.customElements&&"customElements"in le&&he.patchCallbacks(he,le.customElements,"customElements","define",["connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback"])}(le,Se)}),Zone.__load_patch("XHR",(le,he)=>{!function(Pe){const Ye=Pe.XMLHttpRequest;if(!Ye)return;const rt=Ye.prototype;let un=rt[k],Tn=rt[ae];if(!un){const sn=Pe.XMLHttpRequestEventTarget;if(sn){const Sn=sn.prototype;un=Sn[k],Tn=Sn[ae]}}const dn="readystatechange",rn="scheduled";function On(sn){const Sn=sn.data,En=Sn.target;En[ie]=!1,En[H]=!1;const Ei=En[Re];un||(un=En[k],Tn=En[ae]),Ei&&Tn.call(En,dn,Ei);const Zi=En[Re]=()=>{if(En.readyState===En.DONE)if(!Sn.aborted&&En[ie]&&sn.state===rn){const ur=En[he.__symbol__("loadfalse")];if(0!==En.status&&ur&&ur.length>0){const Xi=sn.invoke;sn.invoke=function(){const Oi=En[he.__symbol__("loadfalse")];for(let qi=0;qi<Oi.length;qi++)Oi[qi]===sn&&Oi.splice(qi,1);!Sn.aborted&&sn.state===rn&&Xi.call(sn)},ur.push(sn)}else sn.invoke()}else!Sn.aborted&&!1===En[ie]&&(En[H]=!0)};return un.call(En,dn,Zi),En[Se]||(En[Se]=sn),Lt.apply(En,Sn.args),En[ie]=!0,sn}function Nn(){}function Pn(sn){const Sn=sn.data;return Sn.aborted=!0,Fn.apply(Sn.target,Sn.args)}const Ar=He(rt,"open",()=>function(sn,Sn){return sn[me]=0==Sn[2],sn[W]=Sn[1],Ar.apply(sn,Sn)}),vt=w("fetchTaskAborting"),Nt=w("fetchTaskScheduling"),Lt=He(rt,"send",()=>function(sn,Sn){if(!0===he.current[Nt]||sn[me])return Lt.apply(sn,Sn);{const En={target:sn,url:sn[W],isPeriodic:!1,args:Sn,aborted:!1},Ei=I("XMLHttpRequest.send",Nn,En,On,Pn);sn&&!0===sn[H]&&!En.aborted&&Ei.state===rn&&Ei.invoke()}}),Fn=He(rt,"abort",()=>function(sn,Sn){const En=function(sn){return sn[Se]}(sn);if(En&&"string"==typeof En.type){if(null==En.cancelFn||En.data&&En.data.aborted)return;En.zone.cancelTask(En)}else if(!0===he.current[vt])return Fn.apply(sn,Sn)})}(le);const Se=w("xhrTask"),me=w("xhrSync"),Re=w("xhrListener"),ie=w("xhrScheduled"),W=w("xhrURL"),H=w("xhrErrorBeforeScheduled")}),Zone.__load_patch("geolocation",le=>{le.navigator&&le.navigator.geolocation&&function(le,he){const Se=le.constructor.name;for(let me=0;me<he.length;me++){const Re=he[me],ie=le[Re];if(ie){if(!_(ko(le,Re)))continue;le[Re]=(H=>{const de=function(){return H.apply(this,M(arguments,Se+"."+Re))};return ce(de,H),de})(ie)}}}(le.navigator.geolocation,["getCurrentPosition","watchPosition"])}),Zone.__load_patch("PromiseRejectionEvent",(le,he)=>{function Se(me){return function(Re){bn(le,me).forEach(W=>{const H=le.PromiseRejectionEvent;if(H){const de=new H(me,{promise:Re.promise,reason:Re.rejection});W.invoke(de)}})}}le.PromiseRejectionEvent&&(he[w("unhandledPromiseRejectionHandler")]=Se("unhandledrejection"),he[w("rejectionHandledHandler")]=Se("rejectionhandled"))})},608:(ko,oa,pa)=>{"use strict";function xr(s,t,i,o,a,u,d){try{var p=s[u](d),v=p.value}catch(A){return void i(A)}p.done?t(v):Promise.resolve(v).then(o,a)}pa(86);const H=306,Pe=1001,rt=1003,rn=1006,di=1009,Lt=1012,Sn=1015,En=1016,wi=1020,Oi=1023,Un=1026,$e=1027,$t=2400,xt=2401,Ui=3e3,Kn=3001,Gs="srgb",$s="srgb-linear",Mh=35044,Du=35048;class $a{addEventListener(t,i){void 0===this._listeners&&(this._listeners={});const o=this._listeners;void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(i)&&o[t].push(i)}hasEventListener(t,i){if(void 0===this._listeners)return!1;const o=this._listeners;return void 0!==o[t]&&-1!==o[t].indexOf(i)}removeEventListener(t,i){if(void 0===this._listeners)return;const a=this._listeners[t];if(void 0!==a){const u=a.indexOf(i);-1!==u&&a.splice(u,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const o=this._listeners[t.type];if(void 0!==o){t.target=this;const a=o.slice(0);for(let u=0,d=a.length;u<d;u++)a[u].call(this,t);t.target=null}}}const mo=[];for(let s=0;s<256;s++)mo[s]=(s<16?"0":"")+s.toString(16);const Ws=Math.PI/180,ac=180/Math.PI;function bo(){const s=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return(mo[255&s]+mo[s>>8&255]+mo[s>>16&255]+mo[s>>24&255]+"-"+mo[255&t]+mo[t>>8&255]+"-"+mo[t>>16&15|64]+mo[t>>24&255]+"-"+mo[63&i|128]+mo[i>>8&255]+"-"+mo[i>>16&255]+mo[i>>24&255]+mo[255&o]+mo[o>>8&255]+mo[o>>16&255]+mo[o>>24&255]).toLowerCase()}function Fs(s,t,i){return Math.max(t,Math.min(i,s))}function Ch(s,t,i){return(1-i)*s+i*t}function ep(s){return 0==(s&s-1)&&0!==s}function Pu(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}class st{constructor(t=0,i=0){this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,o=this.y,a=t.elements;return this.x=a[0]*i+a[3]*o+a[6],this.y=a[1]*i+a[4]*o+a[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,o=this.y-t.y;return i*i+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i,o){return void 0!==o&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const o=Math.cos(i),a=Math.sin(i),u=this.x-t.x,d=this.y-t.y;return this.x=u*o-d*a+t.x,this.y=u*a+d*o+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}st.prototype.isVector2=!0;class Hr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,i,o,a,u,d,p,v,A){const P=this.elements;return P[0]=t,P[1]=a,P[2]=p,P[3]=i,P[4]=u,P[5]=v,P[6]=o,P[7]=d,P[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,o=t.elements;return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],this}extractBasis(t,i,o){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),o.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const o=t.elements,a=i.elements,u=this.elements,d=o[0],p=o[3],v=o[6],A=o[1],P=o[4],U=o[7],N=o[2],j=o[5],te=o[8],Z=a[0],q=a[3],ge=a[6],ye=a[1],De=a[4],Le=a[7],Ne=a[2],tt=a[5],lt=a[8];return u[0]=d*Z+p*ye+v*Ne,u[3]=d*q+p*De+v*tt,u[6]=d*ge+p*Le+v*lt,u[1]=A*Z+P*ye+U*Ne,u[4]=A*q+P*De+U*tt,u[7]=A*ge+P*Le+U*lt,u[2]=N*Z+j*ye+te*Ne,u[5]=N*q+j*De+te*tt,u[8]=N*ge+j*Le+te*lt,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],o=t[1],a=t[2],u=t[3],d=t[4],p=t[5],v=t[6],A=t[7],P=t[8];return i*d*P-i*p*A-o*u*P+o*p*v+a*u*A-a*d*v}invert(){const t=this.elements,i=t[0],o=t[1],a=t[2],u=t[3],d=t[4],p=t[5],v=t[6],A=t[7],P=t[8],U=P*d-p*A,N=p*v-P*u,j=A*u-d*v,te=i*U+o*N+a*j;if(0===te)return this.set(0,0,0,0,0,0,0,0,0);const Z=1/te;return t[0]=U*Z,t[1]=(a*A-P*o)*Z,t[2]=(p*o-a*d)*Z,t[3]=N*Z,t[4]=(P*i-a*v)*Z,t[5]=(a*u-p*i)*Z,t[6]=j*Z,t[7]=(o*v-A*i)*Z,t[8]=(d*i-o*u)*Z,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,o,a,u,d,p){const v=Math.cos(u),A=Math.sin(u);return this.set(o*v,o*A,-o*(v*d+A*p)+d+t,-a*A,a*v,-a*(-A*d+v*p)+p+i,0,0,1),this}scale(t,i){const o=this.elements;return o[0]*=t,o[3]*=t,o[6]*=t,o[1]*=i,o[4]*=i,o[7]*=i,this}rotate(t){const i=Math.cos(t),o=Math.sin(t),a=this.elements,u=a[0],d=a[3],p=a[6],v=a[1],A=a[4],P=a[7];return a[0]=i*u+o*v,a[3]=i*d+o*A,a[6]=i*p+o*P,a[1]=-o*u+i*v,a[4]=-o*d+i*A,a[7]=-o*p+i*P,this}translate(t,i){const o=this.elements;return o[0]+=t*o[2],o[3]+=t*o[5],o[6]+=t*o[8],o[1]+=i*o[2],o[4]+=i*o[5],o[7]+=i*o[8],this}equals(t){const i=this.elements,o=t.elements;for(let a=0;a<9;a++)if(i[a]!==o[a])return!1;return!0}fromArray(t,i=0){for(let o=0;o<9;o++)this.elements[o]=t[o+i];return this}toArray(t=[],i=0){const o=this.elements;return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],t[i+4]=o[4],t[i+5]=o[5],t[i+6]=o[6],t[i+7]=o[7],t[i+8]=o[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function tp(s){for(let t=s.length-1;t>=0;--t)if(s[t]>65535)return!0;return!1}function _l(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function lc(s){return s<.04045?.0773993808*s:Math.pow(.9478672986*s+.0521327014,2.4)}function Jo(s){return s<.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}Hr.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const Iu={[Gs]:{[$s]:lc},[$s]:{[Gs]:Jo}},aa={legacyMode:!0,get workingColorSpace(){return $s},set workingColorSpace(s){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(s,t,i){if(this.legacyMode||t===i||!t||!i)return s;if(Iu[t]&&void 0!==Iu[t][i]){const o=Iu[t][i];return s.r=o(s.r),s.g=o(s.g),s.b=o(s.b),s}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(s,t){return this.convert(s,this.workingColorSpace,t)},toWorkingColorSpace:function(s,t){return this.convert(s,t,this.workingColorSpace)}},zc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},to={r:0,g:0,b:0},zn={h:0,s:0,l:0},Ml={h:0,s:0,l:0};function tl(s,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?s+6*(t-s)*i:i<.5?t:i<2/3?s+6*(t-s)*(2/3-i):s}function Fd(s,t){return t.r=s.r,t.g=s.g,t.b=s.b,t}let cc,Rn=(()=>{class s{constructor(i,o,a){return void 0===o&&void 0===a?this.set(i):this.setRGB(i,o,a)}set(i){return i&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i),this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,o=Gs){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,aa.toWorkingColorSpace(this,o),this}setRGB(i,o,a,u=$s){return this.r=i,this.g=o,this.b=a,aa.toWorkingColorSpace(this,u),this}setHSL(i,o,a,u=$s){if(i=function(s,t){return(s%t+t)%t}(i,1),o=Fs(o,0,1),a=Fs(a,0,1),0===o)this.r=this.g=this.b=a;else{const d=a<=.5?a*(1+o):a+o-a*o,p=2*a-d;this.r=tl(p,d,i+1/3),this.g=tl(p,d,i),this.b=tl(p,d,i-1/3)}return aa.toWorkingColorSpace(this,u),this}setStyle(i,o=Gs){function a(d){void 0!==d&&parseFloat(d)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}let u;if(u=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(i)){let d;const v=u[2];switch(u[1]){case"rgb":case"rgba":if(d=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return this.r=Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,aa.toWorkingColorSpace(this,o),a(d[4]),this;if(d=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,aa.toWorkingColorSpace(this,o),a(d[4]),this;break;case"hsl":case"hsla":if(d=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v)){const A=parseFloat(d[1])/360,P=parseInt(d[2],10)/100,U=parseInt(d[3],10)/100;return a(d[4]),this.setHSL(A,P,U,o)}}}else if(u=/^\#([A-Fa-f\d]+)$/.exec(i)){const d=u[1],p=d.length;if(3===p)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,aa.toWorkingColorSpace(this,o),this;if(6===p)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,aa.toWorkingColorSpace(this,o),this}return i&&i.length>0?this.setColorName(i,o):this}setColorName(i,o=Gs){const a=zc[i.toLowerCase()];return void 0!==a?this.setHex(a,o):console.warn("THREE.Color: Unknown color "+i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=lc(i.r),this.g=lc(i.g),this.b=lc(i.b),this}copyLinearToSRGB(i){return this.r=Jo(i.r),this.g=Jo(i.g),this.b=Jo(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Gs){return aa.fromWorkingColorSpace(Fd(this,to),i),Fs(255*to.r,0,255)<<16^Fs(255*to.g,0,255)<<8^Fs(255*to.b,0,255)<<0}getHexString(i=Gs){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,o=$s){aa.fromWorkingColorSpace(Fd(this,to),o);const a=to.r,u=to.g,d=to.b,p=Math.max(a,u,d),v=Math.min(a,u,d);let A,P;const U=(v+p)/2;if(v===p)A=0,P=0;else{const N=p-v;switch(P=U<=.5?N/(p+v):N/(2-p-v),p){case a:A=(u-d)/N+(u<d?6:0);break;case u:A=(d-a)/N+2;break;case d:A=(a-u)/N+4}A/=6}return i.h=A,i.s=P,i.l=U,i}getRGB(i,o=$s){return aa.fromWorkingColorSpace(Fd(this,to),o),i.r=to.r,i.g=to.g,i.b=to.b,i}getStyle(i=Gs){return aa.fromWorkingColorSpace(Fd(this,to),i),i!==Gs?`color(${i} ${to.r} ${to.g} ${to.b})`:`rgb(${255*to.r|0},${255*to.g|0},${255*to.b|0})`}offsetHSL(i,o,a){return this.getHSL(zn),zn.h+=i,zn.s+=o,zn.l+=a,this.setHSL(zn.h,zn.s,zn.l),this}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,o){return this.r=i.r+o.r,this.g=i.g+o.g,this.b=i.b+o.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,o){return this.r+=(i.r-this.r)*o,this.g+=(i.g-this.g)*o,this.b+=(i.b-this.b)*o,this}lerpColors(i,o,a){return this.r=i.r+(o.r-i.r)*a,this.g=i.g+(o.g-i.g)*a,this.b=i.b+(o.b-i.b)*a,this}lerpHSL(i,o){this.getHSL(zn),i.getHSL(Ml);const a=Ch(zn.h,Ml.h,o),u=Ch(zn.s,Ml.s,o),d=Ch(zn.l,Ml.l,o);return this.setHSL(a,u,d),this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,o=0){return this.r=i[o],this.g=i[o+1],this.b=i[o+2],this}toArray(i=[],o=0){return i[o]=this.r,i[o+1]=this.g,i[o+2]=this.b,i}fromBufferAttribute(i,o){return this.r=i.getX(o),this.g=i.getY(o),this.b=i.getZ(o),!0===i.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return s.NAMES=zc,s})();Rn.prototype.isColor=!0,Rn.prototype.r=1,Rn.prototype.g=1,Rn.prototype.b=1;class Or{static getDataURL(t){if(/^data:/i.test(t.src)||"undefined"==typeof HTMLCanvasElement)return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{void 0===cc&&(cc=_l("canvas")),cc.width=t.width,cc.height=t.height;const o=cc.getContext("2d");t instanceof ImageData?o.putImageData(t,0,0):o.drawImage(t,0,0,t.width,t.height),i=cc}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=_l("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");o.drawImage(t,0,0,t.width,t.height);const a=o.getImageData(0,0,t.width,t.height),u=a.data;for(let d=0;d<u.length;d++)u[d]=255*lc(u[d]/255);return o.putImageData(a,0,0),i}if(t.data){const i=t.data.slice(0);for(let o=0;o<i.length;o++)i[o]=i instanceof Uint8Array||i instanceof Uint8ClampedArray?Math.floor(255*lc(i[o]/255)):lc(i[o]);return{data:i,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Ro{constructor(t=null){this.uuid=bo(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.images[this.uuid])return t.images[this.uuid];const o={uuid:this.uuid,url:""},a=this.data;if(null!==a){let u;if(Array.isArray(a)){u=[];for(let d=0,p=a.length;d<p;d++)u.push(Od(a[d].isDataTexture?a[d].image:a[d]))}else u=Od(a);o.url=u}return i||(t.images[this.uuid]=o),o}}function Od(s){return"undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&s instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&s instanceof ImageBitmap?Or.getDataURL(s):s.data?{data:Array.prototype.slice.call(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ro.prototype.isSource=!0;let Ud=0,as=(()=>{class s extends $a{constructor(i=s.DEFAULT_IMAGE,o=s.DEFAULT_MAPPING,a=Pe,u=Pe,d=rn,p=1008,v=Oi,A=di,P=1,U=Ui){super(),Object.defineProperty(this,"id",{value:Ud++}),this.uuid=bo(),this.name="",this.source=new Ro(i),this.mipmaps=[],this.mapping=o,this.wrapS=a,this.wrapT=u,this.magFilter=d,this.minFilter=p,this.anisotropy=P,this.format=v,this.internalFormat=null,this.type=A,this.offset=new st(0,0),this.repeat=new st(1,1),this.center=new st(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Hr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=U,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(i){this.source.data=i}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(i){return this.name=i.name,this.source=i.source,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this.userData=JSON.parse(JSON.stringify(i.userData)),this.needsUpdate=!0,this}toJSON(i){const o=void 0===i||"string"==typeof i;if(!o&&void 0!==i.textures[this.uuid])return i.textures[this.uuid];const a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(i).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),o||(i.textures[this.uuid]=a),a}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(i){if(300!==this.mapping)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case 1e3:i.x=i.x-Math.floor(i.x);break;case Pe:i.x=i.x<0?0:1;break;case 1002:i.x=1===Math.abs(Math.floor(i.x)%2)?Math.ceil(i.x)-i.x:i.x-Math.floor(i.x)}if(i.y<0||i.y>1)switch(this.wrapT){case 1e3:i.y=i.y-Math.floor(i.y);break;case Pe:i.y=i.y<0?0:1;break;case 1002:i.y=1===Math.abs(Math.floor(i.y)%2)?Math.ceil(i.y)-i.y:i.y-Math.floor(i.y)}return this.flipY&&(i.y=1-i.y),i}set needsUpdate(i){!0===i&&(this.version++,this.source.needsUpdate=!0)}}return s.DEFAULT_IMAGE=null,s.DEFAULT_MAPPING=300,s})();as.prototype.isTexture=!0;class Oe{constructor(t=0,i=0,o=0,a=1){this.x=t,this.y=i,this.z=o,this.w=a}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,o,a){return this.x=t,this.y=i,this.z=o,this.w=a,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,o=this.y,a=this.z,u=this.w,d=t.elements;return this.x=d[0]*i+d[4]*o+d[8]*a+d[12]*u,this.y=d[1]*i+d[5]*o+d[9]*a+d[13]*u,this.z=d[2]*i+d[6]*o+d[10]*a+d[14]*u,this.w=d[3]*i+d[7]*o+d[11]*a+d[15]*u,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,o,a,u;const d=.01,p=.1,v=t.elements,A=v[0],P=v[4],U=v[8],N=v[1],j=v[5],te=v[9],Z=v[2],q=v[6],ge=v[10];if(Math.abs(P-N)<d&&Math.abs(U-Z)<d&&Math.abs(te-q)<d){if(Math.abs(P+N)<p&&Math.abs(U+Z)<p&&Math.abs(te+q)<p&&Math.abs(A+j+ge-3)<p)return this.set(1,0,0,0),this;i=Math.PI;const De=(A+1)/2,Le=(j+1)/2,Ne=(ge+1)/2,tt=(P+N)/4,lt=(U+Z)/4,ct=(te+q)/4;return De>Le&&De>Ne?De<d?(o=0,a=.707106781,u=.707106781):(o=Math.sqrt(De),a=tt/o,u=lt/o):Le>Ne?Le<d?(o=.707106781,a=0,u=.707106781):(a=Math.sqrt(Le),o=tt/a,u=ct/a):Ne<d?(o=.707106781,a=.707106781,u=0):(u=Math.sqrt(Ne),o=lt/u,a=ct/u),this.set(o,a,u,i),this}let ye=Math.sqrt((q-te)*(q-te)+(U-Z)*(U-Z)+(N-P)*(N-P));return Math.abs(ye)<.001&&(ye=1),this.x=(q-te)/ye,this.y=(U-Z)/ye,this.z=(N-P)/ye,this.w=Math.acos((A+j+ge-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this.z=t.z+(i.z-t.z)*o,this.w=t.w+(i.w-t.w)*o,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i,o){return void 0!==o&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Oe.prototype.isVector4=!0;class Io extends $a{constructor(t,i,o={}){super(),this.width=t,this.height=i,this.depth=1,this.scissor=new Oe(0,0,t,i),this.scissorTest=!1,this.viewport=new Oe(0,0,t,i),this.texture=new as({width:t,height:i,depth:1},o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==o.generateMipmaps&&o.generateMipmaps,this.texture.internalFormat=void 0!==o.internalFormat?o.internalFormat:null,this.texture.minFilter=void 0!==o.minFilter?o.minFilter:rn,this.depthBuffer=void 0===o.depthBuffer||o.depthBuffer,this.stencilBuffer=void 0!==o.stencilBuffer&&o.stencilBuffer,this.depthTexture=void 0!==o.depthTexture?o.depthTexture:null,this.samples=void 0!==o.samples?o.samples:0}setSize(t,i,o=1){(this.width!==t||this.height!==i||this.depth!==o)&&(this.width=t,this.height=i,this.depth=o,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=o,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Io.prototype.isWebGLRenderTarget=!0;class Lh extends as{constructor(t=null,i=1,o=1,a=1){super(null),this.image={data:t,width:i,height:o,depth:a},this.magFilter=rt,this.minFilter=rt,this.wrapR=Pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Lh.prototype.isDataArrayTexture=!0,class extends Io{constructor(t,i,o){super(t,i),this.depth=o,this.texture=new Lh(null,t,i,o),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class Ta extends as{constructor(t=null,i=1,o=1,a=1){super(null),this.image={data:t,width:i,height:o,depth:a},this.magFilter=rt,this.minFilter=rt,this.wrapR=Pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ta.prototype.isData3DTexture=!0,class extends Io{constructor(t,i,o){super(t,i),this.depth=o,this.texture=new Ta(null,t,i,o),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class extends Io{constructor(t,i,o,a={}){super(t,i,a);const u=this.texture;this.texture=[];for(let d=0;d<o;d++)this.texture[d]=u.clone(),this.texture[d].isRenderTargetTexture=!0}setSize(t,i,o=1){if(this.width!==t||this.height!==i||this.depth!==o){this.width=t,this.height=i,this.depth=o;for(let a=0,u=this.texture.length;a<u;a++)this.texture[a].image.width=t,this.texture[a].image.height=i,this.texture[a].image.depth=o;this.dispose()}return this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let i=0,o=t.texture.length;i<o;i++)this.texture[i]=t.texture[i].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class no{constructor(t=0,i=0,o=0,a=1){this._x=t,this._y=i,this._z=o,this._w=a}static slerp(t,i,o,a){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),o.slerpQuaternions(t,i,a)}static slerpFlat(t,i,o,a,u,d,p){let v=o[a+0],A=o[a+1],P=o[a+2],U=o[a+3];const N=u[d+0],j=u[d+1],te=u[d+2],Z=u[d+3];if(0===p)return t[i+0]=v,t[i+1]=A,t[i+2]=P,void(t[i+3]=U);if(1===p)return t[i+0]=N,t[i+1]=j,t[i+2]=te,void(t[i+3]=Z);if(U!==Z||v!==N||A!==j||P!==te){let q=1-p;const ge=v*N+A*j+P*te+U*Z,ye=ge>=0?1:-1,De=1-ge*ge;if(De>Number.EPSILON){const Ne=Math.sqrt(De),tt=Math.atan2(Ne,ge*ye);q=Math.sin(q*tt)/Ne,p=Math.sin(p*tt)/Ne}const Le=p*ye;if(v=v*q+N*Le,A=A*q+j*Le,P=P*q+te*Le,U=U*q+Z*Le,q===1-p){const Ne=1/Math.sqrt(v*v+A*A+P*P+U*U);v*=Ne,A*=Ne,P*=Ne,U*=Ne}}t[i]=v,t[i+1]=A,t[i+2]=P,t[i+3]=U}static multiplyQuaternionsFlat(t,i,o,a,u,d){const p=o[a],v=o[a+1],A=o[a+2],P=o[a+3],U=u[d],N=u[d+1],j=u[d+2],te=u[d+3];return t[i]=p*te+P*U+v*j-A*N,t[i+1]=v*te+P*N+A*U-p*j,t[i+2]=A*te+P*j+p*N-v*U,t[i+3]=P*te-p*U-v*N-A*j,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,o,a){return this._x=t,this._y=i,this._z=o,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const o=t._x,a=t._y,u=t._z,d=t._order,p=Math.cos,v=Math.sin,A=p(o/2),P=p(a/2),U=p(u/2),N=v(o/2),j=v(a/2),te=v(u/2);switch(d){case"XYZ":this._x=N*P*U+A*j*te,this._y=A*j*U-N*P*te,this._z=A*P*te+N*j*U,this._w=A*P*U-N*j*te;break;case"YXZ":this._x=N*P*U+A*j*te,this._y=A*j*U-N*P*te,this._z=A*P*te-N*j*U,this._w=A*P*U+N*j*te;break;case"ZXY":this._x=N*P*U-A*j*te,this._y=A*j*U+N*P*te,this._z=A*P*te+N*j*U,this._w=A*P*U-N*j*te;break;case"ZYX":this._x=N*P*U-A*j*te,this._y=A*j*U+N*P*te,this._z=A*P*te-N*j*U,this._w=A*P*U+N*j*te;break;case"YZX":this._x=N*P*U+A*j*te,this._y=A*j*U+N*P*te,this._z=A*P*te-N*j*U,this._w=A*P*U-N*j*te;break;case"XZY":this._x=N*P*U-A*j*te,this._y=A*j*U-N*P*te,this._z=A*P*te+N*j*U,this._w=A*P*U+N*j*te;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+d)}return!1!==i&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const o=i/2,a=Math.sin(o);return this._x=t.x*a,this._y=t.y*a,this._z=t.z*a,this._w=Math.cos(o),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,o=i[0],a=i[4],u=i[8],d=i[1],p=i[5],v=i[9],A=i[2],P=i[6],U=i[10],N=o+p+U;if(N>0){const j=.5/Math.sqrt(N+1);this._w=.25/j,this._x=(P-v)*j,this._y=(u-A)*j,this._z=(d-a)*j}else if(o>p&&o>U){const j=2*Math.sqrt(1+o-p-U);this._w=(P-v)/j,this._x=.25*j,this._y=(a+d)/j,this._z=(u+A)/j}else if(p>U){const j=2*Math.sqrt(1+p-o-U);this._w=(u-A)/j,this._x=(a+d)/j,this._y=.25*j,this._z=(v+P)/j}else{const j=2*Math.sqrt(1+U-o-p);this._w=(d-a)/j,this._x=(u+A)/j,this._y=(v+P)/j,this._z=.25*j}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let o=t.dot(i)+1;return o<Number.EPSILON?(o=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=o):(this._x=0,this._y=-t.z,this._z=t.y,this._w=o)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=o),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Fs(this.dot(t),-1,1)))}rotateTowards(t,i){const o=this.angleTo(t);if(0===o)return this;const a=Math.min(1,i/o);return this.slerp(t,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const o=t._x,a=t._y,u=t._z,d=t._w,p=i._x,v=i._y,A=i._z,P=i._w;return this._x=o*P+d*p+a*A-u*v,this._y=a*P+d*v+u*p-o*A,this._z=u*P+d*A+o*v-a*p,this._w=d*P-o*p-a*v-u*A,this._onChangeCallback(),this}slerp(t,i){if(0===i)return this;if(1===i)return this.copy(t);const o=this._x,a=this._y,u=this._z,d=this._w;let p=d*t._w+o*t._x+a*t._y+u*t._z;if(p<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,p=-p):this.copy(t),p>=1)return this._w=d,this._x=o,this._y=a,this._z=u,this;const v=1-p*p;if(v<=Number.EPSILON){const j=1-i;return this._w=j*d+i*this._w,this._x=j*o+i*this._x,this._y=j*a+i*this._y,this._z=j*u+i*this._z,this.normalize(),this._onChangeCallback(),this}const A=Math.sqrt(v),P=Math.atan2(A,p),U=Math.sin((1-i)*P)/A,N=Math.sin(i*P)/A;return this._w=d*U+this._w*N,this._x=o*U+this._x*N,this._y=a*U+this._y*N,this._z=u*U+this._z*N,this._onChangeCallback(),this}slerpQuaternions(t,i,o){return this.copy(t).slerp(i,o)}random(){const t=Math.random(),i=Math.sqrt(1-t),o=Math.sqrt(t),a=2*Math.PI*Math.random(),u=2*Math.PI*Math.random();return this.set(i*Math.cos(a),o*Math.sin(u),o*Math.cos(u),i*Math.sin(a))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}no.prototype.isQuaternion=!0;class ze{constructor(t=0,i=0,o=0){this.x=t,this.y=i,this.z=o}set(t,i,o){return void 0===o&&(o=this.z),this.x=t,this.y=i,this.z=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Tl.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(Tl.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,o=this.y,a=this.z,u=t.elements;return this.x=u[0]*i+u[3]*o+u[6]*a,this.y=u[1]*i+u[4]*o+u[7]*a,this.z=u[2]*i+u[5]*o+u[8]*a,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,o=this.y,a=this.z,u=t.elements,d=1/(u[3]*i+u[7]*o+u[11]*a+u[15]);return this.x=(u[0]*i+u[4]*o+u[8]*a+u[12])*d,this.y=(u[1]*i+u[5]*o+u[9]*a+u[13])*d,this.z=(u[2]*i+u[6]*o+u[10]*a+u[14])*d,this}applyQuaternion(t){const i=this.x,o=this.y,a=this.z,u=t.x,d=t.y,p=t.z,v=t.w,A=v*i+d*a-p*o,P=v*o+p*i-u*a,U=v*a+u*o-d*i,N=-u*i-d*o-p*a;return this.x=A*v+N*-u+P*-p-U*-d,this.y=P*v+N*-d+U*-u-A*-p,this.z=U*v+N*-p+A*-d-P*-u,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,o=this.y,a=this.z,u=t.elements;return this.x=u[0]*i+u[4]*o+u[8]*a,this.y=u[1]*i+u[5]*o+u[9]*a,this.z=u[2]*i+u[6]*o+u[10]*a,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this.z=t.z+(i.z-t.z)*o,this}cross(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}crossVectors(t,i){const o=t.x,a=t.y,u=t.z,d=i.x,p=i.y,v=i.z;return this.x=a*v-u*p,this.y=u*d-o*v,this.z=o*p-a*d,this}projectOnVector(t){const i=t.lengthSq();if(0===i)return this.set(0,0,0);const o=t.dot(this)/i;return this.copy(t).multiplyScalar(o)}projectOnPlane(t){return uc.copy(this).projectOnVector(t),this.sub(uc)}reflect(t){return this.sub(uc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;const o=this.dot(t)/i;return Math.acos(Fs(o,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,o=this.y-t.y,a=this.z-t.z;return i*i+o*o+a*a}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,o){const a=Math.sin(i)*t;return this.x=a*Math.sin(o),this.y=Math.cos(i)*t,this.z=a*Math.cos(o),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,o){return this.x=t*Math.sin(i),this.y=o,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),o=this.setFromMatrixColumn(t,1).length(),a=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=o,this.z=a,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,4*i)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,3*i)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i,o){return void 0!==o&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),i=Math.random()*Math.PI*2,o=Math.sqrt(1-t**2);return this.x=o*Math.cos(i),this.y=o*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}ze.prototype.isVector3=!0;const uc=new ze,Tl=new no;class Eo{constructor(t=new ze(1/0,1/0,1/0),i=new ze(-1/0,-1/0,-1/0)){this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){let i=1/0,o=1/0,a=1/0,u=-1/0,d=-1/0,p=-1/0;for(let v=0,A=t.length;v<A;v+=3){const P=t[v],U=t[v+1],N=t[v+2];P<i&&(i=P),U<o&&(o=U),N<a&&(a=N),P>u&&(u=P),U>d&&(d=U),N>p&&(p=N)}return this.min.set(i,o,a),this.max.set(u,d,p),this}setFromBufferAttribute(t){let i=1/0,o=1/0,a=1/0,u=-1/0,d=-1/0,p=-1/0;for(let v=0,A=t.count;v<A;v++){const P=t.getX(v),U=t.getY(v),N=t.getZ(v);P<i&&(i=P),U<o&&(o=U),N<a&&(a=N),P>u&&(u=P),U>d&&(d=U),N>p&&(p=N)}return this.min.set(i,o,a),this.max.set(u,d,p),this}setFromPoints(t){this.makeEmpty();for(let i=0,o=t.length;i<o;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const o=Sa.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const o=t.geometry;if(void 0!==o)if(i&&null!=o.attributes&&void 0!==o.attributes.position){const u=o.attributes.position;for(let d=0,p=u.count;d<p;d++)Sa.fromBufferAttribute(u,d).applyMatrix4(t.matrixWorld),this.expandByPoint(Sa)}else null===o.boundingBox&&o.computeBoundingBox(),Bu.copy(o.boundingBox),Bu.applyMatrix4(t.matrixWorld),this.union(Bu);const a=t.children;for(let u=0,d=a.length;u<d;u++)this.expandByObject(a[u],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Sa),Sa.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,o;return t.normal.x>0?(i=t.normal.x*this.min.x,o=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,o=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,o+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,o+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,o+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,o+=t.normal.z*this.min.z),i<=-t.constant&&o>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Wc),Ca.subVectors(this.max,Wc),Sl.subVectors(t.a,Wc),ma.subVectors(t.b,Wc),hc.subVectors(t.c,Wc),dc.subVectors(ma,Sl),Cl.subVectors(hc,ma),nl.subVectors(Sl,hc);let i=[0,-dc.z,dc.y,0,-Cl.z,Cl.y,0,-nl.z,nl.y,dc.z,0,-dc.x,Cl.z,0,-Cl.x,nl.z,0,-nl.x,-dc.y,dc.x,0,-Cl.y,Cl.x,0,-nl.y,nl.x,0];return!(!Fu(i,Sl,ma,hc,Ca)||(i=[1,0,0,0,1,0,0,0,1],!Fu(i,Sl,ma,hc,Ca)))&&(ga.crossVectors(dc,Cl),i=[ga.x,ga.y,ga.z],Fu(i,Sl,ma,hc,Ca))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Sa.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Sa).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(jo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),jo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),jo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),jo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),jo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),jo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),jo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),jo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(jo)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Eo.prototype.isBox3=!0;const jo=[new ze,new ze,new ze,new ze,new ze,new ze,new ze,new ze],Sa=new ze,Bu=new Eo,Sl=new ze,ma=new ze,hc=new ze,dc=new ze,Cl=new ze,nl=new ze,Wc=new ze,Ca=new ze,ga=new ze,Rl=new ze;function Fu(s,t,i,o,a){for(let u=0,d=s.length-3;u<=d;u+=3){Rl.fromArray(s,u);const p=a.x*Math.abs(Rl.x)+a.y*Math.abs(Rl.y)+a.z*Math.abs(Rl.z),v=t.dot(Rl),A=i.dot(Rl),P=o.dot(Rl);if(Math.max(-Math.max(v,A,P),Math.min(v,A,P))>p)return!1}return!0}const fc=new Eo,Nd=new ze,Xc=new ze,Dh=new ze;class $o{constructor(t=new ze,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const o=this.center;void 0!==i?o.copy(i):fc.setFromPoints(t).getCenter(o);let a=0;for(let u=0,d=t.length;u<d;u++)a=Math.max(a,o.distanceToSquared(t[u]));return this.radius=Math.sqrt(a),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const o=this.center.distanceToSquared(t);return i.copy(t),o>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Dh.subVectors(t,this.center);const i=Dh.lengthSq();if(i>this.radius*this.radius){const o=Math.sqrt(i),a=.5*(o-this.radius);this.center.add(Dh.multiplyScalar(a/o)),this.radius+=a}return this}union(t){return!0===this.center.equals(t.center)?Xc.set(0,0,1).multiplyScalar(t.radius):Xc.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Nd.copy(t.center).add(Xc)),this.expandByPoint(Nd.copy(t.center).sub(Xc)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ri=new ze,pc=new ze,ea=new ze,mc=new ze,ip=new ze,Ra=new ze,Ou=new ze;class wo{constructor(t=new ze,i=new ze(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ri)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const o=i.dot(this.direction);return o<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(o).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=ri.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(ri.copy(this.direction).multiplyScalar(i).add(this.origin),ri.distanceToSquared(t))}distanceSqToSegment(t,i,o,a){pc.copy(t).add(i).multiplyScalar(.5),ea.copy(i).sub(t).normalize(),mc.copy(this.origin).sub(pc);const u=.5*t.distanceTo(i),d=-this.direction.dot(ea),p=mc.dot(this.direction),v=-mc.dot(ea),A=mc.lengthSq(),P=Math.abs(1-d*d);let U,N,j,te;if(P>0)if(U=d*v-p,N=d*p-v,te=u*P,U>=0)if(N>=-te)if(N<=te){const Z=1/P;U*=Z,N*=Z,j=U*(U+d*N+2*p)+N*(d*U+N+2*v)+A}else N=u,U=Math.max(0,-(d*N+p)),j=-U*U+N*(N+2*v)+A;else N=-u,U=Math.max(0,-(d*N+p)),j=-U*U+N*(N+2*v)+A;else N<=-te?(U=Math.max(0,-(-d*u+p)),N=U>0?-u:Math.min(Math.max(-u,-v),u),j=-U*U+N*(N+2*v)+A):N<=te?(U=0,N=Math.min(Math.max(-u,-v),u),j=N*(N+2*v)+A):(U=Math.max(0,-(d*u+p)),N=U>0?u:Math.min(Math.max(-u,-v),u),j=-U*U+N*(N+2*v)+A);else N=d>0?-u:u,U=Math.max(0,-(d*N+p)),j=-U*U+N*(N+2*v)+A;return o&&o.copy(this.direction).multiplyScalar(U).add(this.origin),a&&a.copy(ea).multiplyScalar(N).add(pc),j}intersectSphere(t,i){ri.subVectors(t.center,this.origin);const o=ri.dot(this.direction),a=ri.dot(ri)-o*o,u=t.radius*t.radius;if(a>u)return null;const d=Math.sqrt(u-a),p=o-d,v=o+d;return p<0&&v<0?null:this.at(p<0?v:p,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(0===i)return 0===t.distanceToPoint(this.origin)?0:null;const o=-(this.origin.dot(t.normal)+t.constant)/i;return o>=0?o:null}intersectPlane(t,i){const o=this.distanceToPlane(t);return null===o?null:this.at(o,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let o,a,u,d,p,v;const A=1/this.direction.x,P=1/this.direction.y,U=1/this.direction.z,N=this.origin;return A>=0?(o=(t.min.x-N.x)*A,a=(t.max.x-N.x)*A):(o=(t.max.x-N.x)*A,a=(t.min.x-N.x)*A),P>=0?(u=(t.min.y-N.y)*P,d=(t.max.y-N.y)*P):(u=(t.max.y-N.y)*P,d=(t.min.y-N.y)*P),o>d||u>a||((u>o||o!=o)&&(o=u),(d<a||a!=a)&&(a=d),U>=0?(p=(t.min.z-N.z)*U,v=(t.max.z-N.z)*U):(p=(t.max.z-N.z)*U,v=(t.min.z-N.z)*U),o>v||p>a)||((p>o||o!=o)&&(o=p),(v<a||a!=a)&&(a=v),a<0)?null:this.at(o>=0?o:a,i)}intersectsBox(t){return null!==this.intersectBox(t,ri)}intersectTriangle(t,i,o,a,u){ip.subVectors(i,t),Ra.subVectors(o,t),Ou.crossVectors(ip,Ra);let p,d=this.direction.dot(Ou);if(d>0){if(a)return null;p=1}else{if(!(d<0))return null;p=-1,d=-d}mc.subVectors(this.origin,t);const v=p*this.direction.dot(Ra.crossVectors(mc,Ra));if(v<0)return null;const A=p*this.direction.dot(ip.cross(mc));if(A<0||v+A>d)return null;const P=-p*mc.dot(Ou);return P<0?null:this.at(P/d,u)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class _i{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,i,o,a,u,d,p,v,A,P,U,N,j,te,Z,q){const ge=this.elements;return ge[0]=t,ge[4]=i,ge[8]=o,ge[12]=a,ge[1]=u,ge[5]=d,ge[9]=p,ge[13]=v,ge[2]=A,ge[6]=P,ge[10]=U,ge[14]=N,ge[3]=j,ge[7]=te,ge[11]=Z,ge[15]=q,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new _i).fromArray(this.elements)}copy(t){const i=this.elements,o=t.elements;return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],this}copyPosition(t){const i=this.elements,o=t.elements;return i[12]=o[12],i[13]=o[13],i[14]=o[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,o){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),o.setFromMatrixColumn(this,2),this}makeBasis(t,i,o){return this.set(t.x,i.x,o.x,0,t.y,i.y,o.y,0,t.z,i.z,o.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,o=t.elements,a=1/jc.setFromMatrixColumn(t,0).length(),u=1/jc.setFromMatrixColumn(t,1).length(),d=1/jc.setFromMatrixColumn(t,2).length();return i[0]=o[0]*a,i[1]=o[1]*a,i[2]=o[2]*a,i[3]=0,i[4]=o[4]*u,i[5]=o[5]*u,i[6]=o[6]*u,i[7]=0,i[8]=o[8]*d,i[9]=o[9]*d,i[10]=o[10]*d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const i=this.elements,o=t.x,a=t.y,u=t.z,d=Math.cos(o),p=Math.sin(o),v=Math.cos(a),A=Math.sin(a),P=Math.cos(u),U=Math.sin(u);if("XYZ"===t.order){const N=d*P,j=d*U,te=p*P,Z=p*U;i[0]=v*P,i[4]=-v*U,i[8]=A,i[1]=j+te*A,i[5]=N-Z*A,i[9]=-p*v,i[2]=Z-N*A,i[6]=te+j*A,i[10]=d*v}else if("YXZ"===t.order){const N=v*P,j=v*U,te=A*P,Z=A*U;i[0]=N+Z*p,i[4]=te*p-j,i[8]=d*A,i[1]=d*U,i[5]=d*P,i[9]=-p,i[2]=j*p-te,i[6]=Z+N*p,i[10]=d*v}else if("ZXY"===t.order){const N=v*P,j=v*U,te=A*P,Z=A*U;i[0]=N-Z*p,i[4]=-d*U,i[8]=te+j*p,i[1]=j+te*p,i[5]=d*P,i[9]=Z-N*p,i[2]=-d*A,i[6]=p,i[10]=d*v}else if("ZYX"===t.order){const N=d*P,j=d*U,te=p*P,Z=p*U;i[0]=v*P,i[4]=te*A-j,i[8]=N*A+Z,i[1]=v*U,i[5]=Z*A+N,i[9]=j*A-te,i[2]=-A,i[6]=p*v,i[10]=d*v}else if("YZX"===t.order){const N=d*v,j=d*A,te=p*v,Z=p*A;i[0]=v*P,i[4]=Z-N*U,i[8]=te*U+j,i[1]=U,i[5]=d*P,i[9]=-p*P,i[2]=-A*P,i[6]=j*U+te,i[10]=N-Z*U}else if("XZY"===t.order){const N=d*v,j=d*A,te=p*v,Z=p*A;i[0]=v*P,i[4]=-U,i[8]=A*P,i[1]=N*U+Z,i[5]=d*P,i[9]=j*U-te,i[2]=te*U-j,i[6]=p*P,i[10]=Z*U+N}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kd,t,sv)}lookAt(t,i,o){const a=this.elements;return io.subVectors(t,i),0===io.lengthSq()&&(io.z=1),io.normalize(),Ll.crossVectors(o,io),0===Ll.lengthSq()&&(1===Math.abs(o.z)?io.x+=1e-4:io.z+=1e-4,io.normalize(),Ll.crossVectors(o,io)),Ll.normalize(),Dl.crossVectors(io,Ll),a[0]=Ll.x,a[4]=Dl.x,a[8]=io.x,a[1]=Ll.y,a[5]=Dl.y,a[9]=io.y,a[2]=Ll.z,a[6]=Dl.z,a[10]=io.z,this}multiply(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const o=t.elements,a=i.elements,u=this.elements,d=o[0],p=o[4],v=o[8],A=o[12],P=o[1],U=o[5],N=o[9],j=o[13],te=o[2],Z=o[6],q=o[10],ge=o[14],ye=o[3],De=o[7],Le=o[11],Ne=o[15],tt=a[0],lt=a[4],ct=a[8],jt=a[12],wt=a[1],Ie=a[5],nt=a[9],wn=a[13],Tt=a[2],Yt=a[6],Wt=a[10],Kt=a[14],St=a[3],yn=a[7],Mn=a[11],jn=a[15];return u[0]=d*tt+p*wt+v*Tt+A*St,u[4]=d*lt+p*Ie+v*Yt+A*yn,u[8]=d*ct+p*nt+v*Wt+A*Mn,u[12]=d*jt+p*wn+v*Kt+A*jn,u[1]=P*tt+U*wt+N*Tt+j*St,u[5]=P*lt+U*Ie+N*Yt+j*yn,u[9]=P*ct+U*nt+N*Wt+j*Mn,u[13]=P*jt+U*wn+N*Kt+j*jn,u[2]=te*tt+Z*wt+q*Tt+ge*St,u[6]=te*lt+Z*Ie+q*Yt+ge*yn,u[10]=te*ct+Z*nt+q*Wt+ge*Mn,u[14]=te*jt+Z*wn+q*Kt+ge*jn,u[3]=ye*tt+De*wt+Le*Tt+Ne*St,u[7]=ye*lt+De*Ie+Le*Yt+Ne*yn,u[11]=ye*ct+De*nt+Le*Wt+Ne*Mn,u[15]=ye*jt+De*wn+Le*Kt+Ne*jn,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],o=t[4],a=t[8],u=t[12],d=t[1],p=t[5],v=t[9],A=t[13],P=t[2],U=t[6],N=t[10],j=t[14];return t[3]*(+u*v*U-a*A*U-u*p*N+o*A*N+a*p*j-o*v*j)+t[7]*(+i*v*j-i*A*N+u*d*N-a*d*j+a*A*P-u*v*P)+t[11]*(+i*A*U-i*p*j-u*d*U+o*d*j+u*p*P-o*A*P)+t[15]*(-a*p*P-i*v*U+i*p*N+a*d*U-o*d*N+o*v*P)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,o){const a=this.elements;return t.isVector3?(a[12]=t.x,a[13]=t.y,a[14]=t.z):(a[12]=t,a[13]=i,a[14]=o),this}invert(){const t=this.elements,i=t[0],o=t[1],a=t[2],u=t[3],d=t[4],p=t[5],v=t[6],A=t[7],P=t[8],U=t[9],N=t[10],j=t[11],te=t[12],Z=t[13],q=t[14],ge=t[15],ye=U*q*A-Z*N*A+Z*v*j-p*q*j-U*v*ge+p*N*ge,De=te*N*A-P*q*A-te*v*j+d*q*j+P*v*ge-d*N*ge,Le=P*Z*A-te*U*A+te*p*j-d*Z*j-P*p*ge+d*U*ge,Ne=te*U*v-P*Z*v-te*p*N+d*Z*N+P*p*q-d*U*q,tt=i*ye+o*De+a*Le+u*Ne;if(0===tt)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const lt=1/tt;return t[0]=ye*lt,t[1]=(Z*N*u-U*q*u-Z*a*j+o*q*j+U*a*ge-o*N*ge)*lt,t[2]=(p*q*u-Z*v*u+Z*a*A-o*q*A-p*a*ge+o*v*ge)*lt,t[3]=(U*v*u-p*N*u-U*a*A+o*N*A+p*a*j-o*v*j)*lt,t[4]=De*lt,t[5]=(P*q*u-te*N*u+te*a*j-i*q*j-P*a*ge+i*N*ge)*lt,t[6]=(te*v*u-d*q*u-te*a*A+i*q*A+d*a*ge-i*v*ge)*lt,t[7]=(d*N*u-P*v*u+P*a*A-i*N*A-d*a*j+i*v*j)*lt,t[8]=Le*lt,t[9]=(te*U*u-P*Z*u-te*o*j+i*Z*j+P*o*ge-i*U*ge)*lt,t[10]=(d*Z*u-te*p*u+te*o*A-i*Z*A-d*o*ge+i*p*ge)*lt,t[11]=(P*p*u-d*U*u-P*o*A+i*U*A+d*o*j-i*p*j)*lt,t[12]=Ne*lt,t[13]=(P*Z*a-te*U*a+te*o*N-i*Z*N-P*o*q+i*U*q)*lt,t[14]=(te*p*a-d*Z*a-te*o*v+i*Z*v+d*o*q-i*p*q)*lt,t[15]=(d*U*a-P*p*a+P*o*v-i*U*v-d*o*N+i*p*N)*lt,this}scale(t){const i=this.elements,o=t.x,a=t.y,u=t.z;return i[0]*=o,i[4]*=a,i[8]*=u,i[1]*=o,i[5]*=a,i[9]*=u,i[2]*=o,i[6]*=a,i[10]*=u,i[3]*=o,i[7]*=a,i[11]*=u,this}getMaxScaleOnAxis(){const t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))}makeTranslation(t,i,o){return this.set(1,0,0,t,0,1,0,i,0,0,1,o,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),o=Math.sin(t);return this.set(1,0,0,0,0,i,-o,0,0,o,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),o=Math.sin(t);return this.set(i,0,o,0,0,1,0,0,-o,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),o=Math.sin(t);return this.set(i,-o,0,0,o,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const o=Math.cos(i),a=Math.sin(i),u=1-o,d=t.x,p=t.y,v=t.z,A=u*d,P=u*p;return this.set(A*d+o,A*p-a*v,A*v+a*p,0,A*p+a*v,P*p+o,P*v-a*d,0,A*v-a*p,P*v+a*d,u*v*v+o,0,0,0,0,1),this}makeScale(t,i,o){return this.set(t,0,0,0,0,i,0,0,0,0,o,0,0,0,0,1),this}makeShear(t,i,o,a,u,d){return this.set(1,o,u,0,t,1,d,0,i,a,1,0,0,0,0,1),this}compose(t,i,o){const a=this.elements,u=i._x,d=i._y,p=i._z,v=i._w,A=u+u,P=d+d,U=p+p,N=u*A,j=u*P,te=u*U,Z=d*P,q=d*U,ge=p*U,ye=v*A,De=v*P,Le=v*U,Ne=o.x,tt=o.y,lt=o.z;return a[0]=(1-(Z+ge))*Ne,a[1]=(j+Le)*Ne,a[2]=(te-De)*Ne,a[3]=0,a[4]=(j-Le)*tt,a[5]=(1-(N+ge))*tt,a[6]=(q+ye)*tt,a[7]=0,a[8]=(te+De)*lt,a[9]=(q-ye)*lt,a[10]=(1-(N+Z))*lt,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this}decompose(t,i,o){const a=this.elements;let u=jc.set(a[0],a[1],a[2]).length();const d=jc.set(a[4],a[5],a[6]).length(),p=jc.set(a[8],a[9],a[10]).length();this.determinant()<0&&(u=-u),t.x=a[12],t.y=a[13],t.z=a[14],Bo.copy(this);const A=1/u,P=1/d,U=1/p;return Bo.elements[0]*=A,Bo.elements[1]*=A,Bo.elements[2]*=A,Bo.elements[4]*=P,Bo.elements[5]*=P,Bo.elements[6]*=P,Bo.elements[8]*=U,Bo.elements[9]*=U,Bo.elements[10]*=U,i.setFromRotationMatrix(Bo),o.x=u,o.y=d,o.z=p,this}makePerspective(t,i,o,a,u,d){void 0===d&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const p=this.elements,A=2*u/(o-a),P=(i+t)/(i-t),U=(o+a)/(o-a),N=-(d+u)/(d-u),j=-2*d*u/(d-u);return p[0]=2*u/(i-t),p[4]=0,p[8]=P,p[12]=0,p[1]=0,p[5]=A,p[9]=U,p[13]=0,p[2]=0,p[6]=0,p[10]=N,p[14]=j,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(t,i,o,a,u,d){const p=this.elements,v=1/(i-t),A=1/(o-a),P=1/(d-u),U=(i+t)*v,N=(o+a)*A,j=(d+u)*P;return p[0]=2*v,p[4]=0,p[8]=0,p[12]=-U,p[1]=0,p[5]=2*A,p[9]=0,p[13]=-N,p[2]=0,p[6]=0,p[10]=-2*P,p[14]=-j,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(t){const i=this.elements,o=t.elements;for(let a=0;a<16;a++)if(i[a]!==o[a])return!1;return!0}fromArray(t,i=0){for(let o=0;o<16;o++)this.elements[o]=t[o+i];return this}toArray(t=[],i=0){const o=this.elements;return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],t[i+4]=o[4],t[i+5]=o[5],t[i+6]=o[6],t[i+7]=o[7],t[i+8]=o[8],t[i+9]=o[9],t[i+10]=o[10],t[i+11]=o[11],t[i+12]=o[12],t[i+13]=o[13],t[i+14]=o[14],t[i+15]=o[15],t}}_i.prototype.isMatrix4=!0;const jc=new ze,Bo=new _i,kd=new ze(0,0,0),sv=new ze(1,1,1),Ll=new ze,Dl=new ze,io=new ze,Ph=new _i,Uu=new no;class Yc{constructor(t=0,i=0,o=0,a=Yc.DefaultOrder){this._x=t,this._y=i,this._z=o,this._order=a}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,o,a=this._order){return this._x=t,this._y=i,this._z=o,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,o=!0){const a=t.elements,u=a[0],d=a[4],p=a[8],v=a[1],A=a[5],P=a[9],U=a[2],N=a[6],j=a[10];switch(i){case"XYZ":this._y=Math.asin(Fs(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-P,j),this._z=Math.atan2(-d,u)):(this._x=Math.atan2(N,A),this._z=0);break;case"YXZ":this._x=Math.asin(-Fs(P,-1,1)),Math.abs(P)<.9999999?(this._y=Math.atan2(p,j),this._z=Math.atan2(v,A)):(this._y=Math.atan2(-U,u),this._z=0);break;case"ZXY":this._x=Math.asin(Fs(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-U,j),this._z=Math.atan2(-d,A)):(this._y=0,this._z=Math.atan2(v,u));break;case"ZYX":this._y=Math.asin(-Fs(U,-1,1)),Math.abs(U)<.9999999?(this._x=Math.atan2(N,j),this._z=Math.atan2(v,u)):(this._x=0,this._z=Math.atan2(-d,A));break;case"YZX":this._z=Math.asin(Fs(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-P,A),this._y=Math.atan2(-U,u)):(this._x=0,this._y=Math.atan2(p,j));break;case"XZY":this._z=Math.asin(-Fs(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(N,A),this._y=Math.atan2(p,u)):(this._x=Math.atan2(-P,j),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===o&&this._onChangeCallback(),this}setFromQuaternion(t,i,o){return Ph.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ph,i,o)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return Uu.setFromEuler(this),this.setFromQuaternion(Uu,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Yc.prototype.isEuler=!0,Yc.DefaultOrder="XYZ",Yc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class rp{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Ym=0;const sp=new ze,Qc=new no,Pl=new _i,Ih=new ze,Er=new ze,La=new ze,Il=new no,Hd=new ze(1,0,0),il=new ze(0,1,0),Zc=new ze(0,0,1),Nu={type:"added"},op={type:"removed"};class ns extends $a{constructor(){super(),Object.defineProperty(this,"id",{value:Ym++}),this.uuid=bo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ns.DefaultUp.clone();const t=new ze,i=new Yc,o=new no,a=new ze(1,1,1);i._onChange(function(){o.setFromEuler(i,!1)}),o._onChange(function(){i.setFromQuaternion(o,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new _i},normalMatrix:{value:new Hr}}),this.matrix=new _i,this.matrixWorld=new _i,this.matrixAutoUpdate=ns.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new rp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Qc.setFromAxisAngle(t,i),this.quaternion.multiply(Qc),this}rotateOnWorldAxis(t,i){return Qc.setFromAxisAngle(t,i),this.quaternion.premultiply(Qc),this}rotateX(t){return this.rotateOnAxis(Hd,t)}rotateY(t){return this.rotateOnAxis(il,t)}rotateZ(t){return this.rotateOnAxis(Zc,t)}translateOnAxis(t,i){return sp.copy(t).applyQuaternion(this.quaternion),this.position.add(sp.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(Hd,t)}translateY(t){return this.translateOnAxis(il,t)}translateZ(t){return this.translateOnAxis(Zc,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Pl.copy(this.matrixWorld).invert())}lookAt(t,i,o){t.isVector3?Ih.copy(t):Ih.set(t,i,o);const a=this.parent;this.updateWorldMatrix(!0,!1),Er.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pl.lookAt(Er,Ih,this.up):Pl.lookAt(Ih,Er,this.up),this.quaternion.setFromRotationMatrix(Pl),a&&(Pl.extractRotation(a.matrixWorld),Qc.setFromRotationMatrix(Pl),this.quaternion.premultiply(Qc.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Nu)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(op)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(op)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Pl.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Pl.multiply(t.parent.matrixWorld)),t.applyMatrix4(Pl),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let o=0,a=this.children.length;o<a;o++){const d=this.children[o].getObjectByProperty(t,i);if(void 0!==d)return d}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Er,t,La),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Er,Il,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].updateMatrixWorld(t)}updateWorldMatrix(t,i){const o=this.parent;if(!0===t&&null!==o&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const a=this.children;for(let u=0,d=a.length;u<d;u++)a[u].updateWorldMatrix(!1,!0)}}toJSON(t){const i=void 0===t||"string"==typeof t,o={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const a={};function u(p,v){return void 0===p[v.uuid]&&(p[v.uuid]=v.toJSON(t)),v.uuid}if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(a.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(a.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=u(t.geometries,this.geometry);const p=this.geometry.parameters;if(void 0!==p&&void 0!==p.shapes){const v=p.shapes;if(Array.isArray(v))for(let A=0,P=v.length;A<P;A++)u(t.shapes,v[A]);else u(t.shapes,v)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(u(t.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const p=[];for(let v=0,A=this.material.length;v<A;v++)p.push(u(t.materials,this.material[v]));a.material=p}else a.material=u(t.materials,this.material);if(this.children.length>0){a.children=[];for(let p=0;p<this.children.length;p++)a.children.push(this.children[p].toJSON(t).object)}if(this.animations.length>0){a.animations=[];for(let p=0;p<this.animations.length;p++)a.animations.push(u(t.animations,this.animations[p]))}if(i){const p=d(t.geometries),v=d(t.materials),A=d(t.textures),P=d(t.images),U=d(t.shapes),N=d(t.skeletons),j=d(t.animations),te=d(t.nodes);p.length>0&&(o.geometries=p),v.length>0&&(o.materials=v),A.length>0&&(o.textures=A),P.length>0&&(o.images=P),U.length>0&&(o.shapes=U),N.length>0&&(o.skeletons=N),j.length>0&&(o.animations=j),te.length>0&&(o.nodes=te)}return o.object=a,o;function d(p){const v=[];for(const A in p){const P=p[A];delete P.metadata,v.push(P)}return v}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let o=0;o<t.children.length;o++)this.add(t.children[o].clone());return this}}ns.DefaultUp=new ze(0,1,0),ns.DefaultMatrixAutoUpdate=!0,ns.prototype.isObject3D=!0;const ca=new ze,Da=new ze,Xs=new ze,Bl=new ze,js=new ze,ta=new ze,ws=new ze,ku=new ze,Gr=new ze,Gd=new ze;class ro{constructor(t=new ze,i=new ze,o=new ze){this.a=t,this.b=i,this.c=o}static getNormal(t,i,o,a){a.subVectors(o,i),ca.subVectors(t,i),a.cross(ca);const u=a.lengthSq();return u>0?a.multiplyScalar(1/Math.sqrt(u)):a.set(0,0,0)}static getBarycoord(t,i,o,a,u){ca.subVectors(a,i),Da.subVectors(o,i),Xs.subVectors(t,i);const d=ca.dot(ca),p=ca.dot(Da),v=ca.dot(Xs),A=Da.dot(Da),P=Da.dot(Xs),U=d*A-p*p;if(0===U)return u.set(-2,-1,-1);const N=1/U,j=(A*v-p*P)*N,te=(d*P-p*v)*N;return u.set(1-j-te,te,j)}static containsPoint(t,i,o,a){return this.getBarycoord(t,i,o,a,Bl),Bl.x>=0&&Bl.y>=0&&Bl.x+Bl.y<=1}static getUV(t,i,o,a,u,d,p,v){return this.getBarycoord(t,i,o,a,Bl),v.set(0,0),v.addScaledVector(u,Bl.x),v.addScaledVector(d,Bl.y),v.addScaledVector(p,Bl.z),v}static isFrontFacing(t,i,o,a){return ca.subVectors(o,i),Da.subVectors(t,i),ca.cross(Da).dot(a)<0}set(t,i,o){return this.a.copy(t),this.b.copy(i),this.c.copy(o),this}setFromPointsAndIndices(t,i,o,a){return this.a.copy(t[i]),this.b.copy(t[o]),this.c.copy(t[a]),this}setFromAttributeAndIndices(t,i,o,a){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,o),this.c.fromBufferAttribute(t,a),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ca.subVectors(this.c,this.b),Da.subVectors(this.a,this.b),.5*ca.cross(Da).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ro.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return ro.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,o,a,u){return ro.getUV(t,this.a,this.b,this.c,i,o,a,u)}containsPoint(t){return ro.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ro.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const o=this.a,a=this.b,u=this.c;let d,p;js.subVectors(a,o),ta.subVectors(u,o),ku.subVectors(t,o);const v=js.dot(ku),A=ta.dot(ku);if(v<=0&&A<=0)return i.copy(o);Gr.subVectors(t,a);const P=js.dot(Gr),U=ta.dot(Gr);if(P>=0&&U<=P)return i.copy(a);const N=v*U-P*A;if(N<=0&&v>=0&&P<=0)return d=v/(v-P),i.copy(o).addScaledVector(js,d);Gd.subVectors(t,u);const j=js.dot(Gd),te=ta.dot(Gd);if(te>=0&&j<=te)return i.copy(u);const Z=j*A-v*te;if(Z<=0&&A>=0&&te<=0)return p=A/(A-te),i.copy(o).addScaledVector(ta,p);const q=P*te-j*U;if(q<=0&&U-P>=0&&j-te>=0)return ws.subVectors(u,a),p=(U-P)/(U-P+(j-te)),i.copy(a).addScaledVector(ws,p);const ge=1/(q+Z+N);return d=Z*ge,p=N*ge,i.copy(o).addScaledVector(js,d).addScaledVector(ta,p)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Qm=0;class so extends $a{constructor(){super(),Object.defineProperty(this,"id",{value:Qm++}),this.uuid=bo(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const i in t){const o=t[i];if(void 0===o){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}if("shading"===i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===o;continue}const a=this[i];void 0!==a?a&&a.isColor?a.set(o):a&&a.isVector3&&o&&o.isVector3?a.copy(o):this[i]=o:console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.")}}toJSON(t){const i=void 0===t||"string"==typeof t;i&&(t={textures:{},images:{}});const o={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function a(u){const d=[];for(const p in u){const v=u[p];delete v.metadata,d.push(v)}return d}if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),void 0!==this.roughness&&(o.roughness=this.roughness),void 0!==this.metalness&&(o.metalness=this.metalness),void 0!==this.sheen&&(o.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(o.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(o.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(o.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(o.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(o.shininess=this.shininess),void 0!==this.clearcoat&&(o.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(o.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(o.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(o.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(o.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,o.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(t).uuid,o.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(t).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(t).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(t).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(t).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(o.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(o.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(o.combine=this.combine)),void 0!==this.envMapIntensity&&(o.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(o.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(o.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(o.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(o.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(o.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(o.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(o.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(o.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(o.size=this.size),null!==this.shadowSide&&(o.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(o.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(o.blending=this.blending),0!==this.side&&(o.side=this.side),this.vertexColors&&(o.vertexColors=!0),this.opacity<1&&(o.opacity=this.opacity),!0===this.transparent&&(o.transparent=this.transparent),o.depthFunc=this.depthFunc,o.depthTest=this.depthTest,o.depthWrite=this.depthWrite,o.colorWrite=this.colorWrite,o.stencilWrite=this.stencilWrite,o.stencilWriteMask=this.stencilWriteMask,o.stencilFunc=this.stencilFunc,o.stencilRef=this.stencilRef,o.stencilFuncMask=this.stencilFuncMask,o.stencilFail=this.stencilFail,o.stencilZFail=this.stencilZFail,o.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(o.rotation=this.rotation),!0===this.polygonOffset&&(o.polygonOffset=!0),0!==this.polygonOffsetFactor&&(o.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(o.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(o.linewidth=this.linewidth),void 0!==this.dashSize&&(o.dashSize=this.dashSize),void 0!==this.gapSize&&(o.gapSize=this.gapSize),void 0!==this.scale&&(o.scale=this.scale),!0===this.dithering&&(o.dithering=!0),this.alphaTest>0&&(o.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(o.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(o.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(o.wireframe=this.wireframe),this.wireframeLinewidth>1&&(o.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(o.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(o.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(o.flatShading=this.flatShading),!1===this.visible&&(o.visible=!1),!1===this.toneMapped&&(o.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),i){const u=a(t.textures),d=a(t.images);u.length>0&&(o.textures=u),d.length>0&&(o.images=d)}return o}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let o=null;if(null!==i){const a=i.length;o=new Array(a);for(let u=0;u!==a;++u)o[u]=i[u].clone()}return this.clippingPlanes=o,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}so.prototype.isMaterial=!0,so.fromType=function(){return null};class Pa extends so{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Rn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Pa.prototype.isMeshBasicMaterial=!0;const oo=new ze,qc=new st;class ls{constructor(t,i,o){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===o,this.usage=Mh,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,i,o){t*=this.itemSize,o*=i.itemSize;for(let a=0,u=this.itemSize;a<u;a++)this.array[t+a]=i.array[o+a];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const i=this.array;let o=0;for(let a=0,u=t.length;a<u;a++){let d=t[a];void 0===d&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",a),d=new Rn),i[o++]=d.r,i[o++]=d.g,i[o++]=d.b}return this}copyVector2sArray(t){const i=this.array;let o=0;for(let a=0,u=t.length;a<u;a++){let d=t[a];void 0===d&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",a),d=new st),i[o++]=d.x,i[o++]=d.y}return this}copyVector3sArray(t){const i=this.array;let o=0;for(let a=0,u=t.length;a<u;a++){let d=t[a];void 0===d&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",a),d=new ze),i[o++]=d.x,i[o++]=d.y,i[o++]=d.z}return this}copyVector4sArray(t){const i=this.array;let o=0;for(let a=0,u=t.length;a<u;a++){let d=t[a];void 0===d&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",a),d=new Oe),i[o++]=d.x,i[o++]=d.y,i[o++]=d.z,i[o++]=d.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let i=0,o=this.count;i<o;i++)qc.fromBufferAttribute(this,i),qc.applyMatrix3(t),this.setXY(i,qc.x,qc.y);else if(3===this.itemSize)for(let i=0,o=this.count;i<o;i++)oo.fromBufferAttribute(this,i),oo.applyMatrix3(t),this.setXYZ(i,oo.x,oo.y,oo.z);return this}applyMatrix4(t){for(let i=0,o=this.count;i<o;i++)oo.fromBufferAttribute(this,i),oo.applyMatrix4(t),this.setXYZ(i,oo.x,oo.y,oo.z);return this}applyNormalMatrix(t){for(let i=0,o=this.count;i<o;i++)oo.fromBufferAttribute(this,i),oo.applyNormalMatrix(t),this.setXYZ(i,oo.x,oo.y,oo.z);return this}transformDirection(t){for(let i=0,o=this.count;i<o;i++)oo.fromBufferAttribute(this,i),oo.transformDirection(t),this.setXYZ(i,oo.x,oo.y,oo.z);return this}set(t,i=0){return this.array.set(t,i),this}getX(t){return this.array[t*this.itemSize]}setX(t,i){return this.array[t*this.itemSize]=i,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,i){return this.array[t*this.itemSize+1]=i,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,i){return this.array[t*this.itemSize+2]=i,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,i){return this.array[t*this.itemSize+3]=i,this}setXY(t,i,o){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=o,this}setXYZ(t,i,o,a){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=o,this.array[t+2]=a,this}setXYZW(t,i,o,a,u){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=o,this.array[t+2]=a,this.array[t+3]=u,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Mh&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}}ls.prototype.isBufferAttribute=!0;class zd extends ls{constructor(t,i,o){super(new Uint16Array(t),i,o)}}class na extends ls{constructor(t,i,o){super(new Uint32Array(t),i,o)}}(class extends ls{constructor(t,i,o){super(new Uint16Array(t),i,o)}}).prototype.isFloat16BufferAttribute=!0;class Vn extends ls{constructor(t,i,o){super(new Float32Array(t),i,o)}}let Zm=0;const Fo=new _i,Oh=new ns,ua=new ze,go=new Eo,va=new Eo,vo=new ze;class Hi extends $a{constructor(){super(),Object.defineProperty(this,"id",{value:Zm++}),this.uuid=bo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return this.index=Array.isArray(t)?new(tp(t)?na:zd)(t,1):t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,i,o=0){this.groups.push({start:t,count:i,materialIndex:o})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);const o=this.attributes.normal;if(void 0!==o){const u=(new Hr).getNormalMatrix(t);o.applyNormalMatrix(u),o.needsUpdate=!0}const a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(t),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Fo.makeRotationFromQuaternion(t),this.applyMatrix4(Fo),this}rotateX(t){return Fo.makeRotationX(t),this.applyMatrix4(Fo),this}rotateY(t){return Fo.makeRotationY(t),this.applyMatrix4(Fo),this}rotateZ(t){return Fo.makeRotationZ(t),this.applyMatrix4(Fo),this}translate(t,i,o){return Fo.makeTranslation(t,i,o),this.applyMatrix4(Fo),this}scale(t,i,o){return Fo.makeScale(t,i,o),this.applyMatrix4(Fo),this}lookAt(t){return Oh.lookAt(t),Oh.updateMatrix(),this.applyMatrix4(Oh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ua).negate(),this.translate(ua.x,ua.y,ua.z),this}setFromPoints(t){const i=[];for(let o=0,a=t.length;o<a;o++){const u=t[o];i.push(u.x,u.y,u.z||0)}return this.setAttribute("position",new Vn(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Eo);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ze(-1/0,-1/0,-1/0),new ze(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(let o=0,a=i.length;o<a;o++)go.setFromBufferAttribute(i[o]),this.morphTargetsRelative?(vo.addVectors(this.boundingBox.min,go.min),this.boundingBox.expandByPoint(vo),vo.addVectors(this.boundingBox.max,go.max),this.boundingBox.expandByPoint(vo)):(this.boundingBox.expandByPoint(go.min),this.boundingBox.expandByPoint(go.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new $o);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ze,1/0);if(t){const o=this.boundingSphere.center;if(go.setFromBufferAttribute(t),i)for(let u=0,d=i.length;u<d;u++)va.setFromBufferAttribute(i[u]),this.morphTargetsRelative?(vo.addVectors(go.min,va.min),go.expandByPoint(vo),vo.addVectors(go.max,va.max),go.expandByPoint(vo)):(go.expandByPoint(va.min),go.expandByPoint(va.max));go.getCenter(o);let a=0;for(let u=0,d=t.count;u<d;u++)vo.fromBufferAttribute(t,u),a=Math.max(a,o.distanceToSquared(vo));if(i)for(let u=0,d=i.length;u<d;u++){const p=i[u],v=this.morphTargetsRelative;for(let A=0,P=p.count;A<P;A++)vo.fromBufferAttribute(p,A),v&&(ua.fromBufferAttribute(t,A),vo.add(ua)),a=Math.max(a,o.distanceToSquared(vo))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(null===t||void 0===i.position||void 0===i.normal||void 0===i.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const o=t.array,a=i.position.array,u=i.normal.array,d=i.uv.array,p=a.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ls(new Float32Array(4*p),4));const v=this.getAttribute("tangent").array,A=[],P=[];for(let wt=0;wt<p;wt++)A[wt]=new ze,P[wt]=new ze;const U=new ze,N=new ze,j=new ze,te=new st,Z=new st,q=new st,ge=new ze,ye=new ze;function De(wt,Ie,nt){U.fromArray(a,3*wt),N.fromArray(a,3*Ie),j.fromArray(a,3*nt),te.fromArray(d,2*wt),Z.fromArray(d,2*Ie),q.fromArray(d,2*nt),N.sub(U),j.sub(U),Z.sub(te),q.sub(te);const wn=1/(Z.x*q.y-q.x*Z.y);!isFinite(wn)||(ge.copy(N).multiplyScalar(q.y).addScaledVector(j,-Z.y).multiplyScalar(wn),ye.copy(j).multiplyScalar(Z.x).addScaledVector(N,-q.x).multiplyScalar(wn),A[wt].add(ge),A[Ie].add(ge),A[nt].add(ge),P[wt].add(ye),P[Ie].add(ye),P[nt].add(ye))}let Le=this.groups;0===Le.length&&(Le=[{start:0,count:o.length}]);for(let wt=0,Ie=Le.length;wt<Ie;++wt){const nt=Le[wt],wn=nt.start;for(let Yt=wn,Wt=wn+nt.count;Yt<Wt;Yt+=3)De(o[Yt+0],o[Yt+1],o[Yt+2])}const Ne=new ze,tt=new ze,lt=new ze,ct=new ze;function jt(wt){lt.fromArray(u,3*wt),ct.copy(lt);const Ie=A[wt];Ne.copy(Ie),Ne.sub(lt.multiplyScalar(lt.dot(Ie))).normalize(),tt.crossVectors(ct,Ie);const wn=tt.dot(P[wt])<0?-1:1;v[4*wt]=Ne.x,v[4*wt+1]=Ne.y,v[4*wt+2]=Ne.z,v[4*wt+3]=wn}for(let wt=0,Ie=Le.length;wt<Ie;++wt){const nt=Le[wt],wn=nt.start;for(let Yt=wn,Wt=wn+nt.count;Yt<Wt;Yt+=3)jt(o[Yt+0]),jt(o[Yt+1]),jt(o[Yt+2])}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(void 0!==i){let o=this.getAttribute("normal");if(void 0===o)o=new ls(new Float32Array(3*i.count),3),this.setAttribute("normal",o);else for(let N=0,j=o.count;N<j;N++)o.setXYZ(N,0,0,0);const a=new ze,u=new ze,d=new ze,p=new ze,v=new ze,A=new ze,P=new ze,U=new ze;if(t)for(let N=0,j=t.count;N<j;N+=3){const te=t.getX(N+0),Z=t.getX(N+1),q=t.getX(N+2);a.fromBufferAttribute(i,te),u.fromBufferAttribute(i,Z),d.fromBufferAttribute(i,q),P.subVectors(d,u),U.subVectors(a,u),P.cross(U),p.fromBufferAttribute(o,te),v.fromBufferAttribute(o,Z),A.fromBufferAttribute(o,q),p.add(P),v.add(P),A.add(P),o.setXYZ(te,p.x,p.y,p.z),o.setXYZ(Z,v.x,v.y,v.z),o.setXYZ(q,A.x,A.y,A.z)}else for(let N=0,j=i.count;N<j;N+=3)a.fromBufferAttribute(i,N+0),u.fromBufferAttribute(i,N+1),d.fromBufferAttribute(i,N+2),P.subVectors(d,u),U.subVectors(a,u),P.cross(U),o.setXYZ(N+0,P.x,P.y,P.z),o.setXYZ(N+1,P.x,P.y,P.z),o.setXYZ(N+2,P.x,P.y,P.z);this.normalizeNormals(),o.needsUpdate=!0}}merge(t,i){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===i&&(i=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const o=this.attributes;for(const a in o){if(void 0===t.attributes[a])continue;const d=o[a].array,p=t.attributes[a],v=p.array,A=p.itemSize*i,P=Math.min(v.length,d.length-A);for(let U=0,N=A;U<P;U++,N++)d[N]=v[U]}return this}normalizeNormals(){const t=this.attributes.normal;for(let i=0,o=t.count;i<o;i++)vo.fromBufferAttribute(t,i),vo.normalize(),t.setXYZ(i,vo.x,vo.y,vo.z)}toNonIndexed(){function t(p,v){const A=p.array,P=p.itemSize,U=p.normalized,N=new A.constructor(v.length*P);let j=0,te=0;for(let Z=0,q=v.length;Z<q;Z++){j=p.isInterleavedBufferAttribute?v[Z]*p.data.stride+p.offset:v[Z]*P;for(let ge=0;ge<P;ge++)N[te++]=A[j++]}return new ls(N,P,U)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Hi,o=this.index.array,a=this.attributes;for(const p in a){const A=t(a[p],o);i.setAttribute(p,A)}const u=this.morphAttributes;for(const p in u){const v=[],A=u[p];for(let P=0,U=A.length;P<U;P++){const j=t(A[P],o);v.push(j)}i.morphAttributes[p]=v}i.morphTargetsRelative=this.morphTargetsRelative;const d=this.groups;for(let p=0,v=d.length;p<v;p++){const A=d[p];i.addGroup(A.start,A.count,A.materialIndex)}return i}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const v=this.parameters;for(const A in v)void 0!==v[A]&&(t[A]=v[A]);return t}t.data={attributes:{}};const i=this.index;null!==i&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const o=this.attributes;for(const v in o)t.data.attributes[v]=o[v].toJSON(t.data);const a={};let u=!1;for(const v in this.morphAttributes){const A=this.morphAttributes[v],P=[];for(let U=0,N=A.length;U<N;U++)P.push(A[U].toJSON(t.data));P.length>0&&(a[v]=P,u=!0)}u&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);const d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));const p=this.boundingSphere;return null!==p&&(t.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const o=t.index;null!==o&&this.setIndex(o.clone(i));const a=t.attributes;for(const A in a)this.setAttribute(A,a[A].clone(i));const u=t.morphAttributes;for(const A in u){const P=[],U=u[A];for(let N=0,j=U.length;N<j;N++)P.push(U[N].clone(i));this.morphAttributes[A]=P}this.morphTargetsRelative=t.morphTargetsRelative;const d=t.groups;for(let A=0,P=d.length;A<P;A++){const U=d[A];this.addGroup(U.start,U.count,U.materialIndex)}const p=t.boundingBox;null!==p&&(this.boundingBox=p.clone());const v=t.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Hi.prototype.isBufferGeometry=!0;const Vd=new _i,Fl=new wo,Hu=new $o,Ba=new ze,Fa=new ze,Oa=new ze,Gu=new ze,Uh=new ze,zu=new ze,Ys=new ze,Wd=new ze,Kc=new ze,ya=new st,Ol=new st,_o=new st,Xd=new ze,jd=new ze;class yo extends ns{constructor(t=new Hi,i=new Pa){super(),this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const i=t.morphAttributes,o=Object.keys(i);if(o.length>0){const a=i[o[0]];if(void 0!==a){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,d=a.length;u<d;u++){const p=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=u}}}}else{const i=t.morphTargets;void 0!==i&&i.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,i){const o=this.geometry,a=this.material,u=this.matrixWorld;if(void 0===a||(null===o.boundingSphere&&o.computeBoundingSphere(),Hu.copy(o.boundingSphere),Hu.applyMatrix4(u),!1===t.ray.intersectsSphere(Hu))||(Vd.copy(u).invert(),Fl.copy(t.ray).applyMatrix4(Vd),null!==o.boundingBox&&!1===Fl.intersectsBox(o.boundingBox)))return;let d;if(o.isBufferGeometry){const p=o.index,v=o.attributes.position,A=o.morphAttributes.position,P=o.morphTargetsRelative,U=o.attributes.uv,N=o.attributes.uv2,j=o.groups,te=o.drawRange;if(null!==p)if(Array.isArray(a))for(let Z=0,q=j.length;Z<q;Z++){const ge=j[Z],ye=a[ge.materialIndex];for(let Ne=Math.max(ge.start,te.start),tt=Math.min(p.count,Math.min(ge.start+ge.count,te.start+te.count));Ne<tt;Ne+=3){const lt=p.getX(Ne),ct=p.getX(Ne+1),jt=p.getX(Ne+2);d=gc(this,ye,t,Fl,v,A,P,U,N,lt,ct,jt),d&&(d.faceIndex=Math.floor(Ne/3),d.face.materialIndex=ge.materialIndex,i.push(d))}}else for(let ge=Math.max(0,te.start),ye=Math.min(p.count,te.start+te.count);ge<ye;ge+=3){const De=p.getX(ge),Le=p.getX(ge+1),Ne=p.getX(ge+2);d=gc(this,a,t,Fl,v,A,P,U,N,De,Le,Ne),d&&(d.faceIndex=Math.floor(ge/3),i.push(d))}else if(void 0!==v)if(Array.isArray(a))for(let Z=0,q=j.length;Z<q;Z++){const ge=j[Z],ye=a[ge.materialIndex];for(let Ne=Math.max(ge.start,te.start),tt=Math.min(v.count,Math.min(ge.start+ge.count,te.start+te.count));Ne<tt;Ne+=3)d=gc(this,ye,t,Fl,v,A,P,U,N,Ne,Ne+1,Ne+2),d&&(d.faceIndex=Math.floor(Ne/3),d.face.materialIndex=ge.materialIndex,i.push(d))}else for(let ge=Math.max(0,te.start),ye=Math.min(v.count,te.start+te.count);ge<ye;ge+=3)d=gc(this,a,t,Fl,v,A,P,U,N,ge,ge+1,ge+2),d&&(d.faceIndex=Math.floor(ge/3),i.push(d))}else o.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function gc(s,t,i,o,a,u,d,p,v,A,P,U){Ba.fromBufferAttribute(a,A),Fa.fromBufferAttribute(a,P),Oa.fromBufferAttribute(a,U);const N=s.morphTargetInfluences;if(u&&N){Ys.set(0,0,0),Wd.set(0,0,0),Kc.set(0,0,0);for(let te=0,Z=u.length;te<Z;te++){const q=N[te],ge=u[te];0!==q&&(Gu.fromBufferAttribute(ge,A),Uh.fromBufferAttribute(ge,P),zu.fromBufferAttribute(ge,U),d?(Ys.addScaledVector(Gu,q),Wd.addScaledVector(Uh,q),Kc.addScaledVector(zu,q)):(Ys.addScaledVector(Gu.sub(Ba),q),Wd.addScaledVector(Uh.sub(Fa),q),Kc.addScaledVector(zu.sub(Oa),q)))}Ba.add(Ys),Fa.add(Wd),Oa.add(Kc)}s.isSkinnedMesh&&(s.boneTransform(A,Ba),s.boneTransform(P,Fa),s.boneTransform(U,Oa));const j=function(s,t,i,o,a,u,d,p){let v;if(v=1===t.side?o.intersectTriangle(d,u,a,!0,p):o.intersectTriangle(a,u,d,2!==t.side,p),null===v)return null;jd.copy(p),jd.applyMatrix4(s.matrixWorld);const A=i.ray.origin.distanceTo(jd);return A<i.near||A>i.far?null:{distance:A,point:jd.clone(),object:s}}(s,t,i,o,Ba,Fa,Oa,Xd);if(j){p&&(ya.fromBufferAttribute(p,A),Ol.fromBufferAttribute(p,P),_o.fromBufferAttribute(p,U),j.uv=ro.getUV(Xd,Ba,Fa,Oa,ya,Ol,_o,new st)),v&&(ya.fromBufferAttribute(v,A),Ol.fromBufferAttribute(v,P),_o.fromBufferAttribute(v,U),j.uv2=ro.getUV(Xd,Ba,Fa,Oa,ya,Ol,_o,new st));const te={a:A,b:P,c:U,normal:new ze,materialIndex:0};ro.getNormal(Ba,Fa,Oa,te.normal),j.face=te}return j}yo.prototype.isMesh=!0;class Ss extends Hi{constructor(t=1,i=1,o=1,a=1,u=1,d=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:o,widthSegments:a,heightSegments:u,depthSegments:d};const p=this;a=Math.floor(a),u=Math.floor(u),d=Math.floor(d);const v=[],A=[],P=[],U=[];let N=0,j=0;function te(Z,q,ge,ye,De,Le,Ne,tt,lt,ct,jt){const wt=Le/lt,Ie=Ne/ct,nt=Le/2,wn=Ne/2,Tt=tt/2,Yt=lt+1,Wt=ct+1;let Kt=0,St=0;const yn=new ze;for(let Mn=0;Mn<Wt;Mn++){const jn=Mn*Ie-wn;for(let Ln=0;Ln<Yt;Ln++)yn[Z]=(Ln*wt-nt)*ye,yn[q]=jn*De,yn[ge]=Tt,A.push(yn.x,yn.y,yn.z),yn[Z]=0,yn[q]=0,yn[ge]=tt>0?1:-1,P.push(yn.x,yn.y,yn.z),U.push(Ln/lt),U.push(1-Mn/ct),Kt+=1}for(let Mn=0;Mn<ct;Mn++)for(let jn=0;jn<lt;jn++){const zi=N+jn+Yt*(Mn+1),Vr=N+(jn+1)+Yt*(Mn+1),yr=N+(jn+1)+Yt*Mn;v.push(N+jn+Yt*Mn,zi,yr),v.push(zi,Vr,yr),St+=6}p.addGroup(j,St,jt),j+=St,N+=Kt}te("z","y","x",-1,-1,o,i,t,d,u,0),te("z","y","x",1,-1,o,i,-t,d,u,1),te("x","z","y",1,1,t,o,i,a,d,2),te("x","z","y",1,-1,t,o,-i,a,d,3),te("x","y","z",1,-1,t,i,o,a,u,4),te("x","y","z",-1,-1,t,i,-o,a,u,5),this.setIndex(v),this.setAttribute("position",new Vn(A,3)),this.setAttribute("normal",new Vn(P,3)),this.setAttribute("uv",new Vn(U,2))}static fromJSON(t){return new Ss(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ua(s){const t={};for(const i in s){t[i]={};for(const o in s[i]){const a=s[i][o];t[i][o]=a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.clone():Array.isArray(a)?a.slice():a}}return t}function ao(s){const t={};for(let i=0;i<s.length;i++){const o=Ua(s[i]);for(const a in o)t[a]=o[a]}return t}const Nh={clone:Ua,merge:ao};class Ho extends so{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ua(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const a in this.uniforms){const d=this.uniforms[a].value;i.uniforms[a]=d&&d.isTexture?{type:"t",value:d.toJSON(t).uuid}:d&&d.isColor?{type:"c",value:d.getHex()}:d&&d.isVector2?{type:"v2",value:d.toArray()}:d&&d.isVector3?{type:"v3",value:d.toArray()}:d&&d.isVector4?{type:"v4",value:d.toArray()}:d&&d.isMatrix3?{type:"m3",value:d.toArray()}:d&&d.isMatrix4?{type:"m4",value:d.toArray()}:{value:d}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;const o={};for(const a in this.extensions)!0===this.extensions[a]&&(o[a]=!0);return Object.keys(o).length>0&&(i.extensions=o),i}}Ho.prototype.isShaderMaterial=!0;class kh extends ns{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new _i,this.projectionMatrix=new _i,this.projectionMatrixInverse=new _i}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}kh.prototype.isCamera=!0;class Oo extends kh{constructor(t=50,i=1,o=.1,a=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=o,this.far=a,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=2*ac*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Ws*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*ac*Math.atan(Math.tan(.5*Ws*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,o,a,u,d){this.aspect=t/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=o,this.view.offsetY=a,this.view.width=u,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(.5*Ws*this.fov)/this.zoom,o=2*i,a=this.aspect*o,u=-.5*a;const d=this.view;if(null!==this.view&&this.view.enabled){const v=d.fullWidth,A=d.fullHeight;u+=d.offsetX*a/v,i-=d.offsetY*o/A,a*=d.width/v,o*=d.height/A}const p=this.filmOffset;0!==p&&(u+=t*p/this.getFilmWidth()),this.projectionMatrix.makePerspective(u,u+a,i,i-o,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}Oo.prototype.isPerspectiveCamera=!0;class Wu extends ns{constructor(t,i,o){if(super(),this.type="CubeCamera",!0!==o.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=o;const a=new Oo(90,1,t,i);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ze(1,0,0)),this.add(a);const u=new Oo(90,1,t,i);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new ze(-1,0,0)),this.add(u);const d=new Oo(90,1,t,i);d.layers=this.layers,d.up.set(0,0,1),d.lookAt(new ze(0,1,0)),this.add(d);const p=new Oo(90,1,t,i);p.layers=this.layers,p.up.set(0,0,-1),p.lookAt(new ze(0,-1,0)),this.add(p);const v=new Oo(90,1,t,i);v.layers=this.layers,v.up.set(0,-1,0),v.lookAt(new ze(0,0,1)),this.add(v);const A=new Oo(90,1,t,i);A.layers=this.layers,A.up.set(0,-1,0),A.lookAt(new ze(0,0,-1)),this.add(A)}update(t,i){null===this.parent&&this.updateMatrixWorld();const o=this.renderTarget,[a,u,d,p,v,A]=this.children,P=t.getRenderTarget(),U=t.outputEncoding,N=t.toneMapping,j=t.xr.enabled;t.outputEncoding=Ui,t.toneMapping=0,t.xr.enabled=!1;const te=o.texture.generateMipmaps;o.texture.generateMipmaps=!1,t.setRenderTarget(o,0),t.render(i,a),t.setRenderTarget(o,1),t.render(i,u),t.setRenderTarget(o,2),t.render(i,d),t.setRenderTarget(o,3),t.render(i,p),t.setRenderTarget(o,4),t.render(i,v),o.texture.generateMipmaps=te,t.setRenderTarget(o,5),t.render(i,A),t.setRenderTarget(P),t.outputEncoding=U,t.toneMapping=N,t.xr.enabled=j,o.texture.needsPMREMUpdate=!0}}class Nl extends as{constructor(t,i,o,a,u,d,p,v,A,P){super(t=void 0!==t?t:[],i=void 0!==i?i:301,o,a,u,d,p,v,A,P),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Nl.prototype.isCubeTexture=!0;class Qd extends Io{constructor(t,i={}){super(t,t,i);const o={width:t,height:t,depth:1};this.texture=new Nl([o,o,o,o,o,o],i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:rn}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o_uniforms={tEquirect:{value:null}},o_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",o_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Ss(5,5,5),u=new Ho({name:"CubemapFromEquirect",uniforms:Ua(o_uniforms),vertexShader:o_vertexShader,fragmentShader:o_fragmentShader,side:1,blending:0});u.uniforms.tEquirect.value=i;const d=new yo(a,u),p=i.minFilter;return 1008===i.minFilter&&(i.minFilter=rn),new Wu(1,10,this).update(t,d),i.minFilter=p,d.geometry.dispose(),d.material.dispose(),this}clear(t,i,o,a){const u=t.getRenderTarget();for(let d=0;d<6;d++)t.setRenderTarget(this,d),t.clear(i,o,a);t.setRenderTarget(u)}}Qd.prototype.isWebGLCubeRenderTarget=!0;const ap=new ze,Jc=new ze,av=new Hr;class kl{constructor(t=new ze(1,0,0),i=0){this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,o,a){return this.normal.set(t,i,o),this.constant=a,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,o){const a=ap.subVectors(o,i).cross(Jc.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,i){const o=t.delta(ap),a=this.normal.dot(o);if(0===a)return 0===this.distanceToPoint(t.start)?i.copy(t.start):null;const u=-(t.start.dot(this.normal)+this.constant)/a;return u<0||u>1?null:i.copy(o).multiplyScalar(u).add(t.start)}intersectsLine(t){const i=this.distanceToPoint(t.start),o=this.distanceToPoint(t.end);return i<0&&o>0||o<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const o=i||av.getNormalMatrix(t),a=this.coplanarPoint(ap).applyMatrix4(t),u=this.normal.applyMatrix3(o).normalize();return this.constant=-a.dot(u),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}kl.prototype.isPlane=!0;const Xu=new $o,Zd=new ze;class qd{constructor(t=new kl,i=new kl,o=new kl,a=new kl,u=new kl,d=new kl){this.planes=[t,i,o,a,u,d]}set(t,i,o,a,u,d){const p=this.planes;return p[0].copy(t),p[1].copy(i),p[2].copy(o),p[3].copy(a),p[4].copy(u),p[5].copy(d),this}copy(t){const i=this.planes;for(let o=0;o<6;o++)i[o].copy(t.planes[o]);return this}setFromProjectionMatrix(t){const i=this.planes,o=t.elements,a=o[0],u=o[1],d=o[2],p=o[3],v=o[4],A=o[5],P=o[6],U=o[7],N=o[8],j=o[9],te=o[10],Z=o[11],q=o[12],ge=o[13],ye=o[14],De=o[15];return i[0].setComponents(p-a,U-v,Z-N,De-q).normalize(),i[1].setComponents(p+a,U+v,Z+N,De+q).normalize(),i[2].setComponents(p+u,U+A,Z+j,De+ge).normalize(),i[3].setComponents(p-u,U-A,Z-j,De-ge).normalize(),i[4].setComponents(p-d,U-P,Z-te,De-ye).normalize(),i[5].setComponents(p+d,U+P,Z+te,De+ye).normalize(),this}intersectsObject(t){const i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),Xu.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Xu)}intersectsSprite(t){return Xu.center.set(0,0,0),Xu.radius=.7071067811865476,Xu.applyMatrix4(t.matrixWorld),this.intersectsSphere(Xu)}intersectsSphere(t){const i=this.planes,o=t.center,a=-t.radius;for(let u=0;u<6;u++)if(i[u].distanceToPoint(o)<a)return!1;return!0}intersectsBox(t){const i=this.planes;for(let o=0;o<6;o++){const a=i[o];if(Zd.x=a.normal.x>0?t.max.x:t.min.x,Zd.y=a.normal.y>0?t.max.y:t.min.y,Zd.z=a.normal.z>0?t.max.z:t.min.z,a.distanceToPoint(Zd)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let o=0;o<6;o++)if(i[o].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function qm(){let s=null,t=!1,i=null,o=null;function a(u,d){i(u,d),o=s.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==i&&(o=s.requestAnimationFrame(a),t=!0)},stop:function(){s.cancelAnimationFrame(o),t=!1},setAnimationLoop:function(u){i=u},setContext:function(u){s=u}}}function lv(s,t){const i=t.isWebGL2,o=new WeakMap;return{get:function(A){return A.isInterleavedBufferAttribute&&(A=A.data),o.get(A)},remove:function(A){A.isInterleavedBufferAttribute&&(A=A.data);const P=o.get(A);P&&(s.deleteBuffer(P.buffer),o.delete(A))},update:function(A,P){if(A.isGLBufferAttribute){const N=o.get(A);return void((!N||N.version<A.version)&&o.set(A,{buffer:A.buffer,type:A.type,bytesPerElement:A.elementSize,version:A.version}))}A.isInterleavedBufferAttribute&&(A=A.data);const U=o.get(A);void 0===U?o.set(A,function(A,P){const U=A.array,N=A.usage,j=s.createBuffer();let te;if(s.bindBuffer(P,j),s.bufferData(P,U,N),A.onUploadCallback(),U instanceof Float32Array)te=5126;else if(U instanceof Uint16Array)if(A.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");te=5131}else te=5123;else if(U instanceof Int16Array)te=5122;else if(U instanceof Uint32Array)te=5125;else if(U instanceof Int32Array)te=5124;else if(U instanceof Int8Array)te=5120;else if(U instanceof Uint8Array)te=5121;else{if(!(U instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+U);te=5121}return{buffer:j,type:te,bytesPerElement:U.BYTES_PER_ELEMENT,version:A.version}}(A,P)):U.version<A.version&&(function(A,P,U){const N=P.array,j=P.updateRange;s.bindBuffer(U,A),-1===j.count?s.bufferSubData(U,0,N):(i?s.bufferSubData(U,j.offset*N.BYTES_PER_ELEMENT,N,j.offset,j.count):s.bufferSubData(U,j.offset*N.BYTES_PER_ELEMENT,N.subarray(j.offset,j.offset+j.count)),j.count=-1)}(U.buffer,A,P),U.version=A.version)}}}class Hh extends Hi{constructor(t=1,i=1,o=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:o,heightSegments:a};const u=t/2,d=i/2,p=Math.floor(o),v=Math.floor(a),A=p+1,P=v+1,U=t/p,N=i/v,j=[],te=[],Z=[],q=[];for(let ge=0;ge<P;ge++){const ye=ge*N-d;for(let De=0;De<A;De++)te.push(De*U-u,-ye,0),Z.push(0,0,1),q.push(De/p),q.push(1-ge/v)}for(let ge=0;ge<v;ge++)for(let ye=0;ye<p;ye++){const Le=ye+A*(ge+1),Ne=ye+1+A*(ge+1),tt=ye+1+A*ge;j.push(ye+A*ge,Le,tt),j.push(Le,Ne,tt)}this.setIndex(j),this.setAttribute("position",new Vn(te,3)),this.setAttribute("normal",new Vn(Z,3)),this.setAttribute("uv",new Vn(q,2))}static fromJSON(t){return new Hh(t.width,t.height,t.widthSegments,t.heightSegments)}}const wr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Xn={common:{diffuse:{value:new Rn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Hr},uv2Transform:{value:new Hr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new st(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hr}},sprite:{diffuse:{value:new Rn(16777215)},opacity:{value:1},center:{value:new st(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hr}}},Qo={basic:{uniforms:ao([Xn.common,Xn.specularmap,Xn.envmap,Xn.aomap,Xn.lightmap,Xn.fog]),vertexShader:wr.meshbasic_vert,fragmentShader:wr.meshbasic_frag},lambert:{uniforms:ao([Xn.common,Xn.specularmap,Xn.envmap,Xn.aomap,Xn.lightmap,Xn.emissivemap,Xn.fog,Xn.lights,{emissive:{value:new Rn(0)}}]),vertexShader:wr.meshlambert_vert,fragmentShader:wr.meshlambert_frag},phong:{uniforms:ao([Xn.common,Xn.specularmap,Xn.envmap,Xn.aomap,Xn.lightmap,Xn.emissivemap,Xn.bumpmap,Xn.normalmap,Xn.displacementmap,Xn.fog,Xn.lights,{emissive:{value:new Rn(0)},specular:{value:new Rn(1118481)},shininess:{value:30}}]),vertexShader:wr.meshphong_vert,fragmentShader:wr.meshphong_frag},standard:{uniforms:ao([Xn.common,Xn.envmap,Xn.aomap,Xn.lightmap,Xn.emissivemap,Xn.bumpmap,Xn.normalmap,Xn.displacementmap,Xn.roughnessmap,Xn.metalnessmap,Xn.fog,Xn.lights,{emissive:{value:new Rn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wr.meshphysical_vert,fragmentShader:wr.meshphysical_frag},toon:{uniforms:ao([Xn.common,Xn.aomap,Xn.lightmap,Xn.emissivemap,Xn.bumpmap,Xn.normalmap,Xn.displacementmap,Xn.gradientmap,Xn.fog,Xn.lights,{emissive:{value:new Rn(0)}}]),vertexShader:wr.meshtoon_vert,fragmentShader:wr.meshtoon_frag},matcap:{uniforms:ao([Xn.common,Xn.bumpmap,Xn.normalmap,Xn.displacementmap,Xn.fog,{matcap:{value:null}}]),vertexShader:wr.meshmatcap_vert,fragmentShader:wr.meshmatcap_frag},points:{uniforms:ao([Xn.points,Xn.fog]),vertexShader:wr.points_vert,fragmentShader:wr.points_frag},dashed:{uniforms:ao([Xn.common,Xn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wr.linedashed_vert,fragmentShader:wr.linedashed_frag},depth:{uniforms:ao([Xn.common,Xn.displacementmap]),vertexShader:wr.depth_vert,fragmentShader:wr.depth_frag},normal:{uniforms:ao([Xn.common,Xn.bumpmap,Xn.normalmap,Xn.displacementmap,{opacity:{value:1}}]),vertexShader:wr.meshnormal_vert,fragmentShader:wr.meshnormal_frag},sprite:{uniforms:ao([Xn.sprite,Xn.fog]),vertexShader:wr.sprite_vert,fragmentShader:wr.sprite_frag},background:{uniforms:{uvTransform:{value:new Hr},t2D:{value:null}},vertexShader:wr.background_vert,fragmentShader:wr.background_frag},cube:{uniforms:ao([Xn.envmap,{opacity:{value:1}}]),vertexShader:wr.cube_vert,fragmentShader:wr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wr.equirect_vert,fragmentShader:wr.equirect_frag},distanceRGBA:{uniforms:ao([Xn.common,Xn.displacementmap,{referencePosition:{value:new ze},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wr.distanceRGBA_vert,fragmentShader:wr.distanceRGBA_frag},shadow:{uniforms:ao([Xn.lights,Xn.fog,{color:{value:new Rn(0)},opacity:{value:1}}]),vertexShader:wr.shadow_vert,fragmentShader:wr.shadow_frag}};function vc(s,t,i,o,a,u){const d=new Rn(0);let v,A,p=!0===a?0:1,P=null,U=0,N=null;function te(Z,q){i.buffers.color.setClear(Z.r,Z.g,Z.b,q,u)}return{getClearColor:function(){return d},setClearColor:function(Z,q=1){d.set(Z),p=q,te(d,p)},getClearAlpha:function(){return p},setClearAlpha:function(Z){p=Z,te(d,p)},render:function(Z,q){let ge=!1,ye=!0===q.isScene?q.background:null;ye&&ye.isTexture&&(ye=t.get(ye));const De=s.xr,Le=De.getSession&&De.getSession();Le&&"additive"===Le.environmentBlendMode&&(ye=null),null===ye?te(d,p):ye&&ye.isColor&&(te(ye,1),ge=!0),(s.autoClear||ge)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),ye&&(ye.isCubeTexture||ye.mapping===H)?(void 0===A&&(A=new yo(new Ss(1,1,1),new Ho({name:"BackgroundCubeMaterial",uniforms:Ua(Qo.cube.uniforms),vertexShader:Qo.cube.vertexShader,fragmentShader:Qo.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),A.geometry.deleteAttribute("uv"),A.onBeforeRender=function(Ne,tt,lt){this.matrixWorld.copyPosition(lt.matrixWorld)},Object.defineProperty(A.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(A)),A.material.uniforms.envMap.value=ye,A.material.uniforms.flipEnvMap.value=ye.isCubeTexture&&!1===ye.isRenderTargetTexture?-1:1,(P!==ye||U!==ye.version||N!==s.toneMapping)&&(A.material.needsUpdate=!0,P=ye,U=ye.version,N=s.toneMapping),Z.unshift(A,A.geometry,A.material,0,0,null)):ye&&ye.isTexture&&(void 0===v&&(v=new yo(new Hh(2,2),new Ho({name:"BackgroundMaterial",uniforms:Ua(Qo.background.uniforms),vertexShader:Qo.background.vertexShader,fragmentShader:Qo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),Object.defineProperty(v.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(v)),v.material.uniforms.t2D.value=ye,!0===ye.matrixAutoUpdate&&ye.updateMatrix(),v.material.uniforms.uvTransform.value.copy(ye.matrix),(P!==ye||U!==ye.version||N!==s.toneMapping)&&(v.material.needsUpdate=!0,P=ye,U=ye.version,N=s.toneMapping),Z.unshift(v,v.geometry,v.material,0,0,null))}}}function sl(s,t,i,o){const a=s.getParameter(34921),u=o.isWebGL2?null:t.get("OES_vertex_array_object"),d=o.isWebGL2||null!==u,p={},v=q(null);let A=v,P=!1;function j(Tt){return o.isWebGL2?s.bindVertexArray(Tt):u.bindVertexArrayOES(Tt)}function te(Tt){return o.isWebGL2?s.deleteVertexArray(Tt):u.deleteVertexArrayOES(Tt)}function q(Tt){const Yt=[],Wt=[],Kt=[];for(let St=0;St<a;St++)Yt[St]=0,Wt[St]=0,Kt[St]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Yt,enabledAttributes:Wt,attributeDivisors:Kt,object:Tt,attributes:{},index:null}}function De(){const Tt=A.newAttributes;for(let Yt=0,Wt=Tt.length;Yt<Wt;Yt++)Tt[Yt]=0}function Le(Tt){Ne(Tt,0)}function Ne(Tt,Yt){const Kt=A.enabledAttributes,St=A.attributeDivisors;A.newAttributes[Tt]=1,0===Kt[Tt]&&(s.enableVertexAttribArray(Tt),Kt[Tt]=1),St[Tt]!==Yt&&((o.isWebGL2?s:t.get("ANGLE_instanced_arrays"))[o.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Tt,Yt),St[Tt]=Yt)}function tt(){const Tt=A.newAttributes,Yt=A.enabledAttributes;for(let Wt=0,Kt=Yt.length;Wt<Kt;Wt++)Yt[Wt]!==Tt[Wt]&&(s.disableVertexAttribArray(Wt),Yt[Wt]=0)}function lt(Tt,Yt,Wt,Kt,St,yn){!0!==o.isWebGL2||5124!==Wt&&5125!==Wt?s.vertexAttribPointer(Tt,Yt,Wt,Kt,St,yn):s.vertexAttribIPointer(Tt,Yt,Wt,St,yn)}function nt(){wn(),P=!0,A!==v&&(A=v,j(A.object))}function wn(){v.geometry=null,v.program=null,v.wireframe=!1}return{setup:function(Tt,Yt,Wt,Kt,St){let yn=!1;if(d){const Mn=function(Tt,Yt,Wt){const Kt=!0===Wt.wireframe;let St=p[Tt.id];void 0===St&&(St={},p[Tt.id]=St);let yn=St[Yt.id];void 0===yn&&(yn={},St[Yt.id]=yn);let Mn=yn[Kt];return void 0===Mn&&(Mn=q(o.isWebGL2?s.createVertexArray():u.createVertexArrayOES()),yn[Kt]=Mn),Mn}(Kt,Wt,Yt);A!==Mn&&(A=Mn,j(A.object)),yn=function(Tt,Yt){const Wt=A.attributes,Kt=Tt.attributes;let St=0;for(const yn in Kt){const Mn=Wt[yn],jn=Kt[yn];if(void 0===Mn||Mn.attribute!==jn||Mn.data!==jn.data)return!0;St++}return A.attributesNum!==St||A.index!==Yt}(Kt,St),yn&&function(Tt,Yt){const Wt={},Kt=Tt.attributes;let St=0;for(const yn in Kt){const Mn=Kt[yn],jn={};jn.attribute=Mn,Mn.data&&(jn.data=Mn.data),Wt[yn]=jn,St++}A.attributes=Wt,A.attributesNum=St,A.index=Yt}(Kt,St)}else{const Mn=!0===Yt.wireframe;(A.geometry!==Kt.id||A.program!==Wt.id||A.wireframe!==Mn)&&(A.geometry=Kt.id,A.program=Wt.id,A.wireframe=Mn,yn=!0)}!0===Tt.isInstancedMesh&&(yn=!0),null!==St&&i.update(St,34963),(yn||P)&&(P=!1,function(Tt,Yt,Wt,Kt){if(!1===o.isWebGL2&&(Tt.isInstancedMesh||Kt.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;De();const St=Kt.attributes,yn=Wt.getAttributes(),Mn=Yt.defaultAttributeValues;for(const jn in yn){const Ln=yn[jn];if(Ln.location>=0){let zi=St[jn];if(void 0===zi&&("instanceMatrix"===jn&&Tt.instanceMatrix&&(zi=Tt.instanceMatrix),"instanceColor"===jn&&Tt.instanceColor&&(zi=Tt.instanceColor)),void 0!==zi){const Vr=zi.normalized,yr=zi.itemSize,pn=i.get(zi);if(void 0===pn)continue;const xs=pn.buffer,Ir=pn.type,Br=pn.bytesPerElement;if(zi.isInterleavedBufferAttribute){const ei=zi.data,Qr=ei.stride,ln=zi.offset;if(ei.isInstancedInterleavedBuffer){for(let xn=0;xn<Ln.locationSize;xn++)Ne(Ln.location+xn,ei.meshPerAttribute);!0!==Tt.isInstancedMesh&&void 0===Kt._maxInstanceCount&&(Kt._maxInstanceCount=ei.meshPerAttribute*ei.count)}else for(let xn=0;xn<Ln.locationSize;xn++)Le(Ln.location+xn);s.bindBuffer(34962,xs);for(let xn=0;xn<Ln.locationSize;xn++)lt(Ln.location+xn,yr/Ln.locationSize,Ir,Vr,Qr*Br,(ln+yr/Ln.locationSize*xn)*Br)}else{if(zi.isInstancedBufferAttribute){for(let ei=0;ei<Ln.locationSize;ei++)Ne(Ln.location+ei,zi.meshPerAttribute);!0!==Tt.isInstancedMesh&&void 0===Kt._maxInstanceCount&&(Kt._maxInstanceCount=zi.meshPerAttribute*zi.count)}else for(let ei=0;ei<Ln.locationSize;ei++)Le(Ln.location+ei);s.bindBuffer(34962,xs);for(let ei=0;ei<Ln.locationSize;ei++)lt(Ln.location+ei,yr/Ln.locationSize,Ir,Vr,yr*Br,yr/Ln.locationSize*ei*Br)}}else if(void 0!==Mn){const Vr=Mn[jn];if(void 0!==Vr)switch(Vr.length){case 2:s.vertexAttrib2fv(Ln.location,Vr);break;case 3:s.vertexAttrib3fv(Ln.location,Vr);break;case 4:s.vertexAttrib4fv(Ln.location,Vr);break;default:s.vertexAttrib1fv(Ln.location,Vr)}}}}tt()}(Tt,Yt,Wt,Kt),null!==St&&s.bindBuffer(34963,i.get(St).buffer))},reset:nt,resetDefaultState:wn,dispose:function(){nt();for(const Tt in p){const Yt=p[Tt];for(const Wt in Yt){const Kt=Yt[Wt];for(const St in Kt)te(Kt[St].object),delete Kt[St];delete Yt[Wt]}delete p[Tt]}},releaseStatesOfGeometry:function(Tt){if(void 0===p[Tt.id])return;const Yt=p[Tt.id];for(const Wt in Yt){const Kt=Yt[Wt];for(const St in Kt)te(Kt[St].object),delete Kt[St];delete Yt[Wt]}delete p[Tt.id]},releaseStatesOfProgram:function(Tt){for(const Yt in p){const Wt=p[Yt];if(void 0===Wt[Tt.id])continue;const Kt=Wt[Tt.id];for(const St in Kt)te(Kt[St].object),delete Kt[St];delete Wt[Tt.id]}},initAttributes:De,enableAttribute:Le,disableUnusedAttributes:tt}}function Km(s,t,i,o){const a=o.isWebGL2;let u;this.setMode=function(A){u=A},this.render=function(A,P){s.drawArrays(u,A,P),i.update(P,u,1)},this.renderInstances=function(A,P,U){if(0===U)return;let N,j;if(a)N=s,j="drawArraysInstanced";else if(N=t.get("ANGLE_instanced_arrays"),j="drawArraysInstancedANGLE",null===N)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");N[j](u,A,P,U),i.update(P,u,U)}}function Jm(s,t,i){let o;function u(lt){if("highp"===lt){if(s.getShaderPrecisionFormat(35633,36338).precision>0&&s.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";lt="mediump"}return"mediump"===lt&&s.getShaderPrecisionFormat(35633,36337).precision>0&&s.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const d="undefined"!=typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&s instanceof WebGL2ComputeRenderingContext;let p=void 0!==i.precision?i.precision:"highp";const v=u(p);v!==p&&(console.warn("THREE.WebGLRenderer:",p,"not supported, using",v,"instead."),p=v);const A=d||t.has("WEBGL_draw_buffers"),P=!0===i.logarithmicDepthBuffer,U=s.getParameter(34930),N=s.getParameter(35660),j=s.getParameter(3379),te=s.getParameter(34076),Z=s.getParameter(34921),q=s.getParameter(36347),ge=s.getParameter(36348),ye=s.getParameter(36349),De=N>0,Le=d||t.has("OES_texture_float");return{isWebGL2:d,drawBuffers:A,getMaxAnisotropy:function(){if(void 0!==o)return o;if(!0===t.has("EXT_texture_filter_anisotropic")){const lt=t.get("EXT_texture_filter_anisotropic");o=s.getParameter(lt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else o=0;return o},getMaxPrecision:u,precision:p,logarithmicDepthBuffer:P,maxTextures:U,maxVertexTextures:N,maxTextureSize:j,maxCubemapSize:te,maxAttributes:Z,maxVertexUniforms:q,maxVaryings:ge,maxFragmentUniforms:ye,vertexTextures:De,floatFragmentTextures:Le,floatVertexTextures:De&&Le,maxSamples:d?s.getParameter(36183):0}}function ju(s){const t=this;let i=null,o=0,a=!1,u=!1;const d=new kl,p=new Hr,v={value:null,needsUpdate:!1};function A(){v.value!==i&&(v.value=i,v.needsUpdate=o>0),t.numPlanes=o,t.numIntersection=0}function P(U,N,j,te){const Z=null!==U?U.length:0;let q=null;if(0!==Z){if(q=v.value,!0!==te||null===q){const ge=j+4*Z,ye=N.matrixWorldInverse;p.getNormalMatrix(ye),(null===q||q.length<ge)&&(q=new Float32Array(ge));for(let De=0,Le=j;De!==Z;++De,Le+=4)d.copy(U[De]).applyMatrix4(ye,p),d.normal.toArray(q,Le),q[Le+3]=d.constant}v.value=q,v.needsUpdate=!0}return t.numPlanes=Z,t.numIntersection=0,q}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(U,N,j){const te=0!==U.length||N||0!==o||a;return a=N,i=P(U,j,0),o=U.length,te},this.beginShadows=function(){u=!0,P(null)},this.endShadows=function(){u=!1,A()},this.setState=function(U,N,j){const te=U.clippingPlanes,Z=U.clipIntersection,q=U.clipShadows,ge=s.get(U);if(!a||null===te||0===te.length||u&&!q)u?P(null):A();else{const ye=u?0:o,De=4*ye;let Le=ge.clippingState||null;v.value=Le,Le=P(te,N,De,j);for(let Ne=0;Ne!==De;++Ne)Le[Ne]=i[Ne];ge.clippingState=Le,this.numIntersection=Z?this.numPlanes:0,this.numPlanes+=ye}}}function lp(s){let t=new WeakMap;function i(d,p){return 303===p?d.mapping=301:304===p&&(d.mapping=302),d}function a(d){const p=d.target;p.removeEventListener("dispose",a);const v=t.get(p);void 0!==v&&(t.delete(p),v.dispose())}return{get:function(d){if(d&&d.isTexture&&!1===d.isRenderTargetTexture){const p=d.mapping;if(303===p||304===p){if(t.has(d))return i(t.get(d).texture,d.mapping);{const v=d.image;if(v&&v.height>0){const A=new Qd(v.height/2);return A.fromEquirectangularTexture(s,d),t.set(d,A),d.addEventListener("dispose",a),i(A.texture,d.mapping)}return null}}}return d},dispose:function(){t=new WeakMap}}}Qo.physical={uniforms:ao([Qo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new st(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Rn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new st},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Rn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Rn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:wr.meshphysical_vert,fragmentShader:wr.meshphysical_frag};class ol extends kh{constructor(t=-1,i=1,o=1,a=-1,u=.1,d=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=o,this.bottom=a,this.near=u,this.far=d,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,i,o,a,u,d){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=o,this.view.offsetY=a,this.view.width=u,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let u=o-t,d=o+t,p=a+i,v=a-i;if(null!==this.view&&this.view.enabled){const A=(this.right-this.left)/this.view.fullWidth/this.zoom,P=(this.top-this.bottom)/this.view.fullHeight/this.zoom;u+=A*this.view.offsetX,d=u+A*this.view.width,p-=P*this.view.offsetY,v=p-P*this.view.height}this.projectionMatrix.makeOrthographic(u,d,p,v,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}ol.prototype.isOrthographicCamera=!0;const Gh=[.125,.215,.35,.446,.526,.582],zh=new ol,xc=new Rn;let Ac=null;const bc=(1+Math.sqrt(5))/2,Ec=1/bc,$m=[new ze(1,1,1),new ze(-1,1,1),new ze(1,1,-1),new ze(-1,1,-1),new ze(0,bc,Ec),new ze(0,bc,-Ec),new ze(Ec,0,bc),new ze(-Ec,0,bc),new ze(bc,Ec,0),new ze(-bc,Ec,0)];class cp{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,o=.1,a=100){Ac=this._renderer.getRenderTarget(),this._setSize(256);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(t,o,a,u),i>0&&this._blur(u,0,0,i),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ng(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Jd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ac),t.scissorTest=!1,Vh(t,0,0,t.width,t.height)}_fromTexture(t,i){this._setSize(301===t.mapping||302===t.mapping?0===t.image.length?16:t.image[0].width||t.image[0].image.width:t.image.width/4),Ac=this._renderer.getRenderTarget();const o=i||this._allocateTargets();return this._textureToCubeUV(t,o),this._applyPMREM(o),this._cleanup(o),o}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize-32,o={magFilter:rn,minFilter:rn,generateMipmaps:!1,type:En,format:Oi,encoding:Ui,depthBuffer:!1},a=eg(t,i,o);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=eg(t,i,o);const{_lodMax:u}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(s){const t=[],i=[],o=[];let a=s;const u=s-4+1+Gh.length;for(let d=0;d<u;d++){const p=Math.pow(2,a);i.push(p);let v=1/p;d>s-4?v=Gh[d-s+4-1]:0===d&&(v=0),o.push(v);const A=1/(p-1),P=-A/2,U=1+A/2,N=[P,P,U,P,U,U,P,P,U,U,P,U],j=6,te=6,Z=3,q=2,ge=1,ye=new Float32Array(Z*te*j),De=new Float32Array(q*te*j),Le=new Float32Array(ge*te*j);for(let tt=0;tt<j;tt++){const lt=tt%3*2/3-1,ct=tt>2?0:-1;ye.set([lt,ct,0,lt+2/3,ct,0,lt+2/3,ct+1,0,lt,ct,0,lt+2/3,ct+1,0,lt,ct+1,0],Z*te*tt),De.set(N,q*te*tt),Le.set([tt,tt,tt,tt,tt,tt],ge*te*tt)}const Ne=new Hi;Ne.setAttribute("position",new ls(ye,Z)),Ne.setAttribute("uv",new ls(De,q)),Ne.setAttribute("faceIndex",new ls(Le,ge)),t.push(Ne),a>4&&a--}return{lodPlanes:t,sizeLods:i,sigmas:o}}(u)),this._blurMaterial=function(s,t,i){const o=new Float32Array(20),a=new ze(0,1,0);return new Ho({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:o},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(u,t,i)}return a}_compileMaterial(t){const i=new yo(this._lodPlanes[0],t);this._renderer.compile(i,zh)}_sceneToCubeUV(t,i,o,a){const p=new Oo(90,1,i,o),v=[1,-1,1,1,1,1],A=[1,1,1,-1,-1,-1],P=this._renderer,U=P.autoClear,N=P.toneMapping;P.getClearColor(xc),P.toneMapping=0,P.autoClear=!1;const j=new Pa({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),te=new yo(new Ss,j);let Z=!1;const q=t.background;q?q.isColor&&(j.color.copy(q),t.background=null,Z=!0):(j.color.copy(xc),Z=!0);for(let ge=0;ge<6;ge++){const ye=ge%3;0===ye?(p.up.set(0,v[ge],0),p.lookAt(A[ge],0,0)):1===ye?(p.up.set(0,0,v[ge]),p.lookAt(0,A[ge],0)):(p.up.set(0,v[ge],0),p.lookAt(0,0,A[ge]));const De=this._cubeSize;Vh(a,ye*De,ge>2?De:0,De,De),P.setRenderTarget(a),Z&&P.render(te,p),P.render(t,p)}te.geometry.dispose(),te.material.dispose(),P.toneMapping=N,P.autoClear=U,t.background=q}_textureToCubeUV(t,i){const o=this._renderer,a=301===t.mapping||302===t.mapping;a?(null===this._cubemapMaterial&&(this._cubemapMaterial=ng()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Jd());const u=a?this._cubemapMaterial:this._equirectMaterial,d=new yo(this._lodPlanes[0],u);u.uniforms.envMap.value=t;const v=this._cubeSize;Vh(i,0,0,3*v,2*v),o.setRenderTarget(i),o.render(d,zh)}_applyPMREM(t){const i=this._renderer,o=i.autoClear;i.autoClear=!1;for(let a=1;a<this._lodPlanes.length;a++){const u=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]);this._blur(t,a-1,a,u,$m[(a-1)%$m.length])}i.autoClear=o}_blur(t,i,o,a,u){const d=this._pingPongRenderTarget;this._halfBlur(t,d,i,o,a,"latitudinal",u),this._halfBlur(d,t,o,o,a,"longitudinal",u)}_halfBlur(t,i,o,a,u,d,p){const v=this._renderer,A=this._blurMaterial;"latitudinal"!==d&&"longitudinal"!==d&&console.error("blur direction must be either latitudinal or longitudinal!");const U=new yo(this._lodPlanes[a],A),N=A.uniforms,j=this._sizeLods[o]-1,te=isFinite(u)?Math.PI/(2*j):2*Math.PI/39,Z=u/te,q=isFinite(u)?1+Math.floor(3*Z):20;q>20&&console.warn(`sigmaRadians, ${u}, is too large and will clip, as it requested ${q} samples when the maximum is set to 20`);const ge=[];let ye=0;for(let lt=0;lt<20;++lt){const ct=lt/Z,jt=Math.exp(-ct*ct/2);ge.push(jt),0===lt?ye+=jt:lt<q&&(ye+=2*jt)}for(let lt=0;lt<ge.length;lt++)ge[lt]=ge[lt]/ye;N.envMap.value=t.texture,N.samples.value=q,N.weights.value=ge,N.latitudinal.value="latitudinal"===d,p&&(N.poleAxis.value=p);const{_lodMax:De}=this;N.dTheta.value=te,N.mipInt.value=De-o;const Le=this._sizeLods[a];Vh(i,3*Le*(a>De-4?a-De+4:0),4*(this._cubeSize-Le),3*Le,2*Le),v.setRenderTarget(i),v.render(U,zh)}}function eg(s,t,i){const o=new Io(s,t,i);return o.texture.mapping=H,o.texture.name="PMREM.cubeUv",o.scissorTest=!0,o}function Vh(s,t,i,o,a){s.viewport.set(t,i,o,a),s.scissor.set(t,i,o,a)}function Jd(){return new Ho({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ng(){return new Ho({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Z0(s){let t=new WeakMap,i=null;function u(p){const v=p.target;v.removeEventListener("dispose",u);const A=t.get(v);void 0!==A&&(t.delete(v),A.dispose())}return{get:function(p){if(p&&p.isTexture){const v=p.mapping,A=303===v||304===v,P=301===v||302===v;if(A||P){if(p.isRenderTargetTexture&&!0===p.needsPMREMUpdate){p.needsPMREMUpdate=!1;let U=t.get(p);return null===i&&(i=new cp(s)),U=A?i.fromEquirectangular(p,U):i.fromCubemap(p,U),t.set(p,U),U.texture}if(t.has(p))return t.get(p).texture;{const U=p.image;if(A&&U&&U.height>0||P&&U&&function(p){let v=0;for(let P=0;P<6;P++)void 0!==p[P]&&v++;return 6===v}(U)){null===i&&(i=new cp(s));const N=A?i.fromEquirectangular(p):i.fromCubemap(p);return t.set(p,N),p.addEventListener("dispose",u),N.texture}return null}}}return p},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function q0(s){const t={};function i(o){if(void 0!==t[o])return t[o];let a;switch(o){case"WEBGL_depth_texture":a=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=s.getExtension(o)}return t[o]=a,a}return{has:function(o){return null!==i(o)},init:function(o){o.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(o){const a=i(o);return null===a&&console.warn("THREE.WebGLRenderer: "+o+" extension not supported."),a}}}function K0(s,t,i,o){const a={},u=new WeakMap;function d(U){const N=U.target;null!==N.index&&t.remove(N.index);for(const te in N.attributes)t.remove(N.attributes[te]);N.removeEventListener("dispose",d),delete a[N.id];const j=u.get(N);j&&(t.remove(j),u.delete(N)),o.releaseStatesOfGeometry(N),!0===N.isInstancedBufferGeometry&&delete N._maxInstanceCount,i.memory.geometries--}function A(U){const N=[],j=U.index,te=U.attributes.position;let Z=0;if(null!==j){const ye=j.array;Z=j.version;for(let De=0,Le=ye.length;De<Le;De+=3){const Ne=ye[De+0],tt=ye[De+1],lt=ye[De+2];N.push(Ne,tt,tt,lt,lt,Ne)}}else{Z=te.version;for(let De=0,Le=te.array.length/3-1;De<Le;De+=3){const Ne=De+0,tt=De+1,lt=De+2;N.push(Ne,tt,tt,lt,lt,Ne)}}const q=new(tp(N)?na:zd)(N,1);q.version=Z;const ge=u.get(U);ge&&t.remove(ge),u.set(U,q)}return{get:function(U,N){return!0===a[N.id]||(N.addEventListener("dispose",d),a[N.id]=!0,i.memory.geometries++),N},update:function(U){const N=U.attributes;for(const te in N)t.update(N[te],34962);const j=U.morphAttributes;for(const te in j){const Z=j[te];for(let q=0,ge=Z.length;q<ge;q++)t.update(Z[q],34962)}},getWireframeAttribute:function(U){const N=u.get(U);if(N){const j=U.index;null!==j&&N.version<j.version&&A(U)}else A(U);return u.get(U)}}}function $d(s,t,i,o){const a=o.isWebGL2;let u,p,v;this.setMode=function(N){u=N},this.setIndex=function(N){p=N.type,v=N.bytesPerElement},this.render=function(N,j){s.drawElements(u,j,p,N*v),i.update(j,u,1)},this.renderInstances=function(N,j,te){if(0===te)return;let Z,q;if(a)Z=s,q="drawElementsInstanced";else if(Z=t.get("ANGLE_instanced_arrays"),q="drawElementsInstancedANGLE",null===Z)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Z[q](u,j,p,N*v,te),i.update(j,u,te)}}function J0(s){const i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(u,d,p){switch(i.calls++,d){case 4:i.triangles+=p*(u/3);break;case 1:i.lines+=p*(u/2);break;case 3:i.lines+=p*(u-1);break;case 2:i.lines+=p*u;break;case 0:i.points+=p*u;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d)}}}}function $0(s,t){return s[0]-t[0]}function ig(s,t){return Math.abs(t[1])-Math.abs(s[1])}function hp(s,t){let i=1;const o=t.isInterleavedBufferAttribute?t.data.array:t.array;o instanceof Int8Array?i=127:o instanceof Int16Array?i=32767:o instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",o),s.divideScalar(i)}function ey(s,t,i){const o={},a=new Float32Array(8),u=new WeakMap,d=new Oe,p=[];for(let A=0;A<8;A++)p[A]=[A,0];return{update:function(A,P,U,N){const j=A.morphTargetInfluences;if(!0===t.isWebGL2){const te=P.morphAttributes.position||P.morphAttributes.normal||P.morphAttributes.color,Z=void 0!==te?te.length:0;let q=u.get(P);if(void 0===q||q.count!==Z){let Yt=function(){wn.dispose(),u.delete(P),P.removeEventListener("dispose",Yt)};void 0!==q&&q.texture.dispose();const De=void 0!==P.morphAttributes.position,Le=void 0!==P.morphAttributes.normal,Ne=void 0!==P.morphAttributes.color,tt=P.morphAttributes.position||[],lt=P.morphAttributes.normal||[],ct=P.morphAttributes.color||[];let jt=0;!0===De&&(jt=1),!0===Le&&(jt=2),!0===Ne&&(jt=3);let wt=P.attributes.position.count*jt,Ie=1;wt>t.maxTextureSize&&(Ie=Math.ceil(wt/t.maxTextureSize),wt=t.maxTextureSize);const nt=new Float32Array(wt*Ie*4*Z),wn=new Lh(nt,wt,Ie,Z);wn.type=Sn,wn.needsUpdate=!0;const Tt=4*jt;for(let Wt=0;Wt<Z;Wt++){const Kt=tt[Wt],St=lt[Wt],yn=ct[Wt],Mn=wt*Ie*4*Wt;for(let jn=0;jn<Kt.count;jn++){const Ln=jn*Tt;!0===De&&(d.fromBufferAttribute(Kt,jn),!0===Kt.normalized&&hp(d,Kt),nt[Mn+Ln+0]=d.x,nt[Mn+Ln+1]=d.y,nt[Mn+Ln+2]=d.z,nt[Mn+Ln+3]=0),!0===Le&&(d.fromBufferAttribute(St,jn),!0===St.normalized&&hp(d,St),nt[Mn+Ln+4]=d.x,nt[Mn+Ln+5]=d.y,nt[Mn+Ln+6]=d.z,nt[Mn+Ln+7]=0),!0===Ne&&(d.fromBufferAttribute(yn,jn),!0===yn.normalized&&hp(d,yn),nt[Mn+Ln+8]=d.x,nt[Mn+Ln+9]=d.y,nt[Mn+Ln+10]=d.z,nt[Mn+Ln+11]=4===yn.itemSize?d.w:1)}}q={count:Z,texture:wn,size:new st(wt,Ie)},u.set(P,q),P.addEventListener("dispose",Yt)}let ge=0;for(let De=0;De<j.length;De++)ge+=j[De];const ye=P.morphTargetsRelative?1:1-ge;N.getUniforms().setValue(s,"morphTargetBaseInfluence",ye),N.getUniforms().setValue(s,"morphTargetInfluences",j),N.getUniforms().setValue(s,"morphTargetsTexture",q.texture,i),N.getUniforms().setValue(s,"morphTargetsTextureSize",q.size)}else{const te=void 0===j?0:j.length;let Z=o[P.id];if(void 0===Z||Z.length!==te){Z=[];for(let Le=0;Le<te;Le++)Z[Le]=[Le,0];o[P.id]=Z}for(let Le=0;Le<te;Le++){const Ne=Z[Le];Ne[0]=Le,Ne[1]=j[Le]}Z.sort(ig);for(let Le=0;Le<8;Le++)Le<te&&Z[Le][1]?(p[Le][0]=Z[Le][0],p[Le][1]=Z[Le][1]):(p[Le][0]=Number.MAX_SAFE_INTEGER,p[Le][1]=0);p.sort($0);const q=P.morphAttributes.position,ge=P.morphAttributes.normal;let ye=0;for(let Le=0;Le<8;Le++){const Ne=p[Le],tt=Ne[0],lt=Ne[1];tt!==Number.MAX_SAFE_INTEGER&&lt?(q&&P.getAttribute("morphTarget"+Le)!==q[tt]&&P.setAttribute("morphTarget"+Le,q[tt]),ge&&P.getAttribute("morphNormal"+Le)!==ge[tt]&&P.setAttribute("morphNormal"+Le,ge[tt]),a[Le]=lt,ye+=lt):(q&&!0===P.hasAttribute("morphTarget"+Le)&&P.deleteAttribute("morphTarget"+Le),ge&&!0===P.hasAttribute("morphNormal"+Le)&&P.deleteAttribute("morphNormal"+Le),a[Le]=0)}const De=P.morphTargetsRelative?1:1-ye;N.getUniforms().setValue(s,"morphTargetBaseInfluence",De),N.getUniforms().setValue(s,"morphTargetInfluences",a)}}}}function dp(s,t,i,o){let a=new WeakMap;function p(v){const A=v.target;A.removeEventListener("dispose",p),i.remove(A.instanceMatrix),null!==A.instanceColor&&i.remove(A.instanceColor)}return{update:function(v){const A=o.render.frame,U=t.get(v,v.geometry);return a.get(U)!==A&&(t.update(U),a.set(U,A)),v.isInstancedMesh&&(!1===v.hasEventListener("dispose",p)&&v.addEventListener("dispose",p),i.update(v.instanceMatrix,34962),null!==v.instanceColor&&i.update(v.instanceColor,34962)),U},dispose:function(){a=new WeakMap}}}const fp=new as,pp=new Lh,mp=new Ta,gp=new Nl,vp=[],yp=[],xp=new Float32Array(16),Ap=new Float32Array(9),bp=new Float32Array(4);function ka(s,t,i){const o=s[0];if(o<=0||o>0)return s;const a=t*i;let u=vp[a];if(void 0===u&&(u=new Float32Array(a),vp[a]=u),0!==t){o.toArray(u,0);for(let d=1,p=0;d!==t;++d)p+=i,s[d].toArray(u,p)}return u}function ms(s,t){if(s.length!==t.length)return!1;for(let i=0,o=s.length;i<o;i++)if(s[i]!==t[i])return!1;return!0}function cs(s,t){for(let i=0,o=t.length;i<o;i++)s[i]=t[i]}function eu(s,t){let i=yp[t];void 0===i&&(i=new Int32Array(t),yp[t]=i);for(let o=0;o!==t;++o)i[o]=s.allocateTextureUnit();return i}function ty(s,t){const i=this.cache;i[0]!==t&&(s.uniform1f(this.addr,t),i[0]=t)}function ny(s,t){const i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(s.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ms(i,t))return;s.uniform2fv(this.addr,t),cs(i,t)}}function iy(s,t){const i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(s.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(s.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(ms(i,t))return;s.uniform3fv(this.addr,t),cs(i,t)}}function ry(s,t){const i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(s.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ms(i,t))return;s.uniform4fv(this.addr,t),cs(i,t)}}function sy(s,t){const i=this.cache,o=t.elements;if(void 0===o){if(ms(i,t))return;s.uniformMatrix2fv(this.addr,!1,t),cs(i,t)}else{if(ms(i,o))return;bp.set(o),s.uniformMatrix2fv(this.addr,!1,bp),cs(i,o)}}function oy(s,t){const i=this.cache,o=t.elements;if(void 0===o){if(ms(i,t))return;s.uniformMatrix3fv(this.addr,!1,t),cs(i,t)}else{if(ms(i,o))return;Ap.set(o),s.uniformMatrix3fv(this.addr,!1,Ap),cs(i,o)}}function ay(s,t){const i=this.cache,o=t.elements;if(void 0===o){if(ms(i,t))return;s.uniformMatrix4fv(this.addr,!1,t),cs(i,t)}else{if(ms(i,o))return;xp.set(o),s.uniformMatrix4fv(this.addr,!1,xp),cs(i,o)}}function ly(s,t){const i=this.cache;i[0]!==t&&(s.uniform1i(this.addr,t),i[0]=t)}function cy(s,t){const i=this.cache;ms(i,t)||(s.uniform2iv(this.addr,t),cs(i,t))}function uy(s,t){const i=this.cache;ms(i,t)||(s.uniform3iv(this.addr,t),cs(i,t))}function hy(s,t){const i=this.cache;ms(i,t)||(s.uniform4iv(this.addr,t),cs(i,t))}function dy(s,t){const i=this.cache;i[0]!==t&&(s.uniform1ui(this.addr,t),i[0]=t)}function fy(s,t){const i=this.cache;ms(i,t)||(s.uniform2uiv(this.addr,t),cs(i,t))}function py(s,t){const i=this.cache;ms(i,t)||(s.uniform3uiv(this.addr,t),cs(i,t))}function my(s,t){const i=this.cache;ms(i,t)||(s.uniform4uiv(this.addr,t),cs(i,t))}function gy(s,t,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(s.uniform1i(this.addr,a),o[0]=a),i.setTexture2D(t||fp,a)}function vy(s,t,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(s.uniform1i(this.addr,a),o[0]=a),i.setTexture3D(t||mp,a)}function yy(s,t,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(s.uniform1i(this.addr,a),o[0]=a),i.setTextureCube(t||gp,a)}function xy(s,t,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(s.uniform1i(this.addr,a),o[0]=a),i.setTexture2DArray(t||pp,a)}function by(s,t){s.uniform1fv(this.addr,t)}function Ey(s,t){const i=ka(t,this.size,2);s.uniform2fv(this.addr,i)}function wy(s,t){const i=ka(t,this.size,3);s.uniform3fv(this.addr,i)}function _y(s,t){const i=ka(t,this.size,4);s.uniform4fv(this.addr,i)}function My(s,t){const i=ka(t,this.size,4);s.uniformMatrix2fv(this.addr,!1,i)}function Ty(s,t){const i=ka(t,this.size,9);s.uniformMatrix3fv(this.addr,!1,i)}function Sy(s,t){const i=ka(t,this.size,16);s.uniformMatrix4fv(this.addr,!1,i)}function Cy(s,t){s.uniform1iv(this.addr,t)}function Ry(s,t){s.uniform2iv(this.addr,t)}function Ly(s,t){s.uniform3iv(this.addr,t)}function Dy(s,t){s.uniform4iv(this.addr,t)}function Py(s,t){s.uniform1uiv(this.addr,t)}function Iy(s,t){s.uniform2uiv(this.addr,t)}function By(s,t){s.uniform3uiv(this.addr,t)}function Fy(s,t){s.uniform4uiv(this.addr,t)}function Oy(s,t,i){const o=t.length,a=eu(i,o);s.uniform1iv(this.addr,a);for(let u=0;u!==o;++u)i.setTexture2D(t[u]||fp,a[u])}function Uy(s,t,i){const o=t.length,a=eu(i,o);s.uniform1iv(this.addr,a);for(let u=0;u!==o;++u)i.setTexture3D(t[u]||mp,a[u])}function Ny(s,t,i){const o=t.length,a=eu(i,o);s.uniform1iv(this.addr,a);for(let u=0;u!==o;++u)i.setTextureCube(t[u]||gp,a[u])}function ky(s,t,i){const o=t.length,a=eu(i,o);s.uniform1iv(this.addr,a);for(let u=0;u!==o;++u)i.setTexture2DArray(t[u]||pp,a[u])}function Gy(s,t,i){this.id=s,this.addr=i,this.cache=[],this.setValue=function(s){switch(s){case 5126:return ty;case 35664:return ny;case 35665:return iy;case 35666:return ry;case 35674:return sy;case 35675:return oy;case 35676:return ay;case 5124:case 35670:return ly;case 35667:case 35671:return cy;case 35668:case 35672:return uy;case 35669:case 35673:return hy;case 5125:return dy;case 36294:return fy;case 36295:return py;case 36296:return my;case 35678:case 36198:case 36298:case 36306:case 35682:return gy;case 35679:case 36299:case 36307:return vy;case 35680:case 36300:case 36308:case 36293:return yy;case 36289:case 36303:case 36311:case 36292:return xy}}(t.type)}function Ep(s,t,i){this.id=s,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(s){switch(s){case 5126:return by;case 35664:return Ey;case 35665:return wy;case 35666:return _y;case 35674:return My;case 35675:return Ty;case 35676:return Sy;case 5124:case 35670:return Cy;case 35667:case 35671:return Ry;case 35668:case 35672:return Ly;case 35669:case 35673:return Dy;case 5125:return Py;case 36294:return Iy;case 36295:return By;case 36296:return Fy;case 35678:case 36198:case 36298:case 36306:case 35682:return Oy;case 35679:case 36299:case 36307:return Uy;case 35680:case 36300:case 36308:case 36293:return Ny;case 36289:case 36303:case 36311:case 36292:return ky}}(t.type)}function wp(s){this.id=s,this.seq=[],this.map={}}Ep.prototype.updateCache=function(s){const t=this.cache;s instanceof Float32Array&&t.length!==s.length&&(this.cache=new Float32Array(s.length)),cs(t,s)},wp.prototype.setValue=function(s,t,i){const o=this.seq;for(let a=0,u=o.length;a!==u;++a){const d=o[a];d.setValue(s,t[d.id],i)}};const Wh=/(\w+)(\])?(\[|\.)?/g;function _p(s,t){s.seq.push(t),s.map[t.id]=t}function zy(s,t,i){const o=s.name,a=o.length;for(Wh.lastIndex=0;;){const u=Wh.exec(o),d=Wh.lastIndex;let p=u[1];const A=u[3];if("]"===u[2]&&(p|=0),void 0===A||"["===A&&d+2===a){_p(i,void 0===A?new Gy(p,s,t):new Ep(p,s,t));break}{let U=i.map[p];void 0===U&&(U=new wp(p),_p(i,U)),i=U}}}function Zo(s,t){this.seq=[],this.map={};const i=s.getProgramParameter(t,35718);for(let o=0;o<i;++o){const a=s.getActiveUniform(t,o);zy(a,s.getUniformLocation(t,a.name),this)}}function Mp(s,t,i){const o=s.createShader(t);return s.shaderSource(o,i),s.compileShader(o),o}Zo.prototype.setValue=function(s,t,i,o){const a=this.map[t];void 0!==a&&a.setValue(s,i,o)},Zo.prototype.setOptional=function(s,t,i){const o=t[i];void 0!==o&&this.setValue(s,i,o)},Zo.upload=function(s,t,i,o){for(let a=0,u=t.length;a!==u;++a){const d=t[a],p=i[d.id];!1!==p.needsUpdate&&d.setValue(s,p.value,o)}},Zo.seqWithValue=function(s,t){const i=[];for(let o=0,a=s.length;o!==a;++o){const u=s[o];u.id in t&&i.push(u)}return i};let Vy=0;function Tp(s,t,i){const o=s.getShaderParameter(t,35713),a=s.getShaderInfoLog(t).trim();if(o&&""===a)return"";const u=parseInt(/ERROR: 0:(\d+)/.exec(a)[1]);return i.toUpperCase()+"\n\n"+a+"\n\n"+function(s,t){const i=s.split("\n"),o=[],a=Math.max(t-6,0),u=Math.min(t+6,i.length);for(let d=a;d<u;d++)o.push(d+1+": "+i[d]);return o.join("\n")}(s.getShaderSource(t),u)}function jy(s,t){const i=function(s){switch(s){case Ui:return["Linear","( value )"];case Kn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",s),["Linear","( value )"]}}(t);return"vec4 "+s+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Yy(s,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+s+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Hl(s){return""!==s}function Sp(s,t){return s.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Cp(s,t){return s.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ky=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xh(s){return s.replace(Ky,Jy)}function Jy(s,t){const i=wr[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Xh(i)}const $y=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ex=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rp(s){return s.replace(ex,Lp).replace($y,tx)}function tx(s,t,i,o){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Lp(0,t,i,o)}function Lp(s,t,i,o){let a="";for(let u=parseInt(t);u<parseInt(i);u++)a+=o.replace(/\[\s*i\s*\]/g,"[ "+u+" ]").replace(/UNROLLED_LOOP_INDEX/g,u);return a}function Dp(s){let t="precision "+s.precision+" float;\nprecision "+s.precision+" int;";return"highp"===s.precision?t+="\n#define HIGH_PRECISION":"mediump"===s.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===s.precision&&(t+="\n#define LOW_PRECISION"),t}function ax(s,t,i,o){const a=s.getContext(),u=i.defines;let d=i.vertexShader,p=i.fragmentShader;const v=function(s){let t="SHADOWMAP_TYPE_BASIC";return 1===s.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===s.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===s.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),A=function(s){let t="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case H:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),P=function(s){let t="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case 302:t="ENVMAP_MODE_REFRACTION"}return t}(i),U=function(s){let t="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),N=function(s){const t=s.envMapCubeUVHeight;if(null===t)return null;const i=Math.log2(t/32+1)+3,o=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:o,maxMip:i}}(i),j=i.isWebGL2?"":function(s){return[s.extensionDerivatives||s.envMapCubeUVHeight||s.bumpMap||s.tangentSpaceNormalMap||s.clearcoatNormalMap||s.flatShading||"physical"===s.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hl).join("\n")}(i),te=function(s){const t=[];for(const i in s){const o=s[i];!1!==o&&t.push("#define "+i+" "+o)}return t.join("\n")}(u),Z=a.createProgram();let q,ge,ye=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(q=[te].filter(Hl).join("\n"),q.length>0&&(q+="\n"),ge=[j,te].filter(Hl).join("\n"),ge.length>0&&(ge+="\n")):(q=[Dp(i),"#define SHADER_NAME "+i.shaderName,te,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+P:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+v:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hl).join("\n"),ge=[j,Dp(i),"#define SHADER_NAME "+i.shaderName,te,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+A:"",i.envMap?"#define "+P:"",i.envMap?"#define "+U:"",N?"#define CUBEUV_TEXEL_WIDTH "+N.texelWidth:"",N?"#define CUBEUV_TEXEL_HEIGHT "+N.texelHeight:"",N?"#define CUBEUV_MAX_MIP "+N.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+v:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?wr.tonemapping_pars_fragment:"",0!==i.toneMapping?Yy("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",wr.encodings_pars_fragment,jy("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Hl).join("\n")),d=Xh(d),d=Sp(d,i),d=Cp(d,i),p=Xh(p),p=Sp(p,i),p=Cp(p,i),d=Rp(d),p=Rp(p),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(ye="#version 300 es\n",q=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+q,ge=["#define varying in","300 es"===i.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===i.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+ge);const Le=ye+ge+p,Ne=Mp(a,35633,ye+q+d),tt=Mp(a,35632,Le);if(a.attachShader(Z,Ne),a.attachShader(Z,tt),void 0!==i.index0AttributeName?a.bindAttribLocation(Z,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(Z,0,"position"),a.linkProgram(Z),s.debug.checkShaderErrors){const jt=a.getProgramInfoLog(Z).trim(),wt=a.getShaderInfoLog(Ne).trim(),Ie=a.getShaderInfoLog(tt).trim();let nt=!0,wn=!0;if(!1===a.getProgramParameter(Z,35714)){nt=!1;const Tt=Tp(a,Ne,"vertex"),Yt=Tp(a,tt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(Z,35715)+"\n\nProgram Info Log: "+jt+"\n"+Tt+"\n"+Yt)}else""!==jt?console.warn("THREE.WebGLProgram: Program Info Log:",jt):(""===wt||""===Ie)&&(wn=!1);wn&&(this.diagnostics={runnable:nt,programLog:jt,vertexShader:{log:wt,prefix:q},fragmentShader:{log:Ie,prefix:ge}})}let lt,ct;return a.deleteShader(Ne),a.deleteShader(tt),this.getUniforms=function(){return void 0===lt&&(lt=new Zo(a,Z)),lt},this.getAttributes=function(){return void 0===ct&&(ct=function(s,t){const i={},o=s.getProgramParameter(t,35721);for(let a=0;a<o;a++){const u=s.getActiveAttrib(t,a),d=u.name;let p=1;35674===u.type&&(p=2),35675===u.type&&(p=3),35676===u.type&&(p=4),i[d]={type:u.type,location:s.getAttribLocation(t,d),locationSize:p}}return i}(a,Z)),ct},this.destroy=function(){o.releaseStatesOfProgram(this),a.deleteProgram(Z),this.program=void 0},this.name=i.shaderName,this.id=Vy++,this.cacheKey=t,this.usedTimes=1,this.program=Z,this.vertexShader=Ne,this.fragmentShader=tt,this}let lx=0;class cx{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const o=t.fragmentShader,a=this._getShaderStage(t.vertexShader),u=this._getShaderStage(o),d=this._getShaderCacheForMaterial(t);return!1===d.has(a)&&(d.add(a),a.usedTimes++),!1===d.has(u)&&(d.add(u),u.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const o of i)o.usedTimes--,0===o.usedTimes&&this.shaderCache.delete(o.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;return!1===i.has(t)&&i.set(t,new Set),i.get(t)}_getShaderStage(t){const i=this.shaderCache;if(!1===i.has(t)){const o=new ux(t);i.set(t,o)}return i.get(t)}}class ux{constructor(t){this.id=lx++,this.code=t,this.usedTimes=0}}function hx(s,t,i,o,a,u,d){const p=new rp,v=new cx,A=[],P=a.isWebGL2,U=a.logarithmicDepthBuffer,N=a.floatVertexTextures,j=a.maxVertexUniforms,te=a.vertexTextures;let Z=a.precision;const q={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(Ie,nt,wn,Tt,Yt){const Wt=Tt.fog,Kt=Yt.geometry,yn=(Ie.isMeshStandardMaterial?i:t).get(Ie.envMap||(Ie.isMeshStandardMaterial?Tt.environment:null)),Mn=yn&&yn.mapping===H?yn.image.height:null,jn=q[Ie.type],Ln=Yt.isSkinnedMesh?function(Ie){const wn=Ie.skeleton.bones;if(N)return 1024;{const Yt=Math.floor((j-20)/4),Wt=Math.min(Yt,wn.length);return Wt<wn.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+wn.length+" bones. This GPU supports "+Wt+"."),0):Wt}}(Yt):0;null!==Ie.precision&&(Z=a.getMaxPrecision(Ie.precision),Z!==Ie.precision&&console.warn("THREE.WebGLProgram.getParameters:",Ie.precision,"not supported, using",Z,"instead."));const zi=Kt.morphAttributes.position||Kt.morphAttributes.normal||Kt.morphAttributes.color,Vr=void 0!==zi?zi.length:0;let pn,xs,Ir,Br,yr=0;if(void 0!==Kt.morphAttributes.position&&(yr=1),void 0!==Kt.morphAttributes.normal&&(yr=2),void 0!==Kt.morphAttributes.color&&(yr=3),jn){const Wn=Qo[jn];pn=Wn.vertexShader,xs=Wn.fragmentShader}else pn=Ie.vertexShader,xs=Ie.fragmentShader,v.update(Ie),Ir=v.getVertexShaderID(Ie),Br=v.getFragmentShaderID(Ie);const ei=s.getRenderTarget(),ln=Ie.clearcoat>0;return{isWebGL2:P,shaderID:jn,shaderName:Ie.type,vertexShader:pn,fragmentShader:xs,defines:Ie.defines,customVertexShaderID:Ir,customFragmentShaderID:Br,isRawShaderMaterial:!0===Ie.isRawShaderMaterial,glslVersion:Ie.glslVersion,precision:Z,instancing:!0===Yt.isInstancedMesh,instancingColor:!0===Yt.isInstancedMesh&&null!==Yt.instanceColor,supportsVertexTextures:te,outputEncoding:null===ei?s.outputEncoding:!0===ei.isXRRenderTarget?ei.texture.encoding:Ui,map:!!Ie.map,matcap:!!Ie.matcap,envMap:!!yn,envMapMode:yn&&yn.mapping,envMapCubeUVHeight:Mn,lightMap:!!Ie.lightMap,aoMap:!!Ie.aoMap,emissiveMap:!!Ie.emissiveMap,bumpMap:!!Ie.bumpMap,normalMap:!!Ie.normalMap,objectSpaceNormalMap:1===Ie.normalMapType,tangentSpaceNormalMap:0===Ie.normalMapType,decodeVideoTexture:!!Ie.map&&!0===Ie.map.isVideoTexture&&Ie.map.encoding===Kn,clearcoat:ln,clearcoatMap:ln&&!!Ie.clearcoatMap,clearcoatRoughnessMap:ln&&!!Ie.clearcoatRoughnessMap,clearcoatNormalMap:ln&&!!Ie.clearcoatNormalMap,displacementMap:!!Ie.displacementMap,roughnessMap:!!Ie.roughnessMap,metalnessMap:!!Ie.metalnessMap,specularMap:!!Ie.specularMap,specularIntensityMap:!!Ie.specularIntensityMap,specularColorMap:!!Ie.specularColorMap,opaque:!1===Ie.transparent&&1===Ie.blending,alphaMap:!!Ie.alphaMap,alphaTest:Ie.alphaTest>0,gradientMap:!!Ie.gradientMap,sheen:Ie.sheen>0,sheenColorMap:!!Ie.sheenColorMap,sheenRoughnessMap:!!Ie.sheenRoughnessMap,transmission:Ie.transmission>0,transmissionMap:!!Ie.transmissionMap,thicknessMap:!!Ie.thicknessMap,combine:Ie.combine,vertexTangents:!!Ie.normalMap&&!!Kt.attributes.tangent,vertexColors:Ie.vertexColors,vertexAlphas:!0===Ie.vertexColors&&!!Kt.attributes.color&&4===Kt.attributes.color.itemSize,vertexUvs:!!(Ie.map||Ie.bumpMap||Ie.normalMap||Ie.specularMap||Ie.alphaMap||Ie.emissiveMap||Ie.roughnessMap||Ie.metalnessMap||Ie.clearcoatMap||Ie.clearcoatRoughnessMap||Ie.clearcoatNormalMap||Ie.displacementMap||Ie.transmissionMap||Ie.thicknessMap||Ie.specularIntensityMap||Ie.specularColorMap||Ie.sheenColorMap||Ie.sheenRoughnessMap),uvsVertexOnly:!(Ie.map||Ie.bumpMap||Ie.normalMap||Ie.specularMap||Ie.alphaMap||Ie.emissiveMap||Ie.roughnessMap||Ie.metalnessMap||Ie.clearcoatNormalMap||Ie.transmission>0||Ie.transmissionMap||Ie.thicknessMap||Ie.specularIntensityMap||Ie.specularColorMap||Ie.sheen>0||Ie.sheenColorMap||Ie.sheenRoughnessMap||!Ie.displacementMap),fog:!!Wt,useFog:Ie.fog,fogExp2:Wt&&Wt.isFogExp2,flatShading:!!Ie.flatShading,sizeAttenuation:Ie.sizeAttenuation,logarithmicDepthBuffer:U,skinning:!0===Yt.isSkinnedMesh&&Ln>0,maxBones:Ln,useVertexTexture:N,morphTargets:void 0!==Kt.morphAttributes.position,morphNormals:void 0!==Kt.morphAttributes.normal,morphColors:void 0!==Kt.morphAttributes.color,morphTargetsCount:Vr,morphTextureStride:yr,numDirLights:nt.directional.length,numPointLights:nt.point.length,numSpotLights:nt.spot.length,numRectAreaLights:nt.rectArea.length,numHemiLights:nt.hemi.length,numDirLightShadows:nt.directionalShadowMap.length,numPointLightShadows:nt.pointShadowMap.length,numSpotLightShadows:nt.spotShadowMap.length,numClippingPlanes:d.numPlanes,numClipIntersection:d.numIntersection,dithering:Ie.dithering,shadowMapEnabled:s.shadowMap.enabled&&wn.length>0,shadowMapType:s.shadowMap.type,toneMapping:Ie.toneMapped?s.toneMapping:0,physicallyCorrectLights:s.physicallyCorrectLights,premultipliedAlpha:Ie.premultipliedAlpha,doubleSided:2===Ie.side,flipSided:1===Ie.side,depthPacking:void 0!==Ie.depthPacking&&Ie.depthPacking,index0AttributeName:Ie.index0AttributeName,extensionDerivatives:Ie.extensions&&Ie.extensions.derivatives,extensionFragDepth:Ie.extensions&&Ie.extensions.fragDepth,extensionDrawBuffers:Ie.extensions&&Ie.extensions.drawBuffers,extensionShaderTextureLOD:Ie.extensions&&Ie.extensions.shaderTextureLOD,rendererExtensionFragDepth:P||o.has("EXT_frag_depth"),rendererExtensionDrawBuffers:P||o.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:P||o.has("EXT_shader_texture_lod"),customProgramCacheKey:Ie.customProgramCacheKey()}},getProgramCacheKey:function(Ie){const nt=[];if(Ie.shaderID?nt.push(Ie.shaderID):(nt.push(Ie.customVertexShaderID),nt.push(Ie.customFragmentShaderID)),void 0!==Ie.defines)for(const wn in Ie.defines)nt.push(wn),nt.push(Ie.defines[wn]);return!1===Ie.isRawShaderMaterial&&(function(Ie,nt){Ie.push(nt.precision),Ie.push(nt.outputEncoding),Ie.push(nt.envMapMode),Ie.push(nt.envMapCubeUVHeight),Ie.push(nt.combine),Ie.push(nt.vertexUvs),Ie.push(nt.fogExp2),Ie.push(nt.sizeAttenuation),Ie.push(nt.maxBones),Ie.push(nt.morphTargetsCount),Ie.push(nt.morphAttributeCount),Ie.push(nt.numDirLights),Ie.push(nt.numPointLights),Ie.push(nt.numSpotLights),Ie.push(nt.numHemiLights),Ie.push(nt.numRectAreaLights),Ie.push(nt.numDirLightShadows),Ie.push(nt.numPointLightShadows),Ie.push(nt.numSpotLightShadows),Ie.push(nt.shadowMapType),Ie.push(nt.toneMapping),Ie.push(nt.numClippingPlanes),Ie.push(nt.numClipIntersection)}(nt,Ie),function(Ie,nt){p.disableAll(),nt.isWebGL2&&p.enable(0),nt.supportsVertexTextures&&p.enable(1),nt.instancing&&p.enable(2),nt.instancingColor&&p.enable(3),nt.map&&p.enable(4),nt.matcap&&p.enable(5),nt.envMap&&p.enable(6),nt.lightMap&&p.enable(7),nt.aoMap&&p.enable(8),nt.emissiveMap&&p.enable(9),nt.bumpMap&&p.enable(10),nt.normalMap&&p.enable(11),nt.objectSpaceNormalMap&&p.enable(12),nt.tangentSpaceNormalMap&&p.enable(13),nt.clearcoat&&p.enable(14),nt.clearcoatMap&&p.enable(15),nt.clearcoatRoughnessMap&&p.enable(16),nt.clearcoatNormalMap&&p.enable(17),nt.displacementMap&&p.enable(18),nt.specularMap&&p.enable(19),nt.roughnessMap&&p.enable(20),nt.metalnessMap&&p.enable(21),nt.gradientMap&&p.enable(22),nt.alphaMap&&p.enable(23),nt.alphaTest&&p.enable(24),nt.vertexColors&&p.enable(25),nt.vertexAlphas&&p.enable(26),nt.vertexUvs&&p.enable(27),nt.vertexTangents&&p.enable(28),nt.uvsVertexOnly&&p.enable(29),nt.fog&&p.enable(30),Ie.push(p.mask),p.disableAll(),nt.useFog&&p.enable(0),nt.flatShading&&p.enable(1),nt.logarithmicDepthBuffer&&p.enable(2),nt.skinning&&p.enable(3),nt.useVertexTexture&&p.enable(4),nt.morphTargets&&p.enable(5),nt.morphNormals&&p.enable(6),nt.morphColors&&p.enable(7),nt.premultipliedAlpha&&p.enable(8),nt.shadowMapEnabled&&p.enable(9),nt.physicallyCorrectLights&&p.enable(10),nt.doubleSided&&p.enable(11),nt.flipSided&&p.enable(12),nt.depthPacking&&p.enable(13),nt.dithering&&p.enable(14),nt.specularIntensityMap&&p.enable(15),nt.specularColorMap&&p.enable(16),nt.transmission&&p.enable(17),nt.transmissionMap&&p.enable(18),nt.thicknessMap&&p.enable(19),nt.sheen&&p.enable(20),nt.sheenColorMap&&p.enable(21),nt.sheenRoughnessMap&&p.enable(22),nt.decodeVideoTexture&&p.enable(23),nt.opaque&&p.enable(24),Ie.push(p.mask)}(nt,Ie),nt.push(s.outputEncoding)),nt.push(Ie.customProgramCacheKey),nt.join()},getUniforms:function(Ie){const nt=q[Ie.type];let wn;return wn=nt?Nh.clone(Qo[nt].uniforms):Ie.uniforms,wn},acquireProgram:function(Ie,nt){let wn;for(let Tt=0,Yt=A.length;Tt<Yt;Tt++){const Wt=A[Tt];if(Wt.cacheKey===nt){wn=Wt,++wn.usedTimes;break}}return void 0===wn&&(wn=new ax(s,nt,Ie,u),A.push(wn)),wn},releaseProgram:function(Ie){if(0==--Ie.usedTimes){const nt=A.indexOf(Ie);A[nt]=A[A.length-1],A.pop(),Ie.destroy()}},releaseShaderCache:function(Ie){v.remove(Ie)},programs:A,dispose:function(){v.dispose()}}}function dx(){let s=new WeakMap;return{get:function(u){let d=s.get(u);return void 0===d&&(d={},s.set(u,d)),d},remove:function(u){s.delete(u)},update:function(u,d,p){s.get(u)[d]=p},dispose:function(){s=new WeakMap}}}function rg(s,t){return s.groupOrder!==t.groupOrder?s.groupOrder-t.groupOrder:s.renderOrder!==t.renderOrder?s.renderOrder-t.renderOrder:s.material.id!==t.material.id?s.material.id-t.material.id:s.z!==t.z?s.z-t.z:s.id-t.id}function Pp(s,t){return s.groupOrder!==t.groupOrder?s.groupOrder-t.groupOrder:s.renderOrder!==t.renderOrder?s.renderOrder-t.renderOrder:s.z!==t.z?t.z-s.z:s.id-t.id}function sg(){const s=[];let t=0;const i=[],o=[],a=[];function d(U,N,j,te,Z,q){let ge=s[t];return void 0===ge?(ge={id:U.id,object:U,geometry:N,material:j,groupOrder:te,renderOrder:U.renderOrder,z:Z,group:q},s[t]=ge):(ge.id=U.id,ge.object=U,ge.geometry=N,ge.material=j,ge.groupOrder=te,ge.renderOrder=U.renderOrder,ge.z=Z,ge.group=q),t++,ge}return{opaque:i,transmissive:o,transparent:a,init:function(){t=0,i.length=0,o.length=0,a.length=0},push:function(U,N,j,te,Z,q){const ge=d(U,N,j,te,Z,q);j.transmission>0?o.push(ge):!0===j.transparent?a.push(ge):i.push(ge)},unshift:function(U,N,j,te,Z,q){const ge=d(U,N,j,te,Z,q);j.transmission>0?o.unshift(ge):!0===j.transparent?a.unshift(ge):i.unshift(ge)},finish:function(){for(let U=t,N=s.length;U<N;U++){const j=s[U];if(null===j.id)break;j.id=null,j.object=null,j.geometry=null,j.material=null,j.group=null}},sort:function(U,N){i.length>1&&i.sort(U||rg),o.length>1&&o.sort(N||Pp),a.length>1&&a.sort(N||Pp)}}}function fx(){let s=new WeakMap;return{get:function(o,a){let u;return!1===s.has(o)?(u=new sg,s.set(o,[u])):a>=s.get(o).length?(u=new sg,s.get(o).push(u)):u=s.get(o)[a],u},dispose:function(){s=new WeakMap}}}function px(){const s={};return{get:function(t){if(void 0!==s[t.id])return s[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new ze,color:new Rn};break;case"SpotLight":i={position:new ze,direction:new ze,color:new Rn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ze,color:new Rn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ze,skyColor:new Rn,groundColor:new Rn};break;case"RectAreaLight":i={color:new Rn,position:new ze,halfWidth:new ze,halfHeight:new ze}}return s[t.id]=i,i}}}let gx=0;function vx(s,t){return(t.castShadow?1:0)-(s.castShadow?1:0)}function og(s,t){const i=new px,o=function(){const s={};return{get:function(t){if(void 0!==s[t.id])return s[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st,shadowCameraNear:1,shadowCameraFar:1e3}}return s[t.id]=i,i}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let P=0;P<9;P++)a.probe.push(new ze);const u=new ze,d=new _i,p=new _i;return{setup:function(P,U){let N=0,j=0,te=0;for(let jt=0;jt<9;jt++)a.probe[jt].set(0,0,0);let Z=0,q=0,ge=0,ye=0,De=0,Le=0,Ne=0,tt=0;P.sort(vx);const lt=!0!==U?Math.PI:1;for(let jt=0,wt=P.length;jt<wt;jt++){const Ie=P[jt],nt=Ie.color,wn=Ie.intensity,Tt=Ie.distance,Yt=Ie.shadow&&Ie.shadow.map?Ie.shadow.map.texture:null;if(Ie.isAmbientLight)N+=nt.r*wn*lt,j+=nt.g*wn*lt,te+=nt.b*wn*lt;else if(Ie.isLightProbe)for(let Wt=0;Wt<9;Wt++)a.probe[Wt].addScaledVector(Ie.sh.coefficients[Wt],wn);else if(Ie.isDirectionalLight){const Wt=i.get(Ie);if(Wt.color.copy(Ie.color).multiplyScalar(Ie.intensity*lt),Ie.castShadow){const Kt=Ie.shadow,St=o.get(Ie);St.shadowBias=Kt.bias,St.shadowNormalBias=Kt.normalBias,St.shadowRadius=Kt.radius,St.shadowMapSize=Kt.mapSize,a.directionalShadow[Z]=St,a.directionalShadowMap[Z]=Yt,a.directionalShadowMatrix[Z]=Ie.shadow.matrix,Le++}a.directional[Z]=Wt,Z++}else if(Ie.isSpotLight){const Wt=i.get(Ie);if(Wt.position.setFromMatrixPosition(Ie.matrixWorld),Wt.color.copy(nt).multiplyScalar(wn*lt),Wt.distance=Tt,Wt.coneCos=Math.cos(Ie.angle),Wt.penumbraCos=Math.cos(Ie.angle*(1-Ie.penumbra)),Wt.decay=Ie.decay,Ie.castShadow){const Kt=Ie.shadow,St=o.get(Ie);St.shadowBias=Kt.bias,St.shadowNormalBias=Kt.normalBias,St.shadowRadius=Kt.radius,St.shadowMapSize=Kt.mapSize,a.spotShadow[ge]=St,a.spotShadowMap[ge]=Yt,a.spotShadowMatrix[ge]=Ie.shadow.matrix,tt++}a.spot[ge]=Wt,ge++}else if(Ie.isRectAreaLight){const Wt=i.get(Ie);Wt.color.copy(nt).multiplyScalar(wn),Wt.halfWidth.set(.5*Ie.width,0,0),Wt.halfHeight.set(0,.5*Ie.height,0),a.rectArea[ye]=Wt,ye++}else if(Ie.isPointLight){const Wt=i.get(Ie);if(Wt.color.copy(Ie.color).multiplyScalar(Ie.intensity*lt),Wt.distance=Ie.distance,Wt.decay=Ie.decay,Ie.castShadow){const Kt=Ie.shadow,St=o.get(Ie);St.shadowBias=Kt.bias,St.shadowNormalBias=Kt.normalBias,St.shadowRadius=Kt.radius,St.shadowMapSize=Kt.mapSize,St.shadowCameraNear=Kt.camera.near,St.shadowCameraFar=Kt.camera.far,a.pointShadow[q]=St,a.pointShadowMap[q]=Yt,a.pointShadowMatrix[q]=Ie.shadow.matrix,Ne++}a.point[q]=Wt,q++}else if(Ie.isHemisphereLight){const Wt=i.get(Ie);Wt.skyColor.copy(Ie.color).multiplyScalar(wn*lt),Wt.groundColor.copy(Ie.groundColor).multiplyScalar(wn*lt),a.hemi[De]=Wt,De++}}ye>0&&(t.isWebGL2||!0===s.has("OES_texture_float_linear")?(a.rectAreaLTC1=Xn.LTC_FLOAT_1,a.rectAreaLTC2=Xn.LTC_FLOAT_2):!0===s.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Xn.LTC_HALF_1,a.rectAreaLTC2=Xn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=N,a.ambient[1]=j,a.ambient[2]=te;const ct=a.hash;(ct.directionalLength!==Z||ct.pointLength!==q||ct.spotLength!==ge||ct.rectAreaLength!==ye||ct.hemiLength!==De||ct.numDirectionalShadows!==Le||ct.numPointShadows!==Ne||ct.numSpotShadows!==tt)&&(a.directional.length=Z,a.spot.length=ge,a.rectArea.length=ye,a.point.length=q,a.hemi.length=De,a.directionalShadow.length=Le,a.directionalShadowMap.length=Le,a.pointShadow.length=Ne,a.pointShadowMap.length=Ne,a.spotShadow.length=tt,a.spotShadowMap.length=tt,a.directionalShadowMatrix.length=Le,a.pointShadowMatrix.length=Ne,a.spotShadowMatrix.length=tt,ct.directionalLength=Z,ct.pointLength=q,ct.spotLength=ge,ct.rectAreaLength=ye,ct.hemiLength=De,ct.numDirectionalShadows=Le,ct.numPointShadows=Ne,ct.numSpotShadows=tt,a.version=gx++)},setupView:function(P,U){let N=0,j=0,te=0,Z=0,q=0;const ge=U.matrixWorldInverse;for(let ye=0,De=P.length;ye<De;ye++){const Le=P[ye];if(Le.isDirectionalLight){const Ne=a.directional[N];Ne.direction.setFromMatrixPosition(Le.matrixWorld),u.setFromMatrixPosition(Le.target.matrixWorld),Ne.direction.sub(u),Ne.direction.transformDirection(ge),N++}else if(Le.isSpotLight){const Ne=a.spot[te];Ne.position.setFromMatrixPosition(Le.matrixWorld),Ne.position.applyMatrix4(ge),Ne.direction.setFromMatrixPosition(Le.matrixWorld),u.setFromMatrixPosition(Le.target.matrixWorld),Ne.direction.sub(u),Ne.direction.transformDirection(ge),te++}else if(Le.isRectAreaLight){const Ne=a.rectArea[Z];Ne.position.setFromMatrixPosition(Le.matrixWorld),Ne.position.applyMatrix4(ge),p.identity(),d.copy(Le.matrixWorld),d.premultiply(ge),p.extractRotation(d),Ne.halfWidth.set(.5*Le.width,0,0),Ne.halfHeight.set(0,.5*Le.height,0),Ne.halfWidth.applyMatrix4(p),Ne.halfHeight.applyMatrix4(p),Z++}else if(Le.isPointLight){const Ne=a.point[j];Ne.position.setFromMatrixPosition(Le.matrixWorld),Ne.position.applyMatrix4(ge),j++}else if(Le.isHemisphereLight){const Ne=a.hemi[q];Ne.direction.setFromMatrixPosition(Le.matrixWorld),Ne.direction.transformDirection(ge),Ne.direction.normalize(),q++}}},state:a}}function ag(s,t){const i=new og(s,t),o=[],a=[];return{init:function(){o.length=0,a.length=0},state:{lightsArray:o,shadowsArray:a,lights:i},setupLights:function(U){i.setup(o,U)},setupLightsView:function(U){i.setupView(o,U)},pushLight:function(U){o.push(U)},pushShadow:function(U){a.push(U)}}}function ef(s,t){let i=new WeakMap;return{get:function(u,d=0){let p;return!1===i.has(u)?(p=new ag(s,t),i.set(u,[p])):d>=i.get(u).length?(p=new ag(s,t),i.get(u).push(p)):p=i.get(u)[d],p},dispose:function(){i=new WeakMap}}}class Yu extends so{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Yu.prototype.isMeshDepthMaterial=!0;class Ip extends so{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ze,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function cg(s,t,i){let o=new qd;const a=new st,u=new st,d=new Oe,p=new Yu({depthPacking:3201}),v=new Ip,A={},P=i.maxTextureSize,U={0:1,1:0,2:2},N=new Ho({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new st},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),j=N.clone();j.defines.HORIZONTAL_PASS=1;const te=new Hi;te.setAttribute("position",new ls(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Z=new yo(te,N),q=this;function ge(Le,Ne){const tt=t.update(Z);N.defines.VSM_SAMPLES!==Le.blurSamples&&(N.defines.VSM_SAMPLES=Le.blurSamples,j.defines.VSM_SAMPLES=Le.blurSamples,N.needsUpdate=!0,j.needsUpdate=!0),N.uniforms.shadow_pass.value=Le.map.texture,N.uniforms.resolution.value=Le.mapSize,N.uniforms.radius.value=Le.radius,s.setRenderTarget(Le.mapPass),s.clear(),s.renderBufferDirect(Ne,null,tt,N,Z,null),j.uniforms.shadow_pass.value=Le.mapPass.texture,j.uniforms.resolution.value=Le.mapSize,j.uniforms.radius.value=Le.radius,s.setRenderTarget(Le.map),s.clear(),s.renderBufferDirect(Ne,null,tt,j,Z,null)}function ye(Le,Ne,tt,lt,ct,jt){let wt=null;const Ie=!0===tt.isPointLight?Le.customDistanceMaterial:Le.customDepthMaterial;if(wt=void 0!==Ie?Ie:!0===tt.isPointLight?v:p,s.localClippingEnabled&&!0===Ne.clipShadows&&0!==Ne.clippingPlanes.length||Ne.displacementMap&&0!==Ne.displacementScale||Ne.alphaMap&&Ne.alphaTest>0){const nt=wt.uuid,wn=Ne.uuid;let Tt=A[nt];void 0===Tt&&(Tt={},A[nt]=Tt);let Yt=Tt[wn];void 0===Yt&&(Yt=wt.clone(),Tt[wn]=Yt),wt=Yt}return wt.visible=Ne.visible,wt.wireframe=Ne.wireframe,wt.side=3===jt?null!==Ne.shadowSide?Ne.shadowSide:Ne.side:null!==Ne.shadowSide?Ne.shadowSide:U[Ne.side],wt.alphaMap=Ne.alphaMap,wt.alphaTest=Ne.alphaTest,wt.clipShadows=Ne.clipShadows,wt.clippingPlanes=Ne.clippingPlanes,wt.clipIntersection=Ne.clipIntersection,wt.displacementMap=Ne.displacementMap,wt.displacementScale=Ne.displacementScale,wt.displacementBias=Ne.displacementBias,wt.wireframeLinewidth=Ne.wireframeLinewidth,wt.linewidth=Ne.linewidth,!0===tt.isPointLight&&!0===wt.isMeshDistanceMaterial&&(wt.referencePosition.setFromMatrixPosition(tt.matrixWorld),wt.nearDistance=lt,wt.farDistance=ct),wt}function De(Le,Ne,tt,lt,ct){if(!1===Le.visible)return;if(Le.layers.test(Ne.layers)&&(Le.isMesh||Le.isLine||Le.isPoints)&&(Le.castShadow||Le.receiveShadow&&3===ct)&&(!Le.frustumCulled||o.intersectsObject(Le))){Le.modelViewMatrix.multiplyMatrices(tt.matrixWorldInverse,Le.matrixWorld);const Ie=t.update(Le),nt=Le.material;if(Array.isArray(nt)){const wn=Ie.groups;for(let Tt=0,Yt=wn.length;Tt<Yt;Tt++){const Wt=wn[Tt],Kt=nt[Wt.materialIndex];if(Kt&&Kt.visible){const St=ye(Le,Kt,lt,tt.near,tt.far,ct);s.renderBufferDirect(tt,null,Ie,St,Le,Wt)}}}else if(nt.visible){const wn=ye(Le,nt,lt,tt.near,tt.far,ct);s.renderBufferDirect(tt,null,Ie,wn,Le,null)}}const wt=Le.children;for(let Ie=0,nt=wt.length;Ie<nt;Ie++)De(wt[Ie],Ne,tt,lt,ct)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(Le,Ne,tt){if(!1===q.enabled||!1===q.autoUpdate&&!1===q.needsUpdate||0===Le.length)return;const lt=s.getRenderTarget(),ct=s.getActiveCubeFace(),jt=s.getActiveMipmapLevel(),wt=s.state;wt.setBlending(0),wt.buffers.color.setClear(1,1,1,1),wt.buffers.depth.setTest(!0),wt.setScissorTest(!1);for(let Ie=0,nt=Le.length;Ie<nt;Ie++){const wn=Le[Ie],Tt=wn.shadow;if(void 0===Tt){console.warn("THREE.WebGLShadowMap:",wn,"has no shadow.");continue}if(!1===Tt.autoUpdate&&!1===Tt.needsUpdate)continue;a.copy(Tt.mapSize);const Yt=Tt.getFrameExtents();a.multiply(Yt),u.copy(Tt.mapSize),(a.x>P||a.y>P)&&(a.x>P&&(u.x=Math.floor(P/Yt.x),a.x=u.x*Yt.x,Tt.mapSize.x=u.x),a.y>P&&(u.y=Math.floor(P/Yt.y),a.y=u.y*Yt.y,Tt.mapSize.y=u.y)),null===Tt.map&&!Tt.isPointLightShadow&&3===this.type&&(Tt.map=new Io(a.x,a.y),Tt.map.texture.name=wn.name+".shadowMap",Tt.mapPass=new Io(a.x,a.y),Tt.camera.updateProjectionMatrix()),null===Tt.map&&(Tt.map=new Io(a.x,a.y,{minFilter:rt,magFilter:rt,format:Oi}),Tt.map.texture.name=wn.name+".shadowMap",Tt.camera.updateProjectionMatrix()),s.setRenderTarget(Tt.map),s.clear();const Wt=Tt.getViewportCount();for(let Kt=0;Kt<Wt;Kt++){const St=Tt.getViewport(Kt);d.set(u.x*St.x,u.y*St.y,u.x*St.z,u.y*St.w),wt.viewport(d),Tt.updateMatrices(wn,Kt),o=Tt.getFrustum(),De(Ne,tt,Tt.camera,wn,this.type)}!Tt.isPointLightShadow&&3===this.type&&ge(Tt,tt),Tt.needsUpdate=!1}q.needsUpdate=!1,s.setRenderTarget(lt,ct,jt)}}function xx(s,t,i){const o=i.isWebGL2,p=new function(){let pt=!1;const oi=new Oe;let ii=null;const mr=new Oe(0,0,0,0);return{setMask:function(Ti){ii!==Ti&&!pt&&(s.colorMask(Ti,Ti,Ti,Ti),ii=Ti)},setLocked:function(Ti){pt=Ti},setClear:function(Ti,gr,ti,Mr,Ks){!0===Ks&&(Ti*=Mr,gr*=Mr,ti*=Mr),oi.set(Ti,gr,ti,Mr),!1===mr.equals(oi)&&(s.clearColor(Ti,gr,ti,Mr),mr.copy(oi))},reset:function(){pt=!1,ii=null,mr.set(-1,0,0,0)}}},v=new function(){let pt=!1,oi=null,ii=null,mr=null;return{setTest:function(Ti){Ti?yr(2929):pn(2929)},setMask:function(Ti){oi!==Ti&&!pt&&(s.depthMask(Ti),oi=Ti)},setFunc:function(Ti){if(ii!==Ti){if(Ti)switch(Ti){case 0:s.depthFunc(512);break;case 1:s.depthFunc(519);break;case 2:s.depthFunc(513);break;case 3:s.depthFunc(515);break;case 4:s.depthFunc(514);break;case 5:s.depthFunc(518);break;case 6:s.depthFunc(516);break;case 7:s.depthFunc(517);break;default:s.depthFunc(515)}else s.depthFunc(515);ii=Ti}},setLocked:function(Ti){pt=Ti},setClear:function(Ti){mr!==Ti&&(s.clearDepth(Ti),mr=Ti)},reset:function(){pt=!1,oi=null,ii=null,mr=null}}},A=new function(){let pt=!1,oi=null,ii=null,mr=null,Ti=null,gr=null,ti=null,Mr=null,Ks=null;return{setTest:function(ss){pt||(ss?yr(2960):pn(2960))},setMask:function(ss){oi!==ss&&!pt&&(s.stencilMask(ss),oi=ss)},setFunc:function(ss,Nc,kc){(ii!==ss||mr!==Nc||Ti!==kc)&&(s.stencilFunc(ss,Nc,kc),ii=ss,mr=Nc,Ti=kc)},setOp:function(ss,Nc,kc){(gr!==ss||ti!==Nc||Mr!==kc)&&(s.stencilOp(ss,Nc,kc),gr=ss,ti=Nc,Mr=kc)},setLocked:function(ss){pt=ss},setClear:function(ss){Ks!==ss&&(s.clearStencil(ss),Ks=ss)},reset:function(){pt=!1,oi=null,ii=null,mr=null,Ti=null,gr=null,ti=null,Mr=null,Ks=null}}};let P={},U={},N=new WeakMap,j=[],te=null,Z=!1,q=null,ge=null,ye=null,De=null,Le=null,Ne=null,tt=null,lt=!1,ct=null,jt=null,wt=null,Ie=null,nt=null;const wn=s.getParameter(35661);let Tt=!1,Yt=0;const Wt=s.getParameter(7938);-1!==Wt.indexOf("WebGL")?(Yt=parseFloat(/^WebGL (\d)/.exec(Wt)[1]),Tt=Yt>=1):-1!==Wt.indexOf("OpenGL ES")&&(Yt=parseFloat(/^OpenGL ES (\d)/.exec(Wt)[1]),Tt=Yt>=2);let Kt=null,St={};const yn=s.getParameter(3088),Mn=s.getParameter(2978),jn=(new Oe).fromArray(yn),Ln=(new Oe).fromArray(Mn);function zi(pt,oi,ii){const mr=new Uint8Array(4),Ti=s.createTexture();s.bindTexture(pt,Ti),s.texParameteri(pt,10241,9728),s.texParameteri(pt,10240,9728);for(let gr=0;gr<ii;gr++)s.texImage2D(oi+gr,0,6408,1,1,0,6408,5121,mr);return Ti}const Vr={};function yr(pt){!0!==P[pt]&&(s.enable(pt),P[pt]=!0)}function pn(pt){!1!==P[pt]&&(s.disable(pt),P[pt]=!1)}Vr[3553]=zi(3553,3553,1),Vr[34067]=zi(34067,34069,6),p.setClear(0,0,0,1),v.setClear(1),A.setClear(0),yr(2929),v.setFunc(3),Wn(!1),Ii(1),yr(2884),ln(0);const ei={100:32774,101:32778,102:32779};if(o)ei[103]=32775,ei[104]=32776;else{const pt=t.get("EXT_blend_minmax");null!==pt&&(ei[103]=pt.MIN_EXT,ei[104]=pt.MAX_EXT)}const Qr={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function ln(pt,oi,ii,mr,Ti,gr,ti,Mr){if(0!==pt){if(!1===Z&&(yr(3042),Z=!0),5===pt)Ti=Ti||oi,gr=gr||ii,ti=ti||mr,(oi!==ge||Ti!==Le)&&(s.blendEquationSeparate(ei[oi],ei[Ti]),ge=oi,Le=Ti),(ii!==ye||mr!==De||gr!==Ne||ti!==tt)&&(s.blendFuncSeparate(Qr[ii],Qr[mr],Qr[gr],Qr[ti]),ye=ii,De=mr,Ne=gr,tt=ti),q=pt,lt=null;else if(pt!==q||Mr!==lt){if((100!==ge||100!==Le)&&(s.blendEquation(32774),ge=100,Le=100),Mr)switch(pt){case 1:s.blendFuncSeparate(1,771,1,771);break;case 2:s.blendFunc(1,1);break;case 3:s.blendFuncSeparate(0,769,0,1);break;case 4:s.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}else switch(pt){case 1:s.blendFuncSeparate(770,771,1,771);break;case 2:s.blendFunc(770,1);break;case 3:s.blendFuncSeparate(0,769,0,1);break;case 4:s.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}ye=null,De=null,Ne=null,tt=null,q=pt,lt=Mr}}else!0===Z&&(pn(3042),Z=!1)}function Wn(pt){ct!==pt&&(s.frontFace(pt?2304:2305),ct=pt)}function Ii(pt){0!==pt?(yr(2884),pt!==jt&&s.cullFace(1===pt?1029:2===pt?1028:1032)):pn(2884),jt=pt}function Cr(pt,oi,ii){pt?(yr(32823),(Ie!==oi||nt!==ii)&&(s.polygonOffset(oi,ii),Ie=oi,nt=ii)):pn(32823)}function $i(pt){void 0===pt&&(pt=33984+wn-1),Kt!==pt&&(s.activeTexture(pt),Kt=pt)}return{buffers:{color:p,depth:v,stencil:A},enable:yr,disable:pn,bindFramebuffer:function(pt,oi){return U[pt]!==oi&&(s.bindFramebuffer(pt,oi),U[pt]=oi,o&&(36009===pt&&(U[36160]=oi),36160===pt&&(U[36009]=oi)),!0)},drawBuffers:function(pt,oi){let ii=j,mr=!1;if(pt)if(ii=N.get(oi),void 0===ii&&(ii=[],N.set(oi,ii)),pt.isWebGLMultipleRenderTargets){const Ti=pt.texture;if(ii.length!==Ti.length||36064!==ii[0]){for(let gr=0,ti=Ti.length;gr<ti;gr++)ii[gr]=36064+gr;ii.length=Ti.length,mr=!0}}else 36064!==ii[0]&&(ii[0]=36064,mr=!0);else 1029!==ii[0]&&(ii[0]=1029,mr=!0);mr&&(i.isWebGL2?s.drawBuffers(ii):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ii))},useProgram:function(pt){return te!==pt&&(s.useProgram(pt),te=pt,!0)},setBlending:ln,setMaterial:function(pt,oi){2===pt.side?pn(2884):yr(2884);let ii=1===pt.side;oi&&(ii=!ii),Wn(ii),1===pt.blending&&!1===pt.transparent?ln(0):ln(pt.blending,pt.blendEquation,pt.blendSrc,pt.blendDst,pt.blendEquationAlpha,pt.blendSrcAlpha,pt.blendDstAlpha,pt.premultipliedAlpha),v.setFunc(pt.depthFunc),v.setTest(pt.depthTest),v.setMask(pt.depthWrite),p.setMask(pt.colorWrite);const mr=pt.stencilWrite;A.setTest(mr),mr&&(A.setMask(pt.stencilWriteMask),A.setFunc(pt.stencilFunc,pt.stencilRef,pt.stencilFuncMask),A.setOp(pt.stencilFail,pt.stencilZFail,pt.stencilZPass)),Cr(pt.polygonOffset,pt.polygonOffsetFactor,pt.polygonOffsetUnits),!0===pt.alphaToCoverage?yr(32926):pn(32926)},setFlipSided:Wn,setCullFace:Ii,setLineWidth:function(pt){pt!==wt&&(Tt&&s.lineWidth(pt),wt=pt)},setPolygonOffset:Cr,setScissorTest:function(pt){pt?yr(3089):pn(3089)},activeTexture:$i,bindTexture:function(pt,oi){null===Kt&&$i();let ii=St[Kt];void 0===ii&&(ii={type:void 0,texture:void 0},St[Kt]=ii),(ii.type!==pt||ii.texture!==oi)&&(s.bindTexture(pt,oi||Vr[pt]),ii.type=pt,ii.texture=oi)},unbindTexture:function(){const pt=St[Kt];void 0!==pt&&void 0!==pt.type&&(s.bindTexture(pt.type,null),pt.type=void 0,pt.texture=void 0)},compressedTexImage2D:function(){try{s.compressedTexImage2D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage2D:function(){try{s.texImage2D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage3D:function(){try{s.texImage3D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texStorage2D:function(){try{s.texStorage2D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texStorage3D:function(){try{s.texStorage3D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texSubImage2D:function(){try{s.texSubImage2D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texSubImage3D:function(){try{s.texSubImage3D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},compressedTexSubImage2D:function(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},scissor:function(pt){!1===jn.equals(pt)&&(s.scissor(pt.x,pt.y,pt.z,pt.w),jn.copy(pt))},viewport:function(pt){!1===Ln.equals(pt)&&(s.viewport(pt.x,pt.y,pt.z,pt.w),Ln.copy(pt))},reset:function(){s.disable(3042),s.disable(2884),s.disable(2929),s.disable(32823),s.disable(3089),s.disable(2960),s.disable(32926),s.blendEquation(32774),s.blendFunc(1,0),s.blendFuncSeparate(1,0,1,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(513),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(519,0,4294967295),s.stencilOp(7680,7680,7680),s.clearStencil(0),s.cullFace(1029),s.frontFace(2305),s.polygonOffset(0,0),s.activeTexture(33984),s.bindFramebuffer(36160,null),!0===o&&(s.bindFramebuffer(36009,null),s.bindFramebuffer(36008,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),P={},Kt=null,St={},U={},N=new WeakMap,j=[],te=null,Z=!1,q=null,ge=null,ye=null,De=null,Le=null,Ne=null,tt=null,lt=!1,ct=null,jt=null,wt=null,Ie=null,nt=null,jn.set(0,0,s.canvas.width,s.canvas.height),Ln.set(0,0,s.canvas.width,s.canvas.height),p.reset(),v.reset(),A.reset()}}}function ug(s,t,i,o,a,u,d){const p=a.isWebGL2,v=a.maxTextures,A=a.maxCubemapSize,P=a.maxTextureSize,U=a.maxSamples,N=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,j=/OculusBrowser/g.test(navigator.userAgent),te=new WeakMap;let Z;const q=new WeakMap;let ge=!1;try{ge="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Je){}function ye(Je,We){return ge?new OffscreenCanvas(Je,We):_l("canvas")}function De(Je,We,qt,In){let hi=1;if((Je.width>In||Je.height>In)&&(hi=In/Math.max(Je.width,Je.height)),hi<1||!0===We){if("undefined"!=typeof HTMLImageElement&&Je instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&Je instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&Je instanceof ImageBitmap){const bi=We?Pu:Math.floor,or=bi(hi*Je.width),Jt=bi(hi*Je.height);void 0===Z&&(Z=ye(or,Jt));const Fr=qt?ye(or,Jt):Z;return Fr.width=or,Fr.height=Jt,Fr.getContext("2d").drawImage(Je,0,0,or,Jt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Je.width+"x"+Je.height+") to ("+or+"x"+Jt+")."),Fr}return"data"in Je&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Je.width+"x"+Je.height+")."),Je}return Je}function Le(Je){return ep(Je.width)&&ep(Je.height)}function tt(Je,We){return Je.generateMipmaps&&We&&Je.minFilter!==rt&&Je.minFilter!==rn}function lt(Je){s.generateMipmap(Je)}function ct(Je,We,qt,In,hi=!1){if(!1===p)return We;if(null!==Je){if(void 0!==s[Je])return s[Je];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Je+"'")}let bi=We;return 6403===We&&(5126===qt&&(bi=33326),5131===qt&&(bi=33325),5121===qt&&(bi=33321)),33319===We&&(5126===qt&&(bi=33328),5131===qt&&(bi=33327),5121===qt&&(bi=33323)),6408===We&&(5126===qt&&(bi=34836),5131===qt&&(bi=34842),5121===qt&&(bi=In===Kn&&!1===hi?35907:32856),32819===qt&&(bi=32854),32820===qt&&(bi=32855)),(33325===bi||33326===bi||33327===bi||33328===bi||34842===bi||34836===bi)&&t.get("EXT_color_buffer_float"),bi}function jt(Je,We,qt){return!0===tt(Je,qt)||Je.isFramebufferTexture&&Je.minFilter!==rt&&Je.minFilter!==rn?Math.log2(Math.max(We.width,We.height))+1:void 0!==Je.mipmaps&&Je.mipmaps.length>0?Je.mipmaps.length:Je.isCompressedTexture&&Array.isArray(Je.image)?We.mipmaps.length:1}function wt(Je){return Je===rt||1004===Je||1005===Je?9728:9729}function Ie(Je){const We=Je.target;We.removeEventListener("dispose",Ie),function(Je){const We=o.get(Je);if(void 0===We.__webglInit)return;const qt=Je.source,In=q.get(qt);if(In){const hi=In[We.__cacheKey];hi.usedTimes--,0===hi.usedTimes&&Tt(Je),0===Object.keys(In).length&&q.delete(qt)}o.remove(Je)}(We),We.isVideoTexture&&te.delete(We)}function nt(Je){const We=Je.target;We.removeEventListener("dispose",nt),function(Je){const We=Je.texture,qt=o.get(Je),In=o.get(We);if(void 0!==In.__webglTexture&&(s.deleteTexture(In.__webglTexture),d.memory.textures--),Je.depthTexture&&Je.depthTexture.dispose(),Je.isWebGLCubeRenderTarget)for(let hi=0;hi<6;hi++)s.deleteFramebuffer(qt.__webglFramebuffer[hi]),qt.__webglDepthbuffer&&s.deleteRenderbuffer(qt.__webglDepthbuffer[hi]);else s.deleteFramebuffer(qt.__webglFramebuffer),qt.__webglDepthbuffer&&s.deleteRenderbuffer(qt.__webglDepthbuffer),qt.__webglMultisampledFramebuffer&&s.deleteFramebuffer(qt.__webglMultisampledFramebuffer),qt.__webglColorRenderbuffer&&s.deleteRenderbuffer(qt.__webglColorRenderbuffer),qt.__webglDepthRenderbuffer&&s.deleteRenderbuffer(qt.__webglDepthRenderbuffer);if(Je.isWebGLMultipleRenderTargets)for(let hi=0,bi=We.length;hi<bi;hi++){const or=o.get(We[hi]);or.__webglTexture&&(s.deleteTexture(or.__webglTexture),d.memory.textures--),o.remove(We[hi])}o.remove(We),o.remove(Je)}(We)}function Tt(Je){const We=o.get(Je);s.deleteTexture(We.__webglTexture),delete q.get(Je.source)[We.__cacheKey],d.memory.textures--}let Wt=0;function Mn(Je,We){const qt=o.get(Je);if(Je.isVideoTexture&&function(Je){const We=d.render.frame;te.get(Je)!==We&&(te.set(Je,We),Je.update())}(Je),!1===Je.isRenderTargetTexture&&Je.version>0&&qt.__version!==Je.version){const In=Je.image;if(null===In)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==In.complete)return void Ir(qt,Je,We);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+We),i.bindTexture(3553,qt.__webglTexture)}const Vr={1e3:10497,[Pe]:33071,1002:33648},yr={[rt]:9728,1004:9984,1005:9986,[rn]:9729,1007:9985,1008:9987};function pn(Je,We,qt){if(qt?(s.texParameteri(Je,10242,Vr[We.wrapS]),s.texParameteri(Je,10243,Vr[We.wrapT]),(32879===Je||35866===Je)&&s.texParameteri(Je,32882,Vr[We.wrapR]),s.texParameteri(Je,10240,yr[We.magFilter]),s.texParameteri(Je,10241,yr[We.minFilter])):(s.texParameteri(Je,10242,33071),s.texParameteri(Je,10243,33071),(32879===Je||35866===Je)&&s.texParameteri(Je,32882,33071),(We.wrapS!==Pe||We.wrapT!==Pe)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(Je,10240,wt(We.magFilter)),s.texParameteri(Je,10241,wt(We.minFilter)),We.minFilter!==rt&&We.minFilter!==rn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const In=t.get("EXT_texture_filter_anisotropic");if(We.type===Sn&&!1===t.has("OES_texture_float_linear")||!1===p&&We.type===En&&!1===t.has("OES_texture_half_float_linear"))return;(We.anisotropy>1||o.get(We).__currentAnisotropy)&&(s.texParameterf(Je,In.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(We.anisotropy,a.getMaxAnisotropy())),o.get(We).__currentAnisotropy=We.anisotropy)}}function xs(Je,We){let qt=!1;void 0===Je.__webglInit&&(Je.__webglInit=!0,We.addEventListener("dispose",Ie));const In=We.source;let hi=q.get(In);void 0===hi&&(hi={},q.set(In,hi));const bi=function(Je){const We=[];return We.push(Je.wrapS),We.push(Je.wrapT),We.push(Je.magFilter),We.push(Je.minFilter),We.push(Je.anisotropy),We.push(Je.internalFormat),We.push(Je.format),We.push(Je.type),We.push(Je.generateMipmaps),We.push(Je.premultiplyAlpha),We.push(Je.flipY),We.push(Je.unpackAlignment),We.push(Je.encoding),We.join()}(We);if(bi!==Je.__cacheKey){void 0===hi[bi]&&(hi[bi]={texture:s.createTexture(),usedTimes:0},d.memory.textures++,qt=!0),hi[bi].usedTimes++;const or=hi[Je.__cacheKey];void 0!==or&&(hi[Je.__cacheKey].usedTimes--,0===or.usedTimes&&Tt(We)),Je.__cacheKey=bi,Je.__webglTexture=hi[bi].texture}return qt}function Ir(Je,We,qt){let In=3553;We.isDataArrayTexture&&(In=35866),We.isData3DTexture&&(In=32879);const hi=xs(Je,We),bi=We.source;if(i.activeTexture(33984+qt),i.bindTexture(In,Je.__webglTexture),bi.version!==bi.__currentVersion||!0===hi){s.pixelStorei(37440,We.flipY),s.pixelStorei(37441,We.premultiplyAlpha),s.pixelStorei(3317,We.unpackAlignment),s.pixelStorei(37443,0);const or=function(Je){return!p&&(Je.wrapS!==Pe||Je.wrapT!==Pe||Je.minFilter!==rt&&Je.minFilter!==rn)}(We)&&!1===Le(We.image);let Jt=De(We.image,or,!1,P);Jt=Ns(We,Jt);const Fr=Le(Jt)||p,Wr=u.convert(We.format,We.encoding);let oi,Bi=u.convert(We.type),pt=ct(We.internalFormat,Wr,Bi,We.encoding,We.isVideoTexture);pn(In,We,Fr);const ii=We.mipmaps,mr=p&&!0!==We.isVideoTexture,Ti=void 0===Je.__version,gr=jt(We,Jt,Fr);if(We.isDepthTexture)pt=6402,p?pt=We.type===Sn?36012:1014===We.type?33190:We.type===wi?35056:33189:We.type===Sn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),We.format===Un&&6402===pt&&We.type!==Lt&&1014!==We.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),We.type=Lt,Bi=u.convert(We.type)),We.format===$e&&6402===pt&&(pt=34041,We.type!==wi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),We.type=wi,Bi=u.convert(We.type))),mr&&Ti?i.texStorage2D(3553,1,pt,Jt.width,Jt.height):i.texImage2D(3553,0,pt,Jt.width,Jt.height,0,Wr,Bi,null);else if(We.isDataTexture)if(ii.length>0&&Fr){mr&&Ti&&i.texStorage2D(3553,gr,pt,ii[0].width,ii[0].height);for(let ti=0,Mr=ii.length;ti<Mr;ti++)oi=ii[ti],mr?i.texSubImage2D(3553,ti,0,0,oi.width,oi.height,Wr,Bi,oi.data):i.texImage2D(3553,ti,pt,oi.width,oi.height,0,Wr,Bi,oi.data);We.generateMipmaps=!1}else mr?(Ti&&i.texStorage2D(3553,gr,pt,Jt.width,Jt.height),i.texSubImage2D(3553,0,0,0,Jt.width,Jt.height,Wr,Bi,Jt.data)):i.texImage2D(3553,0,pt,Jt.width,Jt.height,0,Wr,Bi,Jt.data);else if(We.isCompressedTexture){mr&&Ti&&i.texStorage2D(3553,gr,pt,ii[0].width,ii[0].height);for(let ti=0,Mr=ii.length;ti<Mr;ti++)oi=ii[ti],We.format!==Oi?null!==Wr?mr?i.compressedTexSubImage2D(3553,ti,0,0,oi.width,oi.height,Wr,oi.data):i.compressedTexImage2D(3553,ti,pt,oi.width,oi.height,0,oi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mr?i.texSubImage2D(3553,ti,0,0,oi.width,oi.height,Wr,Bi,oi.data):i.texImage2D(3553,ti,pt,oi.width,oi.height,0,Wr,Bi,oi.data)}else if(We.isDataArrayTexture)mr?(Ti&&i.texStorage3D(35866,gr,pt,Jt.width,Jt.height,Jt.depth),i.texSubImage3D(35866,0,0,0,0,Jt.width,Jt.height,Jt.depth,Wr,Bi,Jt.data)):i.texImage3D(35866,0,pt,Jt.width,Jt.height,Jt.depth,0,Wr,Bi,Jt.data);else if(We.isData3DTexture)mr?(Ti&&i.texStorage3D(32879,gr,pt,Jt.width,Jt.height,Jt.depth),i.texSubImage3D(32879,0,0,0,0,Jt.width,Jt.height,Jt.depth,Wr,Bi,Jt.data)):i.texImage3D(32879,0,pt,Jt.width,Jt.height,Jt.depth,0,Wr,Bi,Jt.data);else if(We.isFramebufferTexture)mr&&Ti?i.texStorage2D(3553,gr,pt,Jt.width,Jt.height):i.texImage2D(3553,0,pt,Jt.width,Jt.height,0,Wr,Bi,null);else if(ii.length>0&&Fr){mr&&Ti&&i.texStorage2D(3553,gr,pt,ii[0].width,ii[0].height);for(let ti=0,Mr=ii.length;ti<Mr;ti++)oi=ii[ti],mr?i.texSubImage2D(3553,ti,0,0,Wr,Bi,oi):i.texImage2D(3553,ti,pt,Wr,Bi,oi);We.generateMipmaps=!1}else mr?(Ti&&i.texStorage2D(3553,gr,pt,Jt.width,Jt.height),i.texSubImage2D(3553,0,0,0,Wr,Bi,Jt)):i.texImage2D(3553,0,pt,Wr,Bi,Jt);tt(We,Fr)&&lt(In),bi.__currentVersion=bi.version,We.onUpdate&&We.onUpdate(We)}Je.__version=We.version}function ei(Je,We,qt,In,hi){const bi=u.convert(qt.format,qt.encoding),or=u.convert(qt.type),Jt=ct(qt.internalFormat,bi,or,qt.encoding);o.get(We).__hasExternalTextures||(32879===hi||35866===hi?i.texImage3D(hi,0,Jt,We.width,We.height,We.depth,0,bi,or,null):i.texImage2D(hi,0,Jt,We.width,We.height,0,bi,or,null)),i.bindFramebuffer(36160,Je),$i(We)?N.framebufferTexture2DMultisampleEXT(36160,In,hi,o.get(qt).__webglTexture,0,lr(We)):s.framebufferTexture2D(36160,In,hi,o.get(qt).__webglTexture,0),i.bindFramebuffer(36160,null)}function Qr(Je,We,qt){if(s.bindRenderbuffer(36161,Je),We.depthBuffer&&!We.stencilBuffer){let In=33189;if(qt||$i(We)){const hi=We.depthTexture;hi&&hi.isDepthTexture&&(hi.type===Sn?In=36012:1014===hi.type&&(In=33190));const bi=lr(We);$i(We)?N.renderbufferStorageMultisampleEXT(36161,bi,In,We.width,We.height):s.renderbufferStorageMultisample(36161,bi,In,We.width,We.height)}else s.renderbufferStorage(36161,In,We.width,We.height);s.framebufferRenderbuffer(36160,36096,36161,Je)}else if(We.depthBuffer&&We.stencilBuffer){const In=lr(We);qt&&!1===$i(We)?s.renderbufferStorageMultisample(36161,In,35056,We.width,We.height):$i(We)?N.renderbufferStorageMultisampleEXT(36161,In,35056,We.width,We.height):s.renderbufferStorage(36161,34041,We.width,We.height),s.framebufferRenderbuffer(36160,33306,36161,Je)}else{const In=!0===We.isWebGLMultipleRenderTargets?We.texture[0]:We.texture,hi=u.convert(In.format,In.encoding),bi=u.convert(In.type),or=ct(In.internalFormat,hi,bi,In.encoding),Jt=lr(We);qt&&!1===$i(We)?s.renderbufferStorageMultisample(36161,Jt,or,We.width,We.height):$i(We)?N.renderbufferStorageMultisampleEXT(36161,Jt,or,We.width,We.height):s.renderbufferStorage(36161,or,We.width,We.height)}s.bindRenderbuffer(36161,null)}function xn(Je){const We=o.get(Je),qt=!0===Je.isWebGLCubeRenderTarget;if(Je.depthTexture&&!We.__autoAllocateDepthBuffer){if(qt)throw new Error("target.depthTexture not supported in Cube render targets");!function(Je,We){if(We&&We.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,Je),!We.depthTexture||!We.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!o.get(We.depthTexture).__webglTexture||We.depthTexture.image.width!==We.width||We.depthTexture.image.height!==We.height)&&(We.depthTexture.image.width=We.width,We.depthTexture.image.height=We.height,We.depthTexture.needsUpdate=!0),Mn(We.depthTexture,0);const In=o.get(We.depthTexture).__webglTexture,hi=lr(We);if(We.depthTexture.format===Un)$i(We)?N.framebufferTexture2DMultisampleEXT(36160,36096,3553,In,0,hi):s.framebufferTexture2D(36160,36096,3553,In,0);else{if(We.depthTexture.format!==$e)throw new Error("Unknown depthTexture format");$i(We)?N.framebufferTexture2DMultisampleEXT(36160,33306,3553,In,0,hi):s.framebufferTexture2D(36160,33306,3553,In,0)}}(We.__webglFramebuffer,Je)}else if(qt){We.__webglDepthbuffer=[];for(let In=0;In<6;In++)i.bindFramebuffer(36160,We.__webglFramebuffer[In]),We.__webglDepthbuffer[In]=s.createRenderbuffer(),Qr(We.__webglDepthbuffer[In],Je,!1)}else i.bindFramebuffer(36160,We.__webglFramebuffer),We.__webglDepthbuffer=s.createRenderbuffer(),Qr(We.__webglDepthbuffer,Je,!1);i.bindFramebuffer(36160,null)}function lr(Je){return Math.min(U,Je.samples)}function $i(Je){const We=o.get(Je);return p&&Je.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==We.__useRenderToTexture}function Ns(Je,We){const qt=Je.encoding,In=Je.format,hi=Je.type;return!0===Je.isCompressedTexture||!0===Je.isVideoTexture||1035===Je.format||qt!==Ui&&(qt===Kn?!1===p?!0===t.has("EXT_sRGB")&&In===Oi?(Je.format=1035,Je.minFilter=rn,Je.generateMipmaps=!1):We=Or.sRGBToLinear(We):(In!==Oi||hi!==di)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",qt)),We}this.allocateTextureUnit=function(){const Je=Wt;return Je>=v&&console.warn("THREE.WebGLTextures: Trying to use "+Je+" texture units while this GPU supports only "+v),Wt+=1,Je},this.resetTextureUnits=function(){Wt=0},this.setTexture2D=Mn,this.setTexture2DArray=function(Je,We){const qt=o.get(Je);Je.version>0&&qt.__version!==Je.version?Ir(qt,Je,We):(i.activeTexture(33984+We),i.bindTexture(35866,qt.__webglTexture))},this.setTexture3D=function(Je,We){const qt=o.get(Je);Je.version>0&&qt.__version!==Je.version?Ir(qt,Je,We):(i.activeTexture(33984+We),i.bindTexture(32879,qt.__webglTexture))},this.setTextureCube=function(Je,We){const qt=o.get(Je);Je.version>0&&qt.__version!==Je.version?function(Je,We,qt){if(6!==We.image.length)return;const In=xs(Je,We),hi=We.source;if(i.activeTexture(33984+qt),i.bindTexture(34067,Je.__webglTexture),hi.version!==hi.__currentVersion||!0===In){s.pixelStorei(37440,We.flipY),s.pixelStorei(37441,We.premultiplyAlpha),s.pixelStorei(3317,We.unpackAlignment),s.pixelStorei(37443,0);const bi=We.isCompressedTexture||We.image[0].isCompressedTexture,or=We.image[0]&&We.image[0].isDataTexture,Jt=[];for(let ti=0;ti<6;ti++)Jt[ti]=bi||or?or?We.image[ti].image:We.image[ti]:De(We.image[ti],!1,!0,A),Jt[ti]=Ns(We,Jt[ti]);const Fr=Jt[0],Wr=Le(Fr)||p,Bi=u.convert(We.format,We.encoding),pt=u.convert(We.type),oi=ct(We.internalFormat,Bi,pt,We.encoding),ii=p&&!0!==We.isVideoTexture,mr=void 0===Je.__version;let gr,Ti=jt(We,Fr,Wr);if(pn(34067,We,Wr),bi){ii&&mr&&i.texStorage2D(34067,Ti,oi,Fr.width,Fr.height);for(let ti=0;ti<6;ti++){gr=Jt[ti].mipmaps;for(let Mr=0;Mr<gr.length;Mr++){const Ks=gr[Mr];We.format!==Oi?null!==Bi?ii?i.compressedTexSubImage2D(34069+ti,Mr,0,0,Ks.width,Ks.height,Bi,Ks.data):i.compressedTexImage2D(34069+ti,Mr,oi,Ks.width,Ks.height,0,Ks.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ii?i.texSubImage2D(34069+ti,Mr,0,0,Ks.width,Ks.height,Bi,pt,Ks.data):i.texImage2D(34069+ti,Mr,oi,Ks.width,Ks.height,0,Bi,pt,Ks.data)}}}else{gr=We.mipmaps,ii&&mr&&(gr.length>0&&Ti++,i.texStorage2D(34067,Ti,oi,Jt[0].width,Jt[0].height));for(let ti=0;ti<6;ti++)if(or){ii?i.texSubImage2D(34069+ti,0,0,0,Jt[ti].width,Jt[ti].height,Bi,pt,Jt[ti].data):i.texImage2D(34069+ti,0,oi,Jt[ti].width,Jt[ti].height,0,Bi,pt,Jt[ti].data);for(let Mr=0;Mr<gr.length;Mr++){const ss=gr[Mr].image[ti].image;ii?i.texSubImage2D(34069+ti,Mr+1,0,0,ss.width,ss.height,Bi,pt,ss.data):i.texImage2D(34069+ti,Mr+1,oi,ss.width,ss.height,0,Bi,pt,ss.data)}}else{ii?i.texSubImage2D(34069+ti,0,0,0,Bi,pt,Jt[ti]):i.texImage2D(34069+ti,0,oi,Bi,pt,Jt[ti]);for(let Mr=0;Mr<gr.length;Mr++){const Ks=gr[Mr];ii?i.texSubImage2D(34069+ti,Mr+1,0,0,Bi,pt,Ks.image[ti]):i.texImage2D(34069+ti,Mr+1,oi,Bi,pt,Ks.image[ti])}}}tt(We,Wr)&&lt(34067),hi.__currentVersion=hi.version,We.onUpdate&&We.onUpdate(We)}Je.__version=We.version}(qt,Je,We):(i.activeTexture(33984+We),i.bindTexture(34067,qt.__webglTexture))},this.rebindTextures=function(Je,We,qt){const In=o.get(Je);void 0!==We&&ei(In.__webglFramebuffer,Je,Je.texture,36064,3553),void 0!==qt&&xn(Je)},this.setupRenderTarget=function(Je){const We=Je.texture,qt=o.get(Je),In=o.get(We);Je.addEventListener("dispose",nt),!0!==Je.isWebGLMultipleRenderTargets&&(void 0===In.__webglTexture&&(In.__webglTexture=s.createTexture()),In.__version=We.version,d.memory.textures++);const hi=!0===Je.isWebGLCubeRenderTarget,bi=!0===Je.isWebGLMultipleRenderTargets,or=Le(Je)||p;if(hi){qt.__webglFramebuffer=[];for(let Jt=0;Jt<6;Jt++)qt.__webglFramebuffer[Jt]=s.createFramebuffer()}else if(qt.__webglFramebuffer=s.createFramebuffer(),bi)if(a.drawBuffers){const Jt=Je.texture;for(let Fr=0,Wr=Jt.length;Fr<Wr;Fr++){const Bi=o.get(Jt[Fr]);void 0===Bi.__webglTexture&&(Bi.__webglTexture=s.createTexture(),d.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p&&Je.samples>0&&!1===$i(Je)){qt.__webglMultisampledFramebuffer=s.createFramebuffer(),qt.__webglColorRenderbuffer=s.createRenderbuffer(),s.bindRenderbuffer(36161,qt.__webglColorRenderbuffer);const Jt=u.convert(We.format,We.encoding),Fr=u.convert(We.type),Wr=ct(We.internalFormat,Jt,Fr,We.encoding),Bi=lr(Je);s.renderbufferStorageMultisample(36161,Bi,Wr,Je.width,Je.height),i.bindFramebuffer(36160,qt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(36160,36064,36161,qt.__webglColorRenderbuffer),s.bindRenderbuffer(36161,null),Je.depthBuffer&&(qt.__webglDepthRenderbuffer=s.createRenderbuffer(),Qr(qt.__webglDepthRenderbuffer,Je,!0)),i.bindFramebuffer(36160,null)}if(hi){i.bindTexture(34067,In.__webglTexture),pn(34067,We,or);for(let Jt=0;Jt<6;Jt++)ei(qt.__webglFramebuffer[Jt],Je,We,36064,34069+Jt);tt(We,or)&&lt(34067),i.unbindTexture()}else if(bi){const Jt=Je.texture;for(let Fr=0,Wr=Jt.length;Fr<Wr;Fr++){const Bi=Jt[Fr],pt=o.get(Bi);i.bindTexture(3553,pt.__webglTexture),pn(3553,Bi,or),ei(qt.__webglFramebuffer,Je,Bi,36064+Fr,3553),tt(Bi,or)&&lt(3553)}i.unbindTexture()}else{let Jt=3553;(Je.isWebGL3DRenderTarget||Je.isWebGLArrayRenderTarget)&&(p?Jt=Je.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Jt,In.__webglTexture),pn(Jt,We,or),ei(qt.__webglFramebuffer,Je,We,36064,Jt),tt(We,or)&&lt(Jt),i.unbindTexture()}Je.depthBuffer&&xn(Je)},this.updateRenderTargetMipmap=function(Je){const We=Le(Je)||p,qt=!0===Je.isWebGLMultipleRenderTargets?Je.texture:[Je.texture];for(let In=0,hi=qt.length;In<hi;In++){const bi=qt[In];if(tt(bi,We)){const or=Je.isWebGLCubeRenderTarget?34067:3553,Jt=o.get(bi).__webglTexture;i.bindTexture(or,Jt),lt(or),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(Je){if(p&&Je.samples>0&&!1===$i(Je)){const We=Je.width,qt=Je.height;let In=16384;const hi=[36064],bi=Je.stencilBuffer?33306:36096;Je.depthBuffer&&hi.push(bi);const or=o.get(Je),Jt=void 0!==or.__ignoreDepthValues&&or.__ignoreDepthValues;!1===Jt&&(Je.depthBuffer&&(In|=256),Je.stencilBuffer&&(In|=1024)),i.bindFramebuffer(36008,or.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,or.__webglFramebuffer),!0===Jt&&(s.invalidateFramebuffer(36008,[bi]),s.invalidateFramebuffer(36009,[bi])),s.blitFramebuffer(0,0,We,qt,0,0,We,qt,In,9728),j&&s.invalidateFramebuffer(36008,hi),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,or.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=xn,this.setupFrameBufferTexture=ei,this.useMultisampledRTT=$i}function wc(s,t,i){const o=i.isWebGL2;return{convert:function(u,d=null){let p;if(u===di)return 5121;if(1017===u)return 32819;if(1018===u)return 32820;if(1010===u)return 5120;if(1011===u)return 5122;if(u===Lt)return 5123;if(1013===u)return 5124;if(1014===u)return 5125;if(u===Sn)return 5126;if(u===En)return o?5131:(p=t.get("OES_texture_half_float"),null!==p?p.HALF_FLOAT_OES:null);if(1021===u)return 6406;if(u===Oi)return 6408;if(1024===u)return 6409;if(1025===u)return 6410;if(u===Un)return 6402;if(u===$e)return 34041;if(1028===u)return 6403;if(1022===u)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===u)return p=t.get("EXT_sRGB"),null!==p?p.SRGB_ALPHA_EXT:null;if(1029===u)return 36244;if(1030===u)return 33319;if(1031===u)return 33320;if(1033===u)return 36249;if(33776===u||33777===u||33778===u||33779===u)if(d===Kn){if(p=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===p)return null;if(33776===u)return p.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===u)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===u)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===u)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(p=t.get("WEBGL_compressed_texture_s3tc"),null===p)return null;if(33776===u)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===u)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===u)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===u)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===u||35841===u||35842===u||35843===u){if(p=t.get("WEBGL_compressed_texture_pvrtc"),null===p)return null;if(35840===u)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===u)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===u)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===u)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===u)return p=t.get("WEBGL_compressed_texture_etc1"),null!==p?p.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===u||37496===u){if(p=t.get("WEBGL_compressed_texture_etc"),null===p)return null;if(37492===u)return d===Kn?p.COMPRESSED_SRGB8_ETC2:p.COMPRESSED_RGB8_ETC2;if(37496===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:p.COMPRESSED_RGBA8_ETC2_EAC}if(37808===u||37809===u||37810===u||37811===u||37812===u||37813===u||37814===u||37815===u||37816===u||37817===u||37818===u||37819===u||37820===u||37821===u){if(p=t.get("WEBGL_compressed_texture_astc"),null===p)return null;if(37808===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:p.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:p.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:p.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:p.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:p.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:p.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:p.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:p.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:p.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:p.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:p.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:p.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:p.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===u)return d===Kn?p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:p.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===u){if(p=t.get("EXT_texture_compression_bptc"),null===p)return null;if(36492===u)return d===Kn?p.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:p.COMPRESSED_RGBA_BPTC_UNORM_EXT}return u===wi?o?34042:(p=t.get("WEBGL_depth_texture"),null!==p?p.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}Ip.prototype.isMeshDistanceMaterial=!0;class jh extends Oo{constructor(t=[]){super(),this.cameras=t}}jh.prototype.isArrayCamera=!0;class tu extends ns{constructor(){super(),this.type="Group"}}tu.prototype.isGroup=!0;const hg={type:"move"};class Bp{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new tu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new tu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ze,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ze),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new tu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ze,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ze),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,i,o){let a=null,u=null,d=null;const p=this._targetRay,v=this._grip,A=this._hand;if(t&&"visible-blurred"!==i.session.visibilityState)if(null!==p&&(a=i.getPose(t.targetRaySpace,o),null!==a&&(p.matrix.fromArray(a.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),a.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(a.linearVelocity)):p.hasLinearVelocity=!1,a.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(a.angularVelocity)):p.hasAngularVelocity=!1,this.dispatchEvent(hg))),A&&t.hand){d=!0;for(const Z of t.hand.values()){const q=i.getJointPose(Z,o);if(void 0===A.joints[Z.jointName]){const ye=new tu;ye.matrixAutoUpdate=!1,ye.visible=!1,A.joints[Z.jointName]=ye,A.add(ye)}const ge=A.joints[Z.jointName];null!==q&&(ge.matrix.fromArray(q.transform.matrix),ge.matrix.decompose(ge.position,ge.rotation,ge.scale),ge.jointRadius=q.radius),ge.visible=null!==q}const N=A.joints["index-finger-tip"].position.distanceTo(A.joints["thumb-tip"].position),j=.02,te=.005;A.inputState.pinching&&N>j+te?(A.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!A.inputState.pinching&&N<=j-te&&(A.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==v&&t.gripSpace&&(u=i.getPose(t.gripSpace,o),null!==u&&(v.matrix.fromArray(u.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),u.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(u.linearVelocity)):v.hasLinearVelocity=!1,u.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(u.angularVelocity)):v.hasAngularVelocity=!1));return null!==p&&(p.visible=null!==a),null!==v&&(v.visible=null!==u),null!==A&&(A.visible=null!==d),this}}class Fp extends as{constructor(t,i,o,a,u,d,p,v,A,P){if((P=void 0!==P?P:Un)!==Un&&P!==$e)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===o&&P===Un&&(o=Lt),void 0===o&&P===$e&&(o=wi),super(null,a,u,d,p,v,P,o,A),this.image={width:t,height:i},this.magFilter=void 0!==p?p:rt,this.minFilter=void 0!==v?v:rt,this.flipY=!1,this.generateMipmaps=!1}}Fp.prototype.isDepthTexture=!0;class Ax extends $a{constructor(t,i){super();const o=this;let a=null,u=1,d=null,p="local-floor",v=null,A=null,P=null,U=null,N=null;const j=i.getContextAttributes();let te=null,Z=null;const q=[],ge=new Map,ye=new Oo;ye.layers.enable(1),ye.viewport=new Oe;const De=new Oo;De.layers.enable(2),De.viewport=new Oe;const Le=[ye,De],Ne=new jh;Ne.layers.enable(1),Ne.layers.enable(2);let tt=null,lt=null;function ct(St){const yn=ge.get(St.inputSource);yn&&yn.dispatchEvent({type:St.type,data:St.inputSource})}function jt(){ge.forEach(function(St,yn){St.disconnect(yn)}),ge.clear(),tt=null,lt=null,t.setRenderTarget(te),U=null,P=null,A=null,a=null,Z=null,Kt.stop(),o.isPresenting=!1,o.dispatchEvent({type:"sessionend"})}function wt(St){const yn=a.inputSources;for(let Mn=0;Mn<q.length;Mn++)ge.set(yn[Mn],q[Mn]);for(let Mn=0;Mn<St.removed.length;Mn++){const jn=St.removed[Mn],Ln=ge.get(jn);Ln&&(Ln.dispatchEvent({type:"disconnected",data:jn}),ge.delete(jn))}for(let Mn=0;Mn<St.added.length;Mn++){const jn=St.added[Mn],Ln=ge.get(jn);Ln&&Ln.dispatchEvent({type:"connected",data:jn})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(St){let yn=q[St];return void 0===yn&&(yn=new Bp,q[St]=yn),yn.getTargetRaySpace()},this.getControllerGrip=function(St){let yn=q[St];return void 0===yn&&(yn=new Bp,q[St]=yn),yn.getGripSpace()},this.getHand=function(St){let yn=q[St];return void 0===yn&&(yn=new Bp,q[St]=yn),yn.getHandSpace()},this.setFramebufferScaleFactor=function(St){u=St,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(St){p=St,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d},this.getBaseLayer=function(){return null!==P?P:U},this.getBinding=function(){return A},this.getFrame=function(){return N},this.getSession=function(){return a},this.setSession=function(){var s,St=(s=function*(yn){if(a=yn,null!==a){if(te=t.getRenderTarget(),a.addEventListener("select",ct),a.addEventListener("selectstart",ct),a.addEventListener("selectend",ct),a.addEventListener("squeeze",ct),a.addEventListener("squeezestart",ct),a.addEventListener("squeezeend",ct),a.addEventListener("end",jt),a.addEventListener("inputsourceschange",wt),!0!==j.xrCompatible&&(yield i.makeXRCompatible()),void 0===a.renderState.layers||!1===t.capabilities.isWebGL2)U=new XRWebGLLayer(a,i,{antialias:void 0!==a.renderState.layers||j.antialias,alpha:j.alpha,depth:j.depth,stencil:j.stencil,framebufferScaleFactor:u}),a.updateRenderState({baseLayer:U}),Z=new Io(U.framebufferWidth,U.framebufferHeight,{format:Oi,type:di,encoding:t.outputEncoding});else{let Mn=null,jn=null,Ln=null;j.depth&&(Ln=j.stencil?35056:33190,Mn=j.stencil?$e:Un,jn=j.stencil?wi:Lt);const zi={colorFormat:t.outputEncoding===Kn?35907:32856,depthFormat:Ln,scaleFactor:u};A=new XRWebGLBinding(a,i),P=A.createProjectionLayer(zi),a.updateRenderState({layers:[P]}),Z=new Io(P.textureWidth,P.textureHeight,{format:Oi,type:di,depthTexture:new Fp(P.textureWidth,P.textureHeight,jn,void 0,void 0,void 0,void 0,void 0,void 0,Mn),stencilBuffer:j.stencil,encoding:t.outputEncoding,samples:j.antialias?4:0}),t.properties.get(Z).__ignoreDepthValues=P.ignoreDepthValues}Z.isXRRenderTarget=!0,this.setFoveation(1),d=yield a.requestReferenceSpace(p),Kt.setContext(a),Kt.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"})}},function(){var t=this,i=arguments;return new Promise(function(o,a){var u=s.apply(t,i);function d(v){xr(u,o,a,d,p,"next",v)}function p(v){xr(u,o,a,d,p,"throw",v)}d(void 0)})});return function(yn){return St.apply(this,arguments)}}();const Ie=new ze,nt=new ze;function Tt(St,yn){null===yn?St.matrixWorld.copy(St.matrix):St.matrixWorld.multiplyMatrices(yn.matrixWorld,St.matrix),St.matrixWorldInverse.copy(St.matrixWorld).invert()}this.updateCamera=function(St){if(null===a)return;Ne.near=De.near=ye.near=St.near,Ne.far=De.far=ye.far=St.far,(tt!==Ne.near||lt!==Ne.far)&&(a.updateRenderState({depthNear:Ne.near,depthFar:Ne.far}),tt=Ne.near,lt=Ne.far);const yn=St.parent,Mn=Ne.cameras;Tt(Ne,yn);for(let Ln=0;Ln<Mn.length;Ln++)Tt(Mn[Ln],yn);Ne.matrixWorld.decompose(Ne.position,Ne.quaternion,Ne.scale),St.position.copy(Ne.position),St.quaternion.copy(Ne.quaternion),St.scale.copy(Ne.scale),St.matrix.copy(Ne.matrix),St.matrixWorld.copy(Ne.matrixWorld);const jn=St.children;for(let Ln=0,zi=jn.length;Ln<zi;Ln++)jn[Ln].updateMatrixWorld(!0);2===Mn.length?function(St,yn,Mn){Ie.setFromMatrixPosition(yn.matrixWorld),nt.setFromMatrixPosition(Mn.matrixWorld);const jn=Ie.distanceTo(nt),Ln=yn.projectionMatrix.elements,zi=Mn.projectionMatrix.elements,Vr=Ln[14]/(Ln[10]-1),yr=Ln[14]/(Ln[10]+1),pn=(Ln[9]+1)/Ln[5],xs=(Ln[9]-1)/Ln[5],Ir=(Ln[8]-1)/Ln[0],Br=(zi[8]+1)/zi[0],ei=Vr*Ir,Qr=Vr*Br,ln=jn/(-Ir+Br),xn=ln*-Ir;yn.matrixWorld.decompose(St.position,St.quaternion,St.scale),St.translateX(xn),St.translateZ(ln),St.matrixWorld.compose(St.position,St.quaternion,St.scale),St.matrixWorldInverse.copy(St.matrixWorld).invert();const Wn=Vr+ln,Ii=yr+ln;St.projectionMatrix.makePerspective(ei-xn,Qr+(jn-xn),pn*yr/Ii*Wn,xs*yr/Ii*Wn,Wn,Ii)}(Ne,ye,De):Ne.projectionMatrix.copy(ye.projectionMatrix)},this.getCamera=function(){return Ne},this.getFoveation=function(){return null!==P?P.fixedFoveation:null!==U?U.fixedFoveation:void 0},this.setFoveation=function(St){null!==P&&(P.fixedFoveation=St),null!==U&&void 0!==U.fixedFoveation&&(U.fixedFoveation=St)};let Yt=null;const Kt=new qm;Kt.setAnimationLoop(function(St,yn){if(v=yn.getViewerPose(d),N=yn,null!==v){const jn=v.views;null!==U&&(t.setRenderTargetFramebuffer(Z,U.framebuffer),t.setRenderTarget(Z));let Ln=!1;jn.length!==Ne.cameras.length&&(Ne.cameras.length=0,Ln=!0);for(let zi=0;zi<jn.length;zi++){const Vr=jn[zi];let yr=null;if(null!==U)yr=U.getViewport(Vr);else{const xs=A.getViewSubImage(P,Vr);yr=xs.viewport,0===zi&&(t.setRenderTargetTextures(Z,xs.colorTexture,P.ignoreDepthValues?void 0:xs.depthStencilTexture),t.setRenderTarget(Z))}const pn=Le[zi];pn.matrix.fromArray(Vr.transform.matrix),pn.projectionMatrix.fromArray(Vr.projectionMatrix),pn.viewport.set(yr.x,yr.y,yr.width,yr.height),0===zi&&Ne.matrix.copy(pn.matrix),!0===Ln&&Ne.cameras.push(pn)}}const Mn=a.inputSources;for(let jn=0;jn<q.length;jn++)q[jn].update(Mn[jn],yn,d);Yt&&Yt(St,yn),N=null}),this.setAnimationLoop=function(St){Yt=St},this.dispose=function(){}}}function Op(s,t){function a(Z,q){Z.opacity.value=q.opacity,q.color&&Z.diffuse.value.copy(q.color),q.emissive&&Z.emissive.value.copy(q.emissive).multiplyScalar(q.emissiveIntensity),q.map&&(Z.map.value=q.map),q.alphaMap&&(Z.alphaMap.value=q.alphaMap),q.bumpMap&&(Z.bumpMap.value=q.bumpMap,Z.bumpScale.value=q.bumpScale,1===q.side&&(Z.bumpScale.value*=-1)),q.displacementMap&&(Z.displacementMap.value=q.displacementMap,Z.displacementScale.value=q.displacementScale,Z.displacementBias.value=q.displacementBias),q.emissiveMap&&(Z.emissiveMap.value=q.emissiveMap),q.normalMap&&(Z.normalMap.value=q.normalMap,Z.normalScale.value.copy(q.normalScale),1===q.side&&Z.normalScale.value.negate()),q.specularMap&&(Z.specularMap.value=q.specularMap),q.alphaTest>0&&(Z.alphaTest.value=q.alphaTest);const ge=t.get(q).envMap;if(ge&&(Z.envMap.value=ge,Z.flipEnvMap.value=ge.isCubeTexture&&!1===ge.isRenderTargetTexture?-1:1,Z.reflectivity.value=q.reflectivity,Z.ior.value=q.ior,Z.refractionRatio.value=q.refractionRatio),q.lightMap){Z.lightMap.value=q.lightMap;const Le=!0!==s.physicallyCorrectLights?Math.PI:1;Z.lightMapIntensity.value=q.lightMapIntensity*Le}let ye,De;q.aoMap&&(Z.aoMap.value=q.aoMap,Z.aoMapIntensity.value=q.aoMapIntensity),q.map?ye=q.map:q.specularMap?ye=q.specularMap:q.displacementMap?ye=q.displacementMap:q.normalMap?ye=q.normalMap:q.bumpMap?ye=q.bumpMap:q.roughnessMap?ye=q.roughnessMap:q.metalnessMap?ye=q.metalnessMap:q.alphaMap?ye=q.alphaMap:q.emissiveMap?ye=q.emissiveMap:q.clearcoatMap?ye=q.clearcoatMap:q.clearcoatNormalMap?ye=q.clearcoatNormalMap:q.clearcoatRoughnessMap?ye=q.clearcoatRoughnessMap:q.specularIntensityMap?ye=q.specularIntensityMap:q.specularColorMap?ye=q.specularColorMap:q.transmissionMap?ye=q.transmissionMap:q.thicknessMap?ye=q.thicknessMap:q.sheenColorMap?ye=q.sheenColorMap:q.sheenRoughnessMap&&(ye=q.sheenRoughnessMap),void 0!==ye&&(ye.isWebGLRenderTarget&&(ye=ye.texture),!0===ye.matrixAutoUpdate&&ye.updateMatrix(),Z.uvTransform.value.copy(ye.matrix)),q.aoMap?De=q.aoMap:q.lightMap&&(De=q.lightMap),void 0!==De&&(De.isWebGLRenderTarget&&(De=De.texture),!0===De.matrixAutoUpdate&&De.updateMatrix(),Z.uv2Transform.value.copy(De.matrix))}return{refreshFogUniforms:function(Z,q){Z.fogColor.value.copy(q.color),q.isFog?(Z.fogNear.value=q.near,Z.fogFar.value=q.far):q.isFogExp2&&(Z.fogDensity.value=q.density)},refreshMaterialUniforms:function(Z,q,ge,ye,De){q.isMeshBasicMaterial||q.isMeshLambertMaterial?a(Z,q):q.isMeshToonMaterial?(a(Z,q),function(Z,q){q.gradientMap&&(Z.gradientMap.value=q.gradientMap)}(Z,q)):q.isMeshPhongMaterial?(a(Z,q),function(Z,q){Z.specular.value.copy(q.specular),Z.shininess.value=Math.max(q.shininess,1e-4)}(Z,q)):q.isMeshStandardMaterial?(a(Z,q),function(Z,q){Z.roughness.value=q.roughness,Z.metalness.value=q.metalness,q.roughnessMap&&(Z.roughnessMap.value=q.roughnessMap),q.metalnessMap&&(Z.metalnessMap.value=q.metalnessMap),t.get(q).envMap&&(Z.envMapIntensity.value=q.envMapIntensity)}(Z,q),q.isMeshPhysicalMaterial&&function(Z,q,ge){Z.ior.value=q.ior,q.sheen>0&&(Z.sheenColor.value.copy(q.sheenColor).multiplyScalar(q.sheen),Z.sheenRoughness.value=q.sheenRoughness,q.sheenColorMap&&(Z.sheenColorMap.value=q.sheenColorMap),q.sheenRoughnessMap&&(Z.sheenRoughnessMap.value=q.sheenRoughnessMap)),q.clearcoat>0&&(Z.clearcoat.value=q.clearcoat,Z.clearcoatRoughness.value=q.clearcoatRoughness,q.clearcoatMap&&(Z.clearcoatMap.value=q.clearcoatMap),q.clearcoatRoughnessMap&&(Z.clearcoatRoughnessMap.value=q.clearcoatRoughnessMap),q.clearcoatNormalMap&&(Z.clearcoatNormalScale.value.copy(q.clearcoatNormalScale),Z.clearcoatNormalMap.value=q.clearcoatNormalMap,1===q.side&&Z.clearcoatNormalScale.value.negate())),q.transmission>0&&(Z.transmission.value=q.transmission,Z.transmissionSamplerMap.value=ge.texture,Z.transmissionSamplerSize.value.set(ge.width,ge.height),q.transmissionMap&&(Z.transmissionMap.value=q.transmissionMap),Z.thickness.value=q.thickness,q.thicknessMap&&(Z.thicknessMap.value=q.thicknessMap),Z.attenuationDistance.value=q.attenuationDistance,Z.attenuationColor.value.copy(q.attenuationColor)),Z.specularIntensity.value=q.specularIntensity,Z.specularColor.value.copy(q.specularColor),q.specularIntensityMap&&(Z.specularIntensityMap.value=q.specularIntensityMap),q.specularColorMap&&(Z.specularColorMap.value=q.specularColorMap)}(Z,q,De)):q.isMeshMatcapMaterial?(a(Z,q),function(Z,q){q.matcap&&(Z.matcap.value=q.matcap)}(Z,q)):q.isMeshDepthMaterial?a(Z,q):q.isMeshDistanceMaterial?(a(Z,q),function(Z,q){Z.referencePosition.value.copy(q.referencePosition),Z.nearDistance.value=q.nearDistance,Z.farDistance.value=q.farDistance}(Z,q)):q.isMeshNormalMaterial?a(Z,q):q.isLineBasicMaterial?(function(Z,q){Z.diffuse.value.copy(q.color),Z.opacity.value=q.opacity}(Z,q),q.isLineDashedMaterial&&function(Z,q){Z.dashSize.value=q.dashSize,Z.totalSize.value=q.dashSize+q.gapSize,Z.scale.value=q.scale}(Z,q)):q.isPointsMaterial?function(Z,q,ge,ye){let De;Z.diffuse.value.copy(q.color),Z.opacity.value=q.opacity,Z.size.value=q.size*ge,Z.scale.value=.5*ye,q.map&&(Z.map.value=q.map),q.alphaMap&&(Z.alphaMap.value=q.alphaMap),q.alphaTest>0&&(Z.alphaTest.value=q.alphaTest),q.map?De=q.map:q.alphaMap&&(De=q.alphaMap),void 0!==De&&(!0===De.matrixAutoUpdate&&De.updateMatrix(),Z.uvTransform.value.copy(De.matrix))}(Z,q,ge,ye):q.isSpriteMaterial?function(Z,q){let ge;Z.diffuse.value.copy(q.color),Z.opacity.value=q.opacity,Z.rotation.value=q.rotation,q.map&&(Z.map.value=q.map),q.alphaMap&&(Z.alphaMap.value=q.alphaMap),q.alphaTest>0&&(Z.alphaTest.value=q.alphaTest),q.map?ge=q.map:q.alphaMap&&(ge=q.alphaMap),void 0!==ge&&(!0===ge.matrixAutoUpdate&&ge.updateMatrix(),Z.uvTransform.value.copy(ge.matrix))}(Z,q):q.isShadowMaterial?(Z.color.value.copy(q.color),Z.opacity.value=q.opacity):q.isShaderMaterial&&(q.uniformsNeedUpdate=!1)}}}function vs(s={}){const t=void 0!==s.canvas?s.canvas:function(){const s=_l("canvas");return s.style.display="block",s}(),i=void 0!==s.context?s.context:null,o=void 0===s.depth||s.depth,a=void 0===s.stencil||s.stencil,u=void 0!==s.antialias&&s.antialias,d=void 0===s.premultipliedAlpha||s.premultipliedAlpha,p=void 0!==s.preserveDrawingBuffer&&s.preserveDrawingBuffer,v=void 0!==s.powerPreference?s.powerPreference:"default",A=void 0!==s.failIfMajorPerformanceCaveat&&s.failIfMajorPerformanceCaveat;let P;P=void 0!==s.context?i.getContextAttributes().alpha:void 0!==s.alpha&&s.alpha;let U=null,N=null;const j=[],te=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ui,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const Z=this;let q=!1,ge=0,ye=0,De=null,Le=-1,Ne=null;const tt=new Oe,lt=new Oe;let ct=null,jt=t.width,wt=t.height,Ie=1,nt=null,wn=null;const Tt=new Oe(0,0,jt,wt),Yt=new Oe(0,0,jt,wt);let Wt=!1;const Kt=new qd;let St=!1,yn=!1,Mn=null;const jn=new _i,Ln=new st,zi=new ze,Vr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function yr(){return null===De?Ie:1}let Ir,Br,ei,Qr,ln,xn,Wn,Ii,mi,Cr,lr,$i,uo,Ns,Je,We,qt,In,hi,bi,or,Jt,Fr,pn=i;function xs(qe,kt){for(let Zt=0;Zt<qe.length;Zt++){const vn=t.getContext(qe[Zt],kt);if(null!==vn)return vn}return null}try{const qe={alpha:!0,depth:o,stencil:a,antialias:u,premultipliedAlpha:d,preserveDrawingBuffer:p,powerPreference:v,failIfMajorPerformanceCaveat:A};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r139"),t.addEventListener("webglcontextlost",pt,!1),t.addEventListener("webglcontextrestored",oi,!1),null===pn){const kt=["webgl2","webgl","experimental-webgl"];if(!0===Z.isWebGL1Renderer&&kt.shift(),pn=xs(kt,qe),null===pn)throw xs(kt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===pn.getShaderPrecisionFormat&&(pn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(qe){throw console.error("THREE.WebGLRenderer: "+qe.message),qe}function Wr(){Ir=new q0(pn),Br=new Jm(pn,Ir,s),Ir.init(Br),Jt=new wc(pn,Ir,Br),ei=new xx(pn,Ir,Br),Qr=new J0(pn),ln=new dx,xn=new ug(pn,Ir,ei,ln,Br,Jt,Qr),Wn=new lp(Z),Ii=new Z0(Z),mi=new lv(pn,Br),Fr=new sl(pn,Ir,mi,Br),Cr=new K0(pn,mi,Qr,Fr),lr=new dp(pn,Cr,mi,Qr),hi=new ey(pn,Br,xn),We=new ju(ln),$i=new hx(Z,Wn,Ii,Ir,Br,Fr,We),uo=new Op(Z,ln),Ns=new fx,Je=new ef(Ir,Br),In=new vc(Z,Wn,ei,lr,P,d),qt=new cg(Z,lr,Br),bi=new Km(pn,Ir,Qr,Br),or=new $d(pn,Ir,Qr,Br),Qr.programs=$i.programs,Z.capabilities=Br,Z.extensions=Ir,Z.properties=ln,Z.renderLists=Ns,Z.shadowMap=qt,Z.state=ei,Z.info=Qr}Wr();const Bi=new Ax(Z,pn);function pt(qe){qe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),q=!0}function oi(){console.log("THREE.WebGLRenderer: Context Restored."),q=!1;const qe=Qr.autoReset,kt=qt.enabled,Zt=qt.autoUpdate,Xt=qt.needsUpdate,vn=qt.type;Wr(),Qr.autoReset=qe,qt.enabled=kt,qt.autoUpdate=Zt,qt.needsUpdate=Xt,qt.type=vn}function ii(qe){const kt=qe.target;kt.removeEventListener("dispose",ii),function(qe){(function(qe){const kt=ln.get(qe).programs;void 0!==kt&&(kt.forEach(function(Zt){$i.releaseProgram(Zt)}),qe.isShaderMaterial&&$i.releaseShaderCache(qe))})(qe),ln.remove(qe)}(kt)}this.xr=Bi,this.getContext=function(){return pn},this.getContextAttributes=function(){return pn.getContextAttributes()},this.forceContextLoss=function(){const qe=Ir.get("WEBGL_lose_context");qe&&qe.loseContext()},this.forceContextRestore=function(){const qe=Ir.get("WEBGL_lose_context");qe&&qe.restoreContext()},this.getPixelRatio=function(){return Ie},this.setPixelRatio=function(qe){void 0!==qe&&(Ie=qe,this.setSize(jt,wt,!1))},this.getSize=function(qe){return qe.set(jt,wt)},this.setSize=function(qe,kt,Zt){Bi.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(jt=qe,wt=kt,t.width=Math.floor(qe*Ie),t.height=Math.floor(kt*Ie),!1!==Zt&&(t.style.width=qe+"px",t.style.height=kt+"px"),this.setViewport(0,0,qe,kt))},this.getDrawingBufferSize=function(qe){return qe.set(jt*Ie,wt*Ie).floor()},this.setDrawingBufferSize=function(qe,kt,Zt){jt=qe,wt=kt,Ie=Zt,t.width=Math.floor(qe*Zt),t.height=Math.floor(kt*Zt),this.setViewport(0,0,qe,kt)},this.getCurrentViewport=function(qe){return qe.copy(tt)},this.getViewport=function(qe){return qe.copy(Tt)},this.setViewport=function(qe,kt,Zt,Xt){qe.isVector4?Tt.set(qe.x,qe.y,qe.z,qe.w):Tt.set(qe,kt,Zt,Xt),ei.viewport(tt.copy(Tt).multiplyScalar(Ie).floor())},this.getScissor=function(qe){return qe.copy(Yt)},this.setScissor=function(qe,kt,Zt,Xt){qe.isVector4?Yt.set(qe.x,qe.y,qe.z,qe.w):Yt.set(qe,kt,Zt,Xt),ei.scissor(lt.copy(Yt).multiplyScalar(Ie).floor())},this.getScissorTest=function(){return Wt},this.setScissorTest=function(qe){ei.setScissorTest(Wt=qe)},this.setOpaqueSort=function(qe){nt=qe},this.setTransparentSort=function(qe){wn=qe},this.getClearColor=function(qe){return qe.copy(In.getClearColor())},this.setClearColor=function(){In.setClearColor.apply(In,arguments)},this.getClearAlpha=function(){return In.getClearAlpha()},this.setClearAlpha=function(){In.setClearAlpha.apply(In,arguments)},this.clear=function(qe=!0,kt=!0,Zt=!0){let Xt=0;qe&&(Xt|=16384),kt&&(Xt|=256),Zt&&(Xt|=1024),pn.clear(Xt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pt,!1),t.removeEventListener("webglcontextrestored",oi,!1),Ns.dispose(),Je.dispose(),ln.dispose(),Wn.dispose(),Ii.dispose(),lr.dispose(),Fr.dispose(),$i.dispose(),Bi.dispose(),Bi.removeEventListener("sessionstart",Mr),Bi.removeEventListener("sessionend",Ks),Mn&&(Mn.dispose(),Mn=null),ss.stop()},this.renderBufferDirect=function(qe,kt,Zt,Xt,vn,vr){null===kt&&(kt=Vr);const Rr=vn.isMesh&&vn.matrixWorld.determinant()<0,Xr=function(qe,kt,Zt,Xt,vn){!0!==kt.isScene&&(kt=Vr),xn.resetTextureUnits();const vr=kt.fog,Xr=null===De?Z.outputEncoding:!0===De.isXRRenderTarget?De.texture.encoding:Ui,Nr=(Xt.isMeshStandardMaterial?Ii:Wn).get(Xt.envMap||(Xt.isMeshStandardMaterial?kt.environment:null)),Ts=!0===Xt.vertexColors&&!!Zt.attributes.color&&4===Zt.attributes.color.itemSize,hs=!!Xt.normalMap&&!!Zt.attributes.tangent,ps=!!Zt.morphAttributes.position,Ao=!!Zt.morphAttributes.normal,Bd=!!Zt.morphAttributes.color,Zf=Xt.toneMapped?Z.toneMapping:0,qf=Zt.morphAttributes.position||Zt.morphAttributes.normal||Zt.morphAttributes.color,Hc=void 0!==qf?qf.length:0,As=ln.get(Xt),Kf=N.state.lights;!0!==St||!0!==yn&&qe===Ne||We.setState(Xt,qe,qe===Ne&&Xt.id===Le);let Do=!1;Xt.version===As.__version?(As.needsLights&&As.lightsStateVersion!==Kf.state.version||As.outputEncoding!==Xr||vn.isInstancedMesh&&!1===As.instancing||!vn.isInstancedMesh&&!0===As.instancing||vn.isSkinnedMesh&&!1===As.skinning||!vn.isSkinnedMesh&&!0===As.skinning||As.envMap!==Nr||Xt.fog&&As.fog!==vr||void 0!==As.numClippingPlanes&&(As.numClippingPlanes!==We.numPlanes||As.numIntersection!==We.numIntersection)||As.vertexAlphas!==Ts||As.vertexTangents!==hs||As.morphTargets!==ps||As.morphNormals!==Ao||As.morphColors!==Bd||As.toneMapping!==Zf||!0===Br.isWebGL2&&As.morphTargetsCount!==Hc)&&(Do=!0):(Do=!0,As.__version=Xt.version);let Gc=As.currentProgram;!0===Do&&(Gc=gA(Xt,kt,vn));let _h=!1,Gm=!1,vA=!1;const sa=Gc.getUniforms(),zm=As.uniforms;if(ei.useProgram(Gc.program)&&(_h=!0,Gm=!0,vA=!0),Xt.id!==Le&&(Le=Xt.id,Gm=!0),_h||Ne!==qe){if(sa.setValue(pn,"projectionMatrix",qe.projectionMatrix),Br.logarithmicDepthBuffer&&sa.setValue(pn,"logDepthBufFC",2/(Math.log(qe.far+1)/Math.LN2)),Ne!==qe&&(Ne=qe,Gm=!0,vA=!0),Xt.isShaderMaterial||Xt.isMeshPhongMaterial||Xt.isMeshToonMaterial||Xt.isMeshStandardMaterial||Xt.envMap){const oc=sa.map.cameraPosition;void 0!==oc&&oc.setValue(pn,zi.setFromMatrixPosition(qe.matrixWorld))}(Xt.isMeshPhongMaterial||Xt.isMeshToonMaterial||Xt.isMeshLambertMaterial||Xt.isMeshBasicMaterial||Xt.isMeshStandardMaterial||Xt.isShaderMaterial)&&sa.setValue(pn,"isOrthographic",!0===qe.isOrthographicCamera),(Xt.isMeshPhongMaterial||Xt.isMeshToonMaterial||Xt.isMeshLambertMaterial||Xt.isMeshBasicMaterial||Xt.isMeshStandardMaterial||Xt.isShaderMaterial||Xt.isShadowMaterial||vn.isSkinnedMesh)&&sa.setValue(pn,"viewMatrix",qe.matrixWorldInverse)}if(vn.isSkinnedMesh){sa.setOptional(pn,vn,"bindMatrix"),sa.setOptional(pn,vn,"bindMatrixInverse");const oc=vn.skeleton;oc&&(Br.floatVertexTextures?(null===oc.boneTexture&&oc.computeBoneTexture(),sa.setValue(pn,"boneTexture",oc.boneTexture,xn),sa.setValue(pn,"boneTextureSize",oc.boneTextureSize)):sa.setOptional(pn,oc,"boneMatrices"))}const yA=Zt.morphAttributes;return(void 0!==yA.position||void 0!==yA.normal||void 0!==yA.color&&!0===Br.isWebGL2)&&hi.update(vn,Zt,Xt,Gc),(Gm||As.receiveShadow!==vn.receiveShadow)&&(As.receiveShadow=vn.receiveShadow,sa.setValue(pn,"receiveShadow",vn.receiveShadow)),Gm&&(sa.setValue(pn,"toneMappingExposure",Z.toneMappingExposure),As.needsLights&&function(qe,kt){qe.ambientLightColor.needsUpdate=kt,qe.lightProbe.needsUpdate=kt,qe.directionalLights.needsUpdate=kt,qe.directionalLightShadows.needsUpdate=kt,qe.pointLights.needsUpdate=kt,qe.pointLightShadows.needsUpdate=kt,qe.spotLights.needsUpdate=kt,qe.spotLightShadows.needsUpdate=kt,qe.rectAreaLights.needsUpdate=kt,qe.hemisphereLights.needsUpdate=kt}(zm,vA),vr&&Xt.fog&&uo.refreshFogUniforms(zm,vr),uo.refreshMaterialUniforms(zm,Xt,Ie,wt,Mn),Zo.upload(pn,As.uniformsList,zm,xn)),Xt.isShaderMaterial&&!0===Xt.uniformsNeedUpdate&&(Zo.upload(pn,As.uniformsList,zm,xn),Xt.uniformsNeedUpdate=!1),Xt.isSpriteMaterial&&sa.setValue(pn,"center",vn.center),sa.setValue(pn,"modelViewMatrix",vn.modelViewMatrix),sa.setValue(pn,"normalMatrix",vn.normalMatrix),sa.setValue(pn,"modelMatrix",vn.matrixWorld),Gc}(qe,kt,Zt,Xt,vn);ei.setMaterial(Xt,Rr);let Nr=Zt.index;const Ts=Zt.attributes.position;if(null===Nr){if(void 0===Ts||0===Ts.count)return}else if(0===Nr.count)return;let hs=1;!0===Xt.wireframe&&(Nr=Cr.getWireframeAttribute(Zt),hs=2),Fr.setup(vn,Xt,Xr,Zt,Nr);let ps,Ao=bi;null!==Nr&&(ps=mi.get(Nr),Ao=or,Ao.setIndex(ps));const Bd=null!==Nr?Nr.count:Ts.count,Zf=Zt.drawRange.start*hs,qf=Zt.drawRange.count*hs,Hc=null!==vr?vr.start*hs:0,As=null!==vr?vr.count*hs:1/0,Kf=Math.max(Zf,Hc),Do=Math.min(Bd,Zf+qf,Hc+As)-1,Gc=Math.max(0,Do-Kf+1);if(0!==Gc){if(vn.isMesh)!0===Xt.wireframe?(ei.setLineWidth(Xt.wireframeLinewidth*yr()),Ao.setMode(1)):Ao.setMode(4);else if(vn.isLine){let _h=Xt.linewidth;void 0===_h&&(_h=1),ei.setLineWidth(_h*yr()),Ao.setMode(vn.isLineSegments?1:vn.isLineLoop?2:3)}else vn.isPoints?Ao.setMode(0):vn.isSprite&&Ao.setMode(4);if(vn.isInstancedMesh)Ao.renderInstances(Kf,Gc,vn.count);else if(Zt.isInstancedBufferGeometry){const _h=Math.min(Zt.instanceCount,Zt._maxInstanceCount);Ao.renderInstances(Kf,Gc,_h)}else Ao.render(Kf,Gc)}},this.compile=function(qe,kt){N=Je.get(qe),N.init(),te.push(N),qe.traverseVisible(function(Zt){Zt.isLight&&Zt.layers.test(kt.layers)&&(N.pushLight(Zt),Zt.castShadow&&N.pushShadow(Zt))}),N.setupLights(Z.physicallyCorrectLights),qe.traverse(function(Zt){const Xt=Zt.material;if(Xt)if(Array.isArray(Xt))for(let vn=0;vn<Xt.length;vn++)gA(Xt[vn],qe,Zt);else gA(Xt,qe,Zt)}),te.pop(),N=null};let gr=null;function Mr(){ss.stop()}function Ks(){ss.start()}const ss=new qm;function Nc(qe,kt,Zt,Xt){if(!1===qe.visible)return;if(qe.layers.test(kt.layers))if(qe.isGroup)Zt=qe.renderOrder;else if(qe.isLOD)!0===qe.autoUpdate&&qe.update(kt);else if(qe.isLight)N.pushLight(qe),qe.castShadow&&N.pushShadow(qe);else if(qe.isSprite){if(!qe.frustumCulled||Kt.intersectsSprite(qe)){Xt&&zi.setFromMatrixPosition(qe.matrixWorld).applyMatrix4(jn);const Rr=lr.update(qe),Xr=qe.material;Xr.visible&&U.push(qe,Rr,Xr,Zt,zi.z,null)}}else if((qe.isMesh||qe.isLine||qe.isPoints)&&(qe.isSkinnedMesh&&qe.skeleton.frame!==Qr.render.frame&&(qe.skeleton.update(),qe.skeleton.frame=Qr.render.frame),!qe.frustumCulled||Kt.intersectsObject(qe))){Xt&&zi.setFromMatrixPosition(qe.matrixWorld).applyMatrix4(jn);const Rr=lr.update(qe),Xr=qe.material;if(Array.isArray(Xr)){const Nr=Rr.groups;for(let Ts=0,hs=Nr.length;Ts<hs;Ts++){const ps=Nr[Ts],Ao=Xr[ps.materialIndex];Ao&&Ao.visible&&U.push(qe,Rr,Ao,Zt,zi.z,ps)}}else Xr.visible&&U.push(qe,Rr,Xr,Zt,zi.z,null)}const vr=qe.children;for(let Rr=0,Xr=vr.length;Rr<Xr;Rr++)Nc(vr[Rr],kt,Zt,Xt)}function kc(qe,kt,Zt,Xt){const vn=qe.opaque,vr=qe.transmissive,Rr=qe.transparent;N.setupLightsView(Zt),vr.length>0&&function(qe,kt,Zt){const Xt=Br.isWebGL2;null===Mn&&(Mn=new Io(1,1,{generateMipmaps:!0,type:null!==Jt.convert(En)?En:di,minFilter:1008,samples:Xt&&!0===u?4:0})),Z.getDrawingBufferSize(Ln),Xt?Mn.setSize(Ln.x,Ln.y):Mn.setSize(Pu(Ln.x),Pu(Ln.y));const vn=Z.getRenderTarget();Z.setRenderTarget(Mn),Z.clear();const vr=Z.toneMapping;Z.toneMapping=0,Xg(qe,kt,Zt),Z.toneMapping=vr,xn.updateMultisampleRenderTarget(Mn),xn.updateRenderTargetMipmap(Mn),Z.setRenderTarget(vn)}(vn,kt,Zt),Xt&&ei.viewport(tt.copy(Xt)),vn.length>0&&Xg(vn,kt,Zt),vr.length>0&&Xg(vr,kt,Zt),Rr.length>0&&Xg(Rr,kt,Zt),ei.buffers.depth.setTest(!0),ei.buffers.depth.setMask(!0),ei.buffers.color.setMask(!0),ei.setPolygonOffset(!1)}function Xg(qe,kt,Zt){const Xt=!0===kt.isScene?kt.overrideMaterial:null;for(let vn=0,vr=qe.length;vn<vr;vn++){const Rr=qe[vn],Xr=Rr.object,Nr=Rr.geometry,Ts=null===Xt?Rr.material:Xt,hs=Rr.group;Xr.layers.test(Zt.layers)&&M1(Xr,kt,Zt,Nr,Ts,hs)}}function M1(qe,kt,Zt,Xt,vn,vr){qe.onBeforeRender(Z,kt,Zt,Xt,vn,vr),qe.modelViewMatrix.multiplyMatrices(Zt.matrixWorldInverse,qe.matrixWorld),qe.normalMatrix.getNormalMatrix(qe.modelViewMatrix),vn.onBeforeRender(Z,kt,Zt,Xt,qe,vr),!0===vn.transparent&&2===vn.side?(vn.side=1,vn.needsUpdate=!0,Z.renderBufferDirect(Zt,kt,Xt,vn,qe,vr),vn.side=0,vn.needsUpdate=!0,Z.renderBufferDirect(Zt,kt,Xt,vn,qe,vr),vn.side=2):Z.renderBufferDirect(Zt,kt,Xt,vn,qe,vr),qe.onAfterRender(Z,kt,Zt,Xt,vn,vr)}function gA(qe,kt,Zt){!0!==kt.isScene&&(kt=Vr);const Xt=ln.get(qe),vn=N.state.lights,Rr=vn.state.version,Xr=$i.getParameters(qe,vn.state,N.state.shadowsArray,kt,Zt),Nr=$i.getProgramCacheKey(Xr);let Ts=Xt.programs;Xt.environment=qe.isMeshStandardMaterial?kt.environment:null,Xt.fog=kt.fog,Xt.envMap=(qe.isMeshStandardMaterial?Ii:Wn).get(qe.envMap||Xt.environment),void 0===Ts&&(qe.addEventListener("dispose",ii),Ts=new Map,Xt.programs=Ts);let hs=Ts.get(Nr);if(void 0!==hs){if(Xt.currentProgram===hs&&Xt.lightsStateVersion===Rr)return Xb(qe,Xr),hs}else Xr.uniforms=$i.getUniforms(qe),qe.onBuild(Zt,Xr,Z),qe.onBeforeCompile(Xr,Z),hs=$i.acquireProgram(Xr,Nr),Ts.set(Nr,hs),Xt.uniforms=Xr.uniforms;const ps=Xt.uniforms;(!qe.isShaderMaterial&&!qe.isRawShaderMaterial||!0===qe.clipping)&&(ps.clippingPlanes=We.uniform),Xb(qe,Xr),Xt.needsLights=function(qe){return qe.isMeshLambertMaterial||qe.isMeshToonMaterial||qe.isMeshPhongMaterial||qe.isMeshStandardMaterial||qe.isShadowMaterial||qe.isShaderMaterial&&!0===qe.lights}(qe),Xt.lightsStateVersion=Rr,Xt.needsLights&&(ps.ambientLightColor.value=vn.state.ambient,ps.lightProbe.value=vn.state.probe,ps.directionalLights.value=vn.state.directional,ps.directionalLightShadows.value=vn.state.directionalShadow,ps.spotLights.value=vn.state.spot,ps.spotLightShadows.value=vn.state.spotShadow,ps.rectAreaLights.value=vn.state.rectArea,ps.ltc_1.value=vn.state.rectAreaLTC1,ps.ltc_2.value=vn.state.rectAreaLTC2,ps.pointLights.value=vn.state.point,ps.pointLightShadows.value=vn.state.pointShadow,ps.hemisphereLights.value=vn.state.hemi,ps.directionalShadowMap.value=vn.state.directionalShadowMap,ps.directionalShadowMatrix.value=vn.state.directionalShadowMatrix,ps.spotShadowMap.value=vn.state.spotShadowMap,ps.spotShadowMatrix.value=vn.state.spotShadowMatrix,ps.pointShadowMap.value=vn.state.pointShadowMap,ps.pointShadowMatrix.value=vn.state.pointShadowMatrix);const Ao=hs.getUniforms(),Bd=Zo.seqWithValue(Ao.seq,ps);return Xt.currentProgram=hs,Xt.uniformsList=Bd,hs}function Xb(qe,kt){const Zt=ln.get(qe);Zt.outputEncoding=kt.outputEncoding,Zt.instancing=kt.instancing,Zt.skinning=kt.skinning,Zt.morphTargets=kt.morphTargets,Zt.morphNormals=kt.morphNormals,Zt.morphColors=kt.morphColors,Zt.morphTargetsCount=kt.morphTargetsCount,Zt.numClippingPlanes=kt.numClippingPlanes,Zt.numIntersection=kt.numClipIntersection,Zt.vertexAlphas=kt.vertexAlphas,Zt.vertexTangents=kt.vertexTangents,Zt.toneMapping=kt.toneMapping}ss.setAnimationLoop(function(qe){gr&&gr(qe)}),"undefined"!=typeof self&&ss.setContext(self),this.setAnimationLoop=function(qe){gr=qe,Bi.setAnimationLoop(qe),null===qe?ss.stop():ss.start()},Bi.addEventListener("sessionstart",Mr),Bi.addEventListener("sessionend",Ks),this.render=function(qe,kt){if(void 0===kt||!0===kt.isCamera){if(!0!==q){if(!0===qe.autoUpdate&&qe.updateMatrixWorld(),null===kt.parent&&kt.updateMatrixWorld(),!0===Bi.enabled&&!0===Bi.isPresenting&&(!0===Bi.cameraAutoUpdate&&Bi.updateCamera(kt),kt=Bi.getCamera()),!0===qe.isScene&&qe.onBeforeRender(Z,qe,kt,De),N=Je.get(qe,te.length),N.init(),te.push(N),jn.multiplyMatrices(kt.projectionMatrix,kt.matrixWorldInverse),Kt.setFromProjectionMatrix(jn),yn=this.localClippingEnabled,St=We.init(this.clippingPlanes,yn,kt),U=Ns.get(qe,j.length),U.init(),j.push(U),Nc(qe,kt,0,Z.sortObjects),U.finish(),!0===Z.sortObjects&&U.sort(nt,wn),!0===St&&We.beginShadows(),qt.render(N.state.shadowsArray,qe,kt),!0===St&&We.endShadows(),!0===this.info.autoReset&&this.info.reset(),In.render(U,qe),N.setupLights(Z.physicallyCorrectLights),kt.isArrayCamera){const Xt=kt.cameras;for(let vn=0,vr=Xt.length;vn<vr;vn++){const Rr=Xt[vn];kc(U,qe,Rr,Rr.viewport)}}else kc(U,qe,kt);null!==De&&(xn.updateMultisampleRenderTarget(De),xn.updateRenderTargetMipmap(De)),!0===qe.isScene&&qe.onAfterRender(Z,qe,kt),Fr.resetDefaultState(),Le=-1,Ne=null,te.pop(),N=te.length>0?te[te.length-1]:null,j.pop(),U=j.length>0?j[j.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ge},this.getActiveMipmapLevel=function(){return ye},this.getRenderTarget=function(){return De},this.setRenderTargetTextures=function(qe,kt,Zt){ln.get(qe.texture).__webglTexture=kt,ln.get(qe.depthTexture).__webglTexture=Zt;const Xt=ln.get(qe);Xt.__hasExternalTextures=!0,Xt.__hasExternalTextures&&(Xt.__autoAllocateDepthBuffer=void 0===Zt,Xt.__autoAllocateDepthBuffer||!0===Ir.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(qe,kt){const Zt=ln.get(qe);Zt.__webglFramebuffer=kt,Zt.__useDefaultFramebuffer=void 0===kt},this.setRenderTarget=function(qe,kt=0,Zt=0){De=qe,ge=kt,ye=Zt;let Xt=!0;if(qe){const Nr=ln.get(qe);void 0!==Nr.__useDefaultFramebuffer?(ei.bindFramebuffer(36160,null),Xt=!1):void 0===Nr.__webglFramebuffer?xn.setupRenderTarget(qe):Nr.__hasExternalTextures&&xn.rebindTextures(qe,ln.get(qe.texture).__webglTexture,ln.get(qe.depthTexture).__webglTexture)}let vn=null,vr=!1,Rr=!1;if(qe){const Nr=qe.texture;(Nr.isData3DTexture||Nr.isDataArrayTexture)&&(Rr=!0);const Ts=ln.get(qe).__webglFramebuffer;qe.isWebGLCubeRenderTarget?(vn=Ts[kt],vr=!0):vn=Br.isWebGL2&&qe.samples>0&&!1===xn.useMultisampledRTT(qe)?ln.get(qe).__webglMultisampledFramebuffer:Ts,tt.copy(qe.viewport),lt.copy(qe.scissor),ct=qe.scissorTest}else tt.copy(Tt).multiplyScalar(Ie).floor(),lt.copy(Yt).multiplyScalar(Ie).floor(),ct=Wt;if(ei.bindFramebuffer(36160,vn)&&Br.drawBuffers&&Xt&&ei.drawBuffers(qe,vn),ei.viewport(tt),ei.scissor(lt),ei.setScissorTest(ct),vr){const Nr=ln.get(qe.texture);pn.framebufferTexture2D(36160,36064,34069+kt,Nr.__webglTexture,Zt)}else if(Rr){const Nr=ln.get(qe.texture);pn.framebufferTextureLayer(36160,36064,Nr.__webglTexture,Zt||0,kt||0)}Le=-1},this.readRenderTargetPixels=function(qe,kt,Zt,Xt,vn,vr,Rr){if(!qe||!qe.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Xr=ln.get(qe).__webglFramebuffer;if(qe.isWebGLCubeRenderTarget&&void 0!==Rr&&(Xr=Xr[Rr]),Xr){ei.bindFramebuffer(36160,Xr);try{const Nr=qe.texture,Ts=Nr.format,hs=Nr.type;if(Ts!==Oi&&Jt.convert(Ts)!==pn.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const ps=hs===En&&(Ir.has("EXT_color_buffer_half_float")||Br.isWebGL2&&Ir.has("EXT_color_buffer_float"));if(!(hs===di||Jt.convert(hs)===pn.getParameter(35738)||hs===Sn&&(Br.isWebGL2||Ir.has("OES_texture_float")||Ir.has("WEBGL_color_buffer_float"))||ps))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");kt>=0&&kt<=qe.width-Xt&&Zt>=0&&Zt<=qe.height-vn&&pn.readPixels(kt,Zt,Xt,vn,Jt.convert(Ts),Jt.convert(hs),vr)}finally{const Nr=null!==De?ln.get(De).__webglFramebuffer:null;ei.bindFramebuffer(36160,Nr)}}},this.copyFramebufferToTexture=function(qe,kt,Zt=0){if(!0!==kt.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Xt=Math.pow(2,-Zt),vn=Math.floor(kt.image.width*Xt),vr=Math.floor(kt.image.height*Xt);xn.setTexture2D(kt,0),pn.copyTexSubImage2D(3553,Zt,0,0,qe.x,qe.y,vn,vr),ei.unbindTexture()},this.copyTextureToTexture=function(qe,kt,Zt,Xt=0){const vn=kt.image.width,vr=kt.image.height,Rr=Jt.convert(Zt.format),Xr=Jt.convert(Zt.type);xn.setTexture2D(Zt,0),pn.pixelStorei(37440,Zt.flipY),pn.pixelStorei(37441,Zt.premultiplyAlpha),pn.pixelStorei(3317,Zt.unpackAlignment),kt.isDataTexture?pn.texSubImage2D(3553,Xt,qe.x,qe.y,vn,vr,Rr,Xr,kt.image.data):kt.isCompressedTexture?pn.compressedTexSubImage2D(3553,Xt,qe.x,qe.y,kt.mipmaps[0].width,kt.mipmaps[0].height,Rr,kt.mipmaps[0].data):pn.texSubImage2D(3553,Xt,qe.x,qe.y,Rr,Xr,kt.image),0===Xt&&Zt.generateMipmaps&&pn.generateMipmap(3553),ei.unbindTexture()},this.copyTextureToTexture3D=function(qe,kt,Zt,Xt,vn=0){if(Z.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const vr=qe.max.x-qe.min.x+1,Rr=qe.max.y-qe.min.y+1,Xr=qe.max.z-qe.min.z+1,Nr=Jt.convert(Xt.format),Ts=Jt.convert(Xt.type);let hs;if(Xt.isData3DTexture)xn.setTexture3D(Xt,0),hs=32879;else{if(!Xt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");xn.setTexture2DArray(Xt,0),hs=35866}pn.pixelStorei(37440,Xt.flipY),pn.pixelStorei(37441,Xt.premultiplyAlpha),pn.pixelStorei(3317,Xt.unpackAlignment);const ps=pn.getParameter(3314),Ao=pn.getParameter(32878),Bd=pn.getParameter(3316),Zf=pn.getParameter(3315),qf=pn.getParameter(32877),Hc=Zt.isCompressedTexture?Zt.mipmaps[0]:Zt.image;pn.pixelStorei(3314,Hc.width),pn.pixelStorei(32878,Hc.height),pn.pixelStorei(3316,qe.min.x),pn.pixelStorei(3315,qe.min.y),pn.pixelStorei(32877,qe.min.z),Zt.isDataTexture||Zt.isData3DTexture?pn.texSubImage3D(hs,vn,kt.x,kt.y,kt.z,vr,Rr,Xr,Nr,Ts,Hc.data):Zt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),pn.compressedTexSubImage3D(hs,vn,kt.x,kt.y,kt.z,vr,Rr,Xr,Nr,Hc.data)):pn.texSubImage3D(hs,vn,kt.x,kt.y,kt.z,vr,Rr,Xr,Nr,Ts,Hc),pn.pixelStorei(3314,ps),pn.pixelStorei(32878,Ao),pn.pixelStorei(3316,Bd),pn.pixelStorei(3315,Zf),pn.pixelStorei(32877,qf),0===vn&&Xt.generateMipmaps&&pn.generateMipmap(hs),ei.unbindTexture()},this.initTexture=function(qe){xn.setTexture2D(qe,0),ei.unbindTexture()},this.resetState=function(){ge=0,ye=0,De=null,ei.reset(),Fr.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}vs.prototype.isWebGLRenderer=!0,class extends vs{}.prototype.isWebGL1Renderer=!0;class nf{constructor(t,i=25e-5){this.name="",this.color=new Rn(t),this.density=i}clone(){return new nf(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}nf.prototype.isFogExp2=!0;class fs{constructor(t,i=1,o=1e3){this.name="",this.color=new Rn(t),this.near=i,this.far=o}clone(){return new fs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}fs.prototype.isFog=!0;class nu extends ns{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return null!==this.fog&&(i.object.fog=this.fog.toJSON()),i}}nu.prototype.isScene=!0;class al{constructor(t,i){this.array=t,this.stride=i,this.count=void 0!==t?t.length/i:0,this.usage=Mh,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=bo()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,o){t*=this.stride,o*=i.stride;for(let a=0,u=this.stride;a<u;a++)this.array[t+a]=i.array[o+a];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=bo()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),o=new this.constructor(i,this.stride);return o.setUsage(this.usage),o}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=bo()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}al.prototype.isInterleavedBuffer=!0;const Mo=new ze;class ll{constructor(t,i,o,a=!1){this.name="",this.data=t,this.itemSize=i,this.offset=o,this.normalized=!0===a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,o=this.data.count;i<o;i++)Mo.fromBufferAttribute(this,i),Mo.applyMatrix4(t),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}applyNormalMatrix(t){for(let i=0,o=this.count;i<o;i++)Mo.fromBufferAttribute(this,i),Mo.applyNormalMatrix(t),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}transformDirection(t){for(let i=0,o=this.count;i<o;i++)Mo.fromBufferAttribute(this,i),Mo.transformDirection(t),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}setX(t,i){return this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,i,o){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=o,this}setXYZ(t,i,o,a){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=o,this.data.array[t+2]=a,this}setXYZW(t,i,o,a,u){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=o,this.data.array[t+2]=a,this.data.array[t+3]=u,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const i=[];for(let o=0;o<this.count;o++){const a=o*this.data.stride+this.offset;for(let u=0;u<this.itemSize;u++)i.push(this.data.array[a+u])}return new ls(new this.array.constructor(i),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ll(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const i=[];for(let o=0;o<this.count;o++){const a=o*this.data.stride+this.offset;for(let u=0;u<this.itemSize;u++)i.push(this.data.array[a+u])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ll.prototype.isInterleavedBufferAttribute=!0;class Gl extends so{constructor(t){super(),this.type="SpriteMaterial",this.color=new Rn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Cs;Gl.prototype.isSpriteMaterial=!0;const xa=new ze,zl=new ze,Ha=new ze,cl=new st,ul=new st,iu=new _i,Vl=new ze,Wl=new ze,Yh=new ze,Qh=new st,ru=new st,Zh=new st;function Qu(s,t,i,o,a,u){cl.subVectors(s,i).addScalar(.5).multiply(o),void 0!==a?(ul.x=u*cl.x-a*cl.y,ul.y=a*cl.x+u*cl.y):ul.copy(cl),s.copy(t),s.x+=ul.x,s.y+=ul.y,s.applyMatrix4(iu)}(class extends ns{constructor(t){if(super(),this.type="Sprite",void 0===Cs){Cs=new Hi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),o=new al(i,5);Cs.setIndex([0,1,2,0,2,3]),Cs.setAttribute("position",new ll(o,3,0,!1)),Cs.setAttribute("uv",new ll(o,2,3,!1))}this.geometry=Cs,this.material=void 0!==t?t:new Gl,this.center=new st(.5,.5)}raycast(t,i){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),zl.setFromMatrixScale(this.matrixWorld),iu.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ha.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&zl.multiplyScalar(-Ha.z);const o=this.material.rotation;let a,u;0!==o&&(u=Math.cos(o),a=Math.sin(o));const d=this.center;Qu(Vl.set(-.5,-.5,0),Ha,d,zl,a,u),Qu(Wl.set(.5,-.5,0),Ha,d,zl,a,u),Qu(Yh.set(.5,.5,0),Ha,d,zl,a,u),Qh.set(0,0),ru.set(1,0),Zh.set(1,1);let p=t.ray.intersectTriangle(Vl,Wl,Yh,!1,xa);if(null===p&&(Qu(Wl.set(-.5,.5,0),Ha,d,zl,a,u),ru.set(0,1),p=t.ray.intersectTriangle(Vl,Yh,Wl,!1,xa),null===p))return;const v=t.ray.origin.distanceTo(xa);v<t.near||v>t.far||i.push({distance:v,point:xa.clone(),uv:ro.getUV(xa,Vl,Wl,Yh,Qh,ru,Zh,new st),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const Jh=new ze,Np=new Oe,kp=new Oe,dg=new ze,Hp=new _i;class sf extends yo{constructor(t,i){super(t,i),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new _i,this.bindMatrixInverse=new _i}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,i){this.skeleton=t,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Oe,i=this.geometry.attributes.skinWeight;for(let o=0,a=i.count;o<a;o++){t.fromBufferAttribute(i,o);const u=1/t.manhattanLength();u!==1/0?t.multiplyScalar(u):t.set(1,0,0,0),i.setXYZW(o,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,i){const o=this.skeleton,a=this.geometry;Np.fromBufferAttribute(a.attributes.skinIndex,t),kp.fromBufferAttribute(a.attributes.skinWeight,t),Jh.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let u=0;u<4;u++){const d=kp.getComponent(u);if(0!==d){const p=Np.getComponent(u);Hp.multiplyMatrices(o.bones[p].matrixWorld,o.boneInverses[p]),i.addScaledVector(dg.copy(Jh).applyMatrix4(Hp),d)}}return i.applyMatrix4(this.bindMatrixInverse)}}sf.prototype.isSkinnedMesh=!0;(class extends ns{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class extends as{constructor(t=null,i=1,o=1,a,u,d,p,v,A=rt,P=rt,U,N){super(null,d,p,v,A,P,a,u,U,N),this.image={data:t,width:i,height:o},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;class ou extends ls{constructor(t,i,o,a=1){"number"==typeof o&&(a=o,o=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,i,o),this.meshPerAttribute=a}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}ou.prototype.isInstancedBufferAttribute=!0;const fg=new _i,ed=new _i,hl=[],Zu=new yo;(class extends yo{constructor(t,i,o){super(t,i),this.instanceMatrix=new ou(new Float32Array(16*o),16),this.instanceColor=null,this.count=o,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,i){i.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,16*t)}raycast(t,i){const o=this.matrixWorld,a=this.count;if(Zu.geometry=this.geometry,Zu.material=this.material,void 0!==Zu.material)for(let u=0;u<a;u++){this.getMatrixAt(u,fg),ed.multiplyMatrices(o,fg),Zu.matrixWorld=ed,Zu.raycast(t,hl);for(let d=0,p=hl.length;d<p;d++){const v=hl[d];v.instanceId=u,v.object=this,i.push(v)}hl.length=0}}setColorAt(t,i){null===this.instanceColor&&(this.instanceColor=new ou(new Float32Array(3*this.instanceMatrix.count),3)),i.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class xo extends so{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Rn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}xo.prototype.isLineBasicMaterial=!0;const qu=new ze,af=new ze,To=new _i,lf=new wo,td=new $o;class _c extends ns{constructor(t=new Hi,i=new xo){super(),this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const i=t.attributes.position,o=[0];for(let a=1,u=i.count;a<u;a++)qu.fromBufferAttribute(i,a-1),af.fromBufferAttribute(i,a),o[a]=o[a-1],o[a]+=qu.distanceTo(af);t.setAttribute("lineDistance",new Vn(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,i){const o=this.geometry,a=this.matrixWorld,u=t.params.Line.threshold,d=o.drawRange;if(null===o.boundingSphere&&o.computeBoundingSphere(),td.copy(o.boundingSphere),td.applyMatrix4(a),td.radius+=u,!1===t.ray.intersectsSphere(td))return;To.copy(a).invert(),lf.copy(t.ray).applyMatrix4(To);const p=u/((this.scale.x+this.scale.y+this.scale.z)/3),v=p*p,A=new ze,P=new ze,U=new ze,N=new ze,j=this.isLineSegments?2:1;if(o.isBufferGeometry){const te=o.index,q=o.attributes.position;if(null!==te)for(let De=Math.max(0,d.start),Le=Math.min(te.count,d.start+d.count)-1;De<Le;De+=j){const Ne=te.getX(De),tt=te.getX(De+1);if(A.fromBufferAttribute(q,Ne),P.fromBufferAttribute(q,tt),lf.distanceSqToSegment(A,P,N,U)>v)continue;N.applyMatrix4(this.matrixWorld);const ct=t.ray.origin.distanceTo(N);ct<t.near||ct>t.far||i.push({distance:ct,point:U.clone().applyMatrix4(this.matrixWorld),index:De,face:null,faceIndex:null,object:this})}else for(let De=Math.max(0,d.start),Le=Math.min(q.count,d.start+d.count)-1;De<Le;De+=j){if(A.fromBufferAttribute(q,De),P.fromBufferAttribute(q,De+1),lf.distanceSqToSegment(A,P,N,U)>v)continue;N.applyMatrix4(this.matrixWorld);const tt=t.ray.origin.distanceTo(N);tt<t.near||tt>t.far||i.push({distance:tt,point:U.clone().applyMatrix4(this.matrixWorld),index:De,face:null,faceIndex:null,object:this})}}else o.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const i=t.morphAttributes,o=Object.keys(i);if(o.length>0){const a=i[o[0]];if(void 0!==a){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,d=a.length;u<d;u++){const p=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=u}}}}else{const i=t.morphTargets;void 0!==i&&i.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}_c.prototype.isLine=!0;const cf=new ze,nd=new ze;class ia extends _c{constructor(t,i){super(t,i),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const i=t.attributes.position,o=[];for(let a=0,u=i.count;a<u;a+=2)cf.fromBufferAttribute(i,a),nd.fromBufferAttribute(i,a+1),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+cf.distanceTo(nd);t.setAttribute("lineDistance",new Vn(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ia.prototype.isLineSegments=!0;(class extends _c{constructor(t,i){super(t,i),this.type="LineLoop"}}).prototype.isLineLoop=!0;class uf extends so{constructor(t){super(),this.type="PointsMaterial",this.color=new Rn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}uf.prototype.isPointsMaterial=!0;const qo=new _i,id=new wo,dl=new $o,rd=new ze;function sd(s,t,i,o,a,u,d){const p=id.distanceSqToPoint(s);if(p<i){const v=new ze;id.closestPointToPoint(s,v),v.applyMatrix4(o);const A=a.ray.origin.distanceTo(v);if(A<a.near||A>a.far)return;u.push({distance:A,distanceToRay:Math.sqrt(p),point:v,index:t,face:null,object:d})}}(class extends ns{constructor(t=new Hi,i=new uf){super(),this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,i){const o=this.geometry,a=this.matrixWorld,u=t.params.Points.threshold,d=o.drawRange;if(null===o.boundingSphere&&o.computeBoundingSphere(),dl.copy(o.boundingSphere),dl.applyMatrix4(a),dl.radius+=u,!1===t.ray.intersectsSphere(dl))return;qo.copy(a).invert(),id.copy(t.ray).applyMatrix4(qo);const p=u/((this.scale.x+this.scale.y+this.scale.z)/3),v=p*p;if(o.isBufferGeometry){const A=o.index,U=o.attributes.position;if(null!==A)for(let te=Math.max(0,d.start),Z=Math.min(A.count,d.start+d.count);te<Z;te++){const q=A.getX(te);rd.fromBufferAttribute(U,q),sd(rd,q,v,a,t,i,this)}else for(let te=Math.max(0,d.start),Z=Math.min(U.count,d.start+d.count);te<Z;te++)rd.fromBufferAttribute(U,te),sd(rd,te,v,a,t,i,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const i=t.morphAttributes,o=Object.keys(i);if(o.length>0){const a=i[o[0]];if(void 0!==a){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,d=a.length;u<d;u++){const p=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=u}}}}else{const i=t.morphTargets;void 0!==i&&i.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends as{constructor(t,i,o,a,u,d,p,v,A){super(t,i,o,a,u,d,p,v,A),this.minFilter=void 0!==d?d:rn,this.magFilter=void 0!==u?u:rn,this.generateMipmaps=!1;const P=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function U(){P.needsUpdate=!0,t.requestVideoFrameCallback(U)})}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t==0&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends as{constructor(t,i,o){super({width:t,height:i}),this.format=o,this.magFilter=rt,this.minFilter=rt,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class extends as{constructor(t,i,o,a,u,d,p,v,A,P,U,N){super(null,d,p,v,A,P,a,u,U,N),this.image={width:i,height:o},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class extends as{constructor(t,i,o,a,u,d,p,v,A){super(t,i,o,a,u,d,p,v,A),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class ha{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const o=this.getUtoTmapping(t);return this.getPoint(o,i)}getPoints(t=5){const i=[];for(let o=0;o<=t;o++)i.push(this.getPoint(o/t));return i}getSpacedPoints(t=5){const i=[];for(let o=0;o<=t;o++)i.push(this.getPointAt(o/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let o,a=this.getPoint(0),u=0;i.push(0);for(let d=1;d<=t;d++)o=this.getPoint(d/t),u+=o.distanceTo(a),i.push(u),a=o;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const o=this.getLengths();let a=0;const u=o.length;let d;d=i||t*o[u-1];let A,p=0,v=u-1;for(;p<=v;)if(a=Math.floor(p+(v-p)/2),A=o[a]-d,A<0)p=a+1;else{if(!(A>0)){v=a;break}v=a-1}if(a=v,o[a]===d)return a/(u-1);const P=o[a];return(a+(d-P)/(o[a+1]-P))/(u-1)}getTangent(t,i){const o=1e-4;let a=t-o,u=t+o;a<0&&(a=0),u>1&&(u=1);const d=this.getPoint(a),p=this.getPoint(u),v=i||(d.isVector2?new st:new ze);return v.copy(p).sub(d).normalize(),v}getTangentAt(t,i){const o=this.getUtoTmapping(t);return this.getTangent(o,i)}computeFrenetFrames(t,i){const o=new ze,a=[],u=[],d=[],p=new ze,v=new _i;for(let j=0;j<=t;j++)a[j]=this.getTangentAt(j/t,new ze);u[0]=new ze,d[0]=new ze;let A=Number.MAX_VALUE;const P=Math.abs(a[0].x),U=Math.abs(a[0].y),N=Math.abs(a[0].z);P<=A&&(A=P,o.set(1,0,0)),U<=A&&(A=U,o.set(0,1,0)),N<=A&&o.set(0,0,1),p.crossVectors(a[0],o).normalize(),u[0].crossVectors(a[0],p),d[0].crossVectors(a[0],u[0]);for(let j=1;j<=t;j++){if(u[j]=u[j-1].clone(),d[j]=d[j-1].clone(),p.crossVectors(a[j-1],a[j]),p.length()>Number.EPSILON){p.normalize();const te=Math.acos(Fs(a[j-1].dot(a[j]),-1,1));u[j].applyMatrix4(v.makeRotationAxis(p,te))}d[j].crossVectors(a[j],u[j])}if(!0===i){let j=Math.acos(Fs(u[0].dot(u[t]),-1,1));j/=t,a[0].dot(p.crossVectors(u[0],u[t]))>0&&(j=-j);for(let te=1;te<=t;te++)u[te].applyMatrix4(v.makeRotationAxis(a[te],j*te)),d[te].crossVectors(a[te],u[te])}return{tangents:a,normals:u,binormals:d}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ku extends ha{constructor(t=0,i=0,o=1,a=1,u=0,d=2*Math.PI,p=!1,v=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=o,this.yRadius=a,this.aStartAngle=u,this.aEndAngle=d,this.aClockwise=p,this.aRotation=v}getPoint(t,i){const o=i||new st,a=2*Math.PI;let u=this.aEndAngle-this.aStartAngle;const d=Math.abs(u)<Number.EPSILON;for(;u<0;)u+=a;for(;u>a;)u-=a;u<Number.EPSILON&&(u=d?0:a),!0===this.aClockwise&&!d&&(u===a?u=-a:u-=a);const p=this.aStartAngle+t*u;let v=this.aX+this.xRadius*Math.cos(p),A=this.aY+this.yRadius*Math.sin(p);if(0!==this.aRotation){const P=Math.cos(this.aRotation),U=Math.sin(this.aRotation),N=v-this.aX,j=A-this.aY;v=N*P-j*U+this.aX,A=N*U+j*P+this.aY}return o.set(v,A)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Ku.prototype.isEllipseCurve=!0;class Xp extends Ku{constructor(t,i,o,a,u,d){super(t,i,o,o,a,u,d),this.type="ArcCurve"}}function Mc(){let s=0,t=0,i=0,o=0;function a(u,d,p,v){s=u,t=p,i=-3*u+3*d-2*p-v,o=2*u-2*d+p+v}return{initCatmullRom:function(u,d,p,v,A){a(d,p,A*(p-u),A*(v-d))},initNonuniformCatmullRom:function(u,d,p,v,A,P,U){let N=(d-u)/A-(p-u)/(A+P)+(p-d)/P,j=(p-d)/P-(v-d)/(P+U)+(v-p)/U;N*=P,j*=P,a(d,p,N,j)},calc:function(u){const d=u*u;return s+t*u+i*d+o*(d*u)}}}Xp.prototype.isArcCurve=!0;const Ga=new ze,Tc=new Mc,Aa=new Mc,Sc=new Mc;class ad extends ha{constructor(t=[],i=!1,o="centripetal",a=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=o,this.tension=a}getPoint(t,i=new ze){const o=i,a=this.points,u=a.length,d=(u-(this.closed?0:1))*t;let A,P,p=Math.floor(d),v=d-p;this.closed?p+=p>0?0:(Math.floor(Math.abs(p)/u)+1)*u:0===v&&p===u-1&&(p=u-2,v=1),this.closed||p>0?A=a[(p-1)%u]:(Ga.subVectors(a[0],a[1]).add(a[0]),A=Ga);const U=a[p%u],N=a[(p+1)%u];if(this.closed||p+2<u?P=a[(p+2)%u]:(Ga.subVectors(a[u-1],a[u-2]).add(a[u-1]),P=Ga),"centripetal"===this.curveType||"chordal"===this.curveType){const j="chordal"===this.curveType?.5:.25;let te=Math.pow(A.distanceToSquared(U),j),Z=Math.pow(U.distanceToSquared(N),j),q=Math.pow(N.distanceToSquared(P),j);Z<1e-4&&(Z=1),te<1e-4&&(te=Z),q<1e-4&&(q=Z),Tc.initNonuniformCatmullRom(A.x,U.x,N.x,P.x,te,Z,q),Aa.initNonuniformCatmullRom(A.y,U.y,N.y,P.y,te,Z,q),Sc.initNonuniformCatmullRom(A.z,U.z,N.z,P.z,te,Z,q)}else"catmullrom"===this.curveType&&(Tc.initCatmullRom(A.x,U.x,N.x,P.x,this.tension),Aa.initCatmullRom(A.y,U.y,N.y,P.y,this.tension),Sc.initCatmullRom(A.z,U.z,N.z,P.z,this.tension));return o.set(Tc.calc(v),Aa.calc(v),Sc.calc(v)),o}copy(t){super.copy(t),this.points=[];for(let i=0,o=t.points.length;i<o;i++)this.points.push(t.points[i].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,o=this.points.length;i<o;i++)t.points.push(this.points[i].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,o=t.points.length;i<o;i++){const a=t.points[i];this.points.push((new ze).fromArray(a))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ld(s,t,i,o,a){const u=.5*(o-t),d=.5*(a-i),p=s*s;return(2*i-2*o+u+d)*(s*p)+(-3*i+3*o-2*u-d)*p+u*s+i}function Uo(s,t,i,o){return function(s,t){const i=1-s;return i*i*t}(s,t)+function(s,t){return 2*(1-s)*s*t}(s,i)+function(s,t){return s*s*t}(s,o)}function au(s,t,i,o,a){return function(s,t){const i=1-s;return i*i*i*t}(s,t)+function(s,t){const i=1-s;return 3*i*i*s*t}(s,i)+function(s,t){return 3*(1-s)*s*s*t}(s,o)+function(s,t){return s*s*s*t}(s,a)}ad.prototype.isCatmullRomCurve3=!0;class ud extends ha{constructor(t=new st,i=new st,o=new st,a=new st){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=o,this.v3=a}getPoint(t,i=new st){const o=i,a=this.v0,u=this.v1,d=this.v2,p=this.v3;return o.set(au(t,a.x,u.x,d.x,p.x),au(t,a.y,u.y,d.y,p.y)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}ud.prototype.isCubicBezierCurve=!0;class mf extends ha{constructor(t=new ze,i=new ze,o=new ze,a=new ze){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=o,this.v3=a}getPoint(t,i=new ze){const o=i,a=this.v0,u=this.v1,d=this.v2,p=this.v3;return o.set(au(t,a.x,u.x,d.x,p.x),au(t,a.y,u.y,d.y,p.y),au(t,a.z,u.z,d.z,p.z)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}mf.prototype.isCubicBezierCurve3=!0;class Ju extends ha{constructor(t=new st,i=new st){super(),this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new st){const o=i;return 1===t?o.copy(this.v2):(o.copy(this.v2).sub(this.v1),o.multiplyScalar(t).add(this.v1)),o}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i){const o=i||new st;return o.copy(this.v2).sub(this.v1).normalize(),o}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ju.prototype.isLineCurve=!0;class qp extends ha{constructor(t=new st,i=new st,o=new st){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=o}getPoint(t,i=new st){const o=i,a=this.v0,u=this.v1,d=this.v2;return o.set(Uo(t,a.x,u.x,d.x),Uo(t,a.y,u.y,d.y)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}qp.prototype.isQuadraticBezierCurve=!0;class Kp extends ha{constructor(t=new ze,i=new ze,o=new ze){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=o}getPoint(t,i=new ze){const o=i,a=this.v0,u=this.v1,d=this.v2;return o.set(Uo(t,a.x,u.x,d.x),Uo(t,a.y,u.y,d.y),Uo(t,a.z,u.z,d.z)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Kp.prototype.isQuadraticBezierCurve3=!0;class Jp extends ha{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,i=new st){const o=i,a=this.points,u=(a.length-1)*t,d=Math.floor(u),p=u-d,v=a[0===d?d:d-1],A=a[d],P=a[d>a.length-2?a.length-1:d+1],U=a[d>a.length-3?a.length-1:d+2];return o.set(ld(p,v.x,A.x,P.x,U.x),ld(p,v.y,A.y,P.y,U.y)),o}copy(t){super.copy(t),this.points=[];for(let i=0,o=t.points.length;i<o;i++)this.points.push(t.points[i].clone());return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,o=this.points.length;i<o;i++)t.points.push(this.points[i].toArray());return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,o=t.points.length;i<o;i++){const a=t.points[i];this.points.push((new st).fromArray(a))}return this}}Jp.prototype.isSplineCurve=!0;var lu=Object.freeze({__proto__:null,ArcCurve:Xp,CatmullRomCurve3:ad,CubicBezierCurve:ud,CubicBezierCurve3:mf,EllipseCurve:Ku,LineCurve:Ju,LineCurve3:class extends ha{constructor(t=new ze,i=new ze){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=i}getPoint(t,i=new ze){const o=i;return 1===t?o.copy(this.v2):(o.copy(this.v2).sub(this.v1),o.multiplyScalar(t).add(this.v1)),o}getPointAt(t,i){return this.getPoint(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:qp,QuadraticBezierCurve3:Kp,SplineCurve:Jp});class Ex extends ha{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new Ju(i,t))}getPoint(t,i){const o=t*this.getLength(),a=this.getCurveLengths();let u=0;for(;u<a.length;){if(a[u]>=o){const d=a[u]-o,p=this.curves[u],v=p.getLength();return p.getPointAt(0===v?0:1-d/v,i)}u++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let o=0,a=this.curves.length;o<a;o++)i+=this.curves[o].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let o=0;o<=t;o++)i.push(this.getPoint(o/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let o;for(let a=0,u=this.curves;a<u.length;a++){const d=u[a],v=d.getPoints(d.isEllipseCurve?2*t:d.isLineCurve||d.isLineCurve3?1:d.isSplineCurve?t*d.points.length:t);for(let A=0;A<v.length;A++){const P=v[A];o&&o.equals(P)||(i.push(P),o=P)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,o=t.curves.length;i<o;i++)this.curves.push(t.curves[i].clone());return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,o=this.curves.length;i<o;i++)t.curves.push(this.curves[i].toJSON());return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,o=t.curves.length;i<o;i++){const a=t.curves[i];this.curves.push((new lu[a.type]).fromJSON(a))}return this}}class hd extends Ex{constructor(t){super(),this.type="Path",this.currentPoint=new st,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,o=t.length;i<o;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const o=new Ju(this.currentPoint.clone(),new st(t,i));return this.curves.push(o),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,o,a){const u=new qp(this.currentPoint.clone(),new st(t,i),new st(o,a));return this.curves.push(u),this.currentPoint.set(o,a),this}bezierCurveTo(t,i,o,a,u,d){const p=new ud(this.currentPoint.clone(),new st(t,i),new st(o,a),new st(u,d));return this.curves.push(p),this.currentPoint.set(u,d),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),o=new Jp(i);return this.curves.push(o),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,o,a,u,d){return this.absarc(t+this.currentPoint.x,i+this.currentPoint.y,o,a,u,d),this}absarc(t,i,o,a,u,d){return this.absellipse(t,i,o,o,a,u,d),this}ellipse(t,i,o,a,u,d,p,v){return this.absellipse(t+this.currentPoint.x,i+this.currentPoint.y,o,a,u,d,p,v),this}absellipse(t,i,o,a,u,d,p,v){const A=new Ku(t,i,o,a,u,d,p,v);if(this.curves.length>0){const U=A.getPoint(0);U.equals(this.currentPoint)||this.lineTo(U.x,U.y)}this.curves.push(A);const P=A.getPoint(1);return this.currentPoint.copy(P),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}new ze,new ze,new ze,new ro;class da extends hd{constructor(t){super(t),this.uuid=bo(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let o=0,a=this.holes.length;o<a;o++)i[o]=this.holes[o].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,o=t.holes.length;i<o;i++)this.holes.push(t.holes[i].clone());return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,o=this.holes.length;i<o;i++)t.holes.push(this.holes[i].toJSON());return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,o=t.holes.length;i<o;i++){const a=t.holes[i];this.holes.push((new hd).fromJSON(a))}return this}}function gg(s,t,i,o,a){let u,d;if(a===function(s,t,i,o){let a=0;for(let u=t,d=i-o;u<i;u+=o)a+=(s[d]-s[u])*(s[u+1]+s[d+1]),d=u;return a}(s,t,i,o)>0)for(u=t;u<i;u+=o)d=nm(u,s[u],s[u+1],d);else for(u=i-o;u>=t;u-=o)d=nm(u,s[u],s[u+1],d);return d&&Rs(d,d.next)&&(rh(d),d=d.next),d}function Yl(s,t){if(!s)return s;t||(t=s);let o,i=s;do{if(o=!1,i.steiner||!Rs(i,i.next)&&0!==Qs(i.prev,i,i.next))i=i.next;else{if(rh(i),i=t=i.prev,i===i.next)break;o=!0}}while(o||i!==t);return t}function Ea(s,t,i,o,a,u,d){if(!s)return;!d&&u&&function(s,t,i,o){let a=s;do{null===a.z&&(a.z=em(a.x,a.y,t,i,o)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==s);a.prevZ.nextZ=null,a.prevZ=null,function(s){let t,i,o,a,u,d,p,v,A=1;do{for(i=s,s=null,u=null,d=0;i;){for(d++,o=i,p=0,t=0;t<A&&(p++,o=o.nextZ,o);t++);for(v=A;p>0||v>0&&o;)0!==p&&(0===v||!o||i.z<=o.z)?(a=i,i=i.nextZ,p--):(a=o,o=o.nextZ,v--),u?u.nextZ=a:s=a,a.prevZ=u,u=a;i=o}u.nextZ=null,A*=2}while(d>1)}(a)}(s,o,a,u);let v,A,p=s;for(;s.prev!==s.next;)if(v=s.prev,A=s.next,u?wx(s,o,a,u):pd(s))t.push(v.i/i),t.push(s.i/i),t.push(A.i/i),rh(s),s=A.next,p=A.next;else if((s=A)===p){d?1===d?Ea(s=_x(Yl(s),t,i),t,i,o,a,u,2):2===d&&Mx(s,t,i,o,a,u):Ea(Yl(s),t,i,o,a,u,1);break}}function pd(s){const t=s.prev,i=s,o=s.next;if(Qs(t,i,o)>=0)return!1;let a=s.next.next;for(;a!==s.prev;){if(nh(t.x,t.y,i.x,i.y,o.x,o.y,a.x,a.y)&&Qs(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function wx(s,t,i,o){const a=s.prev,u=s,d=s.next;if(Qs(a,u,d)>=0)return!1;const A=a.x>u.x?a.x>d.x?a.x:d.x:u.x>d.x?u.x:d.x,P=a.y>u.y?a.y>d.y?a.y:d.y:u.y>d.y?u.y:d.y,U=em(a.x<u.x?a.x<d.x?a.x:d.x:u.x<d.x?u.x:d.x,a.y<u.y?a.y<d.y?a.y:d.y:u.y<d.y?u.y:d.y,t,i,o),N=em(A,P,t,i,o);let j=s.prevZ,te=s.nextZ;for(;j&&j.z>=U&&te&&te.z<=N;){if(j!==s.prev&&j!==s.next&&nh(a.x,a.y,u.x,u.y,d.x,d.y,j.x,j.y)&&Qs(j.prev,j,j.next)>=0||(j=j.prevZ,te!==s.prev&&te!==s.next&&nh(a.x,a.y,u.x,u.y,d.x,d.y,te.x,te.y)&&Qs(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;j&&j.z>=U;){if(j!==s.prev&&j!==s.next&&nh(a.x,a.y,u.x,u.y,d.x,d.y,j.x,j.y)&&Qs(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;te&&te.z<=N;){if(te!==s.prev&&te!==s.next&&nh(a.x,a.y,u.x,u.y,d.x,d.y,te.x,te.y)&&Qs(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function _x(s,t,i){let o=s;do{const a=o.prev,u=o.next.next;!Rs(a,u)&&md(a,o,o.next,u)&&vd(a,u)&&vd(u,a)&&(t.push(a.i/i),t.push(o.i/i),t.push(u.i/i),rh(o),rh(o.next),o=s=u),o=o.next}while(o!==s);return Yl(o)}function Mx(s,t,i,o,a,u){let d=s;do{let p=d.next.next;for(;p!==d.prev;){if(d.i!==p.i&&ih(d,p)){let v=vg(d,p);return d=Yl(d,d.next),v=Yl(v,v.next),Ea(d,t,i,o,a,u),void Ea(v,t,i,o,a,u)}p=p.next}d=d.next}while(d!==s)}function Sx(s,t){return s.x-t.x}function Cx(s,t){if(t=function(s,t){let i=t;const o=s.x,a=s.y;let d,u=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const N=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(N<=o&&N>u){if(u=N,N===o){if(a===i.y)return i;if(a===i.next.y)return i.next}d=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!d)return null;if(o===u)return d;const p=d,v=d.x,A=d.y;let U,P=1/0;i=d;do{o>=i.x&&i.x>=v&&o!==i.x&&nh(a<A?o:u,a,v,A,a<A?u:o,a,i.x,i.y)&&(U=Math.abs(a-i.y)/(o-i.x),vd(i,s)&&(U<P||U===P&&(i.x>d.x||i.x===d.x&&Lx(d,i)))&&(d=i,P=U)),i=i.next}while(i!==p);return d}(s,t)){const i=vg(t,s);Yl(t,t.next),Yl(i,i.next)}}function Lx(s,t){return Qs(s.prev,s,t.prev)<0&&Qs(t.next,s,s.next)<0}function em(s,t,i,o,a){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-i)*a)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-o)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function tm(s){let t=s,i=s;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==s);return i}function nh(s,t,i,o,a,u,d,p){return(a-d)*(t-p)-(s-d)*(u-p)>=0&&(s-d)*(o-p)-(i-d)*(t-p)>=0&&(i-d)*(u-p)-(a-d)*(o-p)>=0}function ih(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(s,t){let i=s;do{if(i.i!==s.i&&i.next.i!==s.i&&i.i!==t.i&&i.next.i!==t.i&&md(i,i.next,s,t))return!0;i=i.next}while(i!==s);return!1}(s,t)&&(vd(s,t)&&vd(t,s)&&function(s,t){let i=s,o=!1;const a=(s.x+t.x)/2,u=(s.y+t.y)/2;do{i.y>u!=i.next.y>u&&i.next.y!==i.y&&a<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==s);return o}(s,t)&&(Qs(s.prev,s,t.prev)||Qs(s,t.prev,t))||Rs(s,t)&&Qs(s.prev,s,s.next)>0&&Qs(t.prev,t,t.next)>0)}function Qs(s,t,i){return(t.y-s.y)*(i.x-t.x)-(t.x-s.x)*(i.y-t.y)}function Rs(s,t){return s.x===t.x&&s.y===t.y}function md(s,t,i,o){const a=hu(Qs(s,t,i)),u=hu(Qs(s,t,o)),d=hu(Qs(i,o,s)),p=hu(Qs(i,o,t));return!!(a!==u&&d!==p||0===a&&gd(s,i,t)||0===u&&gd(s,o,t)||0===d&&gd(i,s,o)||0===p&&gd(i,t,o))}function gd(s,t,i){return t.x<=Math.max(s.x,i.x)&&t.x>=Math.min(s.x,i.x)&&t.y<=Math.max(s.y,i.y)&&t.y>=Math.min(s.y,i.y)}function hu(s){return s>0?1:s<0?-1:0}function vd(s,t){return Qs(s.prev,s,s.next)<0?Qs(s,t,s.next)>=0&&Qs(s,s.prev,t)>=0:Qs(s,t,s.prev)<0||Qs(s,s.next,t)<0}function vg(s,t){const i=new du(s.i,s.x,s.y),o=new du(t.i,t.x,t.y),a=s.next,u=t.prev;return s.next=t,t.prev=s,i.next=a,a.prev=i,o.next=i,i.prev=o,u.next=o,o.prev=u,o}function nm(s,t,i,o){const a=new du(s,t,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function rh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function du(s,t,i){this.i=s,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ql{static area(t){const i=t.length;let o=0;for(let a=i-1,u=0;u<i;a=u++)o+=t[a].x*t[u].y-t[u].x*t[a].y;return.5*o}static isClockWise(t){return Ql.area(t)<0}static triangulateShape(t,i){const o=[],a=[],u=[];za(t),rm(o,t);let d=t.length;i.forEach(za);for(let v=0;v<i.length;v++)a.push(d),d+=i[v].length,rm(o,i[v]);const p=function(s,t,i=2){const o=t&&t.length,a=o?t[0]*i:s.length;let u=gg(s,0,a,i,!0);const d=[];if(!u||u.next===u.prev)return d;let p,v,A,P,U,N,j;if(o&&(u=function(s,t,i,o){const a=[];let u,d,p,v,A;for(u=0,d=t.length;u<d;u++)p=t[u]*o,v=u<d-1?t[u+1]*o:s.length,A=gg(s,p,v,o,!1),A===A.next&&(A.steiner=!0),a.push(tm(A));for(a.sort(Sx),u=0;u<a.length;u++)Cx(a[u],i),i=Yl(i,i.next);return i}(s,t,u,i)),s.length>80*i){p=A=s[0],v=P=s[1];for(let te=i;te<a;te+=i)U=s[te],N=s[te+1],U<p&&(p=U),N<v&&(v=N),U>A&&(A=U),N>P&&(P=N);j=Math.max(A-p,P-v),j=0!==j?1/j:0}return Ea(u,d,i,p,v,j),d}(o,a);for(let v=0;v<p.length;v+=3)u.push(p.slice(v,v+3));return u}}function za(s){const t=s.length;t>2&&s[t-1].equals(s[0])&&s.pop()}function rm(s,t){for(let i=0;i<t.length;i++)s.push(t[i].x),s.push(t[i].y)}class Zl extends Hi{constructor(t=new da([new st(.5,.5),new st(-.5,.5),new st(-.5,-.5),new st(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const o=this,a=[],u=[];for(let p=0,v=t.length;p<v;p++)d(t[p]);function d(p){const v=[],A=void 0!==i.curveSegments?i.curveSegments:12,P=void 0!==i.steps?i.steps:1;let U=void 0!==i.depth?i.depth:1,N=void 0===i.bevelEnabled||i.bevelEnabled,j=void 0!==i.bevelThickness?i.bevelThickness:.2,te=void 0!==i.bevelSize?i.bevelSize:j-.1,Z=void 0!==i.bevelOffset?i.bevelOffset:0,q=void 0!==i.bevelSegments?i.bevelSegments:3;const ge=i.extrudePath,ye=void 0!==i.UVGenerator?i.UVGenerator:pl;void 0!==i.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),U=i.amount);let De,Ne,tt,lt,ct,Le=!1;ge&&(De=ge.getSpacedPoints(P),Le=!0,N=!1,Ne=ge.computeFrenetFrames(P,!1),tt=new ze,lt=new ze,ct=new ze),N||(q=0,j=0,te=0,Z=0);const jt=p.extractPoints(A);let wt=jt.shape;const Ie=jt.holes;if(!Ql.isClockWise(wt)){wt=wt.reverse();for(let ln=0,xn=Ie.length;ln<xn;ln++){const Wn=Ie[ln];Ql.isClockWise(Wn)&&(Ie[ln]=Wn.reverse())}}const wn=Ql.triangulateShape(wt,Ie),Tt=wt;for(let ln=0,xn=Ie.length;ln<xn;ln++)wt=wt.concat(Ie[ln]);function Yt(ln,xn,Wn){return xn||console.error("THREE.ExtrudeGeometry: vec does not exist"),xn.clone().multiplyScalar(Wn).add(ln)}const Wt=wt.length,Kt=wn.length;function St(ln,xn,Wn){let Ii,mi,Cr;const lr=ln.x-xn.x,$i=ln.y-xn.y,uo=Wn.x-ln.x,Ns=Wn.y-ln.y,Je=lr*lr+$i*$i;if(Math.abs(lr*Ns-$i*uo)>Number.EPSILON){const qt=Math.sqrt(Je),In=Math.sqrt(uo*uo+Ns*Ns),hi=xn.x-$i/qt,bi=xn.y+lr/qt,Fr=((Wn.x-Ns/In-hi)*Ns-(Wn.y+uo/In-bi)*uo)/(lr*Ns-$i*uo);Ii=hi+lr*Fr-ln.x,mi=bi+$i*Fr-ln.y;const Wr=Ii*Ii+mi*mi;if(Wr<=2)return new st(Ii,mi);Cr=Math.sqrt(Wr/2)}else{let qt=!1;lr>Number.EPSILON?uo>Number.EPSILON&&(qt=!0):lr<-Number.EPSILON?uo<-Number.EPSILON&&(qt=!0):Math.sign($i)===Math.sign(Ns)&&(qt=!0),qt?(Ii=-$i,mi=lr,Cr=Math.sqrt(Je)):(Ii=lr,mi=$i,Cr=Math.sqrt(Je/2))}return new st(Ii/Cr,mi/Cr)}const yn=[];for(let ln=0,xn=Tt.length,Wn=xn-1,Ii=ln+1;ln<xn;ln++,Wn++,Ii++)Wn===xn&&(Wn=0),Ii===xn&&(Ii=0),yn[ln]=St(Tt[ln],Tt[Wn],Tt[Ii]);const Mn=[];let jn,Ln=yn.concat();for(let ln=0,xn=Ie.length;ln<xn;ln++){const Wn=Ie[ln];jn=[];for(let Ii=0,mi=Wn.length,Cr=mi-1,lr=Ii+1;Ii<mi;Ii++,Cr++,lr++)Cr===mi&&(Cr=0),lr===mi&&(lr=0),jn[Ii]=St(Wn[Ii],Wn[Cr],Wn[lr]);Mn.push(jn),Ln=Ln.concat(jn)}for(let ln=0;ln<q;ln++){const xn=ln/q,Wn=j*Math.cos(xn*Math.PI/2),Ii=te*Math.sin(xn*Math.PI/2)+Z;for(let mi=0,Cr=Tt.length;mi<Cr;mi++){const lr=Yt(Tt[mi],yn[mi],Ii);xs(lr.x,lr.y,-Wn)}for(let mi=0,Cr=Ie.length;mi<Cr;mi++){const lr=Ie[mi];jn=Mn[mi];for(let $i=0,uo=lr.length;$i<uo;$i++){const Ns=Yt(lr[$i],jn[$i],Ii);xs(Ns.x,Ns.y,-Wn)}}}const zi=te+Z;for(let ln=0;ln<Wt;ln++){const xn=N?Yt(wt[ln],Ln[ln],zi):wt[ln];Le?(lt.copy(Ne.normals[0]).multiplyScalar(xn.x),tt.copy(Ne.binormals[0]).multiplyScalar(xn.y),ct.copy(De[0]).add(lt).add(tt),xs(ct.x,ct.y,ct.z)):xs(xn.x,xn.y,0)}for(let ln=1;ln<=P;ln++)for(let xn=0;xn<Wt;xn++){const Wn=N?Yt(wt[xn],Ln[xn],zi):wt[xn];Le?(lt.copy(Ne.normals[ln]).multiplyScalar(Wn.x),tt.copy(Ne.binormals[ln]).multiplyScalar(Wn.y),ct.copy(De[ln]).add(lt).add(tt),xs(ct.x,ct.y,ct.z)):xs(Wn.x,Wn.y,U/P*ln)}for(let ln=q-1;ln>=0;ln--){const xn=ln/q,Wn=j*Math.cos(xn*Math.PI/2),Ii=te*Math.sin(xn*Math.PI/2)+Z;for(let mi=0,Cr=Tt.length;mi<Cr;mi++){const lr=Yt(Tt[mi],yn[mi],Ii);xs(lr.x,lr.y,U+Wn)}for(let mi=0,Cr=Ie.length;mi<Cr;mi++){const lr=Ie[mi];jn=Mn[mi];for(let $i=0,uo=lr.length;$i<uo;$i++){const Ns=Yt(lr[$i],jn[$i],Ii);Le?xs(Ns.x,Ns.y+De[P-1].y,De[P-1].x+Wn):xs(Ns.x,Ns.y,U+Wn)}}}function pn(ln,xn){let Wn=ln.length;for(;--Wn>=0;){const Ii=Wn;let mi=Wn-1;mi<0&&(mi=ln.length-1);for(let Cr=0,lr=P+2*q;Cr<lr;Cr++){const $i=Wt*Cr,uo=Wt*(Cr+1);Br(xn+Ii+$i,xn+mi+$i,xn+mi+uo,xn+Ii+uo)}}}function xs(ln,xn,Wn){v.push(ln),v.push(xn),v.push(Wn)}function Ir(ln,xn,Wn){ei(ln),ei(xn),ei(Wn);const Ii=a.length/3,mi=ye.generateTopUV(o,a,Ii-3,Ii-2,Ii-1);Qr(mi[0]),Qr(mi[1]),Qr(mi[2])}function Br(ln,xn,Wn,Ii){ei(ln),ei(xn),ei(Ii),ei(xn),ei(Wn),ei(Ii);const mi=a.length/3,Cr=ye.generateSideWallUV(o,a,mi-6,mi-3,mi-2,mi-1);Qr(Cr[0]),Qr(Cr[1]),Qr(Cr[3]),Qr(Cr[1]),Qr(Cr[2]),Qr(Cr[3])}function ei(ln){a.push(v[3*ln+0]),a.push(v[3*ln+1]),a.push(v[3*ln+2])}function Qr(ln){u.push(ln.x),u.push(ln.y)}(function(){const ln=a.length/3;if(N){let xn=0,Wn=Wt*xn;for(let Ii=0;Ii<Kt;Ii++){const mi=wn[Ii];Ir(mi[2]+Wn,mi[1]+Wn,mi[0]+Wn)}xn=P+2*q,Wn=Wt*xn;for(let Ii=0;Ii<Kt;Ii++){const mi=wn[Ii];Ir(mi[0]+Wn,mi[1]+Wn,mi[2]+Wn)}}else{for(let xn=0;xn<Kt;xn++){const Wn=wn[xn];Ir(Wn[2],Wn[1],Wn[0])}for(let xn=0;xn<Kt;xn++){const Wn=wn[xn];Ir(Wn[0]+Wt*P,Wn[1]+Wt*P,Wn[2]+Wt*P)}}o.addGroup(ln,a.length/3-ln,0)})(),function(){const ln=a.length/3;let xn=0;pn(Tt,xn),xn+=Tt.length;for(let Wn=0,Ii=Ie.length;Wn<Ii;Wn++){const mi=Ie[Wn];pn(mi,xn),xn+=mi.length}o.addGroup(ln,a.length/3-ln,1)}()}this.setAttribute("position",new Vn(a,3)),this.setAttribute("uv",new Vn(u,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(s,t,i){if(i.shapes=[],Array.isArray(s))for(let o=0,a=s.length;o<a;o++)i.shapes.push(s[o].uuid);else i.shapes.push(s.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,i){const o=[];for(let u=0,d=t.shapes.length;u<d;u++)o.push(i[t.shapes[u]]);const a=t.options.extrudePath;return void 0!==a&&(t.options.extrudePath=(new lu[a.type]).fromJSON(a)),new Zl(o,t.options)}}const pl={generateTopUV:function(s,t,i,o,a){const p=t[3*o],v=t[3*o+1],A=t[3*a],P=t[3*a+1];return[new st(t[3*i],t[3*i+1]),new st(p,v),new st(A,P)]},generateSideWallUV:function(s,t,i,o,a,u){const d=t[3*i],p=t[3*i+1],v=t[3*i+2],A=t[3*o],P=t[3*o+1],U=t[3*o+2],N=t[3*a],j=t[3*a+1],te=t[3*a+2],Z=t[3*u],q=t[3*u+1],ge=t[3*u+2];return Math.abs(p-P)<Math.abs(d-A)?[new st(d,1-v),new st(A,1-U),new st(N,1-te),new st(Z,1-ge)]:[new st(p,1-v),new st(P,1-U),new st(j,1-te),new st(q,1-ge)]}};class Va extends Hi{constructor(t=new da([new st(0,.5),new st(-.5,-.5),new st(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const o=[],a=[],u=[],d=[];let p=0,v=0;if(!1===Array.isArray(t))A(t);else for(let P=0;P<t.length;P++)A(t[P]),this.addGroup(p,v,P),p+=v,v=0;function A(P){const U=a.length/3,N=P.extractPoints(i);let j=N.shape;const te=N.holes;!1===Ql.isClockWise(j)&&(j=j.reverse());for(let q=0,ge=te.length;q<ge;q++){const ye=te[q];!0===Ql.isClockWise(ye)&&(te[q]=ye.reverse())}const Z=Ql.triangulateShape(j,te);for(let q=0,ge=te.length;q<ge;q++)j=j.concat(te[q]);for(let q=0,ge=j.length;q<ge;q++){const ye=j[q];a.push(ye.x,ye.y,0),u.push(0,0,1),d.push(ye.x,ye.y)}for(let q=0,ge=Z.length;q<ge;q++){const ye=Z[q];o.push(ye[0]+U,ye[1]+U,ye[2]+U),v+=3}}this.setIndex(o),this.setAttribute("position",new Vn(a,3)),this.setAttribute("normal",new Vn(u,3)),this.setAttribute("uv",new Vn(d,2))}toJSON(){const t=super.toJSON();return function(s,t){if(t.shapes=[],Array.isArray(s))for(let i=0,o=s.length;i<o;i++)t.shapes.push(s[i].uuid);else t.shapes.push(s.uuid);return t}(this.parameters.shapes,t)}static fromJSON(t,i){const o=[];for(let a=0,u=t.shapes.length;a<u;a++)o.push(i[t.shapes[a]]);return new Va(o,t.curveSegments)}}class sm extends so{constructor(t){super(),this.type="ShadowMaterial",this.color=new Rn(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}sm.prototype.isShadowMaterial=!0;class om extends Ho{constructor(t){super(t),this.type="RawShaderMaterial"}}om.prototype.isRawShaderMaterial=!0;class xd extends so{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}xd.prototype.isMeshStandardMaterial=!0;class Ad extends xd{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new st(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Fs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.sheenColor=new Rn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Rn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Ad.prototype.isMeshPhysicalMaterial=!0;class bf extends so{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Rn(16777215),this.specular=new Rn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}bf.prototype.isMeshPhongMaterial=!0;class Ef extends so{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Rn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Ef.prototype.isMeshToonMaterial=!0;class wf extends so{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}wf.prototype.isMeshNormalMaterial=!0;class _f extends so{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Rn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}_f.prototype.isMeshLambertMaterial=!0;class Mf extends so{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Mf.prototype.isMeshMatcapMaterial=!0;class Tf extends xo{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Tf.prototype.isLineDashedMaterial=!0;const am={ShadowMaterial:sm,SpriteMaterial:Gl,RawShaderMaterial:om,ShaderMaterial:Ho,PointsMaterial:uf,MeshPhysicalMaterial:Ad,MeshStandardMaterial:xd,MeshPhongMaterial:bf,MeshToonMaterial:Ef,MeshNormalMaterial:wf,MeshLambertMaterial:_f,MeshDepthMaterial:Yu,MeshDistanceMaterial:Ip,MeshBasicMaterial:Pa,MeshMatcapMaterial:Mf,LineDashedMaterial:Tf,LineBasicMaterial:xo,Material:so};so.fromType=function(s){return new am[s]};const zs={arraySlice:function(s,t,i){return zs.isTypedArray(s)?new s.constructor(s.subarray(t,void 0!==i?i:s.length)):s.slice(t,i)},convertArray:function(s,t,i){return!s||!i&&s.constructor===t?s:"number"==typeof t.BYTES_PER_ELEMENT?new t(s):Array.prototype.slice.call(s)},isTypedArray:function(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)},getKeyframeOrder:function(s){const i=s.length,o=new Array(i);for(let a=0;a!==i;++a)o[a]=a;return o.sort(function(a,u){return s[a]-s[u]}),o},sortedArray:function(s,t,i){const o=s.length,a=new s.constructor(o);for(let u=0,d=0;d!==o;++u){const p=i[u]*t;for(let v=0;v!==t;++v)a[d++]=s[p+v]}return a},flattenJSON:function(s,t,i,o){let a=1,u=s[0];for(;void 0!==u&&void 0===u[o];)u=s[a++];if(void 0===u)return;let d=u[o];if(void 0!==d)if(Array.isArray(d))do{d=u[o],void 0!==d&&(t.push(u.time),i.push.apply(i,d)),u=s[a++]}while(void 0!==u);else if(void 0!==d.toArray)do{d=u[o],void 0!==d&&(t.push(u.time),d.toArray(i,i.length)),u=s[a++]}while(void 0!==u);else do{d=u[o],void 0!==d&&(t.push(u.time),i.push(d)),u=s[a++]}while(void 0!==u)},subclip:function(s,t,i,o,a=30){const u=s.clone();u.name=t;const d=[];for(let v=0;v<u.tracks.length;++v){const A=u.tracks[v],P=A.getValueSize(),U=[],N=[];for(let j=0;j<A.times.length;++j){const te=A.times[j]*a;if(!(te<i||te>=o)){U.push(A.times[j]);for(let Z=0;Z<P;++Z)N.push(A.values[j*P+Z])}}0!==U.length&&(A.times=zs.convertArray(U,A.times.constructor),A.values=zs.convertArray(N,A.values.constructor),d.push(A))}u.tracks=d;let p=1/0;for(let v=0;v<u.tracks.length;++v)p>u.tracks[v].times[0]&&(p=u.tracks[v].times[0]);for(let v=0;v<u.tracks.length;++v)u.tracks[v].shift(-1*p);return u.resetDuration(),u},makeClipAdditive:function(s,t=0,i=s,o=30){o<=0&&(o=30);const a=i.tracks.length,u=t/o;for(let d=0;d<a;++d){const p=i.tracks[d],v=p.ValueTypeName;if("bool"===v||"string"===v)continue;const A=s.tracks.find(function(ge){return ge.name===p.name&&ge.ValueTypeName===v});if(void 0===A)continue;let P=0;const U=p.getValueSize();p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(P=U/3);let N=0;const j=A.getValueSize();A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(N=j/3);const te=p.times.length-1;let Z;if(u<=p.times[0])Z=zs.arraySlice(p.values,P,U-P);else if(u>=p.times[te]){const ge=te*U+P;Z=zs.arraySlice(p.values,ge,ge+U-P)}else{const ge=p.createInterpolant(),ye=P,De=U-P;ge.evaluate(u),Z=zs.arraySlice(ge.resultBuffer,ye,De)}"quaternion"===v&&(new no).fromArray(Z).normalize().conjugate().toArray(Z);const q=A.times.length;for(let ge=0;ge<q;++ge){const ye=ge*j+N;if("quaternion"===v)no.multiplyQuaternionsFlat(A.values,ye,Z,0,A.values,ye);else{const De=j-2*N;for(let Le=0;Le<De;++Le)A.values[ye+Le]-=Z[Le]}}}return s.blendMode=2501,s}};class is{constructor(t,i,o,a){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new i.constructor(o),this.sampleValues=i,this.valueSize=o,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let o=this._cachedIndex,a=i[o],u=i[o-1];e:{t:{let d;n:{i:if(!(t<a)){for(let p=o+2;;){if(void 0===a){if(t<u)break i;return o=i.length,this._cachedIndex=o,this.afterEnd_(o-1,t,u)}if(o===p)break;if(u=a,a=i[++o],t<a)break t}d=i.length;break n}if(t>=u)break e;{const p=i[1];t<p&&(o=2,u=p);for(let v=o-2;;){if(void 0===u)return this._cachedIndex=0,this.beforeStart_(0,t,a);if(o===v)break;if(a=u,u=i[--o-1],t>=u)break t}d=o,o=0}}for(;o<d;){const p=o+d>>>1;t<i[p]?d=p:o=p+1}if(a=i[o],u=i[o-1],void 0===u)return this._cachedIndex=0,this.beforeStart_(0,t,a);if(void 0===a)return o=i.length,this._cachedIndex=o,this.afterEnd_(o-1,u,t)}this._cachedIndex=o,this.intervalChanged_(o,u,a)}return this.interpolate_(o,u,t,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,u=t*a;for(let d=0;d!==a;++d)i[d]=o[u+d];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}is.prototype.beforeStart_=is.prototype.copySampleValue_,is.prototype.afterEnd_=is.prototype.copySampleValue_;class $l extends is{constructor(t,i,o,a){super(t,i,o,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:$t,endingEnd:$t}}intervalChanged_(t,i,o){const a=this.parameterPositions;let u=t-2,d=t+1,p=a[u],v=a[d];if(void 0===p)switch(this.getSettings_().endingStart){case xt:u=t,p=2*i-o;break;case 2402:u=a.length-2,p=i+a[u]-a[u+1];break;default:u=t,p=o}if(void 0===v)switch(this.getSettings_().endingEnd){case xt:d=t,v=2*o-i;break;case 2402:d=1,v=o+a[1]-a[0];break;default:d=t-1,v=i}const A=.5*(o-i),P=this.valueSize;this._weightPrev=A/(i-p),this._weightNext=A/(v-o),this._offsetPrev=u*P,this._offsetNext=d*P}interpolate_(t,i,o,a){const u=this.resultBuffer,d=this.sampleValues,p=this.valueSize,v=t*p,A=v-p,P=this._offsetPrev,U=this._offsetNext,N=this._weightPrev,j=this._weightNext,te=(o-i)/(a-i),Z=te*te,q=Z*te,ge=-N*q+2*N*Z-N*te,ye=(1+N)*q+(-1.5-2*N)*Z+(-.5+N)*te+1,De=(-1-j)*q+(1.5+j)*Z+.5*te,Le=j*q-j*Z;for(let Ne=0;Ne!==p;++Ne)u[Ne]=ge*d[P+Ne]+ye*d[A+Ne]+De*d[v+Ne]+Le*d[U+Ne];return u}}class lm extends is{constructor(t,i,o,a){super(t,i,o,a)}interpolate_(t,i,o,a){const u=this.resultBuffer,d=this.sampleValues,p=this.valueSize,v=t*p,A=v-p,P=(o-i)/(a-i),U=1-P;for(let N=0;N!==p;++N)u[N]=d[A+N]*U+d[v+N]*P;return u}}class cm extends is{constructor(t,i,o,a){super(t,i,o,a)}interpolate_(t){return this.copySampleValue_(t-1)}}class Xa{constructor(t,i,o,a){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=zs.convertArray(i,this.TimeBufferType),this.values=zs.convertArray(o,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let o;if(i.toJSON!==this.toJSON)o=i.toJSON(t);else{o={name:t.name,times:zs.convertArray(t.times,Array),values:zs.convertArray(t.values,Array)};const a=t.getInterpolation();a!==t.DefaultInterpolation&&(o.interpolation=a)}return o.type=t.ValueTypeName,o}InterpolantFactoryMethodDiscrete(t){return new cm(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new lm(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new $l(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case 2300:i=this.InterpolantFactoryMethodDiscrete;break;case 2301:i=this.InterpolantFactoryMethodLinear;break;case 2302:i=this.InterpolantFactoryMethodSmooth}if(void 0===i){const o="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(o);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",o),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const i=this.times;for(let o=0,a=i.length;o!==a;++o)i[o]+=t}return this}scale(t){if(1!==t){const i=this.times;for(let o=0,a=i.length;o!==a;++o)i[o]*=t}return this}trim(t,i){const o=this.times,a=o.length;let u=0,d=a-1;for(;u!==a&&o[u]<t;)++u;for(;-1!==d&&o[d]>i;)--d;if(++d,0!==u||d!==a){u>=d&&(d=Math.max(d,1),u=d-1);const p=this.getValueSize();this.times=zs.arraySlice(o,u,d),this.values=zs.arraySlice(this.values,u*p,d*p)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const o=this.times,a=this.values,u=o.length;0===u&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let d=null;for(let p=0;p!==u;p++){const v=o[p];if("number"==typeof v&&isNaN(v)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,p,v),t=!1;break}if(null!==d&&d>v){console.error("THREE.KeyframeTrack: Out of order keys.",this,p,v,d),t=!1;break}d=v}if(void 0!==a&&zs.isTypedArray(a))for(let p=0,v=a.length;p!==v;++p){const A=a[p];if(isNaN(A)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,p,A),t=!1;break}}return t}optimize(){const t=zs.arraySlice(this.times),i=zs.arraySlice(this.values),o=this.getValueSize(),a=2302===this.getInterpolation(),u=t.length-1;let d=1;for(let p=1;p<u;++p){let v=!1;const A=t[p];if(A!==t[p+1]&&(1!==p||A!==t[0]))if(a)v=!0;else{const U=p*o,N=U-o,j=U+o;for(let te=0;te!==o;++te){const Z=i[U+te];if(Z!==i[N+te]||Z!==i[j+te]){v=!0;break}}}if(v){if(p!==d){t[d]=t[p];const U=p*o,N=d*o;for(let j=0;j!==o;++j)i[N+j]=i[U+j]}++d}}if(u>0){t[d]=t[u];for(let p=u*o,v=d*o,A=0;A!==o;++A)i[v+A]=i[p+A];++d}return d!==t.length?(this.times=zs.arraySlice(t,0,d),this.values=zs.arraySlice(i,0,d*o)):(this.times=t,this.values=i),this}clone(){const t=zs.arraySlice(this.times,0),i=zs.arraySlice(this.values,0),a=new(0,this.constructor)(this.name,t,i);return a.createInterpolant=this.createInterpolant,a}}Xa.prototype.TimeBufferType=Float32Array,Xa.prototype.ValueBufferType=Float32Array,Xa.prototype.DefaultInterpolation=2301;class Go extends Xa{}Go.prototype.ValueTypeName="bool",Go.prototype.ValueBufferType=Array,Go.prototype.DefaultInterpolation=2300,Go.prototype.InterpolantFactoryMethodLinear=void 0,Go.prototype.InterpolantFactoryMethodSmooth=void 0;class Rc extends Xa{}Rc.prototype.ValueTypeName="color";class oh extends Xa{}oh.prototype.ValueTypeName="number";class bd extends is{constructor(t,i,o,a){super(t,i,o,a)}interpolate_(t,i,o,a){const u=this.resultBuffer,d=this.sampleValues,p=this.valueSize,v=(o-i)/(a-i);let A=t*p;for(let P=A+p;A!==P;A+=4)no.slerpFlat(u,0,d,A-p,d,A,v);return u}}class ah extends Xa{InterpolantFactoryMethodLinear(t){return new bd(this.times,this.values,this.getValueSize(),t)}}ah.prototype.ValueTypeName="quaternion",ah.prototype.DefaultInterpolation=2301,ah.prototype.InterpolantFactoryMethodSmooth=void 0;class ja extends Xa{}ja.prototype.ValueTypeName="string",ja.prototype.ValueBufferType=Array,ja.prototype.DefaultInterpolation=2300,ja.prototype.InterpolantFactoryMethodLinear=void 0,ja.prototype.InterpolantFactoryMethodSmooth=void 0;class vl extends Xa{}vl.prototype.ValueTypeName="vector";class Lc{constructor(t,i=-1,o,a=2500){this.name=t,this.tracks=o,this.duration=i,this.blendMode=a,this.uuid=bo(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],o=t.tracks,a=1/(t.fps||1);for(let d=0,p=o.length;d!==p;++d)i.push(Bx(o[d]).scale(a));const u=new this(t.name,t.duration,i,t.blendMode);return u.uuid=t.uuid,u}static toJSON(t){const i=[],o=t.tracks,a={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let u=0,d=o.length;u!==d;++u)i.push(Xa.toJSON(o[u]));return a}static CreateFromMorphTargetSequence(t,i,o,a){const u=i.length,d=[];for(let p=0;p<u;p++){let v=[],A=[];v.push((p+u-1)%u,p,(p+1)%u),A.push(0,1,0);const P=zs.getKeyframeOrder(v);v=zs.sortedArray(v,1,P),A=zs.sortedArray(A,1,P),!a&&0===v[0]&&(v.push(u),A.push(A[0])),d.push(new oh(".morphTargetInfluences["+i[p].name+"]",v,A).scale(1/o))}return new this(t,-1,d)}static findByName(t,i){let o=t;if(!Array.isArray(t)){const a=t;o=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<o.length;a++)if(o[a].name===i)return o[a];return null}static CreateClipsFromMorphTargetSequences(t,i,o){const a={},u=/^([\w-]*?)([\d]+)$/;for(let p=0,v=t.length;p<v;p++){const A=t[p],P=A.name.match(u);if(P&&P.length>1){const U=P[1];let N=a[U];N||(a[U]=N=[]),N.push(A)}}const d=[];for(const p in a)d.push(this.CreateFromMorphTargetSequence(p,a[p],i,o));return d}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const o=function(U,N,j,te,Z){if(0!==j.length){const q=[],ge=[];zs.flattenJSON(j,q,ge,te),0!==q.length&&Z.push(new U(N,q,ge))}},a=[],u=t.name||"default",d=t.fps||30,p=t.blendMode;let v=t.length||-1;const A=t.hierarchy||[];for(let U=0;U<A.length;U++){const N=A[U].keys;if(N&&0!==N.length)if(N[0].morphTargets){const j={};let te;for(te=0;te<N.length;te++)if(N[te].morphTargets)for(let Z=0;Z<N[te].morphTargets.length;Z++)j[N[te].morphTargets[Z]]=-1;for(const Z in j){const q=[],ge=[];for(let ye=0;ye!==N[te].morphTargets.length;++ye){const De=N[te];q.push(De.time),ge.push(De.morphTarget===Z?1:0)}a.push(new oh(".morphTargetInfluence["+Z+"]",q,ge))}v=j.length*d}else{const j=".bones["+i[U].name+"]";o(vl,j+".position",N,"pos",a),o(ah,j+".quaternion",N,"rot",a),o(vl,j+".scale",N,"scl",a)}}return 0===a.length?null:new this(u,v,a,p)}resetDuration(){let i=0;for(let o=0,a=this.tracks.length;o!==a;++o){const u=this.tracks[o];i=Math.max(i,u.times[u.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Bx(s){if(void 0===s.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return oh;case"vector":case"vector2":case"vector3":case"vector4":return vl;case"color":return Rc;case"quaternion":return ah;case"bool":case"boolean":return Go;case"string":return ja}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}(s.type);if(void 0===s.times){const i=[],o=[];zs.flattenJSON(s.keys,i,o,"value"),s.times=i,s.values=o}return void 0!==t.parse?t.parse(s):new t(s.name,s.times,s.values,s.interpolation)}const lh={enabled:!1,files:{},add:function(s,t){!1!==this.enabled&&(this.files[s]=t)},get:function(s){if(!1!==this.enabled)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};const um=new class{constructor(t,i,o){const a=this;let v,u=!1,d=0,p=0;const A=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=o,this.itemStart=function(P){p++,!1===u&&void 0!==a.onStart&&a.onStart(P,d,p),u=!0},this.itemEnd=function(P){d++,void 0!==a.onProgress&&a.onProgress(P,d,p),d===p&&(u=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(P){void 0!==a.onError&&a.onError(P)},this.resolveURL=function(P){return v?v(P):P},this.setURLModifier=function(P){return v=P,this},this.addHandler=function(P,U){return A.push(P,U),this},this.removeHandler=function(P){const U=A.indexOf(P);return-1!==U&&A.splice(U,2),this},this.getHandler=function(P){for(let U=0,N=A.length;U<N;U+=2){const j=A[U],te=A[U+1];if(j.global&&(j.lastIndex=0),j.test(P))return te}return null}}};class ec{constructor(t){this.manager=void 0!==t?t:um,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const o=this;return new Promise(function(a,u){o.load(t,a,i,u)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Zs={};class zo extends ec{constructor(t){super(t)}load(t,i,o,a){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const u=lh.get(t);if(void 0!==u)return this.manager.itemStart(t),setTimeout(()=>{i&&i(u),this.manager.itemEnd(t)},0),u;if(void 0!==Zs[t])return void Zs[t].push({onLoad:i,onProgress:o,onError:a});Zs[t]=[],Zs[t].push({onLoad:i,onProgress:o,onError:a});const d=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),p=this.mimeType,v=this.responseType;fetch(d).then(A=>{if(200===A.status||0===A.status){if(0===A.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===A.body||void 0===A.body.getReader)return A;const P=Zs[t],U=A.body.getReader(),N=A.headers.get("Content-Length"),j=N?parseInt(N):0,te=0!==j;let Z=0;const q=new ReadableStream({start(ge){!function ye(){U.read().then(({done:De,value:Le})=>{if(De)ge.close();else{Z+=Le.byteLength;const Ne=new ProgressEvent("progress",{lengthComputable:te,loaded:Z,total:j});for(let tt=0,lt=P.length;tt<lt;tt++){const ct=P[tt];ct.onProgress&&ct.onProgress(Ne)}ge.enqueue(Le),ye()}})}()}});return new Response(q)}throw Error(`fetch for "${A.url}" responded with ${A.status}: ${A.statusText}`)}).then(A=>{switch(v){case"arraybuffer":return A.arrayBuffer();case"blob":return A.blob();case"document":return A.text().then(P=>(new DOMParser).parseFromString(P,p));case"json":return A.json();default:if(void 0===p)return A.text();{const U=/charset="?([^;"\s]*)"?/i.exec(p),N=U&&U[1]?U[1].toLowerCase():void 0,j=new TextDecoder(N);return A.arrayBuffer().then(te=>j.decode(te))}}}).then(A=>{lh.add(t,A);const P=Zs[t];delete Zs[t];for(let U=0,N=P.length;U<N;U++){const j=P[U];j.onLoad&&j.onLoad(A)}}).catch(A=>{const P=Zs[t];if(void 0===P)throw this.manager.itemError(t),A;delete Zs[t];for(let U=0,N=P.length;U<N;U++){const j=P[U];j.onError&&j.onError(A)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Sf extends ec{constructor(t){super(t)}load(t,i,o,a){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const u=this,d=lh.get(t);if(void 0!==d)return u.manager.itemStart(t),setTimeout(function(){i&&i(d),u.manager.itemEnd(t)},0),d;const p=_l("img");function v(){P(),lh.add(t,this),i&&i(this),u.manager.itemEnd(t)}function A(U){P(),a&&a(U),u.manager.itemError(t),u.manager.itemEnd(t)}function P(){p.removeEventListener("load",v,!1),p.removeEventListener("error",A,!1)}return p.addEventListener("load",v,!1),p.addEventListener("error",A,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(p.crossOrigin=this.crossOrigin),u.manager.itemStart(t),p.src=t,p}}class wd extends ec{constructor(t){super(t)}load(t,i,o,a){const u=new Nl,d=new Sf(this.manager);d.setCrossOrigin(this.crossOrigin),d.setPath(this.path);let p=0;function v(A){d.load(t[A],function(P){u.images[A]=P,p++,6===p&&(u.needsUpdate=!0,i&&i(u))},void 0,a)}for(let A=0;A<t.length;++A)v(A);return u}}class yg extends ec{constructor(t){super(t)}load(t,i,o,a){const u=new as,d=new Sf(this.manager);return d.setCrossOrigin(this.crossOrigin),d.setPath(this.path),d.load(t,function(p){u.image=p,u.needsUpdate=!0,void 0!==i&&i(u)},o,a),u}}class Ya extends ns{constructor(t,i=1){super(),this.type="Light",this.color=new Rn(t),this.intensity=i}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),void 0!==this.shadow&&(i.object.shadow=this.shadow.toJSON()),i}}Ya.prototype.isLight=!0;(class extends Ya{constructor(t,i,o){super(t,o),this.type="HemisphereLight",this.position.copy(ns.DefaultUp),this.updateMatrix(),this.groundColor=new Rn(i)}copy(t){return Ya.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}).prototype.isHemisphereLight=!0;const Cf=new _i,hm=new ze,dm=new ze;class Rf{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new st(512,512),this.map=null,this.mapPass=null,this.matrix=new _i,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qd,this._frameExtents=new st(1,1),this._viewportCount=1,this._viewports=[new Oe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,o=this.matrix;hm.setFromMatrixPosition(t.matrixWorld),i.position.copy(hm),dm.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(dm),i.updateMatrixWorld(),Cf.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cf),o.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),o.multiply(i.projectionMatrix),o.multiply(i.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Lf extends Rf{constructor(){super(new Oo(50,1,.5,500)),this.focus=1}updateMatrices(t){const i=this.camera,o=2*ac*t.angle*this.focus,a=this.mapSize.width/this.mapSize.height,u=t.distance||i.far;(o!==i.fov||a!==i.aspect||u!==i.far)&&(i.fov=o,i.aspect=a,i.far=u,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Lf.prototype.isSpotLightShadow=!0;(class extends Ya{constructor(t,i,o=0,a=Math.PI/3,u=0,d=1){super(t,i),this.type="SpotLight",this.position.copy(ns.DefaultUp),this.updateMatrix(),this.target=new ns,this.distance=o,this.angle=a,this.penumbra=u,this.decay=d,this.shadow=new Lf}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;const Df=new _i,ch=new ze,mu=new ze;class Pf extends Rf{constructor(){super(new Oo(90,1,.5,500)),this._frameExtents=new st(4,2),this._viewportCount=6,this._viewports=[new Oe(2,1,1,1),new Oe(0,1,1,1),new Oe(3,1,1,1),new Oe(1,1,1,1),new Oe(3,0,1,1),new Oe(1,0,1,1)],this._cubeDirections=[new ze(1,0,0),new ze(-1,0,0),new ze(0,0,1),new ze(0,0,-1),new ze(0,1,0),new ze(0,-1,0)],this._cubeUps=[new ze(0,1,0),new ze(0,1,0),new ze(0,1,0),new ze(0,1,0),new ze(0,0,1),new ze(0,0,-1)]}updateMatrices(t,i=0){const o=this.camera,a=this.matrix,u=t.distance||o.far;u!==o.far&&(o.far=u,o.updateProjectionMatrix()),ch.setFromMatrixPosition(t.matrixWorld),o.position.copy(ch),mu.copy(o.position),mu.add(this._cubeDirections[i]),o.up.copy(this._cubeUps[i]),o.lookAt(mu),o.updateMatrixWorld(),a.makeTranslation(-ch.x,-ch.y,-ch.z),Df.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Df)}}Pf.prototype.isPointLightShadow=!0;(class extends Ya{constructor(t,i,o=0,a=1){super(t,i),this.type="PointLight",this.distance=o,this.decay=a,this.shadow=new Pf}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}).prototype.isPointLight=!0;class If extends Rf{constructor(){super(new ol(-5,5,5,-5,.5,500))}}If.prototype.isDirectionalLightShadow=!0;(class extends Ya{constructor(t,i){super(t,i),this.type="DirectionalLight",this.position.copy(ns.DefaultUp),this.updateMatrix(),this.target=new ns,this.shadow=new If}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class extends Ya{constructor(t,i){super(t,i),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class extends Ya{constructor(t,i,o=10,a=10){super(t,i),this.type="RectAreaLight",this.width=o,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}).prototype.isRectAreaLight=!0;class Of{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ze)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const o=t.x,a=t.y,u=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.282095),i.addScaledVector(d[1],.488603*a),i.addScaledVector(d[2],.488603*u),i.addScaledVector(d[3],.488603*o),i.addScaledVector(d[4],o*a*1.092548),i.addScaledVector(d[5],a*u*1.092548),i.addScaledVector(d[6],.315392*(3*u*u-1)),i.addScaledVector(d[7],o*u*1.092548),i.addScaledVector(d[8],.546274*(o*o-a*a)),i}getIrradianceAt(t,i){const o=t.x,a=t.y,u=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.886227),i.addScaledVector(d[1],1.023328*a),i.addScaledVector(d[2],1.023328*u),i.addScaledVector(d[3],1.023328*o),i.addScaledVector(d[4],.858086*o*a),i.addScaledVector(d[5],.858086*a*u),i.addScaledVector(d[6],.743125*u*u-.247708),i.addScaledVector(d[7],.858086*o*u),i.addScaledVector(d[8],.429043*(o*o-a*a)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let o=0;o<9;o++)this.coefficients[o].addScaledVector(t.coefficients[o],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let o=0;o<9;o++)this.coefficients[o].lerp(t.coefficients[o],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,i=0){const o=this.coefficients;for(let a=0;a<9;a++)o[a].fromArray(t,i+3*a);return this}toArray(t=[],i=0){const o=this.coefficients;for(let a=0;a<9;a++)o[a].toArray(t,i+3*a);return t}static getBasisAt(t,i){const o=t.x,a=t.y,u=t.z;i[0]=.282095,i[1]=.488603*a,i[2]=.488603*u,i[3]=.488603*o,i[4]=1.092548*o*a,i[5]=1.092548*a*u,i[6]=.315392*(3*u*u-1),i[7]=1.092548*o*u,i[8]=.546274*(o*o-a*a)}}Of.prototype.isSphericalHarmonics3=!0;class uh extends Ya{constructor(t=new Of,i=1){super(void 0,i),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}uh.prototype.isLightProbe=!0;let Td;(class extends Hi{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0,class extends ec{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,o,a){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const u=this,d=lh.get(t);if(void 0!==d)return u.manager.itemStart(t),setTimeout(function(){i&&i(d),u.manager.itemEnd(t)},0),d;const p={};p.credentials="anonymous"===this.crossOrigin?"same-origin":"include",p.headers=this.requestHeader,fetch(t,p).then(function(v){return v.blob()}).then(function(v){return createImageBitmap(v,Object.assign(u.options,{colorSpaceConversion:"none"}))}).then(function(v){lh.add(t,v),i&&i(v),u.manager.itemEnd(t)}).catch(function(v){a&&a(v),u.manager.itemError(t),u.manager.itemEnd(t)}),u.manager.itemStart(t)}}.prototype.isImageBitmapLoader=!0;class ym extends ec{constructor(t){super(t)}load(t,i,o,a){const u=this,d=new zo(this.manager);d.setResponseType("arraybuffer"),d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(t,function(p){try{const v=p.slice(0);(void 0===Td&&(Td=new(window.AudioContext||window.webkitAudioContext)),Td).decodeAudioData(v,function(P){i(P)})}catch(v){a?a(v):console.error(v),u.manager.itemError(t)}},o,a)}}(class extends uh{constructor(t,i,o=1){super(void 0,o);const a=(new Rn).set(t),u=(new Rn).set(i),d=new ze(a.r,a.g,a.b),p=new ze(u.r,u.g,u.b),v=Math.sqrt(Math.PI),A=v*Math.sqrt(.75);this.sh.coefficients[0].copy(d).add(p).multiplyScalar(v),this.sh.coefficients[1].copy(d).sub(p).multiplyScalar(A)}}).prototype.isHemisphereLightProbe=!0,class extends uh{constructor(t,i=1){super(void 0,i);const o=(new Rn).set(t);this.sh.coefficients[0].set(o.r,o.g,o.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class wg{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=bm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=bm();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function bm(){return("undefined"==typeof performance?Date:performance).now()}class Tg{constructor(t,i,o){let a,u,d;switch(this.binding=t,this.valueSize=o,i){case"quaternion":a=this._slerp,u=this._slerpAdditive,d=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*o),this._workIndex=5;break;case"string":case"bool":a=this._select,u=this._select,d=this._setAdditiveIdentityOther,this.buffer=new Array(5*o);break;default:a=this._lerp,u=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*o)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=u,this._setIdentity=d,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const o=this.buffer,a=this.valueSize,u=t*a+a;let d=this.cumulativeWeight;if(0===d){for(let p=0;p!==a;++p)o[u+p]=o[p];d=i}else d+=i,this._mixBufferRegion(o,u,0,i/d,a);this.cumulativeWeight=d}accumulateAdditive(t){const i=this.buffer,o=this.valueSize,a=o*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(i,a,0,t,o),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,o=this.buffer,a=t*i+i,u=this.cumulativeWeight,d=this.cumulativeWeightAdditive,p=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,u<1&&this._mixBufferRegion(o,a,i*this._origIndex,1-u,i),d>0&&this._mixBufferRegionAdditive(o,a,this._addIndex*i,1,i);for(let v=i,A=i+i;v!==A;++v)if(o[v]!==o[v+i]){p.setValue(o,a);break}}saveOriginalState(){const i=this.buffer,o=this.valueSize,a=o*this._origIndex;this.binding.getValue(i,a);for(let u=o,d=a;u!==d;++u)i[u]=i[a+u%o];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let o=t;o<i;o++)this.buffer[o]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let o=0;o<this.valueSize;o++)this.buffer[i+o]=this.buffer[t+o]}_select(t,i,o,a,u){if(a>=.5)for(let d=0;d!==u;++d)t[i+d]=t[o+d]}_slerp(t,i,o,a){no.slerpFlat(t,i,t,i,t,o,a)}_slerpAdditive(t,i,o,a,u){const d=this._workIndex*u;no.multiplyQuaternionsFlat(t,d,t,i,t,o),no.slerpFlat(t,i,t,i,t,d,a)}_lerp(t,i,o,a,u){const d=1-a;for(let p=0;p!==u;++p){const v=i+p;t[v]=t[v]*d+t[o+p]*a}}_lerpAdditive(t,i,o,a,u){for(let d=0;d!==u;++d){const p=i+d;t[p]=t[p]+t[o+d]*a}}}const Nf="\\[\\]\\.:\\/",Em=new RegExp("["+Nf+"]","g"),wm="[^"+Nf+"]",_m="[^"+Nf.replace("\\.","")+"]",Hx=/((?:WC+[\/:])*)/.source.replace("WC",wm),Gx=/(WCOD+)?/.source.replace("WCOD",_m),zx=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wm),Vx=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wm),Wx=new RegExp("^"+Hx+Gx+zx+Vx+"$"),Xx=["material","materials","bones"];class jx{constructor(t,i,o){const a=o||Os.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,a)}getValue(t,i){this.bind();const a=this._bindings[this._targetGroup.nCachedObjects_];void 0!==a&&a.getValue(t,i)}setValue(t,i){const o=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=o.length;a!==u;++a)o[a].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=t.length;i!==o;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=t.length;i!==o;++i)t[i].unbind()}}let Os=(()=>{class s{constructor(i,o,a){this.path=o,this.parsedPath=a||s.parseTrackName(o),this.node=s.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(i,o,a){return i&&i.isAnimationObjectGroup?new s.Composite(i,o,a):new s(i,o,a)}static sanitizeNodeName(i){return i.replace(/\s/g,"_").replace(Em,"")}static parseTrackName(i){const o=Wx.exec(i);if(null===o)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const a={nodeName:o[2],objectName:o[3],objectIndex:o[4],propertyName:o[5],propertyIndex:o[6]},u=a.nodeName&&a.nodeName.lastIndexOf(".");if(void 0!==u&&-1!==u){const d=a.nodeName.substring(u+1);-1!==Xx.indexOf(d)&&(a.nodeName=a.nodeName.substring(0,u),a.objectName=d)}if(null===a.propertyName||0===a.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return a}static findNode(i,o){if(void 0===o||""===o||"."===o||-1===o||o===i.name||o===i.uuid)return i;if(i.skeleton){const a=i.skeleton.getBoneByName(o);if(void 0!==a)return a}if(i.children){const a=function(d){for(let p=0;p<d.length;p++){const v=d[p];if(v.name===o||v.uuid===o)return v;const A=a(v.children);if(A)return A}return null},u=a(i.children);if(u)return u}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(i,o){i[o]=this.targetObject[this.propertyName]}_getValue_array(i,o){const a=this.resolvedProperty;for(let u=0,d=a.length;u!==d;++u)i[o++]=a[u]}_getValue_arrayElement(i,o){i[o]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(i,o){this.resolvedProperty.toArray(i,o)}_setValue_direct(i,o){this.targetObject[this.propertyName]=i[o]}_setValue_direct_setNeedsUpdate(i,o){this.targetObject[this.propertyName]=i[o],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(i,o){this.targetObject[this.propertyName]=i[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(i,o){const a=this.resolvedProperty;for(let u=0,d=a.length;u!==d;++u)a[u]=i[o++]}_setValue_array_setNeedsUpdate(i,o){const a=this.resolvedProperty;for(let u=0,d=a.length;u!==d;++u)a[u]=i[o++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(i,o){const a=this.resolvedProperty;for(let u=0,d=a.length;u!==d;++u)a[u]=i[o++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(i,o){this.resolvedProperty[this.propertyIndex]=i[o]}_setValue_arrayElement_setNeedsUpdate(i,o){this.resolvedProperty[this.propertyIndex]=i[o],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(i,o){this.resolvedProperty[this.propertyIndex]=i[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(i,o){this.resolvedProperty.fromArray(i,o)}_setValue_fromArray_setNeedsUpdate(i,o){this.resolvedProperty.fromArray(i,o),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(i,o){this.resolvedProperty.fromArray(i,o),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(i,o){this.bind(),this.getValue(i,o)}_setValue_unbound(i,o){this.bind(),this.setValue(i,o)}bind(){let i=this.node;const o=this.parsedPath,a=o.objectName,u=o.propertyName;let d=o.propertyIndex;if(i||(i=s.findNode(this.rootNode,o.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(a){let P=o.objectIndex;switch(a){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(let U=0;U<i.length;U++)if(i[U].name===P){P=U;break}break;default:if(void 0===i[a])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[a]}if(void 0!==P){if(void 0===i[P])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[P]}}const p=i[u];if(void 0===p)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+o.nodeName+"."+u+" but it wasn't found.",i);let v=this.Versioning.None;this.targetObject=i,void 0!==i.needsUpdate?v=this.Versioning.NeedsUpdate:void 0!==i.matrixWorldNeedsUpdate&&(v=this.Versioning.MatrixWorldNeedsUpdate);let A=this.BindingType.Direct;if(void 0!==d){if("morphTargetInfluences"===u){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==i.morphTargetDictionary[d]&&(d=i.morphTargetDictionary[d])}A=this.BindingType.ArrayElement,this.resolvedProperty=p,this.propertyIndex=d}else void 0!==p.fromArray&&void 0!==p.toArray?(A=this.BindingType.HasFromToArray,this.resolvedProperty=p):Array.isArray(p)?(A=this.BindingType.EntireArray,this.resolvedProperty=p):this.propertyName=u;this.getValue=this.GetterByBindingType[A],this.setValue=this.SetterByBindingTypeAndVersioning[A][v]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return s.Composite=jx,s})();Os.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Os.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Os.prototype.GetterByBindingType=[Os.prototype._getValue_direct,Os.prototype._getValue_array,Os.prototype._getValue_arrayElement,Os.prototype._getValue_toArray],Os.prototype.SetterByBindingTypeAndVersioning=[[Os.prototype._setValue_direct,Os.prototype._setValue_direct_setNeedsUpdate,Os.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Os.prototype._setValue_array,Os.prototype._setValue_array_setNeedsUpdate,Os.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Os.prototype._setValue_arrayElement,Os.prototype._setValue_arrayElement_setNeedsUpdate,Os.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Os.prototype._setValue_fromArray,Os.prototype._setValue_fromArray_setNeedsUpdate,Os.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Sg{constructor(t,i,o=null,a=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=o,this.blendMode=a;const u=i.tracks,d=u.length,p=new Array(d),v={endingStart:$t,endingEnd:$t};for(let A=0;A!==d;++A){const P=u[A].createInterpolant(null);p[A]=P,P.settings=v}this._interpolantSettings=v,this._interpolants=p,this._propertyBindings=new Array(d),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,o){if(t.fadeOut(i),this.fadeIn(i),o){const a=this._clip.duration,u=t._clip.duration,p=a/u;t.warp(1,u/a,i),this.warp(p,1,i)}return this}crossFadeTo(t,i,o){return t.crossFadeFrom(this,i,o)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,o){const a=this._mixer,u=a.time,d=this.timeScale;let p=this._timeScaleInterpolant;null===p&&(p=a._lendControlInterpolant(),this._timeScaleInterpolant=p);const v=p.parameterPositions,A=p.sampleValues;return v[0]=u,v[1]=u+o,A[0]=t/d,A[1]=i/d,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,o,a){if(!this.enabled)return void this._updateWeight(t);const u=this._startTime;if(null!==u){const v=(t-u)*o;if(v<0||0===o)return;this._startTime=null,i=o*v}i*=this._updateTimeScale(t);const d=this._updateTime(i),p=this._updateWeight(t);if(p>0){const v=this._interpolants,A=this._propertyBindings;switch(this.blendMode){case 2501:for(let P=0,U=v.length;P!==U;++P)v[P].evaluate(d),A[P].accumulateAdditive(p);break;case 2500:default:for(let P=0,U=v.length;P!==U;++P)v[P].evaluate(d),A[P].accumulate(a,p)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const o=this._weightInterpolant;if(null!==o){const a=o.evaluate(t)[0];i*=a,t>o.parameterPositions[1]&&(this.stopFading(),0===a&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const o=this._timeScaleInterpolant;null!==o&&(i*=o.evaluate(t)[0],t>o.parameterPositions[1]&&(this.stopWarping(),0===i?this.paused=!0:this.timeScale=i))}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,o=this.loop;let a=this.time+t,u=this._loopCount;const d=2202===o;if(0===t)return-1===u?a:d&&1==(1&u)?i-a:a;if(2200===o){-1===u&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=i)a=i;else{if(!(a<0)){this.time=a;break e}a=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===u&&(t>=0?(u=0,this._setEndings(!0,0===this.repetitions,d)):this._setEndings(0===this.repetitions,!0,d)),a>=i||a<0){const p=Math.floor(a/i);a-=i*p,u+=Math.abs(p);const v=this.repetitions-u;if(v<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=t>0?i:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===v){const A=t<0;this._setEndings(A,!A,d)}else this._setEndings(!1,!1,d);this._loopCount=u,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:p})}}else this.time=a;if(d&&1==(1&u))return i-a}return a}_setEndings(t,i,o){const a=this._interpolantSettings;o?(a.endingStart=xt,a.endingEnd=xt):(a.endingStart=t?this.zeroSlopeAtStart?xt:$t:2402,a.endingEnd=i?this.zeroSlopeAtEnd?xt:$t:2402)}_scheduleFading(t,i,o){const a=this._mixer,u=a.time;let d=this._weightInterpolant;null===d&&(d=a._lendControlInterpolant(),this._weightInterpolant=d);const p=d.parameterPositions,v=d.sampleValues;return p[0]=u,v[0]=i,p[1]=u+t,v[1]=o,this}}(class extends $a{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const o=t._localRoot||this._root,a=t._clip.tracks,u=a.length,d=t._propertyBindings,p=t._interpolants,v=o.uuid,A=this._bindingsByRootAndName;let P=A[v];void 0===P&&(P={},A[v]=P);for(let U=0;U!==u;++U){const N=a[U],j=N.name;let te=P[j];if(void 0!==te)++te.referenceCount,d[U]=te;else{if(te=d[U],void 0!==te){null===te._cacheIndex&&(++te.referenceCount,this._addInactiveBinding(te,v,j));continue}te=new Tg(Os.create(o,j,i&&i._propertyBindings[U].binding.parsedPath),N.ValueTypeName,N.getValueSize()),++te.referenceCount,this._addInactiveBinding(te,v,j),d[U]=te}p[U].resultBuffer=te.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const o=(t._localRoot||this._root).uuid,a=t._clip.uuid,u=this._actionsByClip[a];this._bindAction(t,u&&u.knownActions[0]),this._addInactiveAction(t,a,o)}const i=t._propertyBindings;for(let o=0,a=i.length;o!==a;++o){const u=i[o];0==u.useCount++&&(this._lendBinding(u),u.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let o=0,a=i.length;o!==a;++o){const u=i[o];0==--u.useCount&&(u.restoreOriginalState(),this._takeBackBinding(u))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return null!==i&&i<this._nActiveActions}_addInactiveAction(t,i,o){const a=this._actions,u=this._actionsByClip;let d=u[i];if(void 0===d)d={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,u[i]=d;else{const p=d.knownActions;t._byClipCacheIndex=p.length,p.push(t)}t._cacheIndex=a.length,a.push(t),d.actionByRoot[o]=t}_removeInactiveAction(t){const i=this._actions,o=i[i.length-1],a=t._cacheIndex;o._cacheIndex=a,i[a]=o,i.pop(),t._cacheIndex=null;const u=t._clip.uuid,d=this._actionsByClip,p=d[u],v=p.knownActions,A=v[v.length-1],P=t._byClipCacheIndex;A._byClipCacheIndex=P,v[P]=A,v.pop(),t._byClipCacheIndex=null,delete p.actionByRoot[(t._localRoot||this._root).uuid],0===v.length&&delete d[u],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let o=0,a=i.length;o!==a;++o){const u=i[o];0==--u.referenceCount&&this._removeInactiveBinding(u)}}_lendAction(t){const i=this._actions,o=t._cacheIndex,a=this._nActiveActions++,u=i[a];t._cacheIndex=a,i[a]=t,u._cacheIndex=o,i[o]=u}_takeBackAction(t){const i=this._actions,o=t._cacheIndex,a=--this._nActiveActions,u=i[a];t._cacheIndex=a,i[a]=t,u._cacheIndex=o,i[o]=u}_addInactiveBinding(t,i,o){const a=this._bindingsByRootAndName,u=this._bindings;let d=a[i];void 0===d&&(d={},a[i]=d),d[o]=t,t._cacheIndex=u.length,u.push(t)}_removeInactiveBinding(t){const i=this._bindings,o=t.binding,a=o.rootNode.uuid,u=o.path,d=this._bindingsByRootAndName,p=d[a],v=i[i.length-1],A=t._cacheIndex;v._cacheIndex=A,i[A]=v,i.pop(),delete p[u],0===Object.keys(p).length&&delete d[a]}_lendBinding(t){const i=this._bindings,o=t._cacheIndex,a=this._nActiveBindings++,u=i[a];t._cacheIndex=a,i[a]=t,u._cacheIndex=o,i[o]=u}_takeBackBinding(t){const i=this._bindings,o=t._cacheIndex,a=--this._nActiveBindings,u=i[a];t._cacheIndex=a,i[a]=t,u._cacheIndex=o,i[o]=u}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let o=t[i];return void 0===o&&(o=new lm(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),o.__cacheIndex=i,t[i]=o),o}_takeBackControlInterpolant(t){const i=this._controlInterpolants,o=t.__cacheIndex,a=--this._nActiveControlInterpolants,u=i[a];t.__cacheIndex=a,i[a]=t,u.__cacheIndex=o,i[o]=u}clipAction(t,i,o){const a=i||this._root,u=a.uuid;let d="string"==typeof t?Lc.findByName(a,t):t;const p=null!==d?d.uuid:t,v=this._actionsByClip[p];let A=null;if(void 0===o&&(o=null!==d?d.blendMode:2500),void 0!==v){const U=v.actionByRoot[u];if(void 0!==U&&U.blendMode===o)return U;A=v.knownActions[0],null===d&&(d=A._clip)}if(null===d)return null;const P=new Sg(this,d,i,o);return this._bindAction(P,A),this._addInactiveAction(P,p,u),P}existingAction(t,i){const o=i||this._root,a=o.uuid,u="string"==typeof t?Lc.findByName(o,t):t,p=this._actionsByClip[u?u.uuid:t];return void 0!==p&&p.actionByRoot[a]||null}stopAllAction(){const t=this._actions;for(let o=this._nActiveActions-1;o>=0;--o)t[o].stop();return this}update(t){const i=this._actions,o=this._nActiveActions,a=this.time+=t*=this.timeScale,u=Math.sign(t),d=this._accuIndex^=1;for(let A=0;A!==o;++A)i[A]._update(a,t,u,d);const p=this._bindings,v=this._nActiveBindings;for(let A=0;A!==v;++A)p[A].apply(d);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,o=t.uuid,a=this._actionsByClip,u=a[o];if(void 0!==u){const d=u.knownActions;for(let p=0,v=d.length;p!==v;++p){const A=d[p];this._deactivateAction(A);const P=A._cacheIndex,U=i[i.length-1];A._cacheIndex=null,A._byClipCacheIndex=null,U._cacheIndex=P,i[P]=U,i.pop(),this._removeInactiveBindingsForAction(A)}delete a[o]}}uncacheRoot(t){const i=t.uuid,o=this._actionsByClip;for(const d in o){const v=o[d].actionByRoot[i];void 0!==v&&(this._deactivateAction(v),this._removeInactiveAction(v))}const u=this._bindingsByRootAndName[i];if(void 0!==u)for(const d in u){const p=u[d];p.restoreOriginalState(),this._removeInactiveBinding(p)}}uncacheAction(t,i){const o=this.existingAction(t,i);null!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class ic{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new ic(void 0===this.value.clone?this.value:this.value.clone())}}(class extends al{constructor(t,i,o=1){super(t,i),this.meshPerAttribute=o}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}).prototype.isInstancedInterleavedBuffer=!0;const Dg=new st;class ph{constructor(t=new st(1/0,1/0),i=new st(-1/0,-1/0)){this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,o=t.length;i<o;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const o=Dg.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Dg.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}ph.prototype.isBox2=!0;const Oc=new ze,Qa=new _i,mh=new _i;function Sm(s){const t=[];!0===s.isBone&&t.push(s);for(let i=0;i<s.children.length;i++)t.push.apply(t,Sm(s.children[i]));return t}const Lm=new ArrayBuffer(4),Za=(new Float32Array(Lm),new Uint32Array(Lm),new Uint32Array(512)),qa=new Uint32Array(512);for(let s=0;s<256;++s){const t=s-127;t<-27?(Za[s]=0,Za[256|s]=32768,qa[s]=24,qa[256|s]=24):t<-14?(Za[s]=1024>>-t-14,Za[256|s]=1024>>-t-14|32768,qa[s]=-t-1,qa[256|s]=-t-1):t<=15?(Za[s]=t+15<<10,Za[256|s]=t+15<<10|32768,qa[s]=13,qa[256|s]=13):t<128?(Za[s]=31744,Za[256|s]=64512,qa[s]=24,qa[256|s]=24):(Za[s]=31744,Za[256|s]=64512,qa[s]=13,qa[256|s]=13)}const Dm=new Uint32Array(2048),vh=new Uint32Array(64),Ng=new Uint32Array(64);for(let s=1;s<1024;++s){let t=s<<13,i=0;for(;0==(8388608&t);)t<<=1,i-=8388608;t&=-8388609,i+=947912704,Dm[s]=t|i}for(let s=1024;s<2048;++s)Dm[s]=939524096+(s-1024<<13);for(let s=1;s<31;++s)vh[s]=s<<23;vh[31]=1199570944,vh[32]=2147483648;for(let s=33;s<63;++s)vh[s]=2147483648+(s-32<<23);vh[63]=3347054592;for(let s=1;s<64;++s)32!==s&&(Ng[s]=1024);ha.create=function(s,t){return console.log("THREE.Curve.create() has been deprecated"),s.prototype=Object.create(ha.prototype),s.prototype.constructor=s,s.prototype.getPoint=t,s},hd.prototype.fromPoints=function(s){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(s)},class extends ia{constructor(t=10,i=10,o=4473924,a=8947848){o=new Rn(o),a=new Rn(a);const u=i/2,d=t/i,p=t/2,v=[],A=[];for(let N=0,j=0,te=-p;N<=i;N++,te+=d){v.push(-p,0,te,p,0,te),v.push(te,0,-p,te,0,p);const Z=N===u?o:a;Z.toArray(A,j),j+=3,Z.toArray(A,j),j+=3,Z.toArray(A,j),j+=3,Z.toArray(A,j),j+=3}const P=new Hi;P.setAttribute("position",new Vn(v,3)),P.setAttribute("color",new Vn(A,3)),super(P,new xo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends ia{constructor(t){const i=Sm(t),o=new Hi,a=[],u=[],d=new Rn(0,0,1),p=new Rn(0,1,0);for(let A=0;A<i.length;A++){const P=i[A];P.parent&&P.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),u.push(d.r,d.g,d.b),u.push(p.r,p.g,p.b))}o.setAttribute("position",new Vn(a,3)),o.setAttribute("color",new Vn(u,3)),super(o,new xo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,o=this.geometry,a=o.getAttribute("position");mh.copy(this.root.matrixWorld).invert();for(let u=0,d=0;u<i.length;u++){const p=i[u];p.parent&&p.parent.isBone&&(Qa.multiplyMatrices(mh,p.matrixWorld),Oc.setFromMatrixPosition(Qa),a.setXYZ(d,Oc.x,Oc.y,Oc.z),Qa.multiplyMatrices(mh,p.parent.matrixWorld),Oc.setFromMatrixPosition(Qa),a.setXYZ(d+1,Oc.x,Oc.y,Oc.z),d+=2)}o.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ec.prototype.extractUrlBase=function(s){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let i="";for(let o=0,a=t.length;o<a;o++)i+=String.fromCharCode(t[o]);try{return decodeURIComponent(escape(i))}catch(o){return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return-1===i?"./":t.slice(0,i+1)}static resolveURL(t,i){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}.extractUrlBase(s)},ec.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},ph.prototype.center=function(s){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(s)},ph.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ph.prototype.isIntersectionBox=function(s){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},ph.prototype.size=function(s){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(s)},Eo.prototype.center=function(s){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(s)},Eo.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Eo.prototype.isIntersectionBox=function(s){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},Eo.prototype.isIntersectionSphere=function(s){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)},Eo.prototype.size=function(s){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(s)},Yc.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},$o.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},qd.prototype.setFromMatrix=function(s){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(s)},Hr.prototype.flattenToArrayOffset=function(s,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,t)},Hr.prototype.multiplyVector3=function(s){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),s.applyMatrix3(this)},Hr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Hr.prototype.applyToBufferAttribute=function(s){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),s.applyMatrix3(this)},Hr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Hr.prototype.getInverse=function(s){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(s).invert()},_i.prototype.extractPosition=function(s){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(s)},_i.prototype.flattenToArrayOffset=function(s,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,t)},_i.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new ze).setFromMatrixColumn(this,3)},_i.prototype.setRotationFromQuaternion=function(s){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(s)},_i.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},_i.prototype.multiplyVector3=function(s){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},_i.prototype.multiplyVector4=function(s){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},_i.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},_i.prototype.rotateAxis=function(s){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),s.transformDirection(this)},_i.prototype.crossVector=function(s){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},_i.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},_i.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},_i.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},_i.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},_i.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},_i.prototype.applyToBufferAttribute=function(s){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},_i.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},_i.prototype.makeFrustum=function(s,t,i,o,a,u){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(s,t,o,i,a,u)},_i.prototype.getInverse=function(s){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(s).invert()},kl.prototype.isIntersectionLine=function(s){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(s)},no.prototype.multiplyVector3=function(s){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),s.applyQuaternion(this)},no.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},wo.prototype.isIntersectionBox=function(s){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},wo.prototype.isIntersectionPlane=function(s){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(s)},wo.prototype.isIntersectionSphere=function(s){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)},ro.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},ro.prototype.barycoordFromPoint=function(s,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(s,t)},ro.prototype.midpoint=function(s){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(s)},ro.prototypenormal=function(s){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(s)},ro.prototype.plane=function(s){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(s)},ro.barycoordFromPoint=function(s,t,i,o,a){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ro.getBarycoord(s,t,i,o,a)},ro.normal=function(s,t,i,o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ro.getNormal(s,t,i,o)},da.prototype.extractAllPoints=function(s){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(s)},da.prototype.extrude=function(s){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Zl(this,s)},da.prototype.makeGeometry=function(s){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Va(this,s)},st.prototype.fromAttribute=function(s,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,t,i)},st.prototype.distanceToManhattan=function(s){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(s)},st.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ze.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ze.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ze.prototype.getPositionFromMatrix=function(s){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(s)},ze.prototype.getScaleFromMatrix=function(s){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(s)},ze.prototype.getColumnFromMatrix=function(s,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,s)},ze.prototype.applyProjection=function(s){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(s)},ze.prototype.fromAttribute=function(s,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,t,i)},ze.prototype.distanceToManhattan=function(s){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(s)},ze.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Oe.prototype.fromAttribute=function(s,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,t,i)},Oe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ns.prototype.getChildByName=function(s){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(s)},ns.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},ns.prototype.translate=function(s,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,s)},ns.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},ns.prototype.applyMatrix=function(s){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(s)},Object.defineProperties(ns.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(s){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=s}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),yo.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(yo.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),sf.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Oo.prototype.setLens=function(s,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(s)},Object.defineProperties(Ya.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(s){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=s}},shadowCameraLeft:{set:function(s){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=s}},shadowCameraRight:{set:function(s){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=s}},shadowCameraTop:{set:function(s){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=s}},shadowCameraBottom:{set:function(s){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=s}},shadowCameraNear:{set:function(s){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=s}},shadowCameraFar:{set:function(s){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=s}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(s){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=s}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(s){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=s}},shadowMapHeight:{set:function(s){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=s}}}),Object.defineProperties(ls.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Du},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Du)}}}),ls.prototype.setDynamic=function(s){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===s?Du:Mh),this},ls.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},ls.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Hi.prototype.addIndex=function(s){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(s)},Hi.prototype.addAttribute=function(s,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===s?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(s,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(s,new ls(arguments[1],arguments[2])))},Hi.prototype.addDrawCall=function(s,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(s,t)},Hi.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Hi.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Hi.prototype.removeAttribute=function(s){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(s)},Hi.prototype.applyMatrix=function(s){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(s)},Object.defineProperties(Hi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),al.prototype.setDynamic=function(s){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===s?Du:Mh),this},al.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Zl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Zl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Zl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},nu.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},ic.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(so.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Rn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(s){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===s}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(s){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=s}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ho.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(s){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=s}}}),vs.prototype.clearTarget=function(s,t,i,o){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(s),this.clear(t,i,o)},vs.prototype.animate=function(s){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(s)},vs.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},vs.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},vs.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},vs.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},vs.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},vs.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},vs.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},vs.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},vs.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},vs.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},vs.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},vs.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},vs.prototype.enableScissorTest=function(s){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(s)},vs.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},vs.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},vs.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},vs.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},vs.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},vs.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},vs.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},vs.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},vs.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},vs.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(vs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=s}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=s}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(s){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===s?Kn:Ui}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(cg.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Io.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=s}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=s}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=s}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=s}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(s){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=s}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(s){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=s}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(s){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=s}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(s){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=s}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(s){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=s}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(s){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=s}}}),class extends ns{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(s){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new ym).load(s,function(o){t.setBuffer(o)}),this},Wu.prototype.updateCubeMap=function(s,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(s,t)},Wu.prototype.clear=function(s,t,i,o){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(s,t,i,o)},Or.crossOrigin=void 0,Or.loadTexture=function(s,t,i,o){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const a=new yg;a.setCrossOrigin(this.crossOrigin);const u=a.load(s,i,void 0,o);return t&&(u.mapping=t),u},Or.loadTextureCube=function(s,t,i,o){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const a=new wd;a.setCrossOrigin(this.crossOrigin);const u=a.load(s,i,void 0,o);return t&&(u.mapping=t),u},Or.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Or.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139");const C={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class L{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const G=new ol(-1,1,1,-1,0,1),z=new Hi;z.setAttribute("position",new Vn([-1,3,0,-1,-1,0,3,-1,0],3)),z.setAttribute("uv",new Vn([0,2,0,0,2,0],2));class X{constructor(t){this._mesh=new yo(z,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,G)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Q extends L{constructor(t,i){super(),this.textureID=void 0!==i?i:"tDiffuse",t instanceof Ho?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Nh.clone(t.uniforms),this.material=new Ho({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new X(this.material)}render(t,i,o){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=o.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class re extends L{constructor(t,i){super(),this.scene=t,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,i,o){const a=t.getContext(),u=t.state;let d,p;u.buffers.color.setMask(!1),u.buffers.depth.setMask(!1),u.buffers.color.setLocked(!0),u.buffers.depth.setLocked(!0),this.inverse?(d=0,p=1):(d=1,p=0),u.buffers.stencil.setTest(!0),u.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),u.buffers.stencil.setFunc(a.ALWAYS,d,4294967295),u.buffers.stencil.setClear(p),u.buffers.stencil.setLocked(!0),t.setRenderTarget(o),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),u.buffers.color.setLocked(!1),u.buffers.depth.setLocked(!1),u.buffers.stencil.setLocked(!1),u.buffers.stencil.setFunc(a.EQUAL,1,4294967295),u.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),u.buffers.stencil.setLocked(!0)}}class ue extends L{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class Te{constructor(t,i){if(this.renderer=t,void 0===i){const o=t.getSize(new st);this._pixelRatio=t.getPixelRatio(),this._width=o.width,this._height=o.height,(i=new Io(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===C&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Q&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Q(C),this.clock=new wg}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,i){this.passes.splice(i,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const i=this.passes.indexOf(t);-1!==i&&this.passes.splice(i,1)}isLastEnabledPass(t){for(let i=t+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const i=this.renderer.getRenderTarget();let o=!1;for(let a=0,u=this.passes.length;a<u;a++){const d=this.passes[a];if(!1!==d.enabled){if(d.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),d.render(this.renderer,this.writeBuffer,this.readBuffer,t,o),d.needsSwap){if(o){const p=this.renderer.getContext(),v=this.renderer.state.buffers.stencil;v.setFunc(p.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),v.setFunc(p.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==re&&(d instanceof re?o=!0:d instanceof ue&&(o=!1))}}this.renderer.setRenderTarget(i)}reset(t){if(void 0===t){const i=this.renderer.getSize(new st);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,i){this._width=t,this._height=i;const o=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(o,a),this.renderTarget2.setSize(o,a);for(let u=0;u<this.passes.length;u++)this.passes[u].setSize(o,a)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new ol(-1,1,1,-1,0,1);const Be=new Hi;Be.setAttribute("position",new Vn([-1,3,0,-1,-1,0,3,-1,0],3)),Be.setAttribute("uv",new Vn([0,2,0,0,2,0],2));class Ve extends L{constructor(t,i,o,a,u){super(),this.scene=t,this.camera=i,this.overrideMaterial=o,this.clearColor=a,this.clearAlpha=void 0!==u?u:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Rn}render(t,i,o){const a=t.autoClear;let u,d;t.autoClear=!1,void 0!==this.overrideMaterial&&(d=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),u=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:o),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,u),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=d),t.autoClear=a}}var Di=class extends Ho{constructor(s=new st){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ic(null),texelSize:new ic(new st),halfTexelSize:new ic(new st),kernel:new ic(0),scale:new ic(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(s.x,s.y)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.inputBuffer=s}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(){return this.uniforms.scale.value}setScale(s){this.uniforms.scale.value=s}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(s){this.uniforms.kernel.value=s}setKernel(s){this.kernel=s}setTexelSize(s,t){this.uniforms.texelSize.value.set(s,t),this.uniforms.halfTexelSize.value.set(s,t).multiplyScalar(.5)}setSize(s,t){const i=this.uniforms;i.texelSize.value.set(1/s,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},fa=new kh,gs=null;new Rn;var _s=class extends $a{constructor(s,t=-1,i=-1,o=1){super(),this.resizable=s,this.base=new st(1,1),this.preferred=new st(t,i),this.target=this.preferred,this.s=o}get width(){const{base:s,preferred:t,scale:i}=this;let o;return o=-1!==t.width?t.width:-1!==t.height?Math.round(t.height*(s.width/Math.max(s.height,1))):Math.round(s.width*i),o}set width(s){this.preferredWidth=s}get height(){const{base:s,preferred:t,scale:i}=this;let o;return o=-1!==t.height?t.height:-1!==t.width?Math.round(t.width/Math.max(s.width/Math.max(s.height,1),1)):Math.round(s.height*i),o}set height(s){this.preferredHeight=s}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(s){this.s!==s&&(this.s=s,this.preferred.setScalar(-1),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(s){this.scale=s}get baseWidth(){return this.base.width}set baseWidth(s){this.base.width!==s&&(this.base.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(s){this.base.width!==s&&(this.base.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(s){this.base.height!==s&&(this.base.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(s){this.baseHeight=s}setBaseSize(s,t){(this.base.width!==s||this.base.height!==t)&&(this.base.set(s,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(s){this.preferred.width!==s&&(this.preferred.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(s){this.preferredWidth=s}get preferredHeight(){return this.preferred.height}set preferredHeight(s){this.preferred.height!==s&&(this.preferred.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(s){this.preferredHeight=s}setPreferredSize(s,t){(this.preferred.width!==s||this.preferred.height!==t)&&(this.preferred.set(s,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(s){this.base.set(s.getBaseWidth(),s.getBaseHeight()),this.preferred.set(s.getPreferredWidth(),s.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return-1}};new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]);var bE=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Ah={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5};function dA(s,t,i){return s+(t-s)*i}function ra(s,t,i,o){const a=dA(s,t,.75),u=dA(i,o,.75);return dA(a,u,.875)}Set,new ze,new _i,new Rn,Math,new ze,new ze,new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),ra(0,0,0,0),new Float32Array([0,0,0,0]),ra(0,0,0,1),new Float32Array([0,0,0,1]),ra(0,0,1,0),new Float32Array([0,0,1,0]),ra(0,0,1,1),new Float32Array([0,0,1,1]),ra(0,1,0,0),new Float32Array([0,1,0,0]),ra(0,1,0,1),new Float32Array([0,1,0,1]),ra(0,1,1,0),new Float32Array([0,1,1,0]),ra(0,1,1,1),new Float32Array([0,1,1,1]),ra(1,0,0,0),new Float32Array([1,0,0,0]),ra(1,0,0,1),new Float32Array([1,0,0,1]),ra(1,0,1,0),new Float32Array([1,0,1,0]),ra(1,0,1,1),new Float32Array([1,0,1,1]),ra(1,1,0,0),new Float32Array([1,1,0,0]),ra(1,1,0,1),new Float32Array([1,1,0,1]),ra(1,1,1,0),new Float32Array([1,1,1,0]),ra(1,1,1,1),new Float32Array([1,1,1,1]),pa(129);var Nm,Vb,Hm,wh=0,zb=-1,mA=!1;function x1(){document.getElementById("skybox").setAttribute("src",Nm.linkto);var t=document.getElementById("spots"),i=Vb.parentElement.getAttribute("id");t.emit("reloadspots",{newspots:Nm.spotgroup,currspots:i}),this.emit("zoomout")}AFRAME.registerComponent("hotspots",{init:function(){this.el.addEventListener("reloadspots",function(s){document.getElementById(s.detail.currspots).setAttribute("scale","0 0 0"),document.getElementById(s.detail.newspots).setAttribute("scale","1 1 1")})}}),AFRAME.registerComponent("spot",{schema:{linkto:{type:"string",default:""},spotgroup:{type:"string",default:""}},init:function(){this.el.setAttribute("src","#hotspot"),this.el.setAttribute("class","clickable"),this.el.setAttribute("scale","1.5 1.5 1.5");var s=this.data,t=document.querySelector("a-scene");this.el.addEventListener("click",function(){Nm=s,Vb=this;var i=document.getElementById("cam");(function(s){w1.forEach(t=>{t.showOn===s?setTimeout(()=>{t.el.setAttribute("scale","0.5 0.5 0.5")},400):t.el.setAttribute("scale","0 0 0")})})(Nm.linkto),i.emit("zoomin"),t.emit("playTransitionEffect",{data:4}),setTimeout(()=>{mA=!0},200),setTimeout(()=>{Hm.kernelSize=Ah.HUGE},300),setTimeout(()=>{mA=!1,Hm.kernelSize=Ah.VERY_LARGE;var o=Nm.linkto.replace("#room","");parseInt(o)},500)})}}),AFRAME.registerComponent("init_animations",{schema:{number_of_rooms:{default:"0"},start_room:{default:"#room0"},theme:{default:0}},init:function(){var s=document.getElementById("cam");(t=document.querySelector("a-scene")).renderer.sortObjects=!0,s.addEventListener("animationcomplete",x1);var i=this.data;wh=i.number_of_rooms,zb=i.theme;var o=document.getElementById("skybox"),a=document.getElementById("loagind_screen"),u=document.getElementById("backGround");!function(s){var t=document.getElementById("progress"),i=7;function o(a,u){++i>=a&&i<=u&&null!==document.getElementById("counter")&&(document.getElementById("counter").innerHTML=i+"%",t.style.width=i+"%")}for(let a=7;a<99;a++)setTimeout(()=>{o(a,a+2)},a*s/100)}(350*wh);for(let A=0;A<wh;A++)setTimeout(()=>{o.setAttribute("src","#room"+A)},350*A);setTimeout(()=>{o.setAttribute("src",i.start_room),a.style.display="none",u.style.display="none",document.querySelector("a-scene").emit("playMusic",{test:4});var P=i.start_room.replace("#room","");parseInt(P)},350*wh);var t=document.querySelector("a-scene"),d=document.createElement("a-circle");d.setAttribute("scale","0.85 0.85 0.85"),d.setAttribute("position","0 -3 0"),d.setAttribute("rotation","-90 0 0"),d.setAttribute("color","#FF5D47"),t.appendChild(d);var p=document.createElement("a-circle");if(p.setAttribute("scale","1.270 1.270 1.270"),p.setAttribute("color","#000"),p.setAttribute("position","0 -3.1 0"),p.setAttribute("rotation","-90 0 0"),t.appendChild(p),-1===zb){var v=document.createElement("a-image");v.setAttribute("id","footStartGame"),v.setAttribute("src","#hotspot"),v.setAttribute("position","-8.910 -3.00 -1.920"),v.setAttribute("rotation","-90 85.850 0"),v.setAttribute("scale","2 2 2"),v.setAttribute("opacity","0"),t.appendChild(v)}}}),AFRAME.registerSystem("effects",{init:function(){const s=document.querySelector("a-scene");if(!s.hasLoaded)return void s.addEventListener("loaded",this.init.bind(this));const t=s.object3D,o=s.camera,a=new Te(s.renderer),u=new Ve(t,o);Hm=new class extends class{constructor(s="Pass",t=new nu,i=fa){this.name=s,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(s){if(this.rtt===s){const t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!s}}setRenderer(s){this.renderer=s}isEnabled(){return this.enabled}setEnabled(s){this.enabled=s}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(s){let t=this.screen;null!==t?t.material=s:(t=new yo(function(){if(null===gs){const s=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(gs=new Hi).setAttribute?(gs.setAttribute("position",new ls(s,3)),gs.setAttribute("uv",new ls(t,2))):(gs.addAttribute("position",new ls(s,3)),gs.addAttribute("uv",new ls(t,2)))}return gs}(),s),t.frustumCulled=!1,null===this.scene&&(this.scene=new nu),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(s){this.fullscreenMaterial=s}getDepthTexture(){return null}setDepthTexture(s,t=3200){}render(s,t,i,o,a){throw new Error("Render method not implemented!")}setSize(s,t){}initialize(s,t,i){}dispose(){for(const s of Object.keys(this)){const t=this[s];if(null!==t&&"function"==typeof t.dispose){if(t instanceof nu||t===this.renderer)continue;this[s].dispose()}}}}{constructor({resolutionScale:s=.5,width:t=_s.AUTO_SIZE,height:i=_s.AUTO_SIZE,kernelSize:o=Ah.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Io(1,1,{minFilter:rn,magFilter:rn,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new _s(this,t,i,s);a.addEventListener("change",u=>this.setSize(a.baseWidth,a.baseHeight)),this.blurMaterial=new Di,this.ditheredBlurMaterial=new Di,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=o}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(s){this.resolution.preferredWidth=s}get height(){return this.resolution.height}set height(s){this.resolution.preferredHeight=s}get scale(){return this.blurMaterial.scale}set scale(s){this.blurMaterial.scale=s}getScale(){return this.blurMaterial.scale}setScale(s){this.blurMaterial.scale=s}getKernelSize(){return this.kernelSize}setKernelSize(s){this.kernelSize=s}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,t,i,o,a){const u=this.scene,d=this.camera,p=this.renderTargetA,v=this.renderTargetB,A=bE[this.kernelSize];let N,j,P=this.blurMaterial,U=t;for(this.fullscreenMaterial=P,N=0,j=A.length-1;N<j;++N){const te=0==(1&N)?p:v;P.kernel=A[N],P.inputBuffer=U.texture,s.setRenderTarget(te),s.render(u,d),U=te}this.dithering&&(P=this.ditheredBlurMaterial,this.fullscreenMaterial=P),P.kernel=A[N],P.inputBuffer=U.texture,s.setRenderTarget(this.renderToScreen?null:i),s.render(u,d)}setSize(s,t){const i=this.resolution;i.setBaseSize(s,t);const o=i.width,a=i.height;this.renderTargetA.setSize(o,a),this.renderTargetB.setSize(o,a),this.blurMaterial.setSize(o,a),this.ditheredBlurMaterial.setSize(o,a)}initialize(s,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==di?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):s.outputEncoding===Kn&&(this.renderTargetA.texture.encoding=Kn,this.renderTargetB.texture.encoding=Kn))}static get AUTO_SIZE(){return _s.AUTO_SIZE}}({height:480,kernelSize:Ah.VERY_LARGE}),a.addPass(u),a.addPass(Hm),Hm.enabled=!1,this.composer=a,this.t=0,this.dt=0,this.bind()},tick:function(s,t){this.t=s,this.dt=t,this.composer.passes[1].enabled=mA},bind:function(){const s=this.sceneEl.renderer,t=s.render,i=this;let o=!1;s.render=function(){o?t.apply(this,arguments):(o=!0,i.composer.render(i.dt),o=!1)}}}),AFRAME.components["look-controls"].Component.prototype.onTouchMove=function(s){this.touchStarted&&this.data.touchEnabled&&(this.pitchObject.rotation.x+=.6*Math.PI*(s.touches[0].pageY-this.touchStart.y)/this.el.sceneEl.canvas.clientHeight,this.yawObject.rotation.y+=Math.PI*(s.touches[0].pageX-this.touchStart.x)/this.el.sceneEl.canvas.clientWidth,this.pitchObject.rotation.x=Math.max(Math.PI/-2,Math.min(Math.PI/2,this.pitchObject.rotation.x)),this.touchStart={x:s.touches[0].pageX,y:s.touches[0].pageY})};var w1=[];pa(277)},52:ko=>{function oa(Ko,xr,ks,Is,k,ae,Ue){try{var b=Ko[ae](Ue),D=b.value}catch(B){return void ks(B)}b.done?xr(D):Promise.resolve(D).then(Is,k)}ko.exports=function(Ko){return function(){var xr=this,ks=arguments;return new Promise(function(Is,k){var ae=Ko.apply(xr,ks);function Ue(D){oa(ae,Is,k,Ue,b,"next",D)}function b(D){oa(ae,Is,k,Ue,b,"throw",D)}Ue(void 0)})}},ko.exports.default=ko.exports,ko.exports.__esModule=!0}},ko=>{ko(ko.s=608)}]);